<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>setup debug mode - rice - config file
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="rice Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>rice</h1><span class="desc">config file
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/54d8cb2b6f4dbf70c4c50f6d18bd0435c704124b.html">54d8cb2b6f4dbf70c4c50f6d18bd0435c704124b</a>
<b>parent</b> <a href="../commit/1b0ea743288135ec7aa0273a0c1775de8f36bb79.html">1b0ea743288135ec7aa0273a0c1775de8f36bb79</a>
<b>Author:</b> Mark Feller &lt;<a href="mailto:mfeller@recurly.com">mfeller@recurly.com</a>&gt;
<b>Date:</b>   Wed, 15 Jan 2020 14:35:40 -0700

setup debug mode

Signed-off-by: Mark Feller &lt;mfeller@recurly.com&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">install</a></td><td> | </td><td class="num">63</td><td><span class="i">+++++++++++++</span><span class="d">--------------------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 13 insertions(+), 50 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/install.html">install</a> b/<a href="../file/install.html">install</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -16,7 +16,7 @@ log() {
</a>     # &#39;$((${#1}%5+1))&#39;: Color the package name based on its length.
     # &#39;${2:+[m}&#39;:       If the 2nd argument exists, reset text formatting.
     printf &#39;\033[1;33m%s \033[m%s\033[m %s\n&#39; \
<a href="#h0-0-3" id="h0-0-3" class="d">-           &quot;${3:--&gt;}&quot; &quot;${2:+[1;36m}$1${2:+[m}&quot; &quot;$2&quot; | tee &quot;$logfile&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+           &quot;${3:--&gt;}&quot; &quot;${2:+[1;36m}$1${2:+[m}&quot; &quot;$2&quot;
</a> }
 
 die() {
<a href="#h0-1" id="h0-1" class="h">@@ -30,16 +30,6 @@ try() {
</a>     &quot;$@&quot; || die &quot;Fatal: $*&quot;
 }
 
<a href="#h0-1-3" id="h0-1-3" class="d">-prompt() {
</a><a href="#h0-1-4" id="h0-1-4" class="d">-    # Ask the user for some input.
</a><a href="#h0-1-5" id="h0-1-5" class="d">-    log &quot;$1&quot;
</a><a href="#h0-1-6" id="h0-1-6" class="d">-
</a><a href="#h0-1-7" id="h0-1-7" class="d">-    # POSIX &#39;read&#39; has none of the &quot;nice&quot; options like &#39;-n&#39;, &#39;-p&#39;
</a><a href="#h0-1-8" id="h0-1-8" class="d">-    # etc etc. This is the most basic usage of &#39;read&#39;.
</a><a href="#h0-1-9" id="h0-1-9" class="d">-    # &#39;_&#39; is used as &#39;dash&#39; errors when no variable is given to &#39;read&#39;.
</a><a href="#h0-1-10" id="h0-1-10" class="d">-    read -r &quot;$2&quot;
</a><a href="#h0-1-11" id="h0-1-11" class="d">-}
</a><a href="#h0-1-12" id="h0-1-12" class="d">-
</a> trim_string() {
     # Usage: trim_string &quot;   example   string    &quot;
     trim=${1#${1%%[![:space:]]*}}
<a href="#h0-2" id="h0-2" class="h">@@ -47,45 +37,22 @@ trim_string() {
</a>     printf &#39;%s\n&#39; &quot;$trim&quot;
 }
 
<a href="#h0-2-3" id="h0-2-3" class="d">-getuserandpass() {
</a><a href="#h0-2-4" id="h0-2-4" class="d">-    # Prompts user for new username an password.
</a><a href="#h0-2-5" id="h0-2-5" class="d">-    prompt &quot;Username?&quot; name
</a><a href="#h0-2-6" id="h0-2-6" class="d">-    while ! echo &quot;$name&quot; | grep &quot;^[a-z_][a-z0-9_-]*$&quot; &gt;/dev/null 2&gt;&amp;1; do
</a><a href="#h0-2-7" id="h0-2-7" class="d">-        prompt &quot;Username?&quot; name
</a><a href="#h0-2-8" id="h0-2-8" class="d">-    done
</a><a href="#h0-2-9" id="h0-2-9" class="d">-    prompt &quot;Enter a password for that user.&quot; pass1
</a><a href="#h0-2-10" id="h0-2-10" class="d">-    prompt &quot;Retype password.&quot; pass2
</a><a href="#h0-2-11" id="h0-2-11" class="d">-    while ! [ &quot;$pass1&quot; = &quot;$pass2&quot; ]; do
</a><a href="#h0-2-12" id="h0-2-12" class="d">-        unset pass2
</a><a href="#h0-2-13" id="h0-2-13" class="d">-        log &quot;Passwords do not match.&quot; &quot;&quot; &quot;!&gt;&quot;
</a><a href="#h0-2-14" id="h0-2-14" class="d">-        prompt &quot;Enter password again.&quot; pass2
</a><a href="#h0-2-15" id="h0-2-15" class="d">-    done
</a><a href="#h0-2-16" id="h0-2-16" class="d">-}
</a><a href="#h0-2-17" id="h0-2-17" class="d">-
</a><a href="#h0-2-18" id="h0-2-18" class="d">-adduserandpass() {
</a><a href="#h0-2-19" id="h0-2-19" class="d">-    # Adds user `$name` with password $pass1.
</a><a href="#h0-2-20" id="h0-2-20" class="d">-    useradd -m -g wheel -s /bin/zsh &quot;$name&quot; &gt;/dev/null 2&gt;&amp;1 ||
</a><a href="#h0-2-21" id="h0-2-21" class="d">-    usermod -a -G wheel &quot;$name&quot; &amp;&amp; mkdir -p /home/&quot;$name&quot; &amp;&amp; chown &quot;$name&quot;:wheel /home/&quot;$name&quot;
</a><a href="#h0-2-22" id="h0-2-22" class="d">-    echo &quot;$name:$pass1&quot; | chpasswd
</a><a href="#h0-2-23" id="h0-2-23" class="d">-    unset pass1 pass2
</a><a href="#h0-2-24" id="h0-2-24" class="d">-}
</a><a href="#h0-2-25" id="h0-2-25" class="d">-
</a> pre_install() {
     # Run any preinstall setup necessary
     log &quot;Enabling RPM Fustion...&quot;
     try dnf install -y \
         https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-&quot;$(rpm -E %fedora)&quot;.noarch.rpm \
         https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-&quot;$(rpm -E %fedora)&quot;.noarch.rpm \
<a href="#h0-2-32" id="h0-2-32" class="d">-        &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-2-33" id="h0-2-33" class="i">+        &gt; &quot;$debug&quot;
</a> 
     log &quot;Enabling Fedora community repos...&quot;
<a href="#h0-2-36" id="h0-2-36" class="d">-    try dnf install dnf-plugins-core &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-2-37" id="h0-2-37" class="i">+    try dnf install dnf-plugins-core &gt; &quot;$debug&quot;
</a> 
     log &quot;Enabling i3-gaps community repo...&quot;
<a href="#h0-2-40" id="h0-2-40" class="d">-    try dnf copr enable -y gregw/i3desktop &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-2-41" id="h0-2-41" class="i">+    try dnf copr enable -y gregw/i3desktop &gt; &quot;$debug&quot;
</a> 
     log &quot;Enabling alacritty community repo...&quot;
<a href="#h0-2-44" id="h0-2-44" class="d">-    try dnf copr enable -y pschyska/alacritty &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-2-45" id="h0-2-45" class="i">+    try dnf copr enable -y pschyska/alacritty &gt; &quot;$debug&quot;
</a> }
 
 install_package() {
<a href="#h0-3" id="h0-3" class="h">@@ -93,11 +60,11 @@ install_package() {
</a>     case $2 in
         G)
             log &quot;Installing go package $1...&quot;
<a href="#h0-3-3" id="h0-3-3" class="d">-            try go get -u &quot;$1&quot; &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+            try go get -u &quot;$1&quot; &gt; &quot;$debug&quot;
</a>             ;;
         *)
             log &quot;Installing $1...&quot;
<a href="#h0-3-8" id="h0-3-8" class="d">-            try dnf install -y &quot;$1&quot; &gt;&gt; &quot;$logfile&quot;
</a><a href="#h0-3-9" id="h0-3-9" class="i">+            try dnf install -y &quot;$1&quot; &gt; &quot;$debug&quot;
</a>             ;;
     esac
 }
<a href="#h0-4" id="h0-4" class="h">@@ -121,7 +88,7 @@ install_dots() {
</a>     # Clone and install dot files
     log &quot;Fetching dot files&quot;
     su $name
<a href="#h0-4-3" id="h0-4-3" class="d">-    git clone &quot;$dotrepo&quot; ~/.config/rice &gt;&gt; &quot;$logfile&quot; || log &quot;Dots have already been cloned&quot;
</a><a href="#h0-4-4" id="h0-4-4" class="i">+    git clone &quot;$dotrepo&quot; ~/.config/rice &gt; &quot;$debug&quot; || log &quot;Dots have already been cloned&quot;
</a>     (cd ~/.config/rice &amp;&amp; stow --target=&quot;$HOME&quot; --ignore=&#39;gitignore&#39; dots)
     exit
 }
<a href="#h0-5" id="h0-5" class="h">@@ -134,21 +101,17 @@ cleanup() {
</a> main() {
     # Set the git repo location for downloading dotfiles. This can be overridden
     # to install custom dotfiles.
<a href="#h0-5-3" id="h0-5-3" class="d">-    dotrepo=${dotrepo:-&quot;https://gitlab.com/mark.feller/rice.git&quot;}
</a><a href="#h0-5-4" id="h0-5-4" class="i">+    dotrepo=${RICE_REPO:-&quot;https://gitlab.com/mark.feller/rice.git&quot;}
</a> 
     # Set the package list file that contains all packages to be installed.
<a href="#h0-5-7" id="h0-5-7" class="d">-    pkgfile=${pkgfile:-&quot;https://gitlab.com/mark.feller/rice/raw/master/packages&quot;}
</a><a href="#h0-5-8" id="h0-5-8" class="i">+    pkgfile=${RICE_PKG:-&quot;https://gitlab.com/mark.feller/rice/raw/master/packages&quot;}
</a> 
<a href="#h0-5-10" id="h0-5-10" class="d">-    # Set the log output file
</a><a href="#h0-5-11" id="h0-5-11" class="d">-    logfile=${logfile:-&quot;/var/log/rice.log&quot;}
</a><a href="#h0-5-12" id="h0-5-12" class="i">+    # Setup debug mode
</a><a href="#h0-5-13" id="h0-5-13" class="i">+    debug=&quot;/dev/null&quot;
</a><a href="#h0-5-14" id="h0-5-14" class="i">+    [ &quot;$RICE_DEBUG&quot; != 1 ] || debug=&quot;/dev/stdout&quot;
</a> 
     trap cleanup INT
 
<a href="#h0-5-18" id="h0-5-18" class="d">-    # Setup user
</a><a href="#h0-5-19" id="h0-5-19" class="d">-    try getuserandpass
</a><a href="#h0-5-20" id="h0-5-20" class="d">-    try adduserandpass
</a><a href="#h0-5-21" id="h0-5-21" class="d">-
</a><a href="#h0-5-22" id="h0-5-22" class="d">-    # Install packages
</a>     pre_install
     install_packages
     install_dots
</pre>
</div>
</body>
</html>
