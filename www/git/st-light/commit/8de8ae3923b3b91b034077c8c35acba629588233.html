<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Unset mode when clearing regions - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8de8ae3923b3b91b034077c8c35acba629588233.html">8de8ae3923b3b91b034077c8c35acba629588233</a>
<b>parent</b> <a href="../commit/ec3268961d1dc4072f6caa6f97db5436da2ff411.html">ec3268961d1dc4072f6caa6f97db5436da2ff411</a>
<b>Author:</b> Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga@shike2.com">k0ga@shike2.com</a>&gt;
<b>Date:</b>   Thu,  7 Aug 2014 10:11:38 +0200

Unset mode when clearing regions

tclearregion() was clearing regions using spaces and the current
attributes of the terminal. It was correct with all the modes excepct
underline, because they didn&#39;t affect the space character, but in
the case of underline it was a problem. A easy way of seeing this
problem is writing this in the last line of the terminal:

	tput smul ; echo first; tput rmul; echo second; echo third

Fist was underlined, and second and third were not underlined, but
the spaces at the right of second was underlined becuause in the
previous scrool underline mode was set.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++</span><span class="d">--</span></td></tr>
</table></pre><pre>1 file changed, 6 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1553,6 +1553,7 @@ tsetchar(char *c, Glyph *attr, int x, int y) {
</a> void
 tclearregion(int x1, int y1, int x2, int y2) {
 	int x, y, temp;
<a href="#h0-0-3" id="h0-0-3" class="i">+	Glyph *gp;
</a> 
 	if(x1 &gt; x2)
 		temp = x1, x1 = x2, x2 = temp;
<a href="#h0-1" id="h0-1" class="h">@@ -1567,10 +1568,13 @@ tclearregion(int x1, int y1, int x2, int y2) {
</a> 	for(y = y1; y &lt;= y2; y++) {
 		term.dirty[y] = 1;
 		for(x = x1; x &lt;= x2; x++) {
<a href="#h0-1-3" id="h0-1-3" class="i">+			gp = &amp;term.line[y][x];
</a> 			if(selected(x, y))
 				selclear(NULL);
<a href="#h0-1-6" id="h0-1-6" class="d">-			term.line[y][x] = term.c.attr;
</a><a href="#h0-1-7" id="h0-1-7" class="d">-			memcpy(term.line[y][x].c, &quot; &quot;, 2);
</a><a href="#h0-1-8" id="h0-1-8" class="i">+			gp-&gt;fg = term.c.attr.fg;
</a><a href="#h0-1-9" id="h0-1-9" class="i">+			gp-&gt;bg = term.c.attr.bg;
</a><a href="#h0-1-10" id="h0-1-10" class="i">+			gp-&gt;mode = 0;
</a><a href="#h0-1-11" id="h0-1-11" class="i">+			memcpy(gp-&gt;c, &quot; &quot;, 2);
</a> 		}
 	}
 }
</pre>
</div>
</body>
</html>
