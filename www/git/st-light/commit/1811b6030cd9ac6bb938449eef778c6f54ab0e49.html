<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Add enumeration for sel.mode - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/1811b6030cd9ac6bb938449eef778c6f54ab0e49.html">1811b6030cd9ac6bb938449eef778c6f54ab0e49</a>
<b>parent</b> <a href="../commit/22571ea4e8729efee6940b704666566b46e42e76.html">22571ea4e8729efee6940b704666566b46e42e76</a>
<b>Author:</b> noname &lt;<a href="mailto:noname@inventati.org">noname@inventati.org</a>&gt;
<b>Date:</b>   Fri,  1 May 2015 17:13:13 +0000

Add enumeration for sel.mode

This patch also prevents sel.mode from increasing beyond 2. It is almost
impossible, but sel.mode may overflow if mouse is moved around for too
long while selecting.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">23</td><td><span class="i">++++++++++++++</span><span class="d">---------</span></td></tr>
</table></pre><pre>1 file changed, 14 insertions(+), 9 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -162,6 +162,12 @@ enum window_state {
</a> 	WIN_FOCUSED = 2
 };
 
<a href="#h0-0-3" id="h0-0-3" class="i">+enum selection_mode {
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	SEL_IDLE = 0,
</a><a href="#h0-0-5" id="h0-0-5" class="i">+	SEL_EMPTY = 1,
</a><a href="#h0-0-6" id="h0-0-6" class="i">+	SEL_READY = 2
</a><a href="#h0-0-7" id="h0-0-7" class="i">+};
</a><a href="#h0-0-8" id="h0-0-8" class="i">+
</a> enum selection_type {
 	SEL_REGULAR = 1,
 	SEL_RECTANGULAR = 2
<a href="#h0-1" id="h0-1" class="h">@@ -643,7 +649,7 @@ void
</a> selinit(void) {
 	memset(&amp;sel.tclick1, 0, sizeof(sel.tclick1));
 	memset(&amp;sel.tclick2, 0, sizeof(sel.tclick2));
<a href="#h0-1-3" id="h0-1-3" class="d">-	sel.mode = 0;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	sel.mode = SEL_IDLE;
</a> 	sel.ob.x = -1;
 	sel.primary = NULL;
 	sel.clipboard = NULL;
<a href="#h0-2" id="h0-2" class="h">@@ -897,7 +903,7 @@ bpress(XEvent *e) {
</a> 
 		/* Clear previous selection, logically and visually. */
 		selclear(NULL);
<a href="#h0-2-3" id="h0-2-3" class="d">-		sel.mode = 1;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+		sel.mode = SEL_EMPTY;
</a> 		sel.type = SEL_REGULAR;
 		sel.oe.x = sel.ob.x = x2col(e-&gt;xbutton.x);
 		sel.oe.y = sel.ob.y = y2row(e-&gt;xbutton.y);
<a href="#h0-3" id="h0-3" class="h">@@ -920,7 +926,7 @@ bpress(XEvent *e) {
</a> 		 * make clicks visible
 		 */
 		if(sel.snap != 0) {
<a href="#h0-3-3" id="h0-3-3" class="d">-			sel.mode++;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			sel.mode = SEL_READY;
</a> 			tsetdirt(sel.nb.y, sel.ne.y);
 		}
 		sel.tclick2 = sel.tclick1;
<a href="#h0-4" id="h0-4" class="h">@@ -1142,13 +1148,12 @@ brelease(XEvent *e) {
</a> 	if(e-&gt;xbutton.button == Button2) {
 		selpaste(NULL);
 	} else if(e-&gt;xbutton.button == Button1) {
<a href="#h0-4-3" id="h0-4-3" class="d">-		if(sel.mode &lt; 2) {
</a><a href="#h0-4-4" id="h0-4-4" class="d">-			selclear(NULL);
</a><a href="#h0-4-5" id="h0-4-5" class="d">-		} else {
</a><a href="#h0-4-6" id="h0-4-6" class="i">+		if(sel.mode == SEL_READY) {
</a> 			getbuttoninfo(e);
 			selcopy(e-&gt;xbutton.time);
<a href="#h0-4-9" id="h0-4-9" class="d">-		}
</a><a href="#h0-4-10" id="h0-4-10" class="d">-		sel.mode = 0;
</a><a href="#h0-4-11" id="h0-4-11" class="i">+		} else
</a><a href="#h0-4-12" id="h0-4-12" class="i">+			selclear(NULL);
</a><a href="#h0-4-13" id="h0-4-13" class="i">+		sel.mode = SEL_IDLE;
</a> 		tsetdirt(sel.nb.y, sel.ne.y);
 	}
 }
<a href="#h0-5" id="h0-5" class="h">@@ -1165,7 +1170,7 @@ bmotion(XEvent *e) {
</a> 	if(!sel.mode)
 		return;
 
<a href="#h0-5-3" id="h0-5-3" class="d">-	sel.mode++;
</a><a href="#h0-5-4" id="h0-5-4" class="i">+	sel.mode = SEL_READY;
</a> 	oldey = sel.oe.y;
 	oldex = sel.oe.x;
 	oldsby = sel.nb.y;
</pre>
</div>
</body>
</html>
