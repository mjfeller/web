<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>error message style and use strerror in a few places - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/041912a791e8c2f4d5d2415b16210d29d7e701c5.html">041912a791e8c2f4d5d2415b16210d29d7e701c5</a>
<b>parent</b> <a href="../commit/bd3f7fd84270025696790512cf3c2dafaf5bc77f.html">bd3f7fd84270025696790512cf3c2dafaf5bc77f</a>
<b>Author:</b> Hiltjo Posthuma &lt;<a href="mailto:hiltjo@codemadness.org">hiltjo@codemadness.org</a>&gt;
<b>Date:</b>   Thu, 29 Mar 2018 18:30:05 +0200

error message style and use strerror in a few places

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">x.c</a></td><td> | </td><td class="num">27</td><td><span class="i">+++++++++++++</span><span class="d">--------------</span></td></tr>
</table></pre><pre>2 files changed, 24 insertions(+), 24 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -256,10 +256,10 @@ xwrite(int fd, const char *s, size_t len)
</a> void *
 xmalloc(size_t len)
 {
<a href="#h0-0-3" id="h0-0-3" class="d">-	void *p = malloc(len);
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	void *p;
</a> 
<a href="#h0-0-6" id="h0-0-6" class="d">-	if (!p)
</a><a href="#h0-0-7" id="h0-0-7" class="d">-		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-0-8" id="h0-0-8" class="i">+	if (!(p = malloc(len)))
</a><a href="#h0-0-9" id="h0-0-9" class="i">+		die(&quot;malloc: %s\n&quot;, strerror(errno));
</a> 
 	return p;
 }
<a href="#h0-1" id="h0-1" class="h">@@ -268,7 +268,7 @@ void *
</a> xrealloc(void *p, size_t len)
 {
 	if ((p = realloc(p, len)) == NULL)
<a href="#h0-1-3" id="h0-1-3" class="d">-		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+		die(&quot;realloc: %s\n&quot;, strerror(errno));
</a> 
 	return p;
 }
<a href="#h0-2" id="h0-2" class="h">@@ -277,7 +277,7 @@ char *
</a> xstrdup(char *s)
 {
 	if ((s = strdup(s)) == NULL)
<a href="#h0-2-3" id="h0-2-3" class="d">-		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-2-4" id="h0-2-4" class="i">+		die(&quot;strdup: %s\n&quot;, strerror(errno));
</a> 
 	return s;
 }
<a href="#h0-3" id="h0-3" class="h">@@ -687,7 +687,7 @@ execsh(char *cmd, char **args)
</a> 	errno = 0;
 	if ((pw = getpwuid(getuid())) == NULL) {
 		if (errno)
<a href="#h0-3-3" id="h0-3-3" class="d">-			die(&quot;getpwuid:%s\n&quot;, strerror(errno));
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			die(&quot;getpwuid: %s\n&quot;, strerror(errno));
</a> 		else
 			die(&quot;who are you?\n&quot;);
 	}
<a href="#h0-4" id="h0-4" class="h">@@ -730,7 +730,7 @@ sigchld(int a)
</a> 	pid_t p;
 
 	if ((p = waitpid(pid, &amp;stat, WNOHANG)) &lt; 0)
<a href="#h0-4-3" id="h0-4-3" class="d">-		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
</a><a href="#h0-4-4" id="h0-4-4" class="i">+		die(&quot;waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
</a> 
 	if (pid != p)
 		return;
<a href="#h0-5" id="h0-5" class="h">@@ -781,7 +781,8 @@ ttynew(char *line, char *cmd, char *out, char **args)
</a> 
 	if (line) {
 		if ((cmdfd = open(line, O_RDWR)) &lt; 0)
<a href="#h0-5-3" id="h0-5-3" class="d">-			die(&quot;open line failed: %s\n&quot;, strerror(errno));
</a><a href="#h0-5-4" id="h0-5-4" class="i">+			die(&quot;open line &#39;%s&#39; failed: %s\n&quot;,
</a><a href="#h0-5-5" id="h0-5-5" class="i">+			    line, strerror(errno));
</a> 		dup2(cmdfd, 0);
 		stty(args);
 		return cmdfd;
<a href="#h0-6" id="h0-6" class="h">@@ -793,7 +794,7 @@ ttynew(char *line, char *cmd, char *out, char **args)
</a> 
 	switch (pid = fork()) {
 	case -1:
<a href="#h0-6-3" id="h0-6-3" class="d">-		die(&quot;fork failed\n&quot;);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+		die(&quot;fork failed: %s\n&quot;, strerror(errno));
</a> 		break;
 	case 0:
 		close(iofd);
<a href="#h0-7" id="h0-7" class="h">@@ -826,7 +827,7 @@ ttyread(void)
</a> 
 	/* append read bytes to unprocessed bytes */
 	if ((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
<a href="#h0-7-3" id="h0-7-3" class="d">-		die(&quot;Couldn&#39;t read from shell: %s\n&quot;, strerror(errno));
</a><a href="#h0-7-4" id="h0-7-4" class="i">+		die(&quot;couldn&#39;t read from shell: %s\n&quot;, strerror(errno));
</a> 	buflen += ret;
 
 	written = twrite(buf, buflen, 0);
<b>diff --git a/<a id="h1" href="../file/x.c.html">x.c</a> b/<a href="../file/x.c.html">x.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -742,9 +742,9 @@ xloadcols(void)
</a> 	for (i = 0; i &lt; dc.collen; i++)
 		if (!xloadcolor(i, NULL, &amp;dc.col[i])) {
 			if (colorname[i])
<a href="#h1-0-3" id="h1-0-3" class="d">-				die(&quot;Could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
</a><a href="#h1-0-4" id="h1-0-4" class="i">+				die(&quot;could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
</a> 			else
<a href="#h1-0-6" id="h1-0-6" class="d">-				die(&quot;Could not allocate color %d\n&quot;, i);
</a><a href="#h1-0-7" id="h1-0-7" class="i">+				die(&quot;could not allocate color %d\n&quot;, i);
</a> 		}
 	loaded = 1;
 }
<a href="#h1-1" id="h1-1" class="h">@@ -869,7 +869,7 @@ xloadfont(Font *f, FcPattern *pattern)
</a> 		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;slant&quot;, 0,
 		    &amp;haveattr) != XftResultMatch) || haveattr &lt; wantattr) {
 			f-&gt;badslant = 1;
<a href="#h1-1-3" id="h1-1-3" class="d">-			fputs(&quot;st: font slant does not match\n&quot;, stderr);
</a><a href="#h1-1-4" id="h1-1-4" class="i">+			fputs(&quot;font slant does not match\n&quot;, stderr);
</a> 		}
 	}
 
<a href="#h1-2" id="h1-2" class="h">@@ -878,7 +878,7 @@ xloadfont(Font *f, FcPattern *pattern)
</a> 		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;weight&quot;, 0,
 		    &amp;haveattr) != XftResultMatch) || haveattr != wantattr) {
 			f-&gt;badweight = 1;
<a href="#h1-2-3" id="h1-2-3" class="d">-			fputs(&quot;st: font weight does not match\n&quot;, stderr);
</a><a href="#h1-2-4" id="h1-2-4" class="i">+			fputs(&quot;font weight does not match\n&quot;, stderr);
</a> 		}
 	}
 
<a href="#h1-3" id="h1-3" class="h">@@ -906,14 +906,13 @@ xloadfonts(char *fontstr, double fontsize)
</a> 	FcPattern *pattern;
 	double fontval;
 
<a href="#h1-3-3" id="h1-3-3" class="d">-	if (fontstr[0] == &#39;-&#39;) {
</a><a href="#h1-3-4" id="h1-3-4" class="i">+	if (fontstr[0] == &#39;-&#39;)
</a> 		pattern = XftXlfdParse(fontstr, False, False);
<a href="#h1-3-6" id="h1-3-6" class="d">-	} else {
</a><a href="#h1-3-7" id="h1-3-7" class="i">+	else
</a> 		pattern = FcNameParse((FcChar8 *)fontstr);
<a href="#h1-3-9" id="h1-3-9" class="d">-	}
</a> 
 	if (!pattern)
<a href="#h1-3-12" id="h1-3-12" class="d">-		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h1-3-13" id="h1-3-13" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a> 
 	if (fontsize &gt; 1) {
 		FcPatternDel(pattern, FC_PIXEL_SIZE);
<a href="#h1-4" id="h1-4" class="h">@@ -939,7 +938,7 @@ xloadfonts(char *fontstr, double fontsize)
</a> 	}
 
 	if (xloadfont(&amp;dc.font, pattern))
<a href="#h1-4-3" id="h1-4-3" class="d">-		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h1-4-4" id="h1-4-4" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a> 
 	if (usedfontsize &lt; 0) {
 		FcPatternGetDouble(dc.font.match-&gt;pattern,
<a href="#h1-5" id="h1-5" class="h">@@ -956,17 +955,17 @@ xloadfonts(char *fontstr, double fontsize)
</a> 	FcPatternDel(pattern, FC_SLANT);
 	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
 	if (xloadfont(&amp;dc.ifont, pattern))
<a href="#h1-5-3" id="h1-5-3" class="d">-		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h1-5-4" id="h1-5-4" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a> 
 	FcPatternDel(pattern, FC_WEIGHT);
 	FcPatternAddInteger(pattern, FC_WEIGHT, FC_WEIGHT_BOLD);
 	if (xloadfont(&amp;dc.ibfont, pattern))
<a href="#h1-5-9" id="h1-5-9" class="d">-		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h1-5-10" id="h1-5-10" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a> 
 	FcPatternDel(pattern, FC_SLANT);
 	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ROMAN);
 	if (xloadfont(&amp;dc.bfont, pattern))
<a href="#h1-5-15" id="h1-5-15" class="d">-		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h1-5-16" id="h1-5-16" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a> 
 	FcPatternDestroy(pattern);
 }
<a href="#h1-6" id="h1-6" class="h">@@ -1003,13 +1002,13 @@ xinit(int cols, int rows)
</a> 	XColor xmousefg, xmousebg;
 
 	if (!(xw.dpy = XOpenDisplay(NULL)))
<a href="#h1-6-3" id="h1-6-3" class="d">-		die(&quot;Can&#39;t open display\n&quot;);
</a><a href="#h1-6-4" id="h1-6-4" class="i">+		die(&quot;can&#39;t open display\n&quot;);
</a> 	xw.scr = XDefaultScreen(xw.dpy);
 	xw.vis = XDefaultVisual(xw.dpy, xw.scr);
 
 	/* font */
 	if (!FcInit())
<a href="#h1-6-10" id="h1-6-10" class="d">-		die(&quot;Could not init fontconfig.\n&quot;);
</a><a href="#h1-6-11" id="h1-6-11" class="i">+		die(&quot;could not init fontconfig.\n&quot;);
</a> 
 	usedfont = (opt_font == NULL)? font : opt_font;
 	xloadfonts(usedfont, 0);
</pre>
</div>
</body>
</html>
