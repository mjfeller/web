<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Apply ATTR_REVERSE after ATTR_FAINT - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/e829e13bb1a830e0cdce749ea0865cd93af1846c.html">e829e13bb1a830e0cdce749ea0865cd93af1846c</a>
<b>parent</b> <a href="../commit/c1d23afa9c44cc29818c538126790ae90a64a3c5.html">c1d23afa9c44cc29818c538126790ae90a64a3c5</a>
<b>Author:</b> Benno Fünfstück &lt;<a href="mailto:benno.fuenfstueck@gmail.com">benno.fuenfstueck@gmail.com</a>&gt;
<b>Date:</b>   Tue, 26 Dec 2017 16:38:27 +0100

Apply ATTR_REVERSE after ATTR_FAINT

An example where the new behaviour makes more sense:

Suppose some text is formatted with ATTR_FAINT for red for the foreground, so it
is rendered in a dark red. In that case, when selected with the mouse, the
intended behaviour is that foreground and background color are swapped: so the
selection should be rendered in dark red and the text in the default background
color.

Before this patch, what happened was that the selection would be in normal red
and the text in the darkened background color, making it almost unreadable.

For an example application that uses the FAINT attribute, try dmesg from
util-linux with color support, it uses FAINT for segfault messages.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">x.c</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++</span><span class="d">------</span></td></tr>
</table></pre><pre>1 file changed, 7 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/x.c.html">x.c</a> b/<a href="../file/x.c.html">x.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1189,12 +1189,6 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 		}
 	}
 
<a href="#h0-0-3" id="h0-0-3" class="d">-	if (base.mode &amp; ATTR_REVERSE) {
</a><a href="#h0-0-4" id="h0-0-4" class="d">-		temp = fg;
</a><a href="#h0-0-5" id="h0-0-5" class="d">-		fg = bg;
</a><a href="#h0-0-6" id="h0-0-6" class="d">-		bg = temp;
</a><a href="#h0-0-7" id="h0-0-7" class="d">-	}
</a><a href="#h0-0-8" id="h0-0-8" class="d">-
</a> 	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
 		colfg.red = fg-&gt;color.red / 2;
 		colfg.green = fg-&gt;color.green / 2;
<a href="#h0-1" id="h0-1" class="h">@@ -1203,6 +1197,13 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 		fg = &amp;revfg;
 	}
 
<a href="#h0-1-3" id="h0-1-3" class="i">+
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	if (base.mode &amp; ATTR_REVERSE) {
</a><a href="#h0-1-5" id="h0-1-5" class="i">+		temp = fg;
</a><a href="#h0-1-6" id="h0-1-6" class="i">+		fg = bg;
</a><a href="#h0-1-7" id="h0-1-7" class="i">+		bg = temp;
</a><a href="#h0-1-8" id="h0-1-8" class="i">+	}
</a><a href="#h0-1-9" id="h0-1-9" class="i">+
</a> 	if (base.mode &amp; ATTR_BLINK &amp;&amp; term.mode &amp; MODE_BLINK)
 		fg = bg;
 
</pre>
</div>
</body>
</html>
