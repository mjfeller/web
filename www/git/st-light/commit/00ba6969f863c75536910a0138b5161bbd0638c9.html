<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>s/xw.dis/xw.dpy/ - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/00ba6969f863c75536910a0138b5161bbd0638c9.html">00ba6969f863c75536910a0138b5161bbd0638c9</a>
<b>parent</b> <a href="../commit/b61925b5d6fd8af0ad0ccc922db60dff1746cfe2.html">b61925b5d6fd8af0ad0ccc922db60dff1746cfe2</a>
<b>Author:</b> Aur√©lien Aptel &lt;<a href="mailto:aurelien.aptel@gmail.com">aurelien.aptel@gmail.com</a>&gt;
<b>Date:</b>   Fri, 26 Nov 2010 22:11:31 +0100

s/xw.dis/xw.dpy/

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">109</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 55 insertions(+), 54 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -110,7 +110,7 @@ typedef struct {
</a> 
 /* Purely graphic info */
 typedef struct {
<a href="#h0-0-3" id="h0-0-3" class="d">-	Display* dis;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	Display* dpy;
</a> 	Colormap cmap;
 	Window win;
 	Pixmap buf;
<a href="#h0-1" id="h0-1" class="h">@@ -437,7 +437,7 @@ selnotify(XEvent *e) {
</a> 
 	ofs = 0;
 	do {
<a href="#h0-1-3" id="h0-1-3" class="d">-		if(XGetWindowProperty(xw.dis, xw.win, XA_PRIMARY, ofs, BUFSIZ/4,
</a><a href="#h0-1-4" id="h0-1-4" class="i">+		if(XGetWindowProperty(xw.dpy, xw.win, XA_PRIMARY, ofs, BUFSIZ/4,
</a> 					False, AnyPropertyType, &amp;type, &amp;format,
 					&amp;nitems, &amp;rem, &amp;data)) {
 			fprintf(stderr, &quot;Clipboard allocation failed\n&quot;);
<a href="#h0-2" id="h0-2" class="h">@@ -452,7 +452,7 @@ selnotify(XEvent *e) {
</a> 
 void
 selpaste() {
<a href="#h0-2-3" id="h0-2-3" class="d">-	XConvertSelection(xw.dis, XA_PRIMARY, XA_STRING, XA_PRIMARY, xw.win, CurrentTime);
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	XConvertSelection(xw.dpy, XA_PRIMARY, XA_STRING, XA_PRIMARY, xw.win, CurrentTime);
</a> }
 
 void
<a href="#h0-3" id="h0-3" class="h">@@ -470,7 +470,7 @@ selrequest(XEvent *e) {
</a> 	/* reject */
 	xev.property = None;
 
<a href="#h0-3-3" id="h0-3-3" class="d">-	xa_targets = XInternAtom(xw.dis, &quot;TARGETS&quot;, 0);
</a><a href="#h0-3-4" id="h0-3-4" class="i">+	xa_targets = XInternAtom(xw.dpy, &quot;TARGETS&quot;, 0);
</a> 	if(xsre-&gt;target == xa_targets) {
 		/* respond with the supported type */
 		Atom string = XA_STRING;
<a href="#h0-4" id="h0-4" class="h">@@ -498,12 +498,12 @@ xsetsel(char *str) {
</a> 	free(sel.clip);
 	sel.clip = str;
 
<a href="#h0-4-3" id="h0-4-3" class="d">-	XSetSelectionOwner(xw.dis, XA_PRIMARY, xw.win, CurrentTime);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+	XSetSelectionOwner(xw.dpy, XA_PRIMARY, xw.win, CurrentTime);
</a> 
<a href="#h0-4-6" id="h0-4-6" class="d">-	clipboard = XInternAtom(xw.dis, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h0-4-7" id="h0-4-7" class="d">-	XSetSelectionOwner(xw.dis, clipboard, xw.win, CurrentTime);
</a><a href="#h0-4-8" id="h0-4-8" class="i">+	clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h0-4-9" id="h0-4-9" class="i">+	XSetSelectionOwner(xw.dpy, clipboard, xw.win, CurrentTime);
</a> 
<a href="#h0-4-11" id="h0-4-11" class="d">-	XFlush(xw.dis);
</a><a href="#h0-4-12" id="h0-4-12" class="i">+	XFlush(xw.dpy);
</a> }
 
 /* TODO: doubleclick to select word */
<a href="#h0-5" id="h0-5" class="h">@@ -1185,7 +1185,7 @@ tputc(char *c) {
</a> 			if(ascii == &#39;\a&#39; || term.titlelen+1 &gt;= ESC_TITLE_SIZ) {
 				term.esc = 0;
 				term.title[term.titlelen] = &#39;\0&#39;;
<a href="#h0-5-3" id="h0-5-3" class="d">-				XStoreName(xw.dis, xw.win, term.title);
</a><a href="#h0-5-4" id="h0-5-4" class="i">+				XStoreName(xw.dpy, xw.win, term.title);
</a> 			} else {
 				term.title[term.titlelen++] = ascii;
 			}
<a href="#h0-6" id="h0-6" class="h">@@ -1360,22 +1360,22 @@ xresize(int col, int row) {
</a> 	oldh = xw.bufh;
 	xw.bufw = MAX(1, col * xw.cw);
 	xw.bufh = MAX(1, row * xw.ch);
<a href="#h0-6-3" id="h0-6-3" class="d">-	newbuf = XCreatePixmap(xw.dis, xw.win, xw.bufw, xw.bufh, XDefaultDepth(xw.dis, xw.scr));
</a><a href="#h0-6-4" id="h0-6-4" class="d">-	XCopyArea(xw.dis, xw.buf, newbuf, dc.gc, 0, 0, xw.bufw, xw.bufh, 0, 0);
</a><a href="#h0-6-5" id="h0-6-5" class="d">-	XFreePixmap(xw.dis, xw.buf);
</a><a href="#h0-6-6" id="h0-6-6" class="d">-	XSetForeground(xw.dis, dc.gc, dc.col[DefaultBG]);
</a><a href="#h0-6-7" id="h0-6-7" class="i">+	newbuf = XCreatePixmap(xw.dpy, xw.win, xw.bufw, xw.bufh, XDefaultDepth(xw.dpy, xw.scr));
</a><a href="#h0-6-8" id="h0-6-8" class="i">+	XCopyArea(xw.dpy, xw.buf, newbuf, dc.gc, 0, 0, xw.bufw, xw.bufh, 0, 0);
</a><a href="#h0-6-9" id="h0-6-9" class="i">+	XFreePixmap(xw.dpy, xw.buf);
</a><a href="#h0-6-10" id="h0-6-10" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[DefaultBG]);
</a> 	if(xw.bufw &gt; oldw)
<a href="#h0-6-12" id="h0-6-12" class="d">-		XFillRectangle(xw.dis, newbuf, dc.gc, oldw, 0,
</a><a href="#h0-6-13" id="h0-6-13" class="i">+		XFillRectangle(xw.dpy, newbuf, dc.gc, oldw, 0,
</a> 				xw.bufw-oldw, MIN(xw.bufh, oldh));
 	else if(xw.bufw &lt; oldw &amp;&amp; (BORDER &gt; 0 || xw.w &gt; xw.bufw))
<a href="#h0-6-16" id="h0-6-16" class="d">-		XClearArea(xw.dis, xw.win, BORDER+xw.bufw, BORDER,
</a><a href="#h0-6-17" id="h0-6-17" class="i">+		XClearArea(xw.dpy, xw.win, BORDER+xw.bufw, BORDER,
</a> 				xw.w-xw.bufh-BORDER, BORDER+MIN(xw.bufh, oldh),
 				False);
 	if(xw.bufh &gt; oldh)
<a href="#h0-6-21" id="h0-6-21" class="d">-		XFillRectangle(xw.dis, newbuf, dc.gc, 0, oldh,
</a><a href="#h0-6-22" id="h0-6-22" class="i">+		XFillRectangle(xw.dpy, newbuf, dc.gc, 0, oldh,
</a> 				xw.bufw, xw.bufh-oldh);
 	else if(xw.bufh &lt; oldh &amp;&amp; (BORDER &gt; 0 || xw.h &gt; xw.bufh))
<a href="#h0-6-25" id="h0-6-25" class="d">-		XClearArea(xw.dis, xw.win, BORDER, BORDER+xw.bufh,
</a><a href="#h0-6-26" id="h0-6-26" class="i">+		XClearArea(xw.dpy, xw.win, BORDER, BORDER+xw.bufh,
</a> 				xw.w-2*BORDER, xw.h-xw.bufh-BORDER,
 				False);
 	xw.buf = newbuf;
<a href="#h0-7" id="h0-7" class="h">@@ -1385,10 +1385,10 @@ void
</a> xloadcols(void) {
 	int i, r, g, b;
 	XColor color;
<a href="#h0-7-3" id="h0-7-3" class="d">-	unsigned long white = WhitePixel(xw.dis, xw.scr);
</a><a href="#h0-7-4" id="h0-7-4" class="i">+	unsigned long white = WhitePixel(xw.dpy, xw.scr);
</a> 
 	for(i = 0; i &lt; 16; i++) {
<a href="#h0-7-7" id="h0-7-7" class="d">-		if (!XAllocNamedColor(xw.dis, xw.cmap, colorname[i], &amp;color, &amp;color)) {
</a><a href="#h0-7-8" id="h0-7-8" class="i">+		if (!XAllocNamedColor(xw.dpy, xw.cmap, colorname[i], &amp;color, &amp;color)) {
</a> 			dc.col[i] = white;
 			fprintf(stderr, &quot;Could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
 		} else
<a href="#h0-8" id="h0-8" class="h">@@ -1402,7 +1402,7 @@ xloadcols(void) {
</a> 				color.red = r == 0 ? 0 : 0x3737 + 0x2828 * r;
 				color.green = g == 0 ? 0 : 0x3737 + 0x2828 * g;
 				color.blue = b == 0 ? 0 : 0x3737 + 0x2828 * b;
<a href="#h0-8-3" id="h0-8-3" class="d">-				if (!XAllocColor(xw.dis, xw.cmap, &amp;color)) {
</a><a href="#h0-8-4" id="h0-8-4" class="i">+				if (!XAllocColor(xw.dpy, xw.cmap, &amp;color)) {
</a> 					dc.col[i] = white;
 					fprintf(stderr, &quot;Could not allocate color %d\n&quot;, i);
 				} else
<a href="#h0-9" id="h0-9" class="h">@@ -1412,7 +1412,7 @@ xloadcols(void) {
</a> 
 	for(r = 0; r &lt; 24; r++, i++) {
 		color.red = color.green = color.blue = 0x0808 + 0x0a0a * r;
<a href="#h0-9-3" id="h0-9-3" class="d">-		if (!XAllocColor(xw.dis, xw.cmap, &amp;color)) {
</a><a href="#h0-9-4" id="h0-9-4" class="i">+		if (!XAllocColor(xw.dpy, xw.cmap, &amp;color)) {
</a> 			dc.col[i] = white;
 			fprintf(stderr, &quot;Could not allocate color %d\n&quot;, i);
 		} else
<a href="#h0-10" id="h0-10" class="h">@@ -1422,8 +1422,8 @@ xloadcols(void) {
</a> 
 void
 xclear(int x1, int y1, int x2, int y2) {
<a href="#h0-10-3" id="h0-10-3" class="d">-	XSetForeground(xw.dis, dc.gc, dc.col[DefaultBG]);
</a><a href="#h0-10-4" id="h0-10-4" class="d">-	XFillRectangle(xw.dis, xw.buf, dc.gc,
</a><a href="#h0-10-5" id="h0-10-5" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[DefaultBG]);
</a><a href="#h0-10-6" id="h0-10-6" class="i">+	XFillRectangle(xw.dpy, xw.buf, dc.gc,
</a> 	               x1 * xw.cw, y1 * xw.ch,
 	               (x2-x1+1) * xw.cw, (y2-y1+1) * xw.ch);
 }
<a href="#h0-11" id="h0-11" class="h">@@ -1442,7 +1442,7 @@ xhints(void)
</a> 		.base_height = 2*BORDER,
 		.base_width = 2*BORDER,
 	};
<a href="#h0-11-3" id="h0-11-3" class="d">-	XSetWMProperties(xw.dis, xw.win, NULL, NULL, NULL, 0, &amp;size, &amp;wm, &amp;class);
</a><a href="#h0-11-4" id="h0-11-4" class="i">+	XSetWMProperties(xw.dpy, xw.win, NULL, NULL, NULL, 0, &amp;size, &amp;wm, &amp;class);
</a> }
 
 XFontSet
<a href="#h0-12" id="h0-12" class="h">@@ -1453,7 +1453,7 @@ xinitfont(char *fontstr)
</a> 	int n;
 
 	missing = NULL;
<a href="#h0-12-3" id="h0-12-3" class="d">-	set = XCreateFontSet(xw.dis, fontstr, &amp;missing, &amp;n, &amp;def);
</a><a href="#h0-12-4" id="h0-12-4" class="i">+	set = XCreateFontSet(xw.dpy, fontstr, &amp;missing, &amp;n, &amp;def);
</a> 	if(missing) {
 		while(n--)
 			fprintf(stderr, &quot;st: missing fontset: %s\n&quot;, missing[n]);
<a href="#h0-13" id="h0-13" class="h">@@ -1496,9 +1496,9 @@ void
</a> xinit(void) {
 	XSetWindowAttributes attrs;
 
<a href="#h0-13-3" id="h0-13-3" class="d">-	if(!(xw.dis = XOpenDisplay(NULL)))
</a><a href="#h0-13-4" id="h0-13-4" class="i">+	if(!(xw.dpy = XOpenDisplay(NULL)))
</a> 		die(&quot;Can&#39;t open display\n&quot;);
<a href="#h0-13-6" id="h0-13-6" class="d">-	xw.scr = XDefaultScreen(xw.dis);
</a><a href="#h0-13-7" id="h0-13-7" class="i">+	xw.scr = XDefaultScreen(xw.dpy);
</a> 	
 	/* font */
 	initfonts(FONT, BOLDFONT);
<a href="#h0-14" id="h0-14" class="h">@@ -1508,7 +1508,7 @@ xinit(void) {
</a> 	xw.ch = dc.font.ascent + dc.font.descent;
 
 	/* colors */
<a href="#h0-14-3" id="h0-14-3" class="d">-	xw.cmap = XDefaultColormap(xw.dis, xw.scr);
</a><a href="#h0-14-4" id="h0-14-4" class="i">+	xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a> 	xloadcols();
 
 	/* window - default size */
<a href="#h0-15" id="h0-15" class="h">@@ -1525,27 +1525,27 @@ xinit(void) {
</a> 		| PointerMotionMask | ButtonPressMask | ButtonReleaseMask;
 	attrs.colormap = xw.cmap;
 
<a href="#h0-15-3" id="h0-15-3" class="d">-	xw.win = XCreateWindow(xw.dis, XRootWindow(xw.dis, xw.scr), 0, 0,
</a><a href="#h0-15-4" id="h0-15-4" class="d">-			xw.w, xw.h, 0, XDefaultDepth(xw.dis, xw.scr), InputOutput,
</a><a href="#h0-15-5" id="h0-15-5" class="d">-			XDefaultVisual(xw.dis, xw.scr),
</a><a href="#h0-15-6" id="h0-15-6" class="i">+	xw.win = XCreateWindow(xw.dpy, XRootWindow(xw.dpy, xw.scr), 0, 0,
</a><a href="#h0-15-7" id="h0-15-7" class="i">+			xw.w, xw.h, 0, XDefaultDepth(xw.dpy, xw.scr), InputOutput,
</a><a href="#h0-15-8" id="h0-15-8" class="i">+			XDefaultVisual(xw.dpy, xw.scr),
</a> 			CWBackPixel | CWBorderPixel | CWBitGravity | CWEventMask
 			| CWColormap,
 			&amp;attrs);
<a href="#h0-15-12" id="h0-15-12" class="d">-	xw.buf = XCreatePixmap(xw.dis, xw.win, xw.bufw, xw.bufh, XDefaultDepth(xw.dis, xw.scr));
</a><a href="#h0-15-13" id="h0-15-13" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, xw.bufw, xw.bufh, XDefaultDepth(xw.dpy, xw.scr));
</a> 
 
 	/* input methods */
<a href="#h0-15-17" id="h0-15-17" class="d">-	xw.xim = XOpenIM(xw.dis, NULL, NULL, NULL);
</a><a href="#h0-15-18" id="h0-15-18" class="i">+	xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL);
</a> 	xw.xic = XCreateIC(xw.xim, XNInputStyle, XIMPreeditNothing 
 					   | XIMStatusNothing, XNClientWindow, xw.win, 
 					   XNFocusWindow, xw.win, NULL);
 	/* gc */
<a href="#h0-15-23" id="h0-15-23" class="d">-	dc.gc = XCreateGC(xw.dis, xw.win, 0, NULL);
</a><a href="#h0-15-24" id="h0-15-24" class="i">+	dc.gc = XCreateGC(xw.dpy, xw.win, 0, NULL);
</a> 	
<a href="#h0-15-26" id="h0-15-26" class="d">-	XMapWindow(xw.dis, xw.win);
</a><a href="#h0-15-27" id="h0-15-27" class="i">+	XMapWindow(xw.dpy, xw.win);
</a> 	xhints();
<a href="#h0-15-29" id="h0-15-29" class="d">-	XStoreName(xw.dis, xw.win, opt_title ? opt_title : &quot;st&quot;);
</a><a href="#h0-15-30" id="h0-15-30" class="d">-	XSync(xw.dis, 0);
</a><a href="#h0-15-31" id="h0-15-31" class="i">+	XStoreName(xw.dpy, xw.win, opt_title ? opt_title : &quot;st&quot;);
</a><a href="#h0-15-32" id="h0-15-32" class="i">+	XSync(xw.dpy, 0);
</a> }
 
 void
<a href="#h0-16" id="h0-16" class="h">@@ -1559,10 +1559,10 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 	else
 		xfg = dc.col[base.fg], xbg = dc.col[base.bg];
 
<a href="#h0-16-3" id="h0-16-3" class="d">-	XSetBackground(xw.dis, dc.gc, xbg);
</a><a href="#h0-16-4" id="h0-16-4" class="d">-	XSetForeground(xw.dis, dc.gc, xfg);
</a><a href="#h0-16-5" id="h0-16-5" class="i">+	XSetBackground(xw.dpy, dc.gc, xbg);
</a><a href="#h0-16-6" id="h0-16-6" class="i">+	XSetForeground(xw.dpy, dc.gc, xfg);
</a> 
<a href="#h0-16-8" id="h0-16-8" class="d">-	if(base.mode &amp; ATTR_GFX)
</a><a href="#h0-16-9" id="h0-16-9" class="i">+	if(base.mode &amp; ATTR_GFX) {
</a> 		for(i = 0; i &lt; bytelen; i++) {
 			char c = gfx[(unsigned int)s[i] % 256];
 			if(c)
<a href="#h0-17" id="h0-17" class="h">@@ -1570,12 +1570,13 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 			else if(s[i] &gt; 0x5f)
 				s[i] -= 0x5f;
 		}
<a href="#h0-17-3" id="h0-17-3" class="i">+	}
</a> 
<a href="#h0-17-5" id="h0-17-5" class="d">-	XmbDrawImageString(xw.dis, xw.buf, base.mode &amp; ATTR_BOLD ? dc.bfont.set : dc.font.set,
</a><a href="#h0-17-6" id="h0-17-6" class="i">+	XmbDrawImageString(xw.dpy, xw.buf, base.mode &amp; ATTR_BOLD ? dc.bfont.set : dc.font.set,
</a> 	    dc.gc, winx, winy, s, bytelen);
 	
 	if(base.mode &amp; ATTR_UNDERLINE)
<a href="#h0-17-10" id="h0-17-10" class="d">-		XDrawLine(xw.dis, xw.buf, dc.gc, winx, winy+1, winx+width-1, winy+1);
</a><a href="#h0-17-11" id="h0-17-11" class="i">+		XDrawLine(xw.dpy, xw.buf, dc.gc, winx, winy+1, winx+width-1, winy+1);
</a> }
 
 void
<a href="#h0-18" id="h0-18" class="h">@@ -1612,9 +1613,9 @@ void
</a> xdrawc(int x, int y, Glyph g) {
 	int sl = utf8size(g.c);
 	XRectangle r = { x * xw.cw, y * xw.ch, xw.cw, xw.ch };
<a href="#h0-18-3" id="h0-18-3" class="d">-	XSetBackground(xw.dis, dc.gc, dc.col[g.bg]);
</a><a href="#h0-18-4" id="h0-18-4" class="d">-	XSetForeground(xw.dis, dc.gc, dc.col[g.fg]);
</a><a href="#h0-18-5" id="h0-18-5" class="d">-	XmbDrawImageString(xw.dis, xw.buf, g.mode&amp;ATTR_BOLD?dc.bfont.fs:dc.font.fs,
</a><a href="#h0-18-6" id="h0-18-6" class="i">+	XSetBackground(xw.dpy, dc.gc, dc.col[g.bg]);
</a><a href="#h0-18-7" id="h0-18-7" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[g.fg]);
</a><a href="#h0-18-8" id="h0-18-8" class="i">+	XmbDrawImageString(xw.dpy, xw.buf, g.mode&amp;ATTR_BOLD?dc.bfont.fs:dc.font.fs,
</a> 	    dc.gc, r.x, r.y+dc.font.ascent, g.c, sl);
 }
 
<a href="#h0-19" id="h0-19" class="h">@@ -1629,8 +1630,8 @@ draw(int dummy) {
</a> 				xdrawc(x, y, term.line[y][x]);
 
 	xdrawcursor();
<a href="#h0-19-3" id="h0-19-3" class="d">-	XCopyArea(xw.dis, xw.buf, xw.win, dc.gc, 0, 0, xw.bufw, xw.bufh, BORDER, BORDER);
</a><a href="#h0-19-4" id="h0-19-4" class="d">-	XFlush(xw.dis);
</a><a href="#h0-19-5" id="h0-19-5" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, xw.bufw, xw.bufh, BORDER, BORDER);
</a><a href="#h0-19-6" id="h0-19-6" class="i">+	XFlush(xw.dpy);
</a> }
 
 #else
<a href="#h0-20" id="h0-20" class="h">@@ -1672,7 +1673,7 @@ draw(int redraw_all) {
</a> 			xdraws(buf, base, ox, y, ic, ib);
 	}
 	xdrawcursor();
<a href="#h0-20-3" id="h0-20-3" class="d">-	XCopyArea(xw.dis, xw.buf, xw.win, dc.gc, 0, 0, xw.bufw, xw.bufh, BORDER, BORDER);
</a><a href="#h0-20-4" id="h0-20-4" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, xw.bufw, xw.bufh, BORDER, BORDER);
</a> }
 
 #endif
<a href="#h0-21" id="h0-21" class="h">@@ -1686,7 +1687,7 @@ expose(XEvent *ev) {
</a> 			draw(SCREEN_REDRAW);
 		}
 	} else
<a href="#h0-21-3" id="h0-21-3" class="d">-		XCopyArea(xw.dis, xw.buf, xw.win, dc.gc, e-&gt;x-BORDER, e-&gt;y-BORDER,
</a><a href="#h0-21-4" id="h0-21-4" class="i">+		XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, e-&gt;x-BORDER, e-&gt;y-BORDER,
</a> 				e-&gt;width, e-&gt;height, e-&gt;x, e-&gt;y);
 }
 
<a href="#h0-22" id="h0-22" class="h">@@ -1707,9 +1708,9 @@ unmap(XEvent *ev) {
</a> 
 void
 xseturgency(int add) {
<a href="#h0-22-3" id="h0-22-3" class="d">-	XWMHints *h = XGetWMHints(xw.dis, xw.win);
</a><a href="#h0-22-4" id="h0-22-4" class="i">+	XWMHints *h = XGetWMHints(xw.dpy, xw.win);
</a> 	h-&gt;flags = add ? (h-&gt;flags | XUrgencyHint) : (h-&gt;flags &amp; ~XUrgencyHint);
<a href="#h0-22-6" id="h0-22-6" class="d">-	XSetWMHints(xw.dis, xw.win, h);
</a><a href="#h0-22-7" id="h0-22-7" class="i">+	XSetWMHints(xw.dpy, xw.win, h);
</a> 	XFree(h);
 }
 
<a href="#h0-23" id="h0-23" class="h">@@ -1806,7 +1807,7 @@ void
</a> run(void) {
 	XEvent ev;
 	fd_set rfd;
<a href="#h0-23-3" id="h0-23-3" class="d">-	int xfd = XConnectionNumber(xw.dis);
</a><a href="#h0-23-4" id="h0-23-4" class="i">+	int xfd = XConnectionNumber(xw.dpy);
</a> 
 	for(;;) {
 		FD_ZERO(&amp;rfd);
<a href="#h0-24" id="h0-24" class="h">@@ -1821,8 +1822,8 @@ run(void) {
</a> 			ttyread();
 			draw(SCREEN_UPDATE); 
 		}
<a href="#h0-24-3" id="h0-24-3" class="d">-		while(XPending(xw.dis)) {
</a><a href="#h0-24-4" id="h0-24-4" class="d">-			XNextEvent(xw.dis, &amp;ev);
</a><a href="#h0-24-5" id="h0-24-5" class="i">+		while(XPending(xw.dpy)) {
</a><a href="#h0-24-6" id="h0-24-6" class="i">+			XNextEvent(xw.dpy, &amp;ev);
</a> 			if (XFilterEvent(&amp;ev, xw.win))
 				continue;
 			if(handler[ev.type])
</pre>
</div>
</body>
</html>
