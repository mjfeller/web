<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>replace state with separate variables - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a6efc851b6b0fa9befe1f81627c5c5955d48e6f6.html">a6efc851b6b0fa9befe1f81627c5c5955d48e6f6</a>
<b>parent</b> <a href="../commit/50b4785f2650a741f827f4be17ecc18844a1b175.html">50b4785f2650a741f827f4be17ecc18844a1b175</a>
<b>Author:</b> Matthias-Christian Ott &lt;<a href="mailto:ott@enolink.de">ott@enolink.de</a>&gt;
<b>Date:</b>   Sun,  8 Jun 2008 20:47:08 +0200

replace state with separate variables

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">std.c</a></td><td> | </td><td class="num">19</td><td><span class="i">++++++++</span><span class="d">-----------</span></td></tr>
</table></pre><pre>1 file changed, 8 insertions(+), 11 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/std.c.html">std.c</a> b/<a href="../file/std.c.html">std.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -31,8 +31,6 @@ void shell(void);
</a> void sigchld(int n);
 char unbuffer(void);
 
<a href="#h0-0-3" id="h0-0-3" class="d">-enum { QuestionMark = 1, Digit = 2 };
</a><a href="#h0-0-4" id="h0-0-4" class="d">-
</a> typedef struct {
 	unsigned char data[BUFSIZ];
 	int s, e;
<a href="#h0-1" id="h0-1" class="h">@@ -41,10 +39,10 @@ typedef struct {
</a> 
 int cols = 80, lines = 25;
 int cx = 0, cy = 0;
<a href="#h0-1-3" id="h0-1-3" class="d">-int c, s;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+int c;
</a> FILE *fptm = NULL;
 int ptm, pts;
<a href="#h0-1-7" id="h0-1-7" class="d">-_Bool bold;
</a><a href="#h0-1-8" id="h0-1-8" class="i">+_Bool bold, digit, qmark;
</a> pid_t pid;
 RingBuffer buf;
 
<a href="#h0-2" id="h0-2" class="h">@@ -151,28 +149,27 @@ parseesc(void) {
</a> 	int arg[16];
 
 	memset(arg, 0, LENGTH(arg));
<a href="#h0-2-3" id="h0-2-3" class="d">-	s = 0;
</a> 	c = getc(fptm);
 	switch(c) {
 	case &#39;[&#39;:
 		c = getc(fptm);
 		for(j = 0; j &lt; LENGTH(arg);) {
 			if(isdigit(c)) {
<a href="#h0-2-10" id="h0-2-10" class="d">-				s |= Digit;
</a><a href="#h0-2-11" id="h0-2-11" class="i">+				digit = 1;
</a> 				arg[j] *= 10;
 				arg[j] += c - &#39;0&#39;;
 			}
 			else if(c == &#39;?&#39;)
<a href="#h0-2-16" id="h0-2-16" class="d">-				s |= QuestionMark; 
</a><a href="#h0-2-17" id="h0-2-17" class="i">+				qmark = 1;
</a> 			else if(c == &#39;;&#39;) {
<a href="#h0-2-19" id="h0-2-19" class="d">-				if(!(s &amp; Digit))
</a><a href="#h0-2-20" id="h0-2-20" class="i">+				if(!digit)
</a> 					eprint(&quot;syntax error\n&quot;);
<a href="#h0-2-22" id="h0-2-22" class="d">-				s &amp;= ~Digit;
</a><a href="#h0-2-23" id="h0-2-23" class="i">+				digit = 0;
</a> 				j++;
 			}
 			else {
<a href="#h0-2-27" id="h0-2-27" class="d">-				if(s &amp; Digit) {
</a><a href="#h0-2-28" id="h0-2-28" class="d">-					s &amp;= ~Digit;
</a><a href="#h0-2-29" id="h0-2-29" class="i">+				if(digit) {
</a><a href="#h0-2-30" id="h0-2-30" class="i">+					digit = 0;
</a> 					j++;
 				}
 				break;
</pre>
</div>
</body>
</html>
