<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Fixed wrong nanosecond factor 10E6. - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/19d095717f656d844cd9d696d9c921a0821a5ea7.html">19d095717f656d844cd9d696d9c921a0821a5ea7</a>
<b>parent</b> <a href="../commit/5edeec1b20fcb5900d4f1408594d1e76b6c544f0.html">5edeec1b20fcb5900d4f1408594d1e76b6c544f0</a>
<b>Author:</b> Ivan Delalande &lt;<a href="mailto:colona@ycc.fr">colona@ycc.fr</a>&gt;
<b>Date:</b>   Thu, 26 Jun 2014 04:30:43 +0200

Fixed wrong nanosecond factor 10E6.

Commit 5edeec1 introduced a wrong factor for nanosecond computation, the correct
value is 1E6. Time and timeout values are 10 times less than they should be and
this cause high CPU usage.

Reported by pyroh on IRC. Thanks!

Signed-off-by: Roberto E. Vargas Caballero &lt;k0ga@shike2.com&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
</table></pre><pre>1 file changed, 3 insertions(+), 3 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -76,7 +76,7 @@ char *argv0;
</a> #define LIMIT(x, a, b)    (x) = (x) &lt; (a) ? (a) : (x) &gt; (b) ? (b) : (x)
 #define ATTRCMP(a, b) ((a).mode != (b).mode || (a).fg != (b).fg || (a).bg != (b).bg)
 #define IS_SET(flag) ((term.mode &amp; (flag)) != 0)
<a href="#h0-0-3" id="h0-0-3" class="d">-#define TIMEDIFF(t1, t2) ((t1.tv_sec-t2.tv_sec)*1000 + (t1.tv_nsec-t2.tv_nsec)/10E6)
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#define TIMEDIFF(t1, t2) ((t1.tv_sec-t2.tv_sec)*1000 + (t1.tv_nsec-t2.tv_nsec)/1E6)
</a> #define CEIL(x) (((x) != (int) (x)) ? (x) + 1 : (x))
 #define MODBIT(x, set, bit) ((set) ? ((x) |= (bit)) : ((x) &amp;= ~(bit)))
 
<a href="#h0-1" id="h0-1" class="h">@@ -3753,7 +3753,7 @@ run(void) {
</a> 
 		clock_gettime(CLOCK_MONOTONIC, &amp;now);
 		drawtimeout.tv_sec = 0;
<a href="#h0-1-3" id="h0-1-3" class="d">-		drawtimeout.tv_nsec = (1000/xfps) * 10E6;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+		drawtimeout.tv_nsec = (1000/xfps) * 1E6;
</a> 		tv = &amp;drawtimeout;
 
 		dodraw = 0;
<a href="#h0-2" id="h0-2" class="h">@@ -3790,7 +3790,7 @@ run(void) {
</a> 							&gt; blinktimeout) {
 						drawtimeout.tv_nsec = 1000;
 					} else {
<a href="#h0-2-3" id="h0-2-3" class="d">-						drawtimeout.tv_nsec = (10E6 * \
</a><a href="#h0-2-4" id="h0-2-4" class="i">+						drawtimeout.tv_nsec = (1E6 * \
</a> 							(blinktimeout - \
 							TIMEDIFF(now,
 								lastblink)));
</pre>
</div>
</body>
</html>
