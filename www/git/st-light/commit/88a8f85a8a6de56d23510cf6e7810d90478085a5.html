<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Copy non set positions as spaces - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/88a8f85a8a6de56d23510cf6e7810d90478085a5.html">88a8f85a8a6de56d23510cf6e7810d90478085a5</a>
<b>parent</b> <a href="../commit/111199cf226b33f12e6ee3e66e50fbe5c3566e33.html">111199cf226b33f12e6ee3e66e50fbe5c3566e33</a>
<b>Author:</b> Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga@shike2.com">k0ga@shike2.com</a>&gt;
<b>Date:</b>   Mon, 17 Sep 2012 22:13:09 +0200

Copy non set positions as spaces

st selection don&#39;t insert in the selection position whose value is not
set. This is correct for the positions in the end of the line, but cause
some problems in the beginning. For example echo -e &#39;a\tb&#39; will print in the
screen:

a	b

but after selecting and copying in some place you get:

ab

because positions from 1 to 7 don&#39;t have any value. This patch deals all
positions without value as blank (even at the end of the line).
---
 st.c |   17 ++++++++++-------
 1 file changed, 10 insertions(+), 7 deletions(-)
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">17</td><td><span class="i">++++++++++</span><span class="d">-------</span></td></tr>
</table></pre><pre>1 file changed, 10 insertions(+), 7 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -596,14 +596,17 @@ selcopy(void) {
</a> 		/* append every set &amp; selected glyph to the selection */
 		for(y = 0; y &lt; term.row; y++) {
 			for(x = 0; x &lt; term.col; x++) {
<a href="#h0-0-3" id="h0-0-3" class="d">-				is_selected = selected(x, y);
</a><a href="#h0-0-4" id="h0-0-4" class="d">-				if((term.line[y][x].state &amp; GLYPH_SET) &amp;&amp; is_selected) {
</a><a href="#h0-0-5" id="h0-0-5" class="d">-					int size = utf8size(term.line[y][x].c);
</a><a href="#h0-0-6" id="h0-0-6" class="d">-					memcpy(ptr, term.line[y][x].c, size);
</a><a href="#h0-0-7" id="h0-0-7" class="d">-					ptr += size;
</a><a href="#h0-0-8" id="h0-0-8" class="d">-				}
</a><a href="#h0-0-9" id="h0-0-9" class="i">+				int size;
</a><a href="#h0-0-10" id="h0-0-10" class="i">+				char *p;
</a><a href="#h0-0-11" id="h0-0-11" class="i">+				Glyph *gp = &amp;term.line[y][x];
</a><a href="#h0-0-12" id="h0-0-12" class="i">+
</a><a href="#h0-0-13" id="h0-0-13" class="i">+				if(!(is_selected = selected(x, y)))
</a><a href="#h0-0-14" id="h0-0-14" class="i">+					continue;
</a><a href="#h0-0-15" id="h0-0-15" class="i">+				p = (gp-&gt;state &amp; GLYPH_SET) ? gp-&gt;c : &quot; &quot;;
</a><a href="#h0-0-16" id="h0-0-16" class="i">+				size = utf8size(p);
</a><a href="#h0-0-17" id="h0-0-17" class="i">+				memcpy(ptr, p, size);
</a><a href="#h0-0-18" id="h0-0-18" class="i">+				ptr += size;
</a> 			}
<a href="#h0-0-20" id="h0-0-20" class="d">-
</a> 			/* \n at the end of every selected line except for the last one */
 			if(is_selected &amp;&amp; y &lt; sel.e.y)
 				*ptr++ = &#39;\n&#39;;
</pre>
</div>
</body>
</html>
