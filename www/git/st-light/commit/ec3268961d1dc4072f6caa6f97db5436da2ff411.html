<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Add error message when child exits whit error - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/ec3268961d1dc4072f6caa6f97db5436da2ff411.html">ec3268961d1dc4072f6caa6f97db5436da2ff411</a>
<b>parent</b> <a href="../commit/769d48180747c3255653360d161c77ec2a2e8d13.html">769d48180747c3255653360d161c77ec2a2e8d13</a>
<b>Author:</b> Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga@shike2.com">k0ga@shike2.com</a>&gt;
<b>Date:</b>   Mon,  4 Aug 2014 22:07:04 +0200

Add error message when child exits whit error

Master proccess was not showing any error message when the child
died with an error, and it was very confusing for the user (for
example with incorrect -e command).

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++</span><span class="d">------</span></td></tr>
</table></pre><pre>1 file changed, 5 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1176,16 +1176,15 @@ execsh(void) {
</a> 
 void
 sigchld(int a) {
<a href="#h0-0-3" id="h0-0-3" class="d">-	int stat = 0;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	int stat, ret;
</a> 
 	if(waitpid(pid, &amp;stat, 0) &lt; 0)
 		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
 
<a href="#h0-0-9" id="h0-0-9" class="d">-	if(WIFEXITED(stat)) {
</a><a href="#h0-0-10" id="h0-0-10" class="d">-		exit(WEXITSTATUS(stat));
</a><a href="#h0-0-11" id="h0-0-11" class="d">-	} else {
</a><a href="#h0-0-12" id="h0-0-12" class="d">-		exit(EXIT_FAILURE);
</a><a href="#h0-0-13" id="h0-0-13" class="d">-	}
</a><a href="#h0-0-14" id="h0-0-14" class="i">+	ret = WIFEXITED(stat) ? WEXITSTATUS(stat) : EXIT_FAILURE;
</a><a href="#h0-0-15" id="h0-0-15" class="i">+	if (ret != EXIT_SUCCESS)
</a><a href="#h0-0-16" id="h0-0-16" class="i">+		die(&quot;child finished with error &#39;%d&#39;\n&quot;, stat);
</a><a href="#h0-0-17" id="h0-0-17" class="i">+	exit(EXIT_SUCCESS);
</a> }
 
 void
</pre>
</div>
</body>
</html>
