<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>st: Fix off-by-one error when calculating character width. - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/39964614b742c4ec98a326762d98470cb987a45b.html">39964614b742c4ec98a326762d98470cb987a45b</a>
<b>parent</b> <a href="../commit/0e48a1995eee1c2babc58523ef0be296e4b1c3e8.html">0e48a1995eee1c2babc58523ef0be296e4b1c3e8</a>
<b>Author:</b> Tor Andersson &lt;<a href="mailto:tor@ccxvii.net">tor@ccxvii.net</a>&gt;
<b>Date:</b>   Wed,  9 Mar 2016 17:11:57 +0100

st: Fix off-by-one error when calculating character width.

LEN(str) is one larger than strlen(str) because it also counts the zero
terminator. The original code would include the .notdef glyph (since it&#39;ll
try to encode character 0, which gets encoded to the .notdef glyph) when
measuring the average dimensions of printable ascii characters.

This causes problems with fonts like GNU Unifont where the .notdef glyph is
not the same width as the usual half-width characters.

Signed-off-by: Christoph Lohmann &lt;20h@r-36.net&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
</table></pre><pre>1 file changed, 2 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3291,7 +3291,7 @@ xloadfont(Font *f, FcPattern *pattern)
</a> 
 	XftTextExtentsUtf8(xw.dpy, f-&gt;match,
 		(const FcChar8 *) ascii_printable,
<a href="#h0-0-3" id="h0-0-3" class="d">-		LEN(ascii_printable), &amp;extents);
</a><a href="#h0-0-4" id="h0-0-4" class="i">+		strlen(ascii_printable), &amp;extents);
</a> 
 	f-&gt;set = NULL;
 	f-&gt;pattern = FcPatternDuplicate(pattern);
<a href="#h0-1" id="h0-1" class="h">@@ -3302,7 +3302,7 @@ xloadfont(Font *f, FcPattern *pattern)
</a> 	f-&gt;rbearing = f-&gt;match-&gt;max_advance_width;
 
 	f-&gt;height = f-&gt;ascent + f-&gt;descent;
<a href="#h0-1-3" id="h0-1-3" class="d">-	f-&gt;width = DIVCEIL(extents.xOff, LEN(ascii_printable));
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	f-&gt;width = DIVCEIL(extents.xOff, strlen(ascii_printable));
</a> 
 	return 0;
 }
</pre>
</div>
</body>
</html>
