<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Add DECOM sequence - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/5260a9ea2249b9159c188a6e27a39a38d131e411.html">5260a9ea2249b9159c188a6e27a39a38d131e411</a>
<b>parent</b> <a href="../commit/ee3e0a9fd032bb35eea5c46fc0a9efcd6a80579a.html">ee3e0a9fd032bb35eea5c46fc0a9efcd6a80579a</a>
<b>Author:</b> Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga@shike2.com">k0ga@shike2.com</a>&gt;
<b>Date:</b>   Thu,  8 Nov 2012 17:21:10 +0100

Add DECOM sequence

DECOM sequence allows to the user defines a new home position. The home
position is used as base for all the movement commands except HVP and
VPA. It is important notice than DECSLM moves cursor to absolute position
0,0.
---
 st.c |   33 ++++++++++++++++++++++++++-------
 1 file changed, 26 insertions(+), 7 deletions(-)
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">33</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">-------</span></td></tr>
</table></pre><pre>1 file changed, 26 insertions(+), 7 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -97,6 +97,7 @@ enum cursor_movement {
</a> enum cursor_state {
 	CURSOR_DEFAULT  = 0,
 	CURSOR_WRAPNEXT = 1,
<a href="#h0-0-3" id="h0-0-3" class="i">+	CURSOR_ORIGIN	= 2
</a> };
 
 enum glyph_state {
<a href="#h0-1" id="h0-1" class="h">@@ -300,6 +301,7 @@ static void tdeleteline(int);
</a> static void tinsertblank(int);
 static void tinsertblankline(int);
 static void tmoveto(int, int);
<a href="#h0-1-3" id="h0-1-3" class="i">+static void tmoveato(int x, int y);
</a> static void tnew(int, int);
 static void tnewline(int);
 static void tputtab(bool);
<a href="#h0-2" id="h0-2" class="h">@@ -1211,10 +1213,25 @@ csiparse(void) {
</a> 	}
 }
 
<a href="#h0-2-3" id="h0-2-3" class="i">+/* for absolute user moves, when decom is set */
</a><a href="#h0-2-4" id="h0-2-4" class="i">+void
</a><a href="#h0-2-5" id="h0-2-5" class="i">+tmoveato(int x, int y) {
</a><a href="#h0-2-6" id="h0-2-6" class="i">+	tmoveto(x, y + ((term.c.state &amp; CURSOR_ORIGIN) ? term.top: 0));
</a><a href="#h0-2-7" id="h0-2-7" class="i">+}
</a><a href="#h0-2-8" id="h0-2-8" class="i">+
</a> void
 tmoveto(int x, int y) {
<a href="#h0-2-11" id="h0-2-11" class="i">+	int miny, maxy;
</a><a href="#h0-2-12" id="h0-2-12" class="i">+
</a><a href="#h0-2-13" id="h0-2-13" class="i">+	if(term.c.state &amp; CURSOR_ORIGIN) {
</a><a href="#h0-2-14" id="h0-2-14" class="i">+		miny = term.top;
</a><a href="#h0-2-15" id="h0-2-15" class="i">+		maxy = term.bot;
</a><a href="#h0-2-16" id="h0-2-16" class="i">+	} else {
</a><a href="#h0-2-17" id="h0-2-17" class="i">+		miny = 0;
</a><a href="#h0-2-18" id="h0-2-18" class="i">+		maxy = term.row - 1;
</a><a href="#h0-2-19" id="h0-2-19" class="i">+	}
</a> 	LIMIT(x, 0, term.col-1);
<a href="#h0-2-21" id="h0-2-21" class="d">-	LIMIT(y, 0, term.row-1);
</a><a href="#h0-2-22" id="h0-2-22" class="i">+	LIMIT(y, miny, maxy);
</a> 	term.c.state &amp;= ~CURSOR_WRAPNEXT;
 	term.c.x = x;
 	term.c.y = y;
<a href="#h0-3" id="h0-3" class="h">@@ -1456,7 +1473,9 @@ tsetmode(bool priv, bool set, int *args, int narg) {
</a> 				if(mode != term.mode)
 					redraw();
 				break;
<a href="#h0-3-3" id="h0-3-3" class="d">-			case 6: /* XXX: DECOM -- Origin */
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			case 6: /* DECOM -- Origin */
</a><a href="#h0-3-5" id="h0-3-5" class="i">+				MODBIT(term.c.state, set, CURSOR_ORIGIN);
</a><a href="#h0-3-6" id="h0-3-6" class="i">+				tmoveato(0, 0);
</a> 				break;
 			case 7: /* DECAWM -- Auto wrap */
 				MODBIT(term.mode, set, MODE_WRAP);
<a href="#h0-4" id="h0-4" class="h">@@ -1593,7 +1612,7 @@ csihandle(void) {
</a> 	case &#39;f&#39;: /* HVP */
 		DEFAULT(csiescseq.arg[0], 1);
 		DEFAULT(csiescseq.arg[1], 1);
<a href="#h0-4-3" id="h0-4-3" class="d">-		tmoveto(csiescseq.arg[1]-1, csiescseq.arg[0]-1);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+		tmoveato(csiescseq.arg[1]-1, csiescseq.arg[0]-1);
</a> 		break;
 	case &#39;I&#39;: /* CHT -- Cursor Forward Tabulation &lt;n&gt; tab stops */
 		DEFAULT(csiescseq.arg[0], 1);
<a href="#h0-5" id="h0-5" class="h">@@ -1667,7 +1686,7 @@ csihandle(void) {
</a> 		break;
 	case &#39;d&#39;: /* VPA -- Move to &lt;row&gt; */
 		DEFAULT(csiescseq.arg[0], 1);
<a href="#h0-5-3" id="h0-5-3" class="d">-		tmoveto(term.c.x, csiescseq.arg[0]-1);
</a><a href="#h0-5-4" id="h0-5-4" class="i">+		tmoveato(term.c.x, csiescseq.arg[0]-1);
</a> 		break;
 	case &#39;h&#39;: /* SM -- Set terminal mode */
 		tsetmode(csiescseq.priv, 1, csiescseq.arg, csiescseq.narg);
<a href="#h0-6" id="h0-6" class="h">@@ -1682,7 +1701,7 @@ csihandle(void) {
</a> 			DEFAULT(csiescseq.arg[0], 1);
 			DEFAULT(csiescseq.arg[1], term.row);
 			tsetscroll(csiescseq.arg[0]-1, csiescseq.arg[1]-1);
<a href="#h0-6-3" id="h0-6-3" class="d">-			tmoveto(0, 0);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+			tmoveato(0, 0);
</a> 		}
 		break;
 	case &#39;s&#39;: /* DECSC -- Save cursor position (ANSI.SYS) */
<a href="#h0-7" id="h0-7" class="h">@@ -2119,10 +2138,10 @@ tresize(int col, int row) {
</a> 	/* update terminal size */
 	term.col = col;
 	term.row = row;
<a href="#h0-7-3" id="h0-7-3" class="d">-	/* make use of the LIMIT in tmoveto */
</a><a href="#h0-7-4" id="h0-7-4" class="d">-	tmoveto(term.c.x, term.c.y);
</a> 	/* reset scrolling region */
 	tsetscroll(0, row-1);
<a href="#h0-7-7" id="h0-7-7" class="i">+	/* make use of the LIMIT in tmoveto */
</a><a href="#h0-7-8" id="h0-7-8" class="i">+	tmoveto(term.c.x, term.c.y);
</a> 
 	return (slide &gt; 0);
 }
</pre>
</div>
</body>
</html>
