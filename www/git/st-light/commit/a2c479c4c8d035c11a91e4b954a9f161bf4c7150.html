<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>mouse shortcuts: allow using forcemousemod (e.g. shift) - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a2c479c4c8d035c11a91e4b954a9f161bf4c7150.html">a2c479c4c8d035c11a91e4b954a9f161bf4c7150</a>
<b>parent</b> <a href="../commit/d2b75db8d7519a20af8bf09e9c205507f9ff828c.html">d2b75db8d7519a20af8bf09e9c205507f9ff828c</a>
<b>Author:</b> Avi Halachmi (:avih) &lt;<a href="mailto:avihpit@yahoo.com">avihpit@yahoo.com</a>&gt;
<b>Date:</b>   Thu, 24 Oct 2019 15:42:07 +0300

mouse shortcuts: allow using forcemousemod (e.g. shift)

The recent mouse shurtcuts commits allow customization, but ignore
forcemousemod mask (default: shift) as a modifier, for no good reason
other than following the behavior of the KB shortcuts.

Allow using forcemousemod too, which now can be used to invoke
different shortcuts, though the automatic effect of forcemousemod will
be lost for buttons which use mask with forcemousemod.

E.g. the default is:

static uint forcemousemod = ShiftMask;
...
{ XK_ANY_MOD,           Button4, ttysend,        {.s = &quot;\031&quot;} },
...

where ttysend will be invoked for button4 with any mod when not in mouse
mode, and with shift when in mouse mode.

Now it&#39;s possible to do this:
{ ShiftMask,            Button4, ttysend,        {.s = &quot;foo&quot;} },
{ XK_ANY_MOD,           Button4, ttysend,        {.s = &quot;\031&quot;} },

Which will invoke ttysend(&quot;foo&quot;) while shift is held and ttysend(&quot;\031&quot;)
otherwise. Shift still overrides mouse mode, but will now send &quot;foo&quot;.

Previously with this setup the second binding was always invoked
because the forceousemod mask was always removed from the event.

Buttons which don&#39;t use forcemousemod behave the same as before.

This is useful e.g. for the scrollback mouse patch, which wants to
configure shift+wheel for scrollback, while keeping the normal behavior
without shift.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">x.c</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
</table></pre><pre>1 file changed, 2 insertions(+), 1 deletion(-)
<hr/><b>diff --git a/<a id="h0" href="../file/x.c.html">x.c</a> b/<a href="../file/x.c.html">x.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -426,7 +426,8 @@ mouseaction(XEvent *e, uint release)
</a> 	for (ms = mshortcuts; ms &lt; mshortcuts + LEN(mshortcuts); ms++) {
 		if (ms-&gt;release == release &amp;&amp;
 		    ms-&gt;button == e-&gt;xbutton.button &amp;&amp;
<a href="#h0-0-3" id="h0-0-3" class="d">-		    match(ms-&gt;mod, e-&gt;xbutton.state &amp; ~forcemousemod)) {
</a><a href="#h0-0-4" id="h0-0-4" class="i">+		    (match(ms-&gt;mod, e-&gt;xbutton.state) ||  /* exact or forced */
</a><a href="#h0-0-5" id="h0-0-5" class="i">+		     match(ms-&gt;mod, e-&gt;xbutton.state &amp; ~forcemousemod))) {
</a> 			ms-&gt;func(&amp;(ms-&gt;arg));
 			return 1;
 		}
</pre>
</div>
</body>
</html>
