<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Don&#39;t treat clauses like functions - st-light - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st-light Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st-light</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/f1307d91e2ec351a4a8b7352be8b5f6e4cb24294.html">f1307d91e2ec351a4a8b7352be8b5f6e4cb24294</a>
<b>parent</b> <a href="../commit/13233574ed1ead29bb7e99e71a0665e62c640617.html">13233574ed1ead29bb7e99e71a0665e62c640617</a>
<b>Author:</b> FRIGN &lt;<a href="mailto:dev@frign.de">dev@frign.de</a>&gt;
<b>Date:</b>   Fri, 10 Jul 2015 10:29:53 +0200

Don&#39;t treat clauses like functions

and add a space between the keyword and the parentheses.

Signed-off-by: Christoph Lohmann &lt;20h@r-36.net&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">764</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 382 insertions(+), 382 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -554,9 +554,9 @@ xwrite(int fd, const char *s, size_t len)
</a> {
 	size_t aux = len;
 
<a href="#h0-0-3" id="h0-0-3" class="d">-	while(len &gt; 0) {
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	while (len &gt; 0) {
</a> 		ssize_t r = write(fd, s, len);
<a href="#h0-0-6" id="h0-0-6" class="d">-		if(r &lt; 0)
</a><a href="#h0-0-7" id="h0-0-7" class="i">+		if (r &lt; 0)
</a> 			return r;
 		len -= r;
 		s += r;
<a href="#h0-1" id="h0-1" class="h">@@ -569,7 +569,7 @@ xmalloc(size_t len)
</a> {
 	void *p = malloc(len);
 
<a href="#h0-1-3" id="h0-1-3" class="d">-	if(!p)
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	if (!p)
</a> 		die(&quot;Out of memory\n&quot;);
 
 	return p;
<a href="#h0-2" id="h0-2" class="h">@@ -578,7 +578,7 @@ xmalloc(size_t len)
</a> void *
 xrealloc(void *p, size_t len)
 {
<a href="#h0-2-3" id="h0-2-3" class="d">-	if((p = realloc(p, len)) == NULL)
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	if ((p = realloc(p, len)) == NULL)
</a> 		die(&quot;Out of memory\n&quot;);
 
 	return p;
<a href="#h0-3" id="h0-3" class="h">@@ -587,7 +587,7 @@ xrealloc(void *p, size_t len)
</a> char *
 xstrdup(char *s)
 {
<a href="#h0-3-3" id="h0-3-3" class="d">-	if((s = strdup(s)) == NULL)
</a><a href="#h0-3-4" id="h0-3-4" class="i">+	if ((s = strdup(s)) == NULL)
</a> 		die(&quot;Out of memory\n&quot;);
 
 	return s;
<a href="#h0-4" id="h0-4" class="h">@@ -600,17 +600,17 @@ utf8decode(char *c, Rune *u, size_t clen)
</a> 	Rune udecoded;
 
 	*u = UTF_INVALID;
<a href="#h0-4-3" id="h0-4-3" class="d">-	if(!clen)
</a><a href="#h0-4-4" id="h0-4-4" class="i">+	if (!clen)
</a> 		return 0;
 	udecoded = utf8decodebyte(c[0], &amp;len);
<a href="#h0-4-7" id="h0-4-7" class="d">-	if(!BETWEEN(len, 1, UTF_SIZ))
</a><a href="#h0-4-8" id="h0-4-8" class="i">+	if (!BETWEEN(len, 1, UTF_SIZ))
</a> 		return 1;
<a href="#h0-4-10" id="h0-4-10" class="d">-	for(i = 1, j = 1; i &lt; clen &amp;&amp; j &lt; len; ++i, ++j) {
</a><a href="#h0-4-11" id="h0-4-11" class="i">+	for (i = 1, j = 1; i &lt; clen &amp;&amp; j &lt; len; ++i, ++j) {
</a> 		udecoded = (udecoded &lt;&lt; 6) | utf8decodebyte(c[i], &amp;type);
<a href="#h0-4-13" id="h0-4-13" class="d">-		if(type != 0)
</a><a href="#h0-4-14" id="h0-4-14" class="i">+		if (type != 0)
</a> 			return j;
 	}
<a href="#h0-4-17" id="h0-4-17" class="d">-	if(j &lt; len)
</a><a href="#h0-4-18" id="h0-4-18" class="i">+	if (j &lt; len)
</a> 		return 0;
 	*u = udecoded;
 	utf8validate(u, len);
<a href="#h0-5" id="h0-5" class="h">@@ -620,8 +620,8 @@ utf8decode(char *c, Rune *u, size_t clen)
</a> Rune
 utf8decodebyte(char c, size_t *i)
 {
<a href="#h0-5-3" id="h0-5-3" class="d">-	for(*i = 0; *i &lt; LEN(utfmask); ++(*i))
</a><a href="#h0-5-4" id="h0-5-4" class="d">-		if(((uchar)c &amp; utfmask[*i]) == utfbyte[*i])
</a><a href="#h0-5-5" id="h0-5-5" class="i">+	for (*i = 0; *i &lt; LEN(utfmask); ++(*i))
</a><a href="#h0-5-6" id="h0-5-6" class="i">+		if (((uchar)c &amp; utfmask[*i]) == utfbyte[*i])
</a> 			return (uchar)c &amp; ~utfmask[*i];
 	return 0;
 }
<a href="#h0-6" id="h0-6" class="h">@@ -632,9 +632,9 @@ utf8encode(Rune u, char *c)
</a> 	size_t len, i;
 
 	len = utf8validate(&amp;u, 0);
<a href="#h0-6-3" id="h0-6-3" class="d">-	if(len &gt; UTF_SIZ)
</a><a href="#h0-6-4" id="h0-6-4" class="i">+	if (len &gt; UTF_SIZ)
</a> 		return 0;
<a href="#h0-6-6" id="h0-6-6" class="d">-	for(i = len - 1; i != 0; --i) {
</a><a href="#h0-6-7" id="h0-6-7" class="i">+	for (i = len - 1; i != 0; --i) {
</a> 		c[i] = utf8encodebyte(u, 0);
 		u &gt;&gt;= 6;
 	}
<a href="#h0-7" id="h0-7" class="h">@@ -655,10 +655,10 @@ utf8strchr(char *s, Rune u)
</a> 	size_t i, j, len;
 
 	len = strlen(s);
<a href="#h0-7-3" id="h0-7-3" class="d">-	for(i = 0, j = 0; i &lt; len; i += j) {
</a><a href="#h0-7-4" id="h0-7-4" class="d">-		if(!(j = utf8decode(&amp;s[i], &amp;r, len - i)))
</a><a href="#h0-7-5" id="h0-7-5" class="i">+	for (i = 0, j = 0; i &lt; len; i += j) {
</a><a href="#h0-7-6" id="h0-7-6" class="i">+		if (!(j = utf8decode(&amp;s[i], &amp;r, len - i)))
</a> 			break;
<a href="#h0-7-8" id="h0-7-8" class="d">-		if(r == u)
</a><a href="#h0-7-9" id="h0-7-9" class="i">+		if (r == u)
</a> 			return &amp;(s[i]);
 	}
 	return NULL;
<a href="#h0-8" id="h0-8" class="h">@@ -667,9 +667,9 @@ utf8strchr(char *s, Rune u)
</a> size_t
 utf8validate(Rune *u, size_t i)
 {
<a href="#h0-8-3" id="h0-8-3" class="d">-	if(!BETWEEN(*u, utfmin[i], utfmax[i]) || BETWEEN(*u, 0xD800, 0xDFFF))
</a><a href="#h0-8-4" id="h0-8-4" class="i">+	if (!BETWEEN(*u, utfmin[i], utfmax[i]) || BETWEEN(*u, 0xD800, 0xDFFF))
</a> 		*u = UTF_INVALID;
<a href="#h0-8-6" id="h0-8-6" class="d">-	for(i = 1; *u &gt; utfmax[i]; ++i)
</a><a href="#h0-8-7" id="h0-8-7" class="i">+	for (i = 1; *u &gt; utfmax[i]; ++i)
</a> 		;
 	return i;
 }
<a href="#h0-9" id="h0-9" class="h">@@ -684,7 +684,7 @@ selinit(void)
</a> 	sel.primary = NULL;
 	sel.clipboard = NULL;
 	sel.xtarget = XInternAtom(xw.dpy, &quot;UTF8_STRING&quot;, 0);
<a href="#h0-9-3" id="h0-9-3" class="d">-	if(sel.xtarget == None)
</a><a href="#h0-9-4" id="h0-9-4" class="i">+	if (sel.xtarget == None)
</a> 		sel.xtarget = XA_STRING;
 }
 
<a href="#h0-10" id="h0-10" class="h">@@ -711,10 +711,10 @@ tlinelen(int y)
</a> {
 	int i = term.col;
 
<a href="#h0-10-3" id="h0-10-3" class="d">-	if(term.line[y][i - 1].mode &amp; ATTR_WRAP)
</a><a href="#h0-10-4" id="h0-10-4" class="i">+	if (term.line[y][i - 1].mode &amp; ATTR_WRAP)
</a> 		return i;
 
<a href="#h0-10-7" id="h0-10-7" class="d">-	while(i &gt; 0 &amp;&amp; term.line[y][i - 1].u == &#39; &#39;)
</a><a href="#h0-10-8" id="h0-10-8" class="i">+	while (i &gt; 0 &amp;&amp; term.line[y][i - 1].u == &#39; &#39;)
</a> 		--i;
 
 	return i;
<a href="#h0-11" id="h0-11" class="h">@@ -725,7 +725,7 @@ selnormalize(void)
</a> {
 	int i;
 
<a href="#h0-11-3" id="h0-11-3" class="d">-	if(sel.type == SEL_REGULAR &amp;&amp; sel.ob.y != sel.oe.y) {
</a><a href="#h0-11-4" id="h0-11-4" class="i">+	if (sel.type == SEL_REGULAR &amp;&amp; sel.ob.y != sel.oe.y) {
</a> 		sel.nb.x = sel.ob.y &lt; sel.oe.y ? sel.ob.x : sel.oe.x;
 		sel.ne.x = sel.ob.y &lt; sel.oe.y ? sel.oe.x : sel.ob.x;
 	} else {
<a href="#h0-12" id="h0-12" class="h">@@ -751,10 +751,10 @@ selnormalize(void)
</a> int
 selected(int x, int y)
 {
<a href="#h0-12-3" id="h0-12-3" class="d">-	if(sel.mode == SEL_EMPTY)
</a><a href="#h0-12-4" id="h0-12-4" class="i">+	if (sel.mode == SEL_EMPTY)
</a> 		return 0;
 
<a href="#h0-12-7" id="h0-12-7" class="d">-	if(sel.type == SEL_RECTANGULAR)
</a><a href="#h0-12-8" id="h0-12-8" class="i">+	if (sel.type == SEL_RECTANGULAR)
</a> 		return BETWEEN(y, sel.nb.y, sel.ne.y)
 		    &amp;&amp; BETWEEN(x, sel.nb.x, sel.ne.x);
 
<a href="#h0-13" id="h0-13" class="h">@@ -770,7 +770,7 @@ selsnap(int *x, int *y, int direction)
</a> 	int delim, prevdelim;
 	Glyph *gp, *prevgp;
 
<a href="#h0-13-3" id="h0-13-3" class="d">-	switch(sel.snap) {
</a><a href="#h0-13-4" id="h0-13-4" class="i">+	switch (sel.snap) {
</a> 	case SNAP_WORD:
 		/*
 		 * Snap around if the word wraps around at the end or
<a href="#h0-14" id="h0-14" class="h">@@ -778,20 +778,20 @@ selsnap(int *x, int *y, int direction)
</a> 		 */
 		prevgp = &amp;term.line[*y][*x];
 		prevdelim = ISDELIM(prevgp-&gt;u);
<a href="#h0-14-3" id="h0-14-3" class="d">-		for(;;) {
</a><a href="#h0-14-4" id="h0-14-4" class="i">+		for (;;) {
</a> 			newx = *x + direction;
 			newy = *y;
<a href="#h0-14-7" id="h0-14-7" class="d">-			if(!BETWEEN(newx, 0, term.col - 1)) {
</a><a href="#h0-14-8" id="h0-14-8" class="i">+			if (!BETWEEN(newx, 0, term.col - 1)) {
</a> 				newy += direction;
 				newx = (newx + term.col) % term.col;
 				if (!BETWEEN(newy, 0, term.row - 1))
 					break;
 
<a href="#h0-14-14" id="h0-14-14" class="d">-				if(direction &gt; 0)
</a><a href="#h0-14-15" id="h0-14-15" class="i">+				if (direction &gt; 0)
</a> 					yt = *y, xt = *x;
 				else
 					yt = newy, xt = newx;
<a href="#h0-14-19" id="h0-14-19" class="d">-				if(!(term.line[yt][xt].mode &amp; ATTR_WRAP))
</a><a href="#h0-14-20" id="h0-14-20" class="i">+				if (!(term.line[yt][xt].mode &amp; ATTR_WRAP))
</a> 					break;
 			}
 
<a href="#h0-15" id="h0-15" class="h">@@ -800,7 +800,7 @@ selsnap(int *x, int *y, int direction)
</a> 
 			gp = &amp;term.line[newy][newx];
 			delim = ISDELIM(gp-&gt;u);
<a href="#h0-15-3" id="h0-15-3" class="d">-			if(!(gp-&gt;mode &amp; ATTR_WDUMMY) &amp;&amp; (delim != prevdelim
</a><a href="#h0-15-4" id="h0-15-4" class="i">+			if (!(gp-&gt;mode &amp; ATTR_WDUMMY) &amp;&amp; (delim != prevdelim
</a> 					|| (delim &amp;&amp; gp-&gt;u != prevgp-&gt;u)))
 				break;
 
<a href="#h0-16" id="h0-16" class="h">@@ -817,16 +817,16 @@ selsnap(int *x, int *y, int direction)
</a> 		 * previous line will be selected.
 		 */
 		*x = (direction &lt; 0) ? 0 : term.col - 1;
<a href="#h0-16-3" id="h0-16-3" class="d">-		if(direction &lt; 0) {
</a><a href="#h0-16-4" id="h0-16-4" class="d">-			for(; *y &gt; 0; *y += direction) {
</a><a href="#h0-16-5" id="h0-16-5" class="d">-				if(!(term.line[*y-1][term.col-1].mode
</a><a href="#h0-16-6" id="h0-16-6" class="i">+		if (direction &lt; 0) {
</a><a href="#h0-16-7" id="h0-16-7" class="i">+			for (; *y &gt; 0; *y += direction) {
</a><a href="#h0-16-8" id="h0-16-8" class="i">+				if (!(term.line[*y-1][term.col-1].mode
</a> 						&amp; ATTR_WRAP)) {
 					break;
 				}
 			}
<a href="#h0-16-13" id="h0-16-13" class="d">-		} else if(direction &gt; 0) {
</a><a href="#h0-16-14" id="h0-16-14" class="d">-			for(; *y &lt; term.row-1; *y += direction) {
</a><a href="#h0-16-15" id="h0-16-15" class="d">-				if(!(term.line[*y][term.col-1].mode
</a><a href="#h0-16-16" id="h0-16-16" class="i">+		} else if (direction &gt; 0) {
</a><a href="#h0-16-17" id="h0-16-17" class="i">+			for (; *y &lt; term.row-1; *y += direction) {
</a><a href="#h0-16-18" id="h0-16-18" class="i">+				if (!(term.line[*y][term.col-1].mode
</a> 						&amp; ATTR_WRAP)) {
 					break;
 				}
<a href="#h0-17" id="h0-17" class="h">@@ -849,8 +849,8 @@ getbuttoninfo(XEvent *e)
</a> 	selnormalize();
 
 	sel.type = SEL_REGULAR;
<a href="#h0-17-3" id="h0-17-3" class="d">-	for(type = 1; type &lt; LEN(selmasks); ++type) {
</a><a href="#h0-17-4" id="h0-17-4" class="d">-		if(match(selmasks[type], state)) {
</a><a href="#h0-17-5" id="h0-17-5" class="i">+	for (type = 1; type &lt; LEN(selmasks); ++type) {
</a><a href="#h0-17-6" id="h0-17-6" class="i">+		if (match(selmasks[type], state)) {
</a> 			sel.type = type;
 			break;
 		}
<a href="#h0-18" id="h0-18" class="h">@@ -867,51 +867,51 @@ mousereport(XEvent *e)
</a> 	static int ox, oy;
 
 	/* from urxvt */
<a href="#h0-18-3" id="h0-18-3" class="d">-	if(e-&gt;xbutton.type == MotionNotify) {
</a><a href="#h0-18-4" id="h0-18-4" class="d">-		if(x == ox &amp;&amp; y == oy)
</a><a href="#h0-18-5" id="h0-18-5" class="i">+	if (e-&gt;xbutton.type == MotionNotify) {
</a><a href="#h0-18-6" id="h0-18-6" class="i">+		if (x == ox &amp;&amp; y == oy)
</a> 			return;
<a href="#h0-18-8" id="h0-18-8" class="d">-		if(!IS_SET(MODE_MOUSEMOTION) &amp;&amp; !IS_SET(MODE_MOUSEMANY))
</a><a href="#h0-18-9" id="h0-18-9" class="i">+		if (!IS_SET(MODE_MOUSEMOTION) &amp;&amp; !IS_SET(MODE_MOUSEMANY))
</a> 			return;
 		/* MOUSE_MOTION: no reporting if no button is pressed */
<a href="#h0-18-12" id="h0-18-12" class="d">-		if(IS_SET(MODE_MOUSEMOTION) &amp;&amp; oldbutton == 3)
</a><a href="#h0-18-13" id="h0-18-13" class="i">+		if (IS_SET(MODE_MOUSEMOTION) &amp;&amp; oldbutton == 3)
</a> 			return;
 
 		button = oldbutton + 32;
 		ox = x;
 		oy = y;
 	} else {
<a href="#h0-18-20" id="h0-18-20" class="d">-		if(!IS_SET(MODE_MOUSESGR) &amp;&amp; e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h0-18-21" id="h0-18-21" class="i">+		if (!IS_SET(MODE_MOUSESGR) &amp;&amp; e-&gt;xbutton.type == ButtonRelease) {
</a> 			button = 3;
 		} else {
 			button -= Button1;
<a href="#h0-18-25" id="h0-18-25" class="d">-			if(button &gt;= 3)
</a><a href="#h0-18-26" id="h0-18-26" class="i">+			if (button &gt;= 3)
</a> 				button += 64 - 3;
 		}
<a href="#h0-18-29" id="h0-18-29" class="d">-		if(e-&gt;xbutton.type == ButtonPress) {
</a><a href="#h0-18-30" id="h0-18-30" class="i">+		if (e-&gt;xbutton.type == ButtonPress) {
</a> 			oldbutton = button;
 			ox = x;
 			oy = y;
<a href="#h0-18-34" id="h0-18-34" class="d">-		} else if(e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h0-18-35" id="h0-18-35" class="i">+		} else if (e-&gt;xbutton.type == ButtonRelease) {
</a> 			oldbutton = 3;
 			/* MODE_MOUSEX10: no button release reporting */
<a href="#h0-18-38" id="h0-18-38" class="d">-			if(IS_SET(MODE_MOUSEX10))
</a><a href="#h0-18-39" id="h0-18-39" class="i">+			if (IS_SET(MODE_MOUSEX10))
</a> 				return;
 			if (button == 64 || button == 65)
 				return;
 		}
 	}
 
<a href="#h0-18-46" id="h0-18-46" class="d">-	if(!IS_SET(MODE_MOUSEX10)) {
</a><a href="#h0-18-47" id="h0-18-47" class="i">+	if (!IS_SET(MODE_MOUSEX10)) {
</a> 		button += ((state &amp; ShiftMask  ) ? 4  : 0)
 			+ ((state &amp; Mod4Mask   ) ? 8  : 0)
 			+ ((state &amp; ControlMask) ? 16 : 0);
 	}
 
<a href="#h0-18-53" id="h0-18-53" class="d">-	if(IS_SET(MODE_MOUSESGR)) {
</a><a href="#h0-18-54" id="h0-18-54" class="i">+	if (IS_SET(MODE_MOUSESGR)) {
</a> 		len = snprintf(buf, sizeof(buf), &quot;\033[&lt;%d;%d;%d%c&quot;,
 				button, x+1, y+1,
 				e-&gt;xbutton.type == ButtonRelease ? &#39;m&#39; : &#39;M&#39;);
<a href="#h0-18-58" id="h0-18-58" class="d">-	} else if(x &lt; 223 &amp;&amp; y &lt; 223) {
</a><a href="#h0-18-59" id="h0-18-59" class="i">+	} else if (x &lt; 223 &amp;&amp; y &lt; 223) {
</a> 		len = snprintf(buf, sizeof(buf), &quot;\033[M%c%c%c&quot;,
 				32+button, 32+x+1, 32+y+1);
 	} else {
<a href="#h0-19" id="h0-19" class="h">@@ -927,20 +927,20 @@ bpress(XEvent *e)
</a> 	struct timespec now;
 	Mousekey *mk;
 
<a href="#h0-19-3" id="h0-19-3" class="d">-	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-19-4" id="h0-19-4" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a> 		mousereport(e);
 		return;
 	}
 
<a href="#h0-19-9" id="h0-19-9" class="d">-	for(mk = mshortcuts; mk &lt; mshortcuts + LEN(mshortcuts); mk++) {
</a><a href="#h0-19-10" id="h0-19-10" class="d">-		if(e-&gt;xbutton.button == mk-&gt;b
</a><a href="#h0-19-11" id="h0-19-11" class="i">+	for (mk = mshortcuts; mk &lt; mshortcuts + LEN(mshortcuts); mk++) {
</a><a href="#h0-19-12" id="h0-19-12" class="i">+		if (e-&gt;xbutton.button == mk-&gt;b
</a> 				&amp;&amp; match(mk-&gt;mask, e-&gt;xbutton.state)) {
 			ttysend(mk-&gt;s, strlen(mk-&gt;s));
 			return;
 		}
 	}
 
<a href="#h0-19-19" id="h0-19-19" class="d">-	if(e-&gt;xbutton.button == Button1) {
</a><a href="#h0-19-20" id="h0-19-20" class="i">+	if (e-&gt;xbutton.button == Button1) {
</a> 		clock_gettime(CLOCK_MONOTONIC, &amp;now);
 
 		/* Clear previous selection, logically and visually. */
<a href="#h0-20" id="h0-20" class="h">@@ -954,16 +954,16 @@ bpress(XEvent *e)
</a> 		 * If the user clicks below predefined timeouts specific
 		 * snapping behaviour is exposed.
 		 */
<a href="#h0-20-3" id="h0-20-3" class="d">-		if(TIMEDIFF(now, sel.tclick2) &lt;= tripleclicktimeout) {
</a><a href="#h0-20-4" id="h0-20-4" class="i">+		if (TIMEDIFF(now, sel.tclick2) &lt;= tripleclicktimeout) {
</a> 			sel.snap = SNAP_LINE;
<a href="#h0-20-6" id="h0-20-6" class="d">-		} else if(TIMEDIFF(now, sel.tclick1) &lt;= doubleclicktimeout) {
</a><a href="#h0-20-7" id="h0-20-7" class="i">+		} else if (TIMEDIFF(now, sel.tclick1) &lt;= doubleclicktimeout) {
</a> 			sel.snap = SNAP_WORD;
 		} else {
 			sel.snap = 0;
 		}
 		selnormalize();
 
<a href="#h0-20-14" id="h0-20-14" class="d">-		if(sel.snap != 0)
</a><a href="#h0-20-15" id="h0-20-15" class="i">+		if (sel.snap != 0)
</a> 			sel.mode = SEL_READY;
 		tsetdirt(sel.nb.y, sel.ne.y);
 		sel.tclick2 = sel.tclick1;
<a href="#h0-21" id="h0-21" class="h">@@ -978,17 +978,17 @@ getsel(void)
</a> 	int y, bufsize, lastx, linelen;
 	Glyph *gp, *last;
 
<a href="#h0-21-3" id="h0-21-3" class="d">-	if(sel.ob.x == -1)
</a><a href="#h0-21-4" id="h0-21-4" class="i">+	if (sel.ob.x == -1)
</a> 		return NULL;
 
 	bufsize = (term.col+1) * (sel.ne.y-sel.nb.y+1) * UTF_SIZ;
 	ptr = str = xmalloc(bufsize);
 
 	/* append every set &amp; selected glyph to the selection */
<a href="#h0-21-11" id="h0-21-11" class="d">-	for(y = sel.nb.y; y &lt;= sel.ne.y; y++) {
</a><a href="#h0-21-12" id="h0-21-12" class="i">+	for (y = sel.nb.y; y &lt;= sel.ne.y; y++) {
</a> 		linelen = tlinelen(y);
 
<a href="#h0-21-15" id="h0-21-15" class="d">-		if(sel.type == SEL_RECTANGULAR) {
</a><a href="#h0-21-16" id="h0-21-16" class="i">+		if (sel.type == SEL_RECTANGULAR) {
</a> 			gp = &amp;term.line[y][sel.nb.x];
 			lastx = sel.ne.x;
 		} else {
<a href="#h0-22" id="h0-22" class="h">@@ -996,11 +996,11 @@ getsel(void)
</a> 			lastx = (sel.ne.y == y) ? sel.ne.x : term.col-1;
 		}
 		last = &amp;term.line[y][MIN(lastx, linelen-1)];
<a href="#h0-22-3" id="h0-22-3" class="d">-		while(last &gt;= gp &amp;&amp; last-&gt;u == &#39; &#39;)
</a><a href="#h0-22-4" id="h0-22-4" class="i">+		while (last &gt;= gp &amp;&amp; last-&gt;u == &#39; &#39;)
</a> 			--last;
 
<a href="#h0-22-7" id="h0-22-7" class="d">-		for( ; gp &lt;= last; ++gp) {
</a><a href="#h0-22-8" id="h0-22-8" class="d">-			if(gp-&gt;mode &amp; ATTR_WDUMMY)
</a><a href="#h0-22-9" id="h0-22-9" class="i">+		for ( ; gp &lt;= last; ++gp) {
</a><a href="#h0-22-10" id="h0-22-10" class="i">+			if (gp-&gt;mode &amp; ATTR_WDUMMY)
</a> 				continue;
 
 			ptr += utf8encode(gp-&gt;u, ptr);
<a href="#h0-23" id="h0-23" class="h">@@ -1015,7 +1015,7 @@ getsel(void)
</a> 		 * st.
 		 * FIXME: Fix the computer world.
 		 */
<a href="#h0-23-3" id="h0-23-3" class="d">-		if((y &lt; sel.ne.y || lastx &gt;= linelen) &amp;&amp; !(last-&gt;mode &amp; ATTR_WRAP))
</a><a href="#h0-23-4" id="h0-23-4" class="i">+		if ((y &lt; sel.ne.y || lastx &gt;= linelen) &amp;&amp; !(last-&gt;mode &amp; ATTR_WRAP))
</a> 			*ptr++ = &#39;\n&#39;;
 	}
 	*ptr = 0;
<a href="#h0-24" id="h0-24" class="h">@@ -1042,7 +1042,7 @@ selnotify(XEvent *e)
</a> 	if (xsev-&gt;property == None)
 	    return;
 	do {
<a href="#h0-24-3" id="h0-24-3" class="d">-		if(XGetWindowProperty(xw.dpy, xw.win, xsev-&gt;property, ofs,
</a><a href="#h0-24-4" id="h0-24-4" class="i">+		if (XGetWindowProperty(xw.dpy, xw.win, xsev-&gt;property, ofs,
</a> 					BUFSIZ/4, False, AnyPropertyType,
 					&amp;type, &amp;format, &amp;nitems, &amp;rem,
 					&amp;data)) {
<a href="#h0-25" id="h0-25" class="h">@@ -1059,19 +1059,19 @@ selnotify(XEvent *e)
</a> 		 */
 		repl = data;
 		last = data + nitems * format / 8;
<a href="#h0-25-3" id="h0-25-3" class="d">-		while((repl = memchr(repl, &#39;\n&#39;, last - repl))) {
</a><a href="#h0-25-4" id="h0-25-4" class="i">+		while ((repl = memchr(repl, &#39;\n&#39;, last - repl))) {
</a> 			*repl++ = &#39;\r&#39;;
 		}
 
<a href="#h0-25-8" id="h0-25-8" class="d">-		if(IS_SET(MODE_BRCKTPASTE))
</a><a href="#h0-25-9" id="h0-25-9" class="i">+		if (IS_SET(MODE_BRCKTPASTE))
</a> 			ttywrite(&quot;\033[200~&quot;, 6);
 		ttysend((char *)data, nitems * format / 8);
<a href="#h0-25-12" id="h0-25-12" class="d">-		if(IS_SET(MODE_BRCKTPASTE))
</a><a href="#h0-25-13" id="h0-25-13" class="i">+		if (IS_SET(MODE_BRCKTPASTE))
</a> 			ttywrite(&quot;\033[201~&quot;, 6);
 		XFree(data);
 		/* number of 32-bit chunks returned */
 		ofs += nitems * format / 32;
<a href="#h0-25-18" id="h0-25-18" class="d">-	} while(rem &gt; 0);
</a><a href="#h0-25-19" id="h0-25-19" class="i">+	} while (rem &gt; 0);
</a> }
 
 void
<a href="#h0-26" id="h0-26" class="h">@@ -1086,10 +1086,10 @@ clipcopy(const Arg *dummy)
</a> {
 	Atom clipboard;
 
<a href="#h0-26-3" id="h0-26-3" class="d">-	if(sel.clipboard != NULL)
</a><a href="#h0-26-4" id="h0-26-4" class="i">+	if (sel.clipboard != NULL)
</a> 		free(sel.clipboard);
 
<a href="#h0-26-7" id="h0-26-7" class="d">-	if(sel.primary != NULL) {
</a><a href="#h0-26-8" id="h0-26-8" class="i">+	if (sel.primary != NULL) {
</a> 		sel.clipboard = xstrdup(sel.primary);
 		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
 		XSetSelectionOwner(xw.dpy, clipboard, xw.win, CurrentTime);
<a href="#h0-27" id="h0-27" class="h">@@ -1109,7 +1109,7 @@ clippaste(const Arg *dummy)
</a> void
 selclear(XEvent *e)
 {
<a href="#h0-27-3" id="h0-27-3" class="d">-	if(sel.ob.x == -1)
</a><a href="#h0-27-4" id="h0-27-4" class="i">+	if (sel.ob.x == -1)
</a> 		return;
 	sel.mode = SEL_IDLE;
 	sel.ob.x = -1;
<a href="#h0-28" id="h0-28" class="h">@@ -1137,22 +1137,22 @@ selrequest(XEvent *e)
</a> 	xev.property = None;
 
 	xa_targets = XInternAtom(xw.dpy, &quot;TARGETS&quot;, 0);
<a href="#h0-28-3" id="h0-28-3" class="d">-	if(xsre-&gt;target == xa_targets) {
</a><a href="#h0-28-4" id="h0-28-4" class="i">+	if (xsre-&gt;target == xa_targets) {
</a> 		/* respond with the supported type */
 		string = sel.xtarget;
 		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
 				XA_ATOM, 32, PropModeReplace,
 				(uchar *) &amp;string, 1);
 		xev.property = xsre-&gt;property;
<a href="#h0-28-11" id="h0-28-11" class="d">-	} else if(xsre-&gt;target == sel.xtarget || xsre-&gt;target == XA_STRING) {
</a><a href="#h0-28-12" id="h0-28-12" class="i">+	} else if (xsre-&gt;target == sel.xtarget || xsre-&gt;target == XA_STRING) {
</a> 		/*
 		 * xith XA_STRING non ascii characters may be incorrect in the
 		 * requestor. It is not our problem, use utf8.
 		 */
 		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
<a href="#h0-28-18" id="h0-28-18" class="d">-		if(xsre-&gt;selection == XA_PRIMARY) {
</a><a href="#h0-28-19" id="h0-28-19" class="i">+		if (xsre-&gt;selection == XA_PRIMARY) {
</a> 			seltext = sel.primary;
<a href="#h0-28-21" id="h0-28-21" class="d">-		} else if(xsre-&gt;selection == clipboard) {
</a><a href="#h0-28-22" id="h0-28-22" class="i">+		} else if (xsre-&gt;selection == clipboard) {
</a> 			seltext = sel.clipboard;
 		} else {
 			fprintf(stderr,
<a href="#h0-29" id="h0-29" class="h">@@ -1160,7 +1160,7 @@ selrequest(XEvent *e)
</a> 				xsre-&gt;selection);
 			return;
 		}
<a href="#h0-29-3" id="h0-29-3" class="d">-		if(seltext != NULL) {
</a><a href="#h0-29-4" id="h0-29-4" class="i">+		if (seltext != NULL) {
</a> 			XChangeProperty(xsre-&gt;display, xsre-&gt;requestor,
 					xsre-&gt;property, xsre-&gt;target,
 					8, PropModeReplace,
<a href="#h0-30" id="h0-30" class="h">@@ -1170,7 +1170,7 @@ selrequest(XEvent *e)
</a> 	}
 
 	/* all done, send a notification to the listener */
<a href="#h0-30-3" id="h0-30-3" class="d">-	if(!XSendEvent(xsre-&gt;display, xsre-&gt;requestor, 1, 0, (XEvent *) &amp;xev))
</a><a href="#h0-30-4" id="h0-30-4" class="i">+	if (!XSendEvent(xsre-&gt;display, xsre-&gt;requestor, 1, 0, (XEvent *) &amp;xev))
</a> 		fprintf(stderr, &quot;Error sending SelectionNotify event\n&quot;);
 }
 
<a href="#h0-31" id="h0-31" class="h">@@ -1188,15 +1188,15 @@ xsetsel(char *str, Time t)
</a> void
 brelease(XEvent *e)
 {
<a href="#h0-31-3" id="h0-31-3" class="d">-	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-31-4" id="h0-31-4" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a> 		mousereport(e);
 		return;
 	}
 
<a href="#h0-31-9" id="h0-31-9" class="d">-	if(e-&gt;xbutton.button == Button2) {
</a><a href="#h0-31-10" id="h0-31-10" class="i">+	if (e-&gt;xbutton.button == Button2) {
</a> 		selpaste(NULL);
<a href="#h0-31-12" id="h0-31-12" class="d">-	} else if(e-&gt;xbutton.button == Button1) {
</a><a href="#h0-31-13" id="h0-31-13" class="d">-		if(sel.mode == SEL_READY) {
</a><a href="#h0-31-14" id="h0-31-14" class="i">+	} else if (e-&gt;xbutton.button == Button1) {
</a><a href="#h0-31-15" id="h0-31-15" class="i">+		if (sel.mode == SEL_READY) {
</a> 			getbuttoninfo(e);
 			selcopy(e-&gt;xbutton.time);
 		} else
<a href="#h0-32" id="h0-32" class="h">@@ -1211,12 +1211,12 @@ bmotion(XEvent *e)
</a> {
 	int oldey, oldex, oldsby, oldsey;
 
<a href="#h0-32-3" id="h0-32-3" class="d">-	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-32-4" id="h0-32-4" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a> 		mousereport(e);
 		return;
 	}
 
<a href="#h0-32-9" id="h0-32-9" class="d">-	if(!sel.mode)
</a><a href="#h0-32-10" id="h0-32-10" class="i">+	if (!sel.mode)
</a> 		return;
 
 	sel.mode = SEL_READY;
<a href="#h0-33" id="h0-33" class="h">@@ -1226,7 +1226,7 @@ bmotion(XEvent *e)
</a> 	oldsey = sel.ne.y;
 	getbuttoninfo(e);
 
<a href="#h0-33-3" id="h0-33-3" class="d">-	if(oldey != sel.oe.y || oldex != sel.oe.x)
</a><a href="#h0-33-4" id="h0-33-4" class="i">+	if (oldey != sel.oe.y || oldex != sel.oe.x)
</a> 		tsetdirt(MIN(sel.nb.y, oldsby), MAX(sel.ne.y, oldsey));
 }
 
<a href="#h0-34" id="h0-34" class="h">@@ -1249,8 +1249,8 @@ execsh(void)
</a> 	char buf[sizeof(long) * 8 + 1];
 
 	errno = 0;
<a href="#h0-34-3" id="h0-34-3" class="d">-	if((pw = getpwuid(getuid())) == NULL) {
</a><a href="#h0-34-4" id="h0-34-4" class="d">-		if(errno)
</a><a href="#h0-34-5" id="h0-34-5" class="i">+	if ((pw = getpwuid(getuid())) == NULL) {
</a><a href="#h0-34-6" id="h0-34-6" class="i">+		if (errno)
</a> 			die(&quot;getpwuid:%s\n&quot;, strerror(errno));
 		else
 			die(&quot;who are you?\n&quot;);
<a href="#h0-35" id="h0-35" class="h">@@ -1260,9 +1260,9 @@ execsh(void)
</a> 		sh = (pw-&gt;pw_shell[0]) ? pw-&gt;pw_shell : shell;
 	}
 
<a href="#h0-35-3" id="h0-35-3" class="d">-	if(opt_cmd)
</a><a href="#h0-35-4" id="h0-35-4" class="i">+	if (opt_cmd)
</a> 		prog = opt_cmd[0];
<a href="#h0-35-6" id="h0-35-6" class="d">-	else if(utmp)
</a><a href="#h0-35-7" id="h0-35-7" class="i">+	else if (utmp)
</a> 		prog = utmp;
 	else
 		prog = sh;
<a href="#h0-36" id="h0-36" class="h">@@ -1297,10 +1297,10 @@ sigchld(int a)
</a> 	int stat;
 	pid_t p;
 
<a href="#h0-36-3" id="h0-36-3" class="d">-	if((p = waitpid(pid, &amp;stat, WNOHANG)) &lt; 0)
</a><a href="#h0-36-4" id="h0-36-4" class="i">+	if ((p = waitpid(pid, &amp;stat, WNOHANG)) &lt; 0)
</a> 		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
 
<a href="#h0-36-7" id="h0-36-7" class="d">-	if(pid != p)
</a><a href="#h0-36-8" id="h0-36-8" class="i">+	if (pid != p)
</a> 		return;
 
 	if (!WIFEXITED(stat) || WEXITSTATUS(stat))
<a href="#h0-37" id="h0-37" class="h">@@ -1315,13 +1315,13 @@ stty(void)
</a> 	char cmd[_POSIX_ARG_MAX], **p, *q, *s;
 	size_t n, siz;
 
<a href="#h0-37-3" id="h0-37-3" class="d">-	if((n = strlen(stty_args)) &gt; sizeof(cmd)-1)
</a><a href="#h0-37-4" id="h0-37-4" class="i">+	if ((n = strlen(stty_args)) &gt; sizeof(cmd)-1)
</a> 		die(&quot;incorrect stty parameters\n&quot;);
 	memcpy(cmd, stty_args, n);
 	q = cmd + n;
 	siz = sizeof(cmd) - n;
<a href="#h0-37-9" id="h0-37-9" class="d">-	for(p = opt_cmd; p &amp;&amp; (s = *p); ++p) {
</a><a href="#h0-37-10" id="h0-37-10" class="d">-		if((n = strlen(s)) &gt; siz-1)
</a><a href="#h0-37-11" id="h0-37-11" class="i">+	for (p = opt_cmd; p &amp;&amp; (s = *p); ++p) {
</a><a href="#h0-37-12" id="h0-37-12" class="i">+		if ((n = strlen(s)) &gt; siz-1)
</a> 			die(&quot;stty parameter length too long\n&quot;);
 		*q++ = &#39; &#39;;
 		q = memcpy(q, s, n);
<a href="#h0-38" id="h0-38" class="h">@@ -1339,18 +1339,18 @@ ttynew(void)
</a> 	int m, s;
 	struct winsize w = {term.row, term.col, 0, 0};
 
<a href="#h0-38-3" id="h0-38-3" class="d">-	if(opt_io) {
</a><a href="#h0-38-4" id="h0-38-4" class="i">+	if (opt_io) {
</a> 		term.mode |= MODE_PRINT;
 		iofd = (!strcmp(opt_io, &quot;-&quot;)) ?
 			  1 : open(opt_io, O_WRONLY | O_CREAT, 0666);
<a href="#h0-38-8" id="h0-38-8" class="d">-		if(iofd &lt; 0) {
</a><a href="#h0-38-9" id="h0-38-9" class="i">+		if (iofd &lt; 0) {
</a> 			fprintf(stderr, &quot;Error opening %s:%s\n&quot;,
 				opt_io, strerror(errno));
 		}
 	}
 
 	if (opt_line) {
<a href="#h0-38-16" id="h0-38-16" class="d">-		if((cmdfd = open(opt_line, O_RDWR)) &lt; 0)
</a><a href="#h0-38-17" id="h0-38-17" class="i">+		if ((cmdfd = open(opt_line, O_RDWR)) &lt; 0)
</a> 			die(&quot;open line failed: %s\n&quot;, strerror(errno));
 		close(0);
 		dup(cmdfd);
<a href="#h0-39" id="h0-39" class="h">@@ -1359,10 +1359,10 @@ ttynew(void)
</a> 	}
 
 	/* seems to work fine on linux, openbsd and freebsd */
<a href="#h0-39-3" id="h0-39-3" class="d">-	if(openpty(&amp;m, &amp;s, NULL, NULL, &amp;w) &lt; 0)
</a><a href="#h0-39-4" id="h0-39-4" class="i">+	if (openpty(&amp;m, &amp;s, NULL, NULL, &amp;w) &lt; 0)
</a> 		die(&quot;openpty failed: %s\n&quot;, strerror(errno));
 
<a href="#h0-39-7" id="h0-39-7" class="d">-	switch(pid = fork()) {
</a><a href="#h0-39-8" id="h0-39-8" class="i">+	switch (pid = fork()) {
</a> 	case -1:
 		die(&quot;fork failed\n&quot;);
 		break;
<a href="#h0-40" id="h0-40" class="h">@@ -1372,7 +1372,7 @@ ttynew(void)
</a> 		dup2(s, 0);
 		dup2(s, 1);
 		dup2(s, 2);
<a href="#h0-40-3" id="h0-40-3" class="d">-		if(ioctl(s, TIOCSCTTY, NULL) &lt; 0)
</a><a href="#h0-40-4" id="h0-40-4" class="i">+		if (ioctl(s, TIOCSCTTY, NULL) &lt; 0)
</a> 			die(&quot;ioctl TIOCSCTTY failed: %s\n&quot;, strerror(errno));
 		close(s);
 		close(m);
<a href="#h0-41" id="h0-41" class="h">@@ -1397,13 +1397,13 @@ ttyread(void)
</a> 	int ret;
 
 	/* append read bytes to unprocessed bytes */
<a href="#h0-41-3" id="h0-41-3" class="d">-	if((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
</a><a href="#h0-41-4" id="h0-41-4" class="i">+	if ((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
</a> 		die(&quot;Couldn&#39;t read from shell: %s\n&quot;, strerror(errno));
 
 	/* process every complete utf8 char */
 	buflen += ret;
 	ptr = buf;
<a href="#h0-41-10" id="h0-41-10" class="d">-	while((charsize = utf8decode(ptr, &amp;unicodep, buflen))) {
</a><a href="#h0-41-11" id="h0-41-11" class="i">+	while ((charsize = utf8decode(ptr, &amp;unicodep, buflen))) {
</a> 		tputc(unicodep);
 		ptr += charsize;
 		buflen -= charsize;
<a href="#h0-42" id="h0-42" class="h">@@ -1416,7 +1416,7 @@ ttyread(void)
</a> void
 ttywrite(const char *s, size_t n)
 {
<a href="#h0-42-3" id="h0-42-3" class="d">-	if(xwrite(cmdfd, s, n) == -1)
</a><a href="#h0-42-4" id="h0-42-4" class="i">+	if (xwrite(cmdfd, s, n) == -1)
</a> 		die(&quot;write error on tty: %s\n&quot;, strerror(errno));
 }
 
<a href="#h0-43" id="h0-43" class="h">@@ -1427,8 +1427,8 @@ ttysend(char *s, size_t n)
</a> 	Rune u;
 
 	ttywrite(s, n);
<a href="#h0-43-3" id="h0-43-3" class="d">-	if(IS_SET(MODE_ECHO))
</a><a href="#h0-43-4" id="h0-43-4" class="d">-		while((len = utf8decode(s, &amp;u, n)) &gt; 0) {
</a><a href="#h0-43-5" id="h0-43-5" class="i">+	if (IS_SET(MODE_ECHO))
</a><a href="#h0-43-6" id="h0-43-6" class="i">+		while ((len = utf8decode(s, &amp;u, n)) &gt; 0) {
</a> 			techo(u);
 			n -= len;
 			s += len;
<a href="#h0-44" id="h0-44" class="h">@@ -1444,7 +1444,7 @@ ttyresize(void)
</a> 	w.ws_col = term.col;
 	w.ws_xpixel = xw.tw;
 	w.ws_ypixel = xw.th;
<a href="#h0-44-3" id="h0-44-3" class="d">-	if(ioctl(cmdfd, TIOCSWINSZ, &amp;w) &lt; 0)
</a><a href="#h0-44-4" id="h0-44-4" class="i">+	if (ioctl(cmdfd, TIOCSWINSZ, &amp;w) &lt; 0)
</a> 		fprintf(stderr, &quot;Couldn&#39;t set window size: %s\n&quot;, strerror(errno));
 }
 
<a href="#h0-45" id="h0-45" class="h">@@ -1453,9 +1453,9 @@ tattrset(int attr)
</a> {
 	int i, j;
 
<a href="#h0-45-3" id="h0-45-3" class="d">-	for(i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-45-4" id="h0-45-4" class="d">-		for(j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-45-5" id="h0-45-5" class="d">-			if(term.line[i][j].mode &amp; attr)
</a><a href="#h0-45-6" id="h0-45-6" class="i">+	for (i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-45-7" id="h0-45-7" class="i">+		for (j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-45-8" id="h0-45-8" class="i">+			if (term.line[i][j].mode &amp; attr)
</a> 				return 1;
 		}
 	}
<a href="#h0-46" id="h0-46" class="h">@@ -1471,7 +1471,7 @@ tsetdirt(int top, int bot)
</a> 	LIMIT(top, 0, term.row-1);
 	LIMIT(bot, 0, term.row-1);
 
<a href="#h0-46-3" id="h0-46-3" class="d">-	for(i = top; i &lt;= bot; i++)
</a><a href="#h0-46-4" id="h0-46-4" class="i">+	for (i = top; i &lt;= bot; i++)
</a> 		term.dirty[i] = 1;
 }
 
<a href="#h0-47" id="h0-47" class="h">@@ -1480,9 +1480,9 @@ tsetdirtattr(int attr)
</a> {
 	int i, j;
 
<a href="#h0-47-3" id="h0-47-3" class="d">-	for(i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-47-4" id="h0-47-4" class="d">-		for(j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-47-5" id="h0-47-5" class="d">-			if(term.line[i][j].mode &amp; attr) {
</a><a href="#h0-47-6" id="h0-47-6" class="i">+	for (i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-47-7" id="h0-47-7" class="i">+		for (j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-47-8" id="h0-47-8" class="i">+			if (term.line[i][j].mode &amp; attr) {
</a> 				tsetdirt(i, i);
 				break;
 			}
<a href="#h0-48" id="h0-48" class="h">@@ -1502,9 +1502,9 @@ tcursor(int mode)
</a> 	static TCursor c[2];
 	int alt = IS_SET(MODE_ALTSCREEN);
 
<a href="#h0-48-3" id="h0-48-3" class="d">-	if(mode == CURSOR_SAVE) {
</a><a href="#h0-48-4" id="h0-48-4" class="i">+	if (mode == CURSOR_SAVE) {
</a> 		c[alt] = term.c;
<a href="#h0-48-6" id="h0-48-6" class="d">-	} else if(mode == CURSOR_LOAD) {
</a><a href="#h0-48-7" id="h0-48-7" class="i">+	} else if (mode == CURSOR_LOAD) {
</a> 		term.c = c[alt];
 		tmoveto(c[alt].x, c[alt].y);
 	}
<a href="#h0-49" id="h0-49" class="h">@@ -1522,7 +1522,7 @@ treset(void)
</a> 	}, .x = 0, .y = 0, .state = CURSOR_DEFAULT};
 
 	memset(term.tabs, 0, term.col * sizeof(*term.tabs));
<a href="#h0-49-3" id="h0-49-3" class="d">-	for(i = tabspaces; i &lt; term.col; i += tabspaces)
</a><a href="#h0-49-4" id="h0-49-4" class="i">+	for (i = tabspaces; i &lt; term.col; i += tabspaces)
</a> 		term.tabs[i] = 1;
 	term.top = 0;
 	term.bot = term.row - 1;
<a href="#h0-50" id="h0-50" class="h">@@ -1530,7 +1530,7 @@ treset(void)
</a> 	memset(term.trantbl, CS_USA, sizeof(term.trantbl));
 	term.charset = 0;
 
<a href="#h0-50-3" id="h0-50-3" class="d">-	for(i = 0; i &lt; 2; i++) {
</a><a href="#h0-50-4" id="h0-50-4" class="i">+	for (i = 0; i &lt; 2; i++) {
</a> 		tmoveto(0, 0);
 		tcursor(CURSOR_SAVE);
 		tclearregion(0, 0, term.col-1, term.row-1);
<a href="#h0-51" id="h0-51" class="h">@@ -1570,7 +1570,7 @@ tscrolldown(int orig, int n)
</a> 	tsetdirt(orig, term.bot-n);
 	tclearregion(0, term.bot-n+1, term.col-1, term.bot);
 
<a href="#h0-51-3" id="h0-51-3" class="d">-	for(i = term.bot; i &gt;= orig+n; i--) {
</a><a href="#h0-51-4" id="h0-51-4" class="i">+	for (i = term.bot; i &gt;= orig+n; i--) {
</a> 		temp = term.line[i];
 		term.line[i] = term.line[i-n];
 		term.line[i-n] = temp;
<a href="#h0-52" id="h0-52" class="h">@@ -1590,7 +1590,7 @@ tscrollup(int orig, int n)
</a> 	tclearregion(0, orig, term.col-1, orig+n-1);
 	tsetdirt(orig+n, term.bot);
 
<a href="#h0-52-3" id="h0-52-3" class="d">-	for(i = orig; i &lt;= term.bot-n; i++) {
</a><a href="#h0-52-4" id="h0-52-4" class="i">+	for (i = orig; i &lt;= term.bot-n; i++) {
</a> 		temp = term.line[i];
 		term.line[i] = term.line[i+n];
 		term.line[i+n] = temp;
<a href="#h0-53" id="h0-53" class="h">@@ -1602,25 +1602,25 @@ tscrollup(int orig, int n)
</a> void
 selscroll(int orig, int n)
 {
<a href="#h0-53-3" id="h0-53-3" class="d">-	if(sel.ob.x == -1)
</a><a href="#h0-53-4" id="h0-53-4" class="i">+	if (sel.ob.x == -1)
</a> 		return;
 
<a href="#h0-53-7" id="h0-53-7" class="d">-	if(BETWEEN(sel.ob.y, orig, term.bot) || BETWEEN(sel.oe.y, orig, term.bot)) {
</a><a href="#h0-53-8" id="h0-53-8" class="d">-		if((sel.ob.y += n) &gt; term.bot || (sel.oe.y += n) &lt; term.top) {
</a><a href="#h0-53-9" id="h0-53-9" class="i">+	if (BETWEEN(sel.ob.y, orig, term.bot) || BETWEEN(sel.oe.y, orig, term.bot)) {
</a><a href="#h0-53-10" id="h0-53-10" class="i">+		if ((sel.ob.y += n) &gt; term.bot || (sel.oe.y += n) &lt; term.top) {
</a> 			selclear(NULL);
 			return;
 		}
<a href="#h0-53-14" id="h0-53-14" class="d">-		if(sel.type == SEL_RECTANGULAR) {
</a><a href="#h0-53-15" id="h0-53-15" class="d">-			if(sel.ob.y &lt; term.top)
</a><a href="#h0-53-16" id="h0-53-16" class="i">+		if (sel.type == SEL_RECTANGULAR) {
</a><a href="#h0-53-17" id="h0-53-17" class="i">+			if (sel.ob.y &lt; term.top)
</a> 				sel.ob.y = term.top;
<a href="#h0-53-19" id="h0-53-19" class="d">-			if(sel.oe.y &gt; term.bot)
</a><a href="#h0-53-20" id="h0-53-20" class="i">+			if (sel.oe.y &gt; term.bot)
</a> 				sel.oe.y = term.bot;
 		} else {
<a href="#h0-53-23" id="h0-53-23" class="d">-			if(sel.ob.y &lt; term.top) {
</a><a href="#h0-53-24" id="h0-53-24" class="i">+			if (sel.ob.y &lt; term.top) {
</a> 				sel.ob.y = term.top;
 				sel.ob.x = 0;
 			}
<a href="#h0-53-28" id="h0-53-28" class="d">-			if(sel.oe.y &gt; term.bot) {
</a><a href="#h0-53-29" id="h0-53-29" class="i">+			if (sel.oe.y &gt; term.bot) {
</a> 				sel.oe.y = term.bot;
 				sel.oe.x = term.col;
 			}
<a href="#h0-54" id="h0-54" class="h">@@ -1634,7 +1634,7 @@ tnewline(int first_col)
</a> {
 	int y = term.c.y;
 
<a href="#h0-54-3" id="h0-54-3" class="d">-	if(y == term.bot) {
</a><a href="#h0-54-4" id="h0-54-4" class="i">+	if (y == term.bot) {
</a> 		tscrollup(term.top, 1);
 	} else {
 		y++;
<a href="#h0-55" id="h0-55" class="h">@@ -1649,22 +1649,22 @@ csiparse(void)
</a> 	long int v;
 
 	csiescseq.narg = 0;
<a href="#h0-55-3" id="h0-55-3" class="d">-	if(*p == &#39;?&#39;) {
</a><a href="#h0-55-4" id="h0-55-4" class="i">+	if (*p == &#39;?&#39;) {
</a> 		csiescseq.priv = 1;
 		p++;
 	}
 
 	csiescseq.buf[csiescseq.len] = &#39;\0&#39;;
<a href="#h0-55-10" id="h0-55-10" class="d">-	while(p &lt; csiescseq.buf+csiescseq.len) {
</a><a href="#h0-55-11" id="h0-55-11" class="i">+	while (p &lt; csiescseq.buf+csiescseq.len) {
</a> 		np = NULL;
 		v = strtol(p, &amp;np, 10);
<a href="#h0-55-14" id="h0-55-14" class="d">-		if(np == p)
</a><a href="#h0-55-15" id="h0-55-15" class="i">+		if (np == p)
</a> 			v = 0;
<a href="#h0-55-17" id="h0-55-17" class="d">-		if(v == LONG_MAX || v == LONG_MIN)
</a><a href="#h0-55-18" id="h0-55-18" class="i">+		if (v == LONG_MAX || v == LONG_MIN)
</a> 			v = -1;
 		csiescseq.arg[csiescseq.narg++] = v;
 		p = np;
<a href="#h0-55-22" id="h0-55-22" class="d">-		if(*p != &#39;;&#39; || csiescseq.narg == ESC_ARG_SIZ)
</a><a href="#h0-55-23" id="h0-55-23" class="i">+		if (*p != &#39;;&#39; || csiescseq.narg == ESC_ARG_SIZ)
</a> 			break;
 		p++;
 	}
<a href="#h0-56" id="h0-56" class="h">@@ -1684,7 +1684,7 @@ tmoveto(int x, int y)
</a> {
 	int miny, maxy;
 
<a href="#h0-56-3" id="h0-56-3" class="d">-	if(term.c.state &amp; CURSOR_ORIGIN) {
</a><a href="#h0-56-4" id="h0-56-4" class="i">+	if (term.c.state &amp; CURSOR_ORIGIN) {
</a> 		miny = term.top;
 		maxy = term.bot;
 	} else {
<a href="#h0-57" id="h0-57" class="h">@@ -1713,16 +1713,16 @@ tsetchar(Rune u, Glyph *attr, int x, int y)
</a> 	/*
 	 * The table is proudly stolen from rxvt.
 	 */
<a href="#h0-57-3" id="h0-57-3" class="d">-	if(term.trantbl[term.charset] == CS_GRAPHIC0 &amp;&amp;
</a><a href="#h0-57-4" id="h0-57-4" class="i">+	if (term.trantbl[term.charset] == CS_GRAPHIC0 &amp;&amp;
</a> 	   BETWEEN(u, 0x41, 0x7e) &amp;&amp; vt100_0[u - 0x41])
 		utf8decode(vt100_0[u - 0x41], &amp;u, UTF_SIZ);
 
<a href="#h0-57-8" id="h0-57-8" class="d">-	if(term.line[y][x].mode &amp; ATTR_WIDE) {
</a><a href="#h0-57-9" id="h0-57-9" class="d">-		if(x+1 &lt; term.col) {
</a><a href="#h0-57-10" id="h0-57-10" class="i">+	if (term.line[y][x].mode &amp; ATTR_WIDE) {
</a><a href="#h0-57-11" id="h0-57-11" class="i">+		if (x+1 &lt; term.col) {
</a> 			term.line[y][x+1].u = &#39; &#39;;
 			term.line[y][x+1].mode &amp;= ~ATTR_WDUMMY;
 		}
<a href="#h0-57-15" id="h0-57-15" class="d">-	} else if(term.line[y][x].mode &amp; ATTR_WDUMMY) {
</a><a href="#h0-57-16" id="h0-57-16" class="i">+	} else if (term.line[y][x].mode &amp; ATTR_WDUMMY) {
</a> 		term.line[y][x-1].u = &#39; &#39;;
 		term.line[y][x-1].mode &amp;= ~ATTR_WIDE;
 	}
<a href="#h0-58" id="h0-58" class="h">@@ -1738,9 +1738,9 @@ tclearregion(int x1, int y1, int x2, int y2)
</a> 	int x, y, temp;
 	Glyph *gp;
 
<a href="#h0-58-3" id="h0-58-3" class="d">-	if(x1 &gt; x2)
</a><a href="#h0-58-4" id="h0-58-4" class="i">+	if (x1 &gt; x2)
</a> 		temp = x1, x1 = x2, x2 = temp;
<a href="#h0-58-6" id="h0-58-6" class="d">-	if(y1 &gt; y2)
</a><a href="#h0-58-7" id="h0-58-7" class="i">+	if (y1 &gt; y2)
</a> 		temp = y1, y1 = y2, y2 = temp;
 
 	LIMIT(x1, 0, term.col-1);
<a href="#h0-59" id="h0-59" class="h">@@ -1748,11 +1748,11 @@ tclearregion(int x1, int y1, int x2, int y2)
</a> 	LIMIT(y1, 0, term.row-1);
 	LIMIT(y2, 0, term.row-1);
 
<a href="#h0-59-3" id="h0-59-3" class="d">-	for(y = y1; y &lt;= y2; y++) {
</a><a href="#h0-59-4" id="h0-59-4" class="i">+	for (y = y1; y &lt;= y2; y++) {
</a> 		term.dirty[y] = 1;
<a href="#h0-59-6" id="h0-59-6" class="d">-		for(x = x1; x &lt;= x2; x++) {
</a><a href="#h0-59-7" id="h0-59-7" class="i">+		for (x = x1; x &lt;= x2; x++) {
</a> 			gp = &amp;term.line[y][x];
<a href="#h0-59-9" id="h0-59-9" class="d">-			if(selected(x, y))
</a><a href="#h0-59-10" id="h0-59-10" class="i">+			if (selected(x, y))
</a> 				selclear(NULL);
 			gp-&gt;fg = term.c.attr.fg;
 			gp-&gt;bg = term.c.attr.bg;
<a href="#h0-60" id="h0-60" class="h">@@ -1799,14 +1799,14 @@ tinsertblank(int n)
</a> void
 tinsertblankline(int n)
 {
<a href="#h0-60-3" id="h0-60-3" class="d">-	if(BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h0-60-4" id="h0-60-4" class="i">+	if (BETWEEN(term.c.y, term.top, term.bot))
</a> 		tscrolldown(term.c.y, n);
 }
 
 void
 tdeleteline(int n)
 {
<a href="#h0-60-11" id="h0-60-11" class="d">-	if(BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h0-60-12" id="h0-60-12" class="i">+	if (BETWEEN(term.c.y, term.top, term.bot))
</a> 		tscrollup(term.c.y, n);
 }
 
<a href="#h0-61" id="h0-61" class="h">@@ -1828,7 +1828,7 @@ tdefcolor(int *attr, int *npar, int l)
</a> 		g = attr[*npar + 3];
 		b = attr[*npar + 4];
 		*npar += 4;
<a href="#h0-61-3" id="h0-61-3" class="d">-		if(!BETWEEN(r, 0, 255) || !BETWEEN(g, 0, 255) || !BETWEEN(b, 0, 255))
</a><a href="#h0-61-4" id="h0-61-4" class="i">+		if (!BETWEEN(r, 0, 255) || !BETWEEN(g, 0, 255) || !BETWEEN(b, 0, 255))
</a> 			fprintf(stderr, &quot;erresc: bad rgb color (%u,%u,%u)\n&quot;,
 				r, g, b);
 		else
<a href="#h0-62" id="h0-62" class="h">@@ -1842,7 +1842,7 @@ tdefcolor(int *attr, int *npar, int l)
</a> 			break;
 		}
 		*npar += 2;
<a href="#h0-62-3" id="h0-62-3" class="d">-		if(!BETWEEN(attr[*npar], 0, 255))
</a><a href="#h0-62-4" id="h0-62-4" class="i">+		if (!BETWEEN(attr[*npar], 0, 255))
</a> 			fprintf(stderr, &quot;erresc: bad fgcolor %d\n&quot;, attr[*npar]);
 		else
 			idx = attr[*npar];
<a href="#h0-63" id="h0-63" class="h">@@ -1866,8 +1866,8 @@ tsetattr(int *attr, int l)
</a> 	int i;
 	int32_t idx;
 
<a href="#h0-63-3" id="h0-63-3" class="d">-	for(i = 0; i &lt; l; i++) {
</a><a href="#h0-63-4" id="h0-63-4" class="d">-		switch(attr[i]) {
</a><a href="#h0-63-5" id="h0-63-5" class="i">+	for (i = 0; i &lt; l; i++) {
</a><a href="#h0-63-6" id="h0-63-6" class="i">+		switch (attr[i]) {
</a> 		case 0:
 			term.c.attr.mode &amp;= ~(
 				ATTR_BOLD       |
<a href="#h0-64" id="h0-64" class="h">@@ -1943,13 +1943,13 @@ tsetattr(int *attr, int l)
</a> 			term.c.attr.bg = defaultbg;
 			break;
 		default:
<a href="#h0-64-3" id="h0-64-3" class="d">-			if(BETWEEN(attr[i], 30, 37)) {
</a><a href="#h0-64-4" id="h0-64-4" class="i">+			if (BETWEEN(attr[i], 30, 37)) {
</a> 				term.c.attr.fg = attr[i] - 30;
<a href="#h0-64-6" id="h0-64-6" class="d">-			} else if(BETWEEN(attr[i], 40, 47)) {
</a><a href="#h0-64-7" id="h0-64-7" class="i">+			} else if (BETWEEN(attr[i], 40, 47)) {
</a> 				term.c.attr.bg = attr[i] - 40;
<a href="#h0-64-9" id="h0-64-9" class="d">-			} else if(BETWEEN(attr[i], 90, 97)) {
</a><a href="#h0-64-10" id="h0-64-10" class="i">+			} else if (BETWEEN(attr[i], 90, 97)) {
</a> 				term.c.attr.fg = attr[i] - 90 + 8;
<a href="#h0-64-12" id="h0-64-12" class="d">-			} else if(BETWEEN(attr[i], 100, 107)) {
</a><a href="#h0-64-13" id="h0-64-13" class="i">+			} else if (BETWEEN(attr[i], 100, 107)) {
</a> 				term.c.attr.bg = attr[i] - 100 + 8;
 			} else {
 				fprintf(stderr,
<a href="#h0-65" id="h0-65" class="h">@@ -1968,7 +1968,7 @@ tsetscroll(int t, int b)
</a> 
 	LIMIT(t, 0, term.row-1);
 	LIMIT(b, 0, term.row-1);
<a href="#h0-65-3" id="h0-65-3" class="d">-	if(t &gt; b) {
</a><a href="#h0-65-4" id="h0-65-4" class="i">+	if (t &gt; b) {
</a> 		temp = t;
 		t = b;
 		b = temp;
<a href="#h0-66" id="h0-66" class="h">@@ -1983,16 +1983,16 @@ tsetmode(int priv, int set, int *args, int narg)
</a> 	int *lim, mode;
 	int alt;
 
<a href="#h0-66-3" id="h0-66-3" class="d">-	for(lim = args + narg; args &lt; lim; ++args) {
</a><a href="#h0-66-4" id="h0-66-4" class="d">-		if(priv) {
</a><a href="#h0-66-5" id="h0-66-5" class="d">-			switch(*args) {
</a><a href="#h0-66-6" id="h0-66-6" class="i">+	for (lim = args + narg; args &lt; lim; ++args) {
</a><a href="#h0-66-7" id="h0-66-7" class="i">+		if (priv) {
</a><a href="#h0-66-8" id="h0-66-8" class="i">+			switch (*args) {
</a> 			case 1: /* DECCKM -- Cursor key */
 				MODBIT(term.mode, set, MODE_APPCURSOR);
 				break;
 			case 5: /* DECSCNM -- Reverse video */
 				mode = term.mode;
 				MODBIT(term.mode, set, MODE_REVERSE);
<a href="#h0-66-15" id="h0-66-15" class="d">-				if(mode != term.mode)
</a><a href="#h0-66-16" id="h0-66-16" class="i">+				if (mode != term.mode)
</a> 					redraw();
 				break;
 			case 6: /* DECOM -- Origin */
<a href="#h0-67" id="h0-67" class="h">@@ -2054,13 +2054,13 @@ tsetmode(int priv, int set, int *args, int narg)
</a> 				if (!allowaltscreen)
 					break;
 				alt = IS_SET(MODE_ALTSCREEN);
<a href="#h0-67-3" id="h0-67-3" class="d">-				if(alt) {
</a><a href="#h0-67-4" id="h0-67-4" class="i">+				if (alt) {
</a> 					tclearregion(0, 0, term.col-1,
 							term.row-1);
 				}
<a href="#h0-67-8" id="h0-67-8" class="d">-				if(set ^ alt) /* set is always 1 or 0 */
</a><a href="#h0-67-9" id="h0-67-9" class="i">+				if (set ^ alt) /* set is always 1 or 0 */
</a> 					tswapscreen();
<a href="#h0-67-11" id="h0-67-11" class="d">-				if(*args != 1049)
</a><a href="#h0-67-12" id="h0-67-12" class="i">+				if (*args != 1049)
</a> 					break;
 				/* FALLTHROUGH */
 			case 1048:
<a href="#h0-68" id="h0-68" class="h">@@ -2085,7 +2085,7 @@ tsetmode(int priv, int set, int *args, int narg)
</a> 				break;
 			}
 		} else {
<a href="#h0-68-3" id="h0-68-3" class="d">-			switch(*args) {
</a><a href="#h0-68-4" id="h0-68-4" class="i">+			switch (*args) {
</a> 			case 0:  /* Error (IGNORED) */
 				break;
 			case 2:  /* KAM -- keyboard action */
<a href="#h0-69" id="h0-69" class="h">@@ -2116,7 +2116,7 @@ csihandle(void)
</a> 	char buf[40];
 	int len;
 
<a href="#h0-69-3" id="h0-69-3" class="d">-	switch(csiescseq.mode[0]) {
</a><a href="#h0-69-4" id="h0-69-4" class="i">+	switch (csiescseq.mode[0]) {
</a> 	default:
 	unknown:
 		fprintf(stderr, &quot;erresc: unknown csi &quot;);
<a href="#h0-70" id="h0-70" class="h">@@ -2137,7 +2137,7 @@ csihandle(void)
</a> 		tmoveto(term.c.x, term.c.y+csiescseq.arg[0]);
 		break;
 	case &#39;i&#39;: /* MC -- Media Copy */
<a href="#h0-70-3" id="h0-70-3" class="d">-		switch(csiescseq.arg[0]) {
</a><a href="#h0-70-4" id="h0-70-4" class="i">+		switch (csiescseq.arg[0]) {
</a> 		case 0:
 			tdump();
 			break;
<a href="#h0-71" id="h0-71" class="h">@@ -2156,7 +2156,7 @@ csihandle(void)
</a> 		}
 		break;
 	case &#39;c&#39;: /* DA -- Device Attributes */
<a href="#h0-71-3" id="h0-71-3" class="d">-		if(csiescseq.arg[0] == 0)
</a><a href="#h0-71-4" id="h0-71-4" class="i">+		if (csiescseq.arg[0] == 0)
</a> 			ttywrite(vtiden, sizeof(vtiden) - 1);
 		break;
 	case &#39;C&#39;: /* CUF -- Cursor &lt;n&gt; Forward */
<a href="#h0-72" id="h0-72" class="h">@@ -2177,7 +2177,7 @@ csihandle(void)
</a> 		tmoveto(0, term.c.y-csiescseq.arg[0]);
 		break;
 	case &#39;g&#39;: /* TBC -- Tabulation clear */
<a href="#h0-72-3" id="h0-72-3" class="d">-		switch(csiescseq.arg[0]) {
</a><a href="#h0-72-4" id="h0-72-4" class="i">+		switch (csiescseq.arg[0]) {
</a> 		case 0: /* clear current tab stop */
 			term.tabs[term.c.x] = 0;
 			break;
<a href="#h0-73" id="h0-73" class="h">@@ -2205,16 +2205,16 @@ csihandle(void)
</a> 		break;
 	case &#39;J&#39;: /* ED -- Clear screen */
 		selclear(NULL);
<a href="#h0-73-3" id="h0-73-3" class="d">-		switch(csiescseq.arg[0]) {
</a><a href="#h0-73-4" id="h0-73-4" class="i">+		switch (csiescseq.arg[0]) {
</a> 		case 0: /* below */
 			tclearregion(term.c.x, term.c.y, term.col-1, term.c.y);
<a href="#h0-73-7" id="h0-73-7" class="d">-			if(term.c.y &lt; term.row-1) {
</a><a href="#h0-73-8" id="h0-73-8" class="i">+			if (term.c.y &lt; term.row-1) {
</a> 				tclearregion(0, term.c.y+1, term.col-1,
 						term.row-1);
 			}
 			break;
 		case 1: /* above */
<a href="#h0-73-14" id="h0-73-14" class="d">-			if(term.c.y &gt; 1)
</a><a href="#h0-73-15" id="h0-73-15" class="i">+			if (term.c.y &gt; 1)
</a> 				tclearregion(0, 0, term.col-1, term.c.y-1);
 			tclearregion(0, term.c.y, term.c.x, term.c.y);
 			break;
<a href="#h0-74" id="h0-74" class="h">@@ -2226,7 +2226,7 @@ csihandle(void)
</a> 		}
 		break;
 	case &#39;K&#39;: /* EL -- Clear line */
<a href="#h0-74-3" id="h0-74-3" class="d">-		switch(csiescseq.arg[0]) {
</a><a href="#h0-74-4" id="h0-74-4" class="i">+		switch (csiescseq.arg[0]) {
</a> 		case 0: /* right */
 			tclearregion(term.c.x, term.c.y, term.col-1,
 					term.c.y);
<a href="#h0-75" id="h0-75" class="h">@@ -2289,7 +2289,7 @@ csihandle(void)
</a> 		}
 		break;
 	case &#39;r&#39;: /* DECSTBM -- Set Scrolling Region */
<a href="#h0-75-3" id="h0-75-3" class="d">-		if(csiescseq.priv) {
</a><a href="#h0-75-4" id="h0-75-4" class="i">+		if (csiescseq.priv) {
</a> 			goto unknown;
 		} else {
 			DEFAULT(csiescseq.arg[0], 1);
<a href="#h0-76" id="h0-76" class="h">@@ -2327,15 +2327,15 @@ csidump(void)
</a> 	uint c;
 
 	printf(&quot;ESC[&quot;);
<a href="#h0-76-3" id="h0-76-3" class="d">-	for(i = 0; i &lt; csiescseq.len; i++) {
</a><a href="#h0-76-4" id="h0-76-4" class="i">+	for (i = 0; i &lt; csiescseq.len; i++) {
</a> 		c = csiescseq.buf[i] &amp; 0xff;
<a href="#h0-76-6" id="h0-76-6" class="d">-		if(isprint(c)) {
</a><a href="#h0-76-7" id="h0-76-7" class="i">+		if (isprint(c)) {
</a> 			putchar(c);
<a href="#h0-76-9" id="h0-76-9" class="d">-		} else if(c == &#39;\n&#39;) {
</a><a href="#h0-76-10" id="h0-76-10" class="i">+		} else if (c == &#39;\n&#39;) {
</a> 			printf(&quot;(\\n)&quot;);
<a href="#h0-76-12" id="h0-76-12" class="d">-		} else if(c == &#39;\r&#39;) {
</a><a href="#h0-76-13" id="h0-76-13" class="i">+		} else if (c == &#39;\r&#39;) {
</a> 			printf(&quot;(\\r)&quot;);
<a href="#h0-76-15" id="h0-76-15" class="d">-		} else if(c == 0x1b) {
</a><a href="#h0-76-16" id="h0-76-16" class="i">+		} else if (c == 0x1b) {
</a> 			printf(&quot;(\\e)&quot;);
 		} else {
 			printf(&quot;(%02x)&quot;, c);
<a href="#h0-77" id="h0-77" class="h">@@ -2360,23 +2360,23 @@ strhandle(void)
</a> 	strparse();
 	par = (narg = strescseq.narg) ? atoi(strescseq.args[0]) : 0;
 
<a href="#h0-77-3" id="h0-77-3" class="d">-	switch(strescseq.type) {
</a><a href="#h0-77-4" id="h0-77-4" class="i">+	switch (strescseq.type) {
</a> 	case &#39;]&#39;: /* OSC -- Operating System Command */
<a href="#h0-77-6" id="h0-77-6" class="d">-		switch(par) {
</a><a href="#h0-77-7" id="h0-77-7" class="i">+		switch (par) {
</a> 		case 0:
 		case 1:
 		case 2:
<a href="#h0-77-11" id="h0-77-11" class="d">-			if(narg &gt; 1)
</a><a href="#h0-77-12" id="h0-77-12" class="i">+			if (narg &gt; 1)
</a> 				xsettitle(strescseq.args[1]);
 			return;
 		case 4: /* color set */
<a href="#h0-77-16" id="h0-77-16" class="d">-			if(narg &lt; 3)
</a><a href="#h0-77-17" id="h0-77-17" class="i">+			if (narg &lt; 3)
</a> 				break;
 			p = strescseq.args[2];
 			/* FALLTHROUGH */
 		case 104: /* color reset, here p = NULL */
 			j = (narg &gt; 1) ? atoi(strescseq.args[1]) : -1;
<a href="#h0-77-23" id="h0-77-23" class="d">-			if(xsetcolorname(j, p)) {
</a><a href="#h0-77-24" id="h0-77-24" class="i">+			if (xsetcolorname(j, p)) {
</a> 				fprintf(stderr, &quot;erresc: invalid color %s\n&quot;, p);
 			} else {
 				/*
<a href="#h0-78" id="h0-78" class="h">@@ -2410,14 +2410,14 @@ strparse(void)
</a> 	strescseq.narg = 0;
 	strescseq.buf[strescseq.len] = &#39;\0&#39;;
 
<a href="#h0-78-3" id="h0-78-3" class="d">-	if(*p == &#39;\0&#39;)
</a><a href="#h0-78-4" id="h0-78-4" class="i">+	if (*p == &#39;\0&#39;)
</a> 		return;
 
<a href="#h0-78-7" id="h0-78-7" class="d">-	while(strescseq.narg &lt; STR_ARG_SIZ) {
</a><a href="#h0-78-8" id="h0-78-8" class="i">+	while (strescseq.narg &lt; STR_ARG_SIZ) {
</a> 		strescseq.args[strescseq.narg++] = p;
<a href="#h0-78-10" id="h0-78-10" class="d">-		while((c = *p) != &#39;;&#39; &amp;&amp; c != &#39;\0&#39;)
</a><a href="#h0-78-11" id="h0-78-11" class="i">+		while ((c = *p) != &#39;;&#39; &amp;&amp; c != &#39;\0&#39;)
</a> 			++p;
<a href="#h0-78-13" id="h0-78-13" class="d">-		if(c == &#39;\0&#39;)
</a><a href="#h0-78-14" id="h0-78-14" class="i">+		if (c == &#39;\0&#39;)
</a> 			return;
 		*p++ = &#39;\0&#39;;
 	}
<a href="#h0-79" id="h0-79" class="h">@@ -2430,17 +2430,17 @@ strdump(void)
</a> 	uint c;
 
 	printf(&quot;ESC%c&quot;, strescseq.type);
<a href="#h0-79-3" id="h0-79-3" class="d">-	for(i = 0; i &lt; strescseq.len; i++) {
</a><a href="#h0-79-4" id="h0-79-4" class="i">+	for (i = 0; i &lt; strescseq.len; i++) {
</a> 		c = strescseq.buf[i] &amp; 0xff;
<a href="#h0-79-6" id="h0-79-6" class="d">-		if(c == &#39;\0&#39;) {
</a><a href="#h0-79-7" id="h0-79-7" class="i">+		if (c == &#39;\0&#39;) {
</a> 			return;
<a href="#h0-79-9" id="h0-79-9" class="d">-		} else if(isprint(c)) {
</a><a href="#h0-79-10" id="h0-79-10" class="i">+		} else if (isprint(c)) {
</a> 			putchar(c);
<a href="#h0-79-12" id="h0-79-12" class="d">-		} else if(c == &#39;\n&#39;) {
</a><a href="#h0-79-13" id="h0-79-13" class="i">+		} else if (c == &#39;\n&#39;) {
</a> 			printf(&quot;(\\n)&quot;);
<a href="#h0-79-15" id="h0-79-15" class="d">-		} else if(c == &#39;\r&#39;) {
</a><a href="#h0-79-16" id="h0-79-16" class="i">+		} else if (c == &#39;\r&#39;) {
</a> 			printf(&quot;(\\r)&quot;);
<a href="#h0-79-18" id="h0-79-18" class="d">-		} else if(c == 0x1b) {
</a><a href="#h0-79-19" id="h0-79-19" class="i">+		} else if (c == 0x1b) {
</a> 			printf(&quot;(\\e)&quot;);
 		} else {
 			printf(&quot;(%02x)&quot;, c);
<a href="#h0-80" id="h0-80" class="h">@@ -2458,7 +2458,7 @@ strreset(void)
</a> void
 tprinter(char *s, size_t len)
 {
<a href="#h0-80-3" id="h0-80-3" class="d">-	if(iofd != -1 &amp;&amp; xwrite(iofd, s, len) &lt; 0) {
</a><a href="#h0-80-4" id="h0-80-4" class="i">+	if (iofd != -1 &amp;&amp; xwrite(iofd, s, len) &lt; 0) {
</a> 		fprintf(stderr, &quot;Error writing in %s:%s\n&quot;,
 			opt_io, strerror(errno));
 		close(iofd);
<a href="#h0-81" id="h0-81" class="h">@@ -2489,7 +2489,7 @@ tdumpsel(void)
</a> {
 	char *ptr;
 
<a href="#h0-81-3" id="h0-81-3" class="d">-	if((ptr = getsel())) {
</a><a href="#h0-81-4" id="h0-81-4" class="i">+	if ((ptr = getsel())) {
</a> 		tprinter(ptr, strlen(ptr));
 		free(ptr);
 	}
<a href="#h0-82" id="h0-82" class="h">@@ -2503,8 +2503,8 @@ tdumpline(int n)
</a> 
 	bp = &amp;term.line[n][0];
 	end = &amp;bp[MIN(tlinelen(n), term.col) - 1];
<a href="#h0-82-3" id="h0-82-3" class="d">-	if(bp != end || bp-&gt;u != &#39; &#39;) {
</a><a href="#h0-82-4" id="h0-82-4" class="d">-		for( ;bp &lt;= end; ++bp)
</a><a href="#h0-82-5" id="h0-82-5" class="i">+	if (bp != end || bp-&gt;u != &#39; &#39;) {
</a><a href="#h0-82-6" id="h0-82-6" class="i">+		for ( ;bp &lt;= end; ++bp)
</a> 			tprinter(buf, utf8encode(bp-&gt;u, buf));
 	}
 	tprinter(&quot;\n&quot;, 1);
<a href="#h0-83" id="h0-83" class="h">@@ -2515,7 +2515,7 @@ tdump(void)
</a> {
 	int i;
 
<a href="#h0-83-3" id="h0-83-3" class="d">-	for(i = 0; i &lt; term.row; ++i)
</a><a href="#h0-83-4" id="h0-83-4" class="i">+	for (i = 0; i &lt; term.row; ++i)
</a> 		tdumpline(i);
 }
 
<a href="#h0-84" id="h0-84" class="h">@@ -2524,13 +2524,13 @@ tputtab(int n)
</a> {
 	uint x = term.c.x;
 
<a href="#h0-84-3" id="h0-84-3" class="d">-	if(n &gt; 0) {
</a><a href="#h0-84-4" id="h0-84-4" class="d">-		while(x &lt; term.col &amp;&amp; n--)
</a><a href="#h0-84-5" id="h0-84-5" class="d">-			for(++x; x &lt; term.col &amp;&amp; !term.tabs[x]; ++x)
</a><a href="#h0-84-6" id="h0-84-6" class="i">+	if (n &gt; 0) {
</a><a href="#h0-84-7" id="h0-84-7" class="i">+		while (x &lt; term.col &amp;&amp; n--)
</a><a href="#h0-84-8" id="h0-84-8" class="i">+			for (++x; x &lt; term.col &amp;&amp; !term.tabs[x]; ++x)
</a> 				/* nothing */ ;
<a href="#h0-84-10" id="h0-84-10" class="d">-	} else if(n &lt; 0) {
</a><a href="#h0-84-11" id="h0-84-11" class="d">-		while(x &gt; 0 &amp;&amp; n++)
</a><a href="#h0-84-12" id="h0-84-12" class="d">-			for(--x; x &gt; 0 &amp;&amp; !term.tabs[x]; --x)
</a><a href="#h0-84-13" id="h0-84-13" class="i">+	} else if (n &lt; 0) {
</a><a href="#h0-84-14" id="h0-84-14" class="i">+		while (x &gt; 0 &amp;&amp; n++)
</a><a href="#h0-84-15" id="h0-84-15" class="i">+			for (--x; x &gt; 0 &amp;&amp; !term.tabs[x]; --x)
</a> 				/* nothing */ ;
 	}
 	term.c.x = LIMIT(x, 0, term.col-1);
<a href="#h0-85" id="h0-85" class="h">@@ -2539,12 +2539,12 @@ tputtab(int n)
</a> void
 techo(Rune u)
 {
<a href="#h0-85-3" id="h0-85-3" class="d">-	if(ISCONTROL(u)) { /* control code */
</a><a href="#h0-85-4" id="h0-85-4" class="d">-		if(u &amp; 0x80) {
</a><a href="#h0-85-5" id="h0-85-5" class="i">+	if (ISCONTROL(u)) { /* control code */
</a><a href="#h0-85-6" id="h0-85-6" class="i">+		if (u &amp; 0x80) {
</a> 			u &amp;= 0x7f;
 			tputc(&#39;^&#39;);
 			tputc(&#39;[&#39;);
<a href="#h0-85-10" id="h0-85-10" class="d">-		} else if(u != &#39;\n&#39; &amp;&amp; u != &#39;\r&#39; &amp;&amp; u != &#39;\t&#39;) {
</a><a href="#h0-85-11" id="h0-85-11" class="i">+		} else if (u != &#39;\n&#39; &amp;&amp; u != &#39;\r&#39; &amp;&amp; u != &#39;\t&#39;) {
</a> 			u ^= 0x40;
 			tputc(&#39;^&#39;);
 		}
<a href="#h0-86" id="h0-86" class="h">@@ -2559,7 +2559,7 @@ tdeftran(char ascii)
</a> 	static int vcs[] = {CS_GRAPHIC0, CS_USA};
 	char *p;
 
<a href="#h0-86-3" id="h0-86-3" class="d">-	if((p = strchr(cs, ascii)) == NULL) {
</a><a href="#h0-86-4" id="h0-86-4" class="i">+	if ((p = strchr(cs, ascii)) == NULL) {
</a> 		fprintf(stderr, &quot;esc unhandled charset: ESC ( %c\n&quot;, ascii);
 	} else {
 		term.trantbl[term.icharset] = vcs[p - cs];
<a href="#h0-87" id="h0-87" class="h">@@ -2571,9 +2571,9 @@ tdectest(char c)
</a> {
 	int x, y;
 
<a href="#h0-87-3" id="h0-87-3" class="d">-	if(c == &#39;8&#39;) { /* DEC screen alignment test. */
</a><a href="#h0-87-4" id="h0-87-4" class="d">-		for(x = 0; x &lt; term.col; ++x) {
</a><a href="#h0-87-5" id="h0-87-5" class="d">-			for(y = 0; y &lt; term.row; ++y)
</a><a href="#h0-87-6" id="h0-87-6" class="i">+	if (c == &#39;8&#39;) { /* DEC screen alignment test. */
</a><a href="#h0-87-7" id="h0-87-7" class="i">+		for (x = 0; x &lt; term.col; ++x) {
</a><a href="#h0-87-8" id="h0-87-8" class="i">+			for (y = 0; y &lt; term.row; ++y)
</a> 				tsetchar(&#39;E&#39;, &amp;term.c.attr, x, y);
 		}
 	}
<a href="#h0-88" id="h0-88" class="h">@@ -2604,7 +2604,7 @@ tstrsequence(uchar c)
</a> void
 tcontrolcode(uchar ascii)
 {
<a href="#h0-88-3" id="h0-88-3" class="d">-	switch(ascii) {
</a><a href="#h0-88-4" id="h0-88-4" class="i">+	switch (ascii) {
</a> 	case &#39;\t&#39;:   /* HT */
 		tputtab(1);
 		return;
<a href="#h0-89" id="h0-89" class="h">@@ -2621,11 +2621,11 @@ tcontrolcode(uchar ascii)
</a> 		tnewline(IS_SET(MODE_CRLF));
 		return;
 	case &#39;\a&#39;:   /* BEL */
<a href="#h0-89-3" id="h0-89-3" class="d">-		if(term.esc &amp; ESC_STR_END) {
</a><a href="#h0-89-4" id="h0-89-4" class="i">+		if (term.esc &amp; ESC_STR_END) {
</a> 			/* backwards compatibility to xterm */
 			strhandle();
 		} else {
<a href="#h0-89-8" id="h0-89-8" class="d">-			if(!(xw.state &amp; WIN_FOCUSED))
</a><a href="#h0-89-9" id="h0-89-9" class="i">+			if (!(xw.state &amp; WIN_FOCUSED))
</a> 				xseturgency(1);
 			if (bellvolume)
 				XkbBell(xw.dpy, xw.win, bellvolume, (Atom)NULL);
<a href="#h0-90" id="h0-90" class="h">@@ -2688,7 +2688,7 @@ tcontrolcode(uchar ascii)
</a> int
 eschandle(uchar ascii)
 {
<a href="#h0-90-3" id="h0-90-3" class="d">-	switch(ascii) {
</a><a href="#h0-90-4" id="h0-90-4" class="i">+	switch (ascii) {
</a> 	case &#39;[&#39;:
 		term.esc |= ESC_CSI;
 		return 0;
<a href="#h0-91" id="h0-91" class="h">@@ -2714,7 +2714,7 @@ eschandle(uchar ascii)
</a> 		term.esc |= ESC_ALTCHARSET;
 		return 0;
 	case &#39;D&#39;: /* IND -- Linefeed */
<a href="#h0-91-3" id="h0-91-3" class="d">-		if(term.c.y == term.bot) {
</a><a href="#h0-91-4" id="h0-91-4" class="i">+		if (term.c.y == term.bot) {
</a> 			tscrollup(term.top, 1);
 		} else {
 			tmoveto(term.c.x, term.c.y+1);
<a href="#h0-92" id="h0-92" class="h">@@ -2727,7 +2727,7 @@ eschandle(uchar ascii)
</a> 		term.tabs[term.c.x] = 1;
 		break;
 	case &#39;M&#39;: /* RI -- Reverse index */
<a href="#h0-92-3" id="h0-92-3" class="d">-		if(term.c.y == term.top) {
</a><a href="#h0-92-4" id="h0-92-4" class="i">+		if (term.c.y == term.top) {
</a> 			tscrolldown(term.top, 1);
 		} else {
 			tmoveto(term.c.x, term.c.y-1);
<a href="#h0-93" id="h0-93" class="h">@@ -2754,7 +2754,7 @@ eschandle(uchar ascii)
</a> 		tcursor(CURSOR_LOAD);
 		break;
 	case &#39;\\&#39;: /* ST -- String Terminator */
<a href="#h0-93-3" id="h0-93-3" class="d">-		if(term.esc &amp; ESC_STR_END)
</a><a href="#h0-93-4" id="h0-93-4" class="i">+		if (term.esc &amp; ESC_STR_END)
</a> 			strhandle();
 		break;
 	default:
<a href="#h0-94" id="h0-94" class="h">@@ -2774,12 +2774,12 @@ tputc(Rune u)
</a> 	Glyph *gp;
 
 	len = utf8encode(u, c);
<a href="#h0-94-3" id="h0-94-3" class="d">-	if((width = wcwidth(u)) == -1) {
</a><a href="#h0-94-4" id="h0-94-4" class="i">+	if ((width = wcwidth(u)) == -1) {
</a> 		memcpy(c, &quot;\357\277\275&quot;, 4); /* UTF_INVALID */
 		width = 1;
 	}
 
<a href="#h0-94-9" id="h0-94-9" class="d">-	if(IS_SET(MODE_PRINT))
</a><a href="#h0-94-10" id="h0-94-10" class="i">+	if (IS_SET(MODE_PRINT))
</a> 		tprinter(c, len);
 	control = ISCONTROL(u);
 
<a href="#h0-95" id="h0-95" class="h">@@ -2789,12 +2789,12 @@ tputc(Rune u)
</a> 	 * receives a ESC, a SUB, a ST or any other C1 control
 	 * character.
 	 */
<a href="#h0-95-3" id="h0-95-3" class="d">-	if(term.esc &amp; ESC_STR) {
</a><a href="#h0-95-4" id="h0-95-4" class="d">-		if(u == &#39;\a&#39; || u == 030 || u == 032 || u == 033 ||
</a><a href="#h0-95-5" id="h0-95-5" class="i">+	if (term.esc &amp; ESC_STR) {
</a><a href="#h0-95-6" id="h0-95-6" class="i">+		if (u == &#39;\a&#39; || u == 030 || u == 032 || u == 033 ||
</a> 		   ISCONTROLC1(u)) {
 			term.esc &amp;= ~(ESC_START|ESC_STR);
 			term.esc |= ESC_STR_END;
<a href="#h0-95-10" id="h0-95-10" class="d">-		} else if(strescseq.len + len &lt; sizeof(strescseq.buf) - 1) {
</a><a href="#h0-95-11" id="h0-95-11" class="i">+		} else if (strescseq.len + len &lt; sizeof(strescseq.buf) - 1) {
</a> 			memmove(&amp;strescseq.buf[strescseq.len], c, len);
 			strescseq.len += len;
 			return;
<a href="#h0-96" id="h0-96" class="h">@@ -2821,16 +2821,16 @@ tputc(Rune u)
</a> 	 * because they can be embedded inside a control sequence, and
 	 * they must not cause conflicts with sequences.
 	 */
<a href="#h0-96-3" id="h0-96-3" class="d">-	if(control) {
</a><a href="#h0-96-4" id="h0-96-4" class="i">+	if (control) {
</a> 		tcontrolcode(u);
 		/*
 		 * control codes are not shown ever
 		 */
 		return;
<a href="#h0-96-10" id="h0-96-10" class="d">-	} else if(term.esc &amp; ESC_START) {
</a><a href="#h0-96-11" id="h0-96-11" class="d">-		if(term.esc &amp; ESC_CSI) {
</a><a href="#h0-96-12" id="h0-96-12" class="i">+	} else if (term.esc &amp; ESC_START) {
</a><a href="#h0-96-13" id="h0-96-13" class="i">+		if (term.esc &amp; ESC_CSI) {
</a> 			csiescseq.buf[csiescseq.len++] = u;
<a href="#h0-96-15" id="h0-96-15" class="d">-			if(BETWEEN(u, 0x40, 0x7E)
</a><a href="#h0-96-16" id="h0-96-16" class="i">+			if (BETWEEN(u, 0x40, 0x7E)
</a> 					|| csiescseq.len &gt;= \
 					sizeof(csiescseq.buf)-1) {
 				term.esc = 0;
<a href="#h0-97" id="h0-97" class="h">@@ -2838,9 +2838,9 @@ tputc(Rune u)
</a> 				csihandle();
 			}
 			return;
<a href="#h0-97-3" id="h0-97-3" class="d">-		} else if(term.esc &amp; ESC_ALTCHARSET) {
</a><a href="#h0-97-4" id="h0-97-4" class="i">+		} else if (term.esc &amp; ESC_ALTCHARSET) {
</a> 			tdeftran(u);
<a href="#h0-97-6" id="h0-97-6" class="d">-		} else if(term.esc &amp; ESC_TEST) {
</a><a href="#h0-97-7" id="h0-97-7" class="i">+		} else if (term.esc &amp; ESC_TEST) {
</a> 			tdectest(u);
 		} else {
 			if (!eschandle(u))
<a href="#h0-98" id="h0-98" class="h">@@ -2854,34 +2854,34 @@ tputc(Rune u)
</a> 		 */
 		return;
 	}
<a href="#h0-98-3" id="h0-98-3" class="d">-	if(sel.ob.x != -1 &amp;&amp; BETWEEN(term.c.y, sel.ob.y, sel.oe.y))
</a><a href="#h0-98-4" id="h0-98-4" class="i">+	if (sel.ob.x != -1 &amp;&amp; BETWEEN(term.c.y, sel.ob.y, sel.oe.y))
</a> 		selclear(NULL);
 
 	gp = &amp;term.line[term.c.y][term.c.x];
<a href="#h0-98-8" id="h0-98-8" class="d">-	if(IS_SET(MODE_WRAP) &amp;&amp; (term.c.state &amp; CURSOR_WRAPNEXT)) {
</a><a href="#h0-98-9" id="h0-98-9" class="i">+	if (IS_SET(MODE_WRAP) &amp;&amp; (term.c.state &amp; CURSOR_WRAPNEXT)) {
</a> 		gp-&gt;mode |= ATTR_WRAP;
 		tnewline(1);
 		gp = &amp;term.line[term.c.y][term.c.x];
 	}
 
<a href="#h0-98-15" id="h0-98-15" class="d">-	if(IS_SET(MODE_INSERT) &amp;&amp; term.c.x+width &lt; term.col)
</a><a href="#h0-98-16" id="h0-98-16" class="i">+	if (IS_SET(MODE_INSERT) &amp;&amp; term.c.x+width &lt; term.col)
</a> 		memmove(gp+width, gp, (term.col - term.c.x - width) * sizeof(Glyph));
 
<a href="#h0-98-19" id="h0-98-19" class="d">-	if(term.c.x+width &gt; term.col) {
</a><a href="#h0-98-20" id="h0-98-20" class="i">+	if (term.c.x+width &gt; term.col) {
</a> 		tnewline(1);
 		gp = &amp;term.line[term.c.y][term.c.x];
 	}
 
 	tsetchar(u, &amp;term.c.attr, term.c.x, term.c.y);
 
<a href="#h0-98-27" id="h0-98-27" class="d">-	if(width == 2) {
</a><a href="#h0-98-28" id="h0-98-28" class="i">+	if (width == 2) {
</a> 		gp-&gt;mode |= ATTR_WIDE;
<a href="#h0-98-30" id="h0-98-30" class="d">-		if(term.c.x+1 &lt; term.col) {
</a><a href="#h0-98-31" id="h0-98-31" class="i">+		if (term.c.x+1 &lt; term.col) {
</a> 			gp[1].u = &#39;\0&#39;;
 			gp[1].mode = ATTR_WDUMMY;
 		}
 	}
<a href="#h0-98-36" id="h0-98-36" class="d">-	if(term.c.x+width &lt; term.col) {
</a><a href="#h0-98-37" id="h0-98-37" class="i">+	if (term.c.x+width &lt; term.col) {
</a> 		tmoveto(term.c.x+width, term.c.y);
 	} else {
 		term.c.state |= CURSOR_WRAPNEXT;
<a href="#h0-99" id="h0-99" class="h">@@ -2897,7 +2897,7 @@ tresize(int col, int row)
</a> 	int *bp;
 	TCursor c;
 
<a href="#h0-99-3" id="h0-99-3" class="d">-	if(col &lt; 1 || row &lt; 1) {
</a><a href="#h0-99-4" id="h0-99-4" class="i">+	if (col &lt; 1 || row &lt; 1) {
</a> 		fprintf(stderr,
 		        &quot;tresize: error resizing to %dx%d\n&quot;, col, row);
 		return;
<a href="#h0-100" id="h0-100" class="h">@@ -2908,7 +2908,7 @@ tresize(int col, int row)
</a> 	 * tscrollup would work here, but we can optimize to
 	 * memmove because we&#39;re freeing the earlier lines
 	 */
<a href="#h0-100-3" id="h0-100-3" class="d">-	for(i = 0; i &lt;= term.c.y - row; i++) {
</a><a href="#h0-100-4" id="h0-100-4" class="i">+	for (i = 0; i &lt;= term.c.y - row; i++) {
</a> 		free(term.line[i]);
 		free(term.alt[i]);
 	}
<a href="#h0-101" id="h0-101" class="h">@@ -2917,7 +2917,7 @@ tresize(int col, int row)
</a> 		memmove(term.line, term.line + i, row * sizeof(Line));
 		memmove(term.alt, term.alt + i, row * sizeof(Line));
 	}
<a href="#h0-101-3" id="h0-101-3" class="d">-	for(i += row; i &lt; term.row; i++) {
</a><a href="#h0-101-4" id="h0-101-4" class="i">+	for (i += row; i &lt; term.row; i++) {
</a> 		free(term.line[i]);
 		free(term.alt[i]);
 	}
<a href="#h0-102" id="h0-102" class="h">@@ -2932,23 +2932,23 @@ tresize(int col, int row)
</a> 	term.tabs = xrealloc(term.tabs, col * sizeof(*term.tabs));
 
 	/* resize each row to new width, zero-pad if needed */
<a href="#h0-102-3" id="h0-102-3" class="d">-	for(i = 0; i &lt; minrow; i++) {
</a><a href="#h0-102-4" id="h0-102-4" class="i">+	for (i = 0; i &lt; minrow; i++) {
</a> 		term.line[i] = xrealloc(term.line[i], col * sizeof(Glyph));
 		term.alt[i]  = xrealloc(term.alt[i],  col * sizeof(Glyph));
 	}
 
 	/* allocate any new rows */
<a href="#h0-102-10" id="h0-102-10" class="d">-	for(/* i == minrow */; i &lt; row; i++) {
</a><a href="#h0-102-11" id="h0-102-11" class="i">+	for (/* i == minrow */; i &lt; row; i++) {
</a> 		term.line[i] = xmalloc(col * sizeof(Glyph));
 		term.alt[i] = xmalloc(col * sizeof(Glyph));
 	}
<a href="#h0-102-15" id="h0-102-15" class="d">-	if(col &gt; term.col) {
</a><a href="#h0-102-16" id="h0-102-16" class="i">+	if (col &gt; term.col) {
</a> 		bp = term.tabs + term.col;
 
 		memset(bp, 0, sizeof(*term.tabs) * (col - term.col));
<a href="#h0-102-20" id="h0-102-20" class="d">-		while(--bp &gt; term.tabs &amp;&amp; !*bp)
</a><a href="#h0-102-21" id="h0-102-21" class="i">+		while (--bp &gt; term.tabs &amp;&amp; !*bp)
</a> 			/* nothing */ ;
<a href="#h0-102-23" id="h0-102-23" class="d">-		for(bp += tabspaces; bp &lt; term.tabs + col; bp += tabspaces)
</a><a href="#h0-102-24" id="h0-102-24" class="i">+		for (bp += tabspaces; bp &lt; term.tabs + col; bp += tabspaces)
</a> 			*bp = 1;
 	}
 	/* update terminal size */
<a href="#h0-103" id="h0-103" class="h">@@ -2960,11 +2960,11 @@ tresize(int col, int row)
</a> 	tmoveto(term.c.x, term.c.y);
 	/* Clearing both screens (it makes dirty all lines) */
 	c = term.c;
<a href="#h0-103-3" id="h0-103-3" class="d">-	for(i = 0; i &lt; 2; i++) {
</a><a href="#h0-103-4" id="h0-103-4" class="d">-		if(mincol &lt; col &amp;&amp; 0 &lt; minrow) {
</a><a href="#h0-103-5" id="h0-103-5" class="i">+	for (i = 0; i &lt; 2; i++) {
</a><a href="#h0-103-6" id="h0-103-6" class="i">+		if (mincol &lt; col &amp;&amp; 0 &lt; minrow) {
</a> 			tclearregion(mincol, 0, col - 1, minrow - 1);
 		}
<a href="#h0-103-9" id="h0-103-9" class="d">-		if(0 &lt; col &amp;&amp; minrow &lt; row) {
</a><a href="#h0-103-10" id="h0-103-10" class="i">+		if (0 &lt; col &amp;&amp; minrow &lt; row) {
</a> 			tclearregion(0, minrow, col - 1, row - 1);
 		}
 		tswapscreen();
<a href="#h0-104" id="h0-104" class="h">@@ -2997,9 +2997,9 @@ xloadcolor(int i, const char *name, Color *ncolor)
</a> {
 	XRenderColor color = { .alpha = 0xffff };
 
<a href="#h0-104-3" id="h0-104-3" class="d">-	if(!name) {
</a><a href="#h0-104-4" id="h0-104-4" class="d">-		if(BETWEEN(i, 16, 255)) { /* 256 color */
</a><a href="#h0-104-5" id="h0-104-5" class="d">-			if(i &lt; 6*6*6+16) { /* same colors as xterm */
</a><a href="#h0-104-6" id="h0-104-6" class="i">+	if (!name) {
</a><a href="#h0-104-7" id="h0-104-7" class="i">+		if (BETWEEN(i, 16, 255)) { /* 256 color */
</a><a href="#h0-104-8" id="h0-104-8" class="i">+			if (i &lt; 6*6*6+16) { /* same colors as xterm */
</a> 				color.red   = sixd_to_16bit( ((i-16)/36)%6 );
 				color.green = sixd_to_16bit( ((i-16)/6) %6 );
 				color.blue  = sixd_to_16bit( ((i-16)/1) %6 );
<a href="#h0-105" id="h0-105" class="h">@@ -3022,14 +3022,14 @@ xloadcols(void)
</a> 	static int loaded;
 	Color *cp;
 
<a href="#h0-105-3" id="h0-105-3" class="d">-	if(loaded) {
</a><a href="#h0-105-4" id="h0-105-4" class="i">+	if (loaded) {
</a> 		for (cp = dc.col; cp &lt; &amp;dc.col[LEN(dc.col)]; ++cp)
 			XftColorFree(xw.dpy, xw.vis, xw.cmap, cp);
 	}
 
<a href="#h0-105-9" id="h0-105-9" class="d">-	for(i = 0; i &lt; LEN(dc.col); i++)
</a><a href="#h0-105-10" id="h0-105-10" class="d">-		if(!xloadcolor(i, NULL, &amp;dc.col[i])) {
</a><a href="#h0-105-11" id="h0-105-11" class="d">-			if(colorname[i])
</a><a href="#h0-105-12" id="h0-105-12" class="i">+	for (i = 0; i &lt; LEN(dc.col); i++)
</a><a href="#h0-105-13" id="h0-105-13" class="i">+		if (!xloadcolor(i, NULL, &amp;dc.col[i])) {
</a><a href="#h0-105-14" id="h0-105-14" class="i">+			if (colorname[i])
</a> 				die(&quot;Could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
 			else
 				die(&quot;Could not allocate color %d\n&quot;, i);
<a href="#h0-106" id="h0-106" class="h">@@ -3042,11 +3042,11 @@ xsetcolorname(int x, const char *name)
</a> {
 	Color ncolor;
 
<a href="#h0-106-3" id="h0-106-3" class="d">-	if(!BETWEEN(x, 0, LEN(dc.col)))
</a><a href="#h0-106-4" id="h0-106-4" class="i">+	if (!BETWEEN(x, 0, LEN(dc.col)))
</a> 		return 1;
 
 
<a href="#h0-106-8" id="h0-106-8" class="d">-	if(!xloadcolor(x, name, &amp;ncolor))
</a><a href="#h0-106-9" id="h0-106-9" class="i">+	if (!xloadcolor(x, name, &amp;ncolor))
</a> 		return 1;
 
 	XftColorFree(xw.dpy, xw.vis, xw.cmap, &amp;dc.col[x]);
<a href="#h0-107" id="h0-107" class="h">@@ -3092,12 +3092,12 @@ xhints(void)
</a> 	sizeh-&gt;width_inc = xw.cw;
 	sizeh-&gt;base_height = 2 * borderpx;
 	sizeh-&gt;base_width = 2 * borderpx;
<a href="#h0-107-3" id="h0-107-3" class="d">-	if(xw.isfixed) {
</a><a href="#h0-107-4" id="h0-107-4" class="i">+	if (xw.isfixed) {
</a> 		sizeh-&gt;flags |= PMaxSize | PMinSize;
 		sizeh-&gt;min_width = sizeh-&gt;max_width = xw.w;
 		sizeh-&gt;min_height = sizeh-&gt;max_height = xw.h;
 	}
<a href="#h0-107-9" id="h0-107-9" class="d">-	if(xw.gm &amp; (XValue|YValue)) {
</a><a href="#h0-107-10" id="h0-107-10" class="i">+	if (xw.gm &amp; (XValue|YValue)) {
</a> 		sizeh-&gt;flags |= USPosition | PWinGravity;
 		sizeh-&gt;x = xw.l;
 		sizeh-&gt;y = xw.t;
<a href="#h0-108" id="h0-108" class="h">@@ -3112,7 +3112,7 @@ xhints(void)
</a> int
 xgeommasktogravity(int mask)
 {
<a href="#h0-108-3" id="h0-108-3" class="d">-	switch(mask &amp; (XNegative|YNegative)) {
</a><a href="#h0-108-4" id="h0-108-4" class="i">+	switch (mask &amp; (XNegative|YNegative)) {
</a> 	case 0:
 		return NorthWestGravity;
 	case XNegative:
<a href="#h0-109" id="h0-109" class="h">@@ -3130,10 +3130,10 @@ xloadfont(Font *f, FcPattern *pattern)
</a> 	FcResult result;
 
 	match = FcFontMatch(NULL, pattern, &amp;result);
<a href="#h0-109-3" id="h0-109-3" class="d">-	if(!match)
</a><a href="#h0-109-4" id="h0-109-4" class="i">+	if (!match)
</a> 		return 1;
 
<a href="#h0-109-7" id="h0-109-7" class="d">-	if(!(f-&gt;match = XftFontOpenPattern(xw.dpy, match))) {
</a><a href="#h0-109-8" id="h0-109-8" class="i">+	if (!(f-&gt;match = XftFontOpenPattern(xw.dpy, match))) {
</a> 		FcPatternDestroy(match);
 		return 1;
 	}
<a href="#h0-110" id="h0-110" class="h">@@ -3159,25 +3159,25 @@ xloadfonts(char *fontstr, double fontsize)
</a> 	double fontval;
 	float ceilf(float);
 
<a href="#h0-110-3" id="h0-110-3" class="d">-	if(fontstr[0] == &#39;-&#39;) {
</a><a href="#h0-110-4" id="h0-110-4" class="i">+	if (fontstr[0] == &#39;-&#39;) {
</a> 		pattern = XftXlfdParse(fontstr, False, False);
 	} else {
 		pattern = FcNameParse((FcChar8 *)fontstr);
 	}
 
<a href="#h0-110-10" id="h0-110-10" class="d">-	if(!pattern)
</a><a href="#h0-110-11" id="h0-110-11" class="i">+	if (!pattern)
</a> 		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
 
<a href="#h0-110-14" id="h0-110-14" class="d">-	if(fontsize &gt; 1) {
</a><a href="#h0-110-15" id="h0-110-15" class="i">+	if (fontsize &gt; 1) {
</a> 		FcPatternDel(pattern, FC_PIXEL_SIZE);
 		FcPatternDel(pattern, FC_SIZE);
 		FcPatternAddDouble(pattern, FC_PIXEL_SIZE, (double)fontsize);
 		usedfontsize = fontsize;
 	} else {
<a href="#h0-110-21" id="h0-110-21" class="d">-		if(FcPatternGetDouble(pattern, FC_PIXEL_SIZE, 0, &amp;fontval) ==
</a><a href="#h0-110-22" id="h0-110-22" class="i">+		if (FcPatternGetDouble(pattern, FC_PIXEL_SIZE, 0, &amp;fontval) ==
</a> 				FcResultMatch) {
 			usedfontsize = fontval;
<a href="#h0-110-25" id="h0-110-25" class="d">-		} else if(FcPatternGetDouble(pattern, FC_SIZE, 0, &amp;fontval) ==
</a><a href="#h0-110-26" id="h0-110-26" class="i">+		} else if (FcPatternGetDouble(pattern, FC_SIZE, 0, &amp;fontval) ==
</a> 				FcResultMatch) {
 			usedfontsize = -1;
 		} else {
<a href="#h0-111" id="h0-111" class="h">@@ -3194,14 +3194,14 @@ xloadfonts(char *fontstr, double fontsize)
</a> 	FcConfigSubstitute(0, pattern, FcMatchPattern);
 	FcDefaultSubstitute(pattern);
 
<a href="#h0-111-3" id="h0-111-3" class="d">-	if(xloadfont(&amp;dc.font, pattern))
</a><a href="#h0-111-4" id="h0-111-4" class="i">+	if (xloadfont(&amp;dc.font, pattern))
</a> 		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
 
<a href="#h0-111-7" id="h0-111-7" class="d">-	if(usedfontsize &lt; 0) {
</a><a href="#h0-111-8" id="h0-111-8" class="i">+	if (usedfontsize &lt; 0) {
</a> 		FcPatternGetDouble(dc.font.match-&gt;pattern,
 		                   FC_PIXEL_SIZE, 0, &amp;fontval);
 		usedfontsize = fontval;
<a href="#h0-111-12" id="h0-111-12" class="d">-		if(fontsize == 0)
</a><a href="#h0-111-13" id="h0-111-13" class="i">+		if (fontsize == 0)
</a> 			defaultfontsize = fontval;
 	}
 
<a href="#h0-112" id="h0-112" class="h">@@ -3211,17 +3211,17 @@ xloadfonts(char *fontstr, double fontsize)
</a> 
 	FcPatternDel(pattern, FC_SLANT);
 	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
<a href="#h0-112-3" id="h0-112-3" class="d">-	if(xloadfont(&amp;dc.ifont, pattern))
</a><a href="#h0-112-4" id="h0-112-4" class="i">+	if (xloadfont(&amp;dc.ifont, pattern))
</a> 		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
 
 	FcPatternDel(pattern, FC_WEIGHT);
 	FcPatternAddInteger(pattern, FC_WEIGHT, FC_WEIGHT_BOLD);
<a href="#h0-112-9" id="h0-112-9" class="d">-	if(xloadfont(&amp;dc.ibfont, pattern))
</a><a href="#h0-112-10" id="h0-112-10" class="i">+	if (xloadfont(&amp;dc.ibfont, pattern))
</a> 		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
 
 	FcPatternDel(pattern, FC_SLANT);
 	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ROMAN);
<a href="#h0-112-15" id="h0-112-15" class="d">-	if(xloadfont(&amp;dc.bfont, pattern))
</a><a href="#h0-112-16" id="h0-112-16" class="i">+	if (xloadfont(&amp;dc.bfont, pattern))
</a> 		die(&quot;st: can&#39;t open font %s\n&quot;, fontstr);
 
 	FcPatternDestroy(pattern);
<a href="#h0-113" id="h0-113" class="h">@@ -3232,7 +3232,7 @@ xunloadfont(Font *f)
</a> {
 	XftFontClose(xw.dpy, f-&gt;match);
 	FcPatternDestroy(f-&gt;pattern);
<a href="#h0-113-3" id="h0-113-3" class="d">-	if(f-&gt;set)
</a><a href="#h0-113-4" id="h0-113-4" class="i">+	if (f-&gt;set)
</a> 		FcFontSetDestroy(f-&gt;set);
 }
 
<a href="#h0-114" id="h0-114" class="h">@@ -3240,7 +3240,7 @@ void
</a> xunloadfonts(void)
 {
 	/* Free the loaded fonts in the font cache.  */
<a href="#h0-114-3" id="h0-114-3" class="d">-	while(frclen &gt; 0)
</a><a href="#h0-114-4" id="h0-114-4" class="i">+	while (frclen &gt; 0)
</a> 		XftFontClose(xw.dpy, frc[--frclen].font);
 
 	xunloadfont(&amp;dc.font);
<a href="#h0-115" id="h0-115" class="h">@@ -3273,7 +3273,7 @@ xzoomreset(const Arg *arg)
</a> {
 	Arg larg;
 
<a href="#h0-115-3" id="h0-115-3" class="d">-	if(defaultfontsize &gt; 0) {
</a><a href="#h0-115-4" id="h0-115-4" class="i">+	if (defaultfontsize &gt; 0) {
</a> 		larg.f = defaultfontsize;
 		xzoomabs(&amp;larg);
 	}
<a href="#h0-116" id="h0-116" class="h">@@ -3287,13 +3287,13 @@ xinit(void)
</a> 	Window parent;
 	pid_t thispid = getpid();
 
<a href="#h0-116-3" id="h0-116-3" class="d">-	if(!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h0-116-4" id="h0-116-4" class="i">+	if (!(xw.dpy = XOpenDisplay(NULL)))
</a> 		die(&quot;Can&#39;t open display\n&quot;);
 	xw.scr = XDefaultScreen(xw.dpy);
 	xw.vis = XDefaultVisual(xw.dpy, xw.scr);
 
 	/* font */
<a href="#h0-116-10" id="h0-116-10" class="d">-	if(!FcInit())
</a><a href="#h0-116-11" id="h0-116-11" class="i">+	if (!FcInit())
</a> 		die(&quot;Could not init fontconfig.\n&quot;);
 
 	usedfont = (opt_font == NULL)? font : opt_font;
<a href="#h0-117" id="h0-117" class="h">@@ -3306,9 +3306,9 @@ xinit(void)
</a> 	/* adjust fixed window geometry */
 	xw.w = 2 * borderpx + term.col * xw.cw;
 	xw.h = 2 * borderpx + term.row * xw.ch;
<a href="#h0-117-3" id="h0-117-3" class="d">-	if(xw.gm &amp; XNegative)
</a><a href="#h0-117-4" id="h0-117-4" class="i">+	if (xw.gm &amp; XNegative)
</a> 		xw.l += DisplayWidth(xw.dpy, xw.scr) - xw.w - 2;
<a href="#h0-117-6" id="h0-117-6" class="d">-	if(xw.gm &amp; YNegative)
</a><a href="#h0-117-7" id="h0-117-7" class="i">+	if (xw.gm &amp; YNegative)
</a> 		xw.t += DisplayWidth(xw.dpy, xw.scr) - xw.h - 2;
 
 	/* Events */
<a href="#h0-118" id="h0-118" class="h">@@ -3340,11 +3340,11 @@ xinit(void)
</a> 	xw.draw = XftDrawCreate(xw.dpy, xw.buf, xw.vis, xw.cmap);
 
 	/* input methods */
<a href="#h0-118-3" id="h0-118-3" class="d">-	if((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h0-118-4" id="h0-118-4" class="i">+	if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a> 		XSetLocaleModifiers(&quot;@im=local&quot;);
<a href="#h0-118-6" id="h0-118-6" class="d">-		if((xw.xim =  XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h0-118-7" id="h0-118-7" class="i">+		if ((xw.xim =  XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a> 			XSetLocaleModifiers(&quot;@im=&quot;);
<a href="#h0-118-9" id="h0-118-9" class="d">-			if((xw.xim = XOpenIM(xw.dpy,
</a><a href="#h0-118-10" id="h0-118-10" class="i">+			if ((xw.xim = XOpenIM(xw.dpy,
</a> 					NULL, NULL, NULL)) == NULL) {
 				die(&quot;XOpenIM failed. Could not open input&quot;
 					&quot; device.\n&quot;);
<a href="#h0-119" id="h0-119" class="h">@@ -3354,7 +3354,7 @@ xinit(void)
</a> 	xw.xic = XCreateIC(xw.xim, XNInputStyle, XIMPreeditNothing
 					   | XIMStatusNothing, XNClientWindow, xw.win,
 					   XNFocusWindow, xw.win, NULL);
<a href="#h0-119-3" id="h0-119-3" class="d">-	if(xw.xic == NULL)
</a><a href="#h0-119-4" id="h0-119-4" class="i">+	if (xw.xic == NULL)
</a> 		die(&quot;XCreateIC failed. Could not obtain input method.\n&quot;);
 
 	/* white cursor, black outline */
<a href="#h0-120" id="h0-120" class="h">@@ -3395,28 +3395,28 @@ xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x
</a> 	FcCharSet *fccharset;
 	int i, f, numspecs = 0;
 
<a href="#h0-120-3" id="h0-120-3" class="d">-	for(i = 0, xp = winx, yp = winy + font-&gt;ascent; i &lt; len; ++i) {
</a><a href="#h0-120-4" id="h0-120-4" class="i">+	for (i = 0, xp = winx, yp = winy + font-&gt;ascent; i &lt; len; ++i) {
</a> 		/* Fetch rune and mode for current glyph. */
 		rune = glyphs[i].u;
 		mode = glyphs[i].mode;
 
 		/* Skip dummy wide-character spacing. */
<a href="#h0-120-10" id="h0-120-10" class="d">-		if(mode == ATTR_WDUMMY)
</a><a href="#h0-120-11" id="h0-120-11" class="i">+		if (mode == ATTR_WDUMMY)
</a> 			continue;
 
 		/* Determine font for glyph if different from previous glyph. */
<a href="#h0-120-15" id="h0-120-15" class="d">-		if(prevmode != mode) {
</a><a href="#h0-120-16" id="h0-120-16" class="i">+		if (prevmode != mode) {
</a> 			prevmode = mode;
 			font = &amp;dc.font;
 			frcflags = FRC_NORMAL;
 			runewidth = xw.cw * ((mode &amp; ATTR_WIDE) ? 2.0f : 1.0f);
<a href="#h0-120-21" id="h0-120-21" class="d">-			if((mode &amp; ATTR_ITALIC) &amp;&amp; (mode &amp; ATTR_BOLD)) {
</a><a href="#h0-120-22" id="h0-120-22" class="i">+			if ((mode &amp; ATTR_ITALIC) &amp;&amp; (mode &amp; ATTR_BOLD)) {
</a> 				font = &amp;dc.ibfont;
 				frcflags = FRC_ITALICBOLD;
<a href="#h0-120-25" id="h0-120-25" class="d">-			} else if(mode &amp; ATTR_ITALIC) {
</a><a href="#h0-120-26" id="h0-120-26" class="i">+			} else if (mode &amp; ATTR_ITALIC) {
</a> 				font = &amp;dc.ifont;
 				frcflags = FRC_ITALIC;
<a href="#h0-120-29" id="h0-120-29" class="d">-			} else if(mode &amp; ATTR_BOLD) {
</a><a href="#h0-120-30" id="h0-120-30" class="i">+			} else if (mode &amp; ATTR_BOLD) {
</a> 				font = &amp;dc.bfont;
 				frcflags = FRC_BOLD;
 			}
<a href="#h0-121" id="h0-121" class="h">@@ -3425,7 +3425,7 @@ xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x
</a> 
 		/* Lookup character index with default font. */
 		glyphidx = XftCharIndex(xw.dpy, font-&gt;match, rune);
<a href="#h0-121-3" id="h0-121-3" class="d">-		if(glyphidx) {
</a><a href="#h0-121-4" id="h0-121-4" class="i">+		if (glyphidx) {
</a> 			specs[numspecs].font = font-&gt;match;
 			specs[numspecs].glyph = glyphidx;
 			specs[numspecs].x = (short)xp;
<a href="#h0-122" id="h0-122" class="h">@@ -3436,21 +3436,21 @@ xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x
</a> 		}
 
 		/* Fallback on font cache, search the font cache for match. */
<a href="#h0-122-3" id="h0-122-3" class="d">-		for(f = 0; f &lt; frclen; f++) {
</a><a href="#h0-122-4" id="h0-122-4" class="i">+		for (f = 0; f &lt; frclen; f++) {
</a> 			glyphidx = XftCharIndex(xw.dpy, frc[f].font, rune);
 			/* Everything correct. */
<a href="#h0-122-7" id="h0-122-7" class="d">-			if(glyphidx &amp;&amp; frc[f].flags == frcflags)
</a><a href="#h0-122-8" id="h0-122-8" class="i">+			if (glyphidx &amp;&amp; frc[f].flags == frcflags)
</a> 				break;
 			/* We got a default font for a not found glyph. */
<a href="#h0-122-11" id="h0-122-11" class="d">-			if(!glyphidx &amp;&amp; frc[f].flags == frcflags
</a><a href="#h0-122-12" id="h0-122-12" class="i">+			if (!glyphidx &amp;&amp; frc[f].flags == frcflags
</a> 					&amp;&amp; frc[f].unicodep == rune) {
 				break;
 			}
 		}
 
 		/* Nothing was found. Use fontconfig to find matching font. */
<a href="#h0-122-19" id="h0-122-19" class="d">-		if(f &gt;= frclen) {
</a><a href="#h0-122-20" id="h0-122-20" class="d">-			if(!font-&gt;set)
</a><a href="#h0-122-21" id="h0-122-21" class="i">+		if (f &gt;= frclen) {
</a><a href="#h0-122-22" id="h0-122-22" class="i">+			if (!font-&gt;set)
</a> 				font-&gt;set = FcFontSort(0, font-&gt;pattern,
 				                       1, 0, &amp;fcres);
 			fcsets[0] = font-&gt;set;
<a href="#h0-123" id="h0-123" class="h">@@ -3480,7 +3480,7 @@ xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x
</a> 			/*
 			 * Overwrite or create the new cache entry.
 			 */
<a href="#h0-123-3" id="h0-123-3" class="d">-			if(frclen &gt;= LEN(frc)) {
</a><a href="#h0-123-4" id="h0-123-4" class="i">+			if (frclen &gt;= LEN(frc)) {
</a> 				frclen = LEN(frc) - 1;
 				XftFontClose(xw.dpy, frc[frclen].font);
 				frc[frclen].unicodep = 0;
<a href="#h0-124" id="h0-124" class="h">@@ -3522,16 +3522,16 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 	XRectangle r;
 
 	/* Determine foreground and background colors based on mode. */
<a href="#h0-124-3" id="h0-124-3" class="d">-	if(base.fg == defaultfg) {
</a><a href="#h0-124-4" id="h0-124-4" class="d">-		if(base.mode &amp; ATTR_ITALIC)
</a><a href="#h0-124-5" id="h0-124-5" class="i">+	if (base.fg == defaultfg) {
</a><a href="#h0-124-6" id="h0-124-6" class="i">+		if (base.mode &amp; ATTR_ITALIC)
</a> 			base.fg = defaultitalic;
<a href="#h0-124-8" id="h0-124-8" class="d">-		else if((base.mode &amp; ATTR_ITALIC) &amp;&amp; (base.mode &amp; ATTR_BOLD))
</a><a href="#h0-124-9" id="h0-124-9" class="i">+		else if ((base.mode &amp; ATTR_ITALIC) &amp;&amp; (base.mode &amp; ATTR_BOLD))
</a> 			base.fg = defaultitalic;
<a href="#h0-124-11" id="h0-124-11" class="d">-		else if(base.mode &amp; ATTR_UNDERLINE)
</a><a href="#h0-124-12" id="h0-124-12" class="i">+		else if (base.mode &amp; ATTR_UNDERLINE)
</a> 			base.fg = defaultunderline;
 	}
 
<a href="#h0-124-16" id="h0-124-16" class="d">-	if(IS_TRUECOL(base.fg)) {
</a><a href="#h0-124-17" id="h0-124-17" class="i">+	if (IS_TRUECOL(base.fg)) {
</a> 		colfg.alpha = 0xffff;
 		colfg.red = TRUERED(base.fg);
 		colfg.green = TRUEGREEN(base.fg);
<a href="#h0-125" id="h0-125" class="h">@@ -3542,7 +3542,7 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 		fg = &amp;dc.col[base.fg];
 	}
 
<a href="#h0-125-3" id="h0-125-3" class="d">-	if(IS_TRUECOL(base.bg)) {
</a><a href="#h0-125-4" id="h0-125-4" class="i">+	if (IS_TRUECOL(base.bg)) {
</a> 		colbg.alpha = 0xffff;
 		colbg.green = TRUEGREEN(base.bg);
 		colbg.red = TRUERED(base.bg);
<a href="#h0-126" id="h0-126" class="h">@@ -3554,11 +3554,11 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 	}
 
 	/* Change basic system colors [0-7] to bright system colors [8-15] */
<a href="#h0-126-3" id="h0-126-3" class="d">-	if((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_BOLD &amp;&amp; BETWEEN(base.fg, 0, 7))
</a><a href="#h0-126-4" id="h0-126-4" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_BOLD &amp;&amp; BETWEEN(base.fg, 0, 7))
</a> 		fg = &amp;dc.col[base.fg + 8];
 
<a href="#h0-126-7" id="h0-126-7" class="d">-	if(IS_SET(MODE_REVERSE)) {
</a><a href="#h0-126-8" id="h0-126-8" class="d">-		if(fg == &amp;dc.col[defaultfg]) {
</a><a href="#h0-126-9" id="h0-126-9" class="i">+	if (IS_SET(MODE_REVERSE)) {
</a><a href="#h0-126-10" id="h0-126-10" class="i">+		if (fg == &amp;dc.col[defaultfg]) {
</a> 			fg = &amp;dc.col[defaultbg];
 		} else {
 			colfg.red = ~fg-&gt;color.red;
<a href="#h0-127" id="h0-127" class="h">@@ -3570,7 +3570,7 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 			fg = &amp;revfg;
 		}
 
<a href="#h0-127-3" id="h0-127-3" class="d">-		if(bg == &amp;dc.col[defaultbg]) {
</a><a href="#h0-127-4" id="h0-127-4" class="i">+		if (bg == &amp;dc.col[defaultbg]) {
</a> 			bg = &amp;dc.col[defaultfg];
 		} else {
 			colbg.red = ~bg-&gt;color.red;
<a href="#h0-128" id="h0-128" class="h">@@ -3583,13 +3583,13 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 		}
 	}
 
<a href="#h0-128-3" id="h0-128-3" class="d">-	if(base.mode &amp; ATTR_REVERSE) {
</a><a href="#h0-128-4" id="h0-128-4" class="i">+	if (base.mode &amp; ATTR_REVERSE) {
</a> 		temp = fg;
 		fg = bg;
 		bg = temp;
 	}
 
<a href="#h0-128-10" id="h0-128-10" class="d">-	if((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
</a><a href="#h0-128-11" id="h0-128-11" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
</a> 		colfg.red = fg-&gt;color.red / 2;
 		colfg.green = fg-&gt;color.green / 2;
 		colfg.blue = fg-&gt;color.blue / 2;
<a href="#h0-129" id="h0-129" class="h">@@ -3597,24 +3597,24 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 		fg = &amp;revfg;
 	}
 
<a href="#h0-129-3" id="h0-129-3" class="d">-	if(base.mode &amp; ATTR_BLINK &amp;&amp; term.mode &amp; MODE_BLINK)
</a><a href="#h0-129-4" id="h0-129-4" class="i">+	if (base.mode &amp; ATTR_BLINK &amp;&amp; term.mode &amp; MODE_BLINK)
</a> 		fg = bg;
 
<a href="#h0-129-7" id="h0-129-7" class="d">-	if(base.mode &amp; ATTR_INVISIBLE)
</a><a href="#h0-129-8" id="h0-129-8" class="i">+	if (base.mode &amp; ATTR_INVISIBLE)
</a> 		fg = bg;
 
 	/* Intelligent cleaning up of the borders. */
<a href="#h0-129-12" id="h0-129-12" class="d">-	if(x == 0) {
</a><a href="#h0-129-13" id="h0-129-13" class="i">+	if (x == 0) {
</a> 		xclear(0, (y == 0)? 0 : winy, borderpx,
 			winy + xw.ch + ((y &gt;= term.row-1)? xw.h : 0));
 	}
<a href="#h0-129-17" id="h0-129-17" class="d">-	if(x + charlen &gt;= term.col) {
</a><a href="#h0-129-18" id="h0-129-18" class="i">+	if (x + charlen &gt;= term.col) {
</a> 		xclear(winx + width, (y == 0)? 0 : winy, xw.w,
 			((y &gt;= term.row-1)? xw.h : (winy + xw.ch)));
 	}
<a href="#h0-129-22" id="h0-129-22" class="d">-	if(y == 0)
</a><a href="#h0-129-23" id="h0-129-23" class="i">+	if (y == 0)
</a> 		xclear(winx, 0, winx + width, borderpx);
<a href="#h0-129-25" id="h0-129-25" class="d">-	if(y == term.row-1)
</a><a href="#h0-129-26" id="h0-129-26" class="i">+	if (y == term.row-1)
</a> 		xclear(winx, winy + xw.ch, winx + width, xw.h);
 
 	/* Clean up the region we want to draw to. */
<a href="#h0-130" id="h0-130" class="h">@@ -3631,12 +3631,12 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a> 	XftDrawGlyphFontSpec(xw.draw, fg, specs, len);
 
 	/* Render underline and strikethrough. */
<a href="#h0-130-3" id="h0-130-3" class="d">-	if(base.mode &amp; ATTR_UNDERLINE) {
</a><a href="#h0-130-4" id="h0-130-4" class="i">+	if (base.mode &amp; ATTR_UNDERLINE) {
</a> 		XftDrawRect(xw.draw, fg, winx, winy + dc.font.ascent + 1,
 				width, 1);
 	}
 
<a href="#h0-130-9" id="h0-130-9" class="d">-	if(base.mode &amp; ATTR_STRUCK) {
</a><a href="#h0-130-10" id="h0-130-10" class="i">+	if (base.mode &amp; ATTR_STRUCK) {
</a> 		XftDrawRect(xw.draw, fg, winx, winy + 2 * dc.font.ascent / 3,
 				width, 1);
 	}
<a href="#h0-131" id="h0-131" class="h">@@ -3667,9 +3667,9 @@ xdrawcursor(void)
</a> 	curx = term.c.x;
 
 	/* adjust position if in dummy */
<a href="#h0-131-3" id="h0-131-3" class="d">-	if(term.line[oldy][oldx].mode &amp; ATTR_WDUMMY)
</a><a href="#h0-131-4" id="h0-131-4" class="i">+	if (term.line[oldy][oldx].mode &amp; ATTR_WDUMMY)
</a> 		oldx--;
<a href="#h0-131-6" id="h0-131-6" class="d">-	if(term.line[term.c.y][curx].mode &amp; ATTR_WDUMMY)
</a><a href="#h0-131-7" id="h0-131-7" class="i">+	if (term.line[term.c.y][curx].mode &amp; ATTR_WDUMMY)
</a> 		curx--;
 
 	g.u = term.line[term.c.y][term.c.x].u;
<a href="#h0-132" id="h0-132" class="h">@@ -3677,16 +3677,16 @@ xdrawcursor(void)
</a> 	/* remove the old cursor */
 	xdrawglyph(term.line[oldy][oldx], oldx, oldy);
 
<a href="#h0-132-3" id="h0-132-3" class="d">-	if(IS_SET(MODE_HIDE))
</a><a href="#h0-132-4" id="h0-132-4" class="i">+	if (IS_SET(MODE_HIDE))
</a> 		return;
 
 	/* draw the new one */
<a href="#h0-132-8" id="h0-132-8" class="d">-	if(xw.state &amp; WIN_FOCUSED) {
</a><a href="#h0-132-9" id="h0-132-9" class="i">+	if (xw.state &amp; WIN_FOCUSED) {
</a> 		switch (xw.cursor) {
 			case 0: /* Blinking Block */
 			case 1: /* Blinking Block (Default) */
 			case 2: /* Steady Block */
<a href="#h0-132-14" id="h0-132-14" class="d">-				if(IS_SET(MODE_REVERSE)) {
</a><a href="#h0-132-15" id="h0-132-15" class="i">+				if (IS_SET(MODE_REVERSE)) {
</a> 						g.mode |= ATTR_REVERSE;
 						g.fg = defaultcs;
 						g.bg = defaultfg;
<a href="#h0-133" id="h0-133" class="h">@@ -3776,11 +3776,11 @@ drawregion(int x1, int y1, int x2, int y2)
</a> 	XftGlyphFontSpec* specs;
 	int ena_sel = sel.ob.x != -1 &amp;&amp; sel.alt == IS_SET(MODE_ALTSCREEN);
 
<a href="#h0-133-3" id="h0-133-3" class="d">-	if(!(xw.state &amp; WIN_VISIBLE))
</a><a href="#h0-133-4" id="h0-133-4" class="i">+	if (!(xw.state &amp; WIN_VISIBLE))
</a> 		return;
 
<a href="#h0-133-7" id="h0-133-7" class="d">-	for(y = y1; y &lt; y2; y++) {
</a><a href="#h0-133-8" id="h0-133-8" class="d">-		if(!term.dirty[y])
</a><a href="#h0-133-9" id="h0-133-9" class="i">+	for (y = y1; y &lt; y2; y++) {
</a><a href="#h0-133-10" id="h0-133-10" class="i">+		if (!term.dirty[y])
</a> 			continue;
 
 		xtermclear(0, y, term.col, y);
<a href="#h0-134" id="h0-134" class="h">@@ -3790,25 +3790,25 @@ drawregion(int x1, int y1, int x2, int y2)
</a> 		numspecs = xmakeglyphfontspecs(specs, &amp;term.line[y][x1], x2 - x1, x1, y);
 
 		i = ox = 0;
<a href="#h0-134-3" id="h0-134-3" class="d">-		for(x = x1; x &lt; x2 &amp;&amp; i &lt; numspecs; x++) {
</a><a href="#h0-134-4" id="h0-134-4" class="i">+		for (x = x1; x &lt; x2 &amp;&amp; i &lt; numspecs; x++) {
</a> 			new = term.line[y][x];
<a href="#h0-134-6" id="h0-134-6" class="d">-			if(new.mode == ATTR_WDUMMY)
</a><a href="#h0-134-7" id="h0-134-7" class="i">+			if (new.mode == ATTR_WDUMMY)
</a> 				continue;
<a href="#h0-134-9" id="h0-134-9" class="d">-			if(ena_sel &amp;&amp; selected(x, y))
</a><a href="#h0-134-10" id="h0-134-10" class="i">+			if (ena_sel &amp;&amp; selected(x, y))
</a> 				new.mode ^= ATTR_REVERSE;
<a href="#h0-134-12" id="h0-134-12" class="d">-			if(i &gt; 0 &amp;&amp; ATTRCMP(base, new)) {
</a><a href="#h0-134-13" id="h0-134-13" class="i">+			if (i &gt; 0 &amp;&amp; ATTRCMP(base, new)) {
</a> 				xdrawglyphfontspecs(specs, base, i, ox, y);
 				specs += i;
 				numspecs -= i;
 				i = 0;
 			}
<a href="#h0-134-19" id="h0-134-19" class="d">-			if(i == 0) {
</a><a href="#h0-134-20" id="h0-134-20" class="i">+			if (i == 0) {
</a> 				ox = x;
 				base = new;
 			}
 			i++;
 		}
<a href="#h0-134-26" id="h0-134-26" class="d">-		if(i &gt; 0)
</a><a href="#h0-134-27" id="h0-134-27" class="i">+		if (i &gt; 0)
</a> 			xdrawglyphfontspecs(specs, base, i, ox, y);
 	}
 	xdrawcursor();
<a href="#h0-135" id="h0-135" class="h">@@ -3856,19 +3856,19 @@ focus(XEvent *ev)
</a> {
 	XFocusChangeEvent *e = &amp;ev-&gt;xfocus;
 
<a href="#h0-135-3" id="h0-135-3" class="d">-	if(e-&gt;mode == NotifyGrab)
</a><a href="#h0-135-4" id="h0-135-4" class="i">+	if (e-&gt;mode == NotifyGrab)
</a> 		return;
 
<a href="#h0-135-7" id="h0-135-7" class="d">-	if(ev-&gt;type == FocusIn) {
</a><a href="#h0-135-8" id="h0-135-8" class="i">+	if (ev-&gt;type == FocusIn) {
</a> 		XSetICFocus(xw.xic);
 		xw.state |= WIN_FOCUSED;
 		xseturgency(0);
<a href="#h0-135-12" id="h0-135-12" class="d">-		if(IS_SET(MODE_FOCUS))
</a><a href="#h0-135-13" id="h0-135-13" class="i">+		if (IS_SET(MODE_FOCUS))
</a> 			ttywrite(&quot;\033[I&quot;, 3);
 	} else {
 		XUnsetICFocus(xw.xic);
 		xw.state &amp;= ~WIN_FOCUSED;
<a href="#h0-135-18" id="h0-135-18" class="d">-		if(IS_SET(MODE_FOCUS))
</a><a href="#h0-135-19" id="h0-135-19" class="i">+		if (IS_SET(MODE_FOCUS))
</a> 			ttywrite(&quot;\033[O&quot;, 3);
 	}
 }
<a href="#h0-136" id="h0-136" class="h">@@ -3892,31 +3892,31 @@ kmap(KeySym k, uint state)
</a> 	int i;
 
 	/* Check for mapped keys out of X11 function keys. */
<a href="#h0-136-3" id="h0-136-3" class="d">-	for(i = 0; i &lt; LEN(mappedkeys); i++) {
</a><a href="#h0-136-4" id="h0-136-4" class="d">-		if(mappedkeys[i] == k)
</a><a href="#h0-136-5" id="h0-136-5" class="i">+	for (i = 0; i &lt; LEN(mappedkeys); i++) {
</a><a href="#h0-136-6" id="h0-136-6" class="i">+		if (mappedkeys[i] == k)
</a> 			break;
 	}
<a href="#h0-136-9" id="h0-136-9" class="d">-	if(i == LEN(mappedkeys)) {
</a><a href="#h0-136-10" id="h0-136-10" class="d">-		if((k &amp; 0xFFFF) &lt; 0xFD00)
</a><a href="#h0-136-11" id="h0-136-11" class="i">+	if (i == LEN(mappedkeys)) {
</a><a href="#h0-136-12" id="h0-136-12" class="i">+		if ((k &amp; 0xFFFF) &lt; 0xFD00)
</a> 			return NULL;
 	}
 
<a href="#h0-136-16" id="h0-136-16" class="d">-	for(kp = key; kp &lt; key + LEN(key); kp++) {
</a><a href="#h0-136-17" id="h0-136-17" class="d">-		if(kp-&gt;k != k)
</a><a href="#h0-136-18" id="h0-136-18" class="i">+	for (kp = key; kp &lt; key + LEN(key); kp++) {
</a><a href="#h0-136-19" id="h0-136-19" class="i">+		if (kp-&gt;k != k)
</a> 			continue;
 
<a href="#h0-136-22" id="h0-136-22" class="d">-		if(!match(kp-&gt;mask, state))
</a><a href="#h0-136-23" id="h0-136-23" class="i">+		if (!match(kp-&gt;mask, state))
</a> 			continue;
 
<a href="#h0-136-26" id="h0-136-26" class="d">-		if(IS_SET(MODE_APPKEYPAD) ? kp-&gt;appkey &lt; 0 : kp-&gt;appkey &gt; 0)
</a><a href="#h0-136-27" id="h0-136-27" class="i">+		if (IS_SET(MODE_APPKEYPAD) ? kp-&gt;appkey &lt; 0 : kp-&gt;appkey &gt; 0)
</a> 			continue;
<a href="#h0-136-29" id="h0-136-29" class="d">-		if(term.numlock &amp;&amp; kp-&gt;appkey == 2)
</a><a href="#h0-136-30" id="h0-136-30" class="i">+		if (term.numlock &amp;&amp; kp-&gt;appkey == 2)
</a> 			continue;
 
<a href="#h0-136-33" id="h0-136-33" class="d">-		if(IS_SET(MODE_APPCURSOR) ? kp-&gt;appcursor &lt; 0 : kp-&gt;appcursor &gt; 0)
</a><a href="#h0-136-34" id="h0-136-34" class="i">+		if (IS_SET(MODE_APPCURSOR) ? kp-&gt;appcursor &lt; 0 : kp-&gt;appcursor &gt; 0)
</a> 			continue;
 
<a href="#h0-136-37" id="h0-136-37" class="d">-		if(IS_SET(MODE_CRLF) ? kp-&gt;crlf &lt; 0 : kp-&gt;crlf &gt; 0)
</a><a href="#h0-136-38" id="h0-136-38" class="i">+		if (IS_SET(MODE_CRLF) ? kp-&gt;crlf &lt; 0 : kp-&gt;crlf &gt; 0)
</a> 			continue;
 
 		return kp-&gt;s;
<a href="#h0-137" id="h0-137" class="h">@@ -3936,30 +3936,30 @@ kpress(XEvent *ev)
</a> 	Status status;
 	Shortcut *bp;
 
<a href="#h0-137-3" id="h0-137-3" class="d">-	if(IS_SET(MODE_KBDLOCK))
</a><a href="#h0-137-4" id="h0-137-4" class="i">+	if (IS_SET(MODE_KBDLOCK))
</a> 		return;
 
 	len = XmbLookupString(xw.xic, e, buf, sizeof buf, &amp;ksym, &amp;status);
 	/* 1. shortcuts */
<a href="#h0-137-9" id="h0-137-9" class="d">-	for(bp = shortcuts; bp &lt; shortcuts + LEN(shortcuts); bp++) {
</a><a href="#h0-137-10" id="h0-137-10" class="d">-		if(ksym == bp-&gt;keysym &amp;&amp; match(bp-&gt;mod, e-&gt;state)) {
</a><a href="#h0-137-11" id="h0-137-11" class="i">+	for (bp = shortcuts; bp &lt; shortcuts + LEN(shortcuts); bp++) {
</a><a href="#h0-137-12" id="h0-137-12" class="i">+		if (ksym == bp-&gt;keysym &amp;&amp; match(bp-&gt;mod, e-&gt;state)) {
</a> 			bp-&gt;func(&amp;(bp-&gt;arg));
 			return;
 		}
 	}
 
 	/* 2. custom keys from config.h */
<a href="#h0-137-19" id="h0-137-19" class="d">-	if((customkey = kmap(ksym, e-&gt;state))) {
</a><a href="#h0-137-20" id="h0-137-20" class="i">+	if ((customkey = kmap(ksym, e-&gt;state))) {
</a> 		ttysend(customkey, strlen(customkey));
 		return;
 	}
 
 	/* 3. composed string from input method */
<a href="#h0-137-26" id="h0-137-26" class="d">-	if(len == 0)
</a><a href="#h0-137-27" id="h0-137-27" class="i">+	if (len == 0)
</a> 		return;
<a href="#h0-137-29" id="h0-137-29" class="d">-	if(len == 1 &amp;&amp; e-&gt;state &amp; Mod1Mask) {
</a><a href="#h0-137-30" id="h0-137-30" class="d">-		if(IS_SET(MODE_8BIT)) {
</a><a href="#h0-137-31" id="h0-137-31" class="d">-			if(*buf &lt; 0177) {
</a><a href="#h0-137-32" id="h0-137-32" class="i">+	if (len == 1 &amp;&amp; e-&gt;state &amp; Mod1Mask) {
</a><a href="#h0-137-33" id="h0-137-33" class="i">+		if (IS_SET(MODE_8BIT)) {
</a><a href="#h0-137-34" id="h0-137-34" class="i">+			if (*buf &lt; 0177) {
</a> 				c = *buf | 0x80;
 				len = utf8encode(c, buf);
 			}
<a href="#h0-138" id="h0-138" class="h">@@ -3980,14 +3980,14 @@ cmessage(XEvent *e)
</a> 	 * See xembed specs
 	 *  http://standards.freedesktop.org/xembed-spec/xembed-spec-latest.html
 	 */
<a href="#h0-138-3" id="h0-138-3" class="d">-	if(e-&gt;xclient.message_type == xw.xembed &amp;&amp; e-&gt;xclient.format == 32) {
</a><a href="#h0-138-4" id="h0-138-4" class="d">-		if(e-&gt;xclient.data.l[1] == XEMBED_FOCUS_IN) {
</a><a href="#h0-138-5" id="h0-138-5" class="i">+	if (e-&gt;xclient.message_type == xw.xembed &amp;&amp; e-&gt;xclient.format == 32) {
</a><a href="#h0-138-6" id="h0-138-6" class="i">+		if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_IN) {
</a> 			xw.state |= WIN_FOCUSED;
 			xseturgency(0);
<a href="#h0-138-9" id="h0-138-9" class="d">-		} else if(e-&gt;xclient.data.l[1] == XEMBED_FOCUS_OUT) {
</a><a href="#h0-138-10" id="h0-138-10" class="i">+		} else if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_OUT) {
</a> 			xw.state &amp;= ~WIN_FOCUSED;
 		}
<a href="#h0-138-13" id="h0-138-13" class="d">-	} else if(e-&gt;xclient.data.l[0] == xw.wmdeletewin) {
</a><a href="#h0-138-14" id="h0-138-14" class="i">+	} else if (e-&gt;xclient.data.l[0] == xw.wmdeletewin) {
</a> 		/* Send SIGHUP to shell */
 		kill(pid, SIGHUP);
 		exit(0);
<a href="#h0-139" id="h0-139" class="h">@@ -3999,9 +3999,9 @@ cresize(int width, int height)
</a> {
 	int col, row;
 
<a href="#h0-139-3" id="h0-139-3" class="d">-	if(width != 0)
</a><a href="#h0-139-4" id="h0-139-4" class="i">+	if (width != 0)
</a> 		xw.w = width;
<a href="#h0-139-6" id="h0-139-6" class="d">-	if(height != 0)
</a><a href="#h0-139-7" id="h0-139-7" class="i">+	if (height != 0)
</a> 		xw.h = height;
 
 	col = (xw.w - 2 * borderpx) / xw.cw;
<a href="#h0-140" id="h0-140" class="h">@@ -4015,7 +4015,7 @@ cresize(int width, int height)
</a> void
 resize(XEvent *e)
 {
<a href="#h0-140-3" id="h0-140-3" class="d">-	if(e-&gt;xconfigure.width == xw.w &amp;&amp; e-&gt;xconfigure.height == xw.h)
</a><a href="#h0-140-4" id="h0-140-4" class="i">+	if (e-&gt;xconfigure.width == xw.w &amp;&amp; e-&gt;xconfigure.height == xw.h)
</a> 		return;
 
 	cresize(e-&gt;xconfigure.width, e-&gt;xconfigure.height);
<a href="#h0-141" id="h0-141" class="h">@@ -4039,13 +4039,13 @@ run(void)
</a> 		 * this is not unnecessary.It does not only filter the key event,
 		 * but some clientmessage for input method as well.
 		 */
<a href="#h0-141-3" id="h0-141-3" class="d">-		if(XFilterEvent(&amp;ev, None))
</a><a href="#h0-141-4" id="h0-141-4" class="i">+		if (XFilterEvent(&amp;ev, None))
</a> 			continue;
<a href="#h0-141-6" id="h0-141-6" class="d">-		if(ev.type == ConfigureNotify) {
</a><a href="#h0-141-7" id="h0-141-7" class="i">+		if (ev.type == ConfigureNotify) {
</a> 			w = ev.xconfigure.width;
 			h = ev.xconfigure.height;
 		}
<a href="#h0-141-11" id="h0-141-11" class="d">-	} while(ev.type != MapNotify);
</a><a href="#h0-141-12" id="h0-141-12" class="i">+	} while (ev.type != MapNotify);
</a> 
 	ttynew();
 	cresize(w, h);
<a href="#h0-142" id="h0-142" class="h">@@ -4053,26 +4053,26 @@ run(void)
</a> 	clock_gettime(CLOCK_MONOTONIC, &amp;last);
 	lastblink = last;
 
<a href="#h0-142-3" id="h0-142-3" class="d">-	for(xev = actionfps;;) {
</a><a href="#h0-142-4" id="h0-142-4" class="i">+	for (xev = actionfps;;) {
</a> 		FD_ZERO(&amp;rfd);
 		FD_SET(cmdfd, &amp;rfd);
 		FD_SET(xfd, &amp;rfd);
 
<a href="#h0-142-9" id="h0-142-9" class="d">-		if(pselect(MAX(xfd, cmdfd)+1, &amp;rfd, NULL, NULL, tv, NULL) &lt; 0) {
</a><a href="#h0-142-10" id="h0-142-10" class="d">-			if(errno == EINTR)
</a><a href="#h0-142-11" id="h0-142-11" class="i">+		if (pselect(MAX(xfd, cmdfd)+1, &amp;rfd, NULL, NULL, tv, NULL) &lt; 0) {
</a><a href="#h0-142-12" id="h0-142-12" class="i">+			if (errno == EINTR)
</a> 				continue;
 			die(&quot;select failed: %s\n&quot;, strerror(errno));
 		}
<a href="#h0-142-16" id="h0-142-16" class="d">-		if(FD_ISSET(cmdfd, &amp;rfd)) {
</a><a href="#h0-142-17" id="h0-142-17" class="i">+		if (FD_ISSET(cmdfd, &amp;rfd)) {
</a> 			ttyread();
<a href="#h0-142-19" id="h0-142-19" class="d">-			if(blinktimeout) {
</a><a href="#h0-142-20" id="h0-142-20" class="i">+			if (blinktimeout) {
</a> 				blinkset = tattrset(ATTR_BLINK);
<a href="#h0-142-22" id="h0-142-22" class="d">-				if(!blinkset)
</a><a href="#h0-142-23" id="h0-142-23" class="i">+				if (!blinkset)
</a> 					MODBIT(term.mode, 0, MODE_BLINK);
 			}
 		}
 
<a href="#h0-142-28" id="h0-142-28" class="d">-		if(FD_ISSET(xfd, &amp;rfd))
</a><a href="#h0-142-29" id="h0-142-29" class="i">+		if (FD_ISSET(xfd, &amp;rfd))
</a> 			xev = actionfps;
 
 		clock_gettime(CLOCK_MONOTONIC, &amp;now);
<a href="#h0-143" id="h0-143" class="h">@@ -4081,35 +4081,35 @@ run(void)
</a> 		tv = &amp;drawtimeout;
 
 		dodraw = 0;
<a href="#h0-143-3" id="h0-143-3" class="d">-		if(blinktimeout &amp;&amp; TIMEDIFF(now, lastblink) &gt; blinktimeout) {
</a><a href="#h0-143-4" id="h0-143-4" class="i">+		if (blinktimeout &amp;&amp; TIMEDIFF(now, lastblink) &gt; blinktimeout) {
</a> 			tsetdirtattr(ATTR_BLINK);
 			term.mode ^= MODE_BLINK;
 			lastblink = now;
 			dodraw = 1;
 		}
 		deltatime = TIMEDIFF(now, last);
<a href="#h0-143-11" id="h0-143-11" class="d">-		if(deltatime &gt; 1000 / (xev ? xfps : actionfps)) {
</a><a href="#h0-143-12" id="h0-143-12" class="i">+		if (deltatime &gt; 1000 / (xev ? xfps : actionfps)) {
</a> 			dodraw = 1;
 			last = now;
 		}
 
<a href="#h0-143-17" id="h0-143-17" class="d">-		if(dodraw) {
</a><a href="#h0-143-18" id="h0-143-18" class="d">-			while(XPending(xw.dpy)) {
</a><a href="#h0-143-19" id="h0-143-19" class="i">+		if (dodraw) {
</a><a href="#h0-143-20" id="h0-143-20" class="i">+			while (XPending(xw.dpy)) {
</a> 				XNextEvent(xw.dpy, &amp;ev);
<a href="#h0-143-22" id="h0-143-22" class="d">-				if(XFilterEvent(&amp;ev, None))
</a><a href="#h0-143-23" id="h0-143-23" class="i">+				if (XFilterEvent(&amp;ev, None))
</a> 					continue;
<a href="#h0-143-25" id="h0-143-25" class="d">-				if(handler[ev.type])
</a><a href="#h0-143-26" id="h0-143-26" class="i">+				if (handler[ev.type])
</a> 					(handler[ev.type])(&amp;ev);
 			}
 
 			draw();
 			XFlush(xw.dpy);
 
<a href="#h0-143-33" id="h0-143-33" class="d">-			if(xev &amp;&amp; !FD_ISSET(xfd, &amp;rfd))
</a><a href="#h0-143-34" id="h0-143-34" class="i">+			if (xev &amp;&amp; !FD_ISSET(xfd, &amp;rfd))
</a> 				xev--;
<a href="#h0-143-36" id="h0-143-36" class="d">-			if(!FD_ISSET(cmdfd, &amp;rfd) &amp;&amp; !FD_ISSET(xfd, &amp;rfd)) {
</a><a href="#h0-143-37" id="h0-143-37" class="d">-				if(blinkset) {
</a><a href="#h0-143-38" id="h0-143-38" class="d">-					if(TIMEDIFF(now, lastblink) \
</a><a href="#h0-143-39" id="h0-143-39" class="i">+			if (!FD_ISSET(cmdfd, &amp;rfd) &amp;&amp; !FD_ISSET(xfd, &amp;rfd)) {
</a><a href="#h0-143-40" id="h0-143-40" class="i">+				if (blinkset) {
</a><a href="#h0-143-41" id="h0-143-41" class="i">+					if (TIMEDIFF(now, lastblink) \
</a> 							&gt; blinktimeout) {
 						drawtimeout.tv_nsec = 1000;
 					} else {
<a href="#h0-144" id="h0-144" class="h">@@ -4157,7 +4157,7 @@ main(int argc, char *argv[])
</a> 		opt_class = EARGF(usage());
 		break;
 	case &#39;e&#39;:
<a href="#h0-144-3" id="h0-144-3" class="d">-		if(argc &gt; 0)
</a><a href="#h0-144-4" id="h0-144-4" class="i">+		if (argc &gt; 0)
</a> 			--argc, ++argv;
 		goto run;
 	case &#39;f&#39;:
<a href="#h0-145" id="h0-145" class="h">@@ -4188,10 +4188,10 @@ main(int argc, char *argv[])
</a> 	} ARGEND;
 
 run:
<a href="#h0-145-3" id="h0-145-3" class="d">-	if(argc &gt; 0) {
</a><a href="#h0-145-4" id="h0-145-4" class="i">+	if (argc &gt; 0) {
</a> 		/* eat all remaining arguments */
 		opt_cmd = argv;
<a href="#h0-145-7" id="h0-145-7" class="d">-		if(!opt_title &amp;&amp; !opt_line)
</a><a href="#h0-145-8" id="h0-145-8" class="i">+		if (!opt_title &amp;&amp; !opt_line)
</a> 			opt_title = basename(xstrdup(argv[0]));
 	}
 	setlocale(LC_CTYPE, &quot;&quot;);
</pre>
</div>
</body>
</html>
