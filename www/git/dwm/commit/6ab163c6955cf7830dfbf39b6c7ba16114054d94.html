<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>some drawbar() polishing, and certain related fixes - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/6ab163c6955cf7830dfbf39b6c7ba16114054d94.html">6ab163c6955cf7830dfbf39b6c7ba16114054d94</a>
<b>parent</b> <a href="../commit/e8244395e4fb7f0617367187c799b1fbddeac7a2.html">e8244395e4fb7f0617367187c799b1fbddeac7a2</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Fri, 15 Feb 2008 16:00:02 +0000

some drawbar() polishing, and certain related fixes
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">54</td><td><span class="i">+++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
</table></pre><pre>1 file changed, 33 insertions(+), 21 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -164,9 +164,9 @@ void grabbuttons(Client *c, Bool focused);
</a> void grabkeys(void);
 unsigned int idxoftag(const char *tag);
 void initfont(Monitor*, const char *fontstr);
<a href="#h0-0-3" id="h0-0-3" class="d">-Bool isoccupied(Monitor *m, unsigned int t);
</a><a href="#h0-0-4" id="h0-0-4" class="i">+Bool isoccupied(unsigned int monitor, unsigned int t);
</a> Bool isprotodel(Client *c);
<a href="#h0-0-6" id="h0-0-6" class="d">-Bool isurgent(int monitor, unsigned int t);
</a><a href="#h0-0-7" id="h0-0-7" class="i">+Bool isurgent(unsigned int monitor, unsigned int t);
</a> Bool isvisible(Client *c, int monitor);
 void keypress(XEvent *e);
 void killclient(const char *arg);
<a href="#h0-1" id="h0-1" class="h">@@ -562,39 +562,46 @@ detachstack(Client *c) {
</a> void
 drawbar(void) {
 	int i, j, x;
<a href="#h0-1-3" id="h0-1-3" class="i">+	Client *c;
</a> 
 	for(i = 0; i &lt; mcount; i++) {
 		Monitor *m = &amp;monitors[i];
 		m-&gt;dc.x = 0;
<a href="#h0-1-8" id="h0-1-8" class="i">+		for(c = stack; c &amp;&amp; !isvisible(c, i); c = c-&gt;snext);
</a><a href="#h0-1-9" id="h0-1-9" class="i">+		fprintf(stderr, &quot;m%d %s\n&quot;, i, c ? c-&gt;name : &quot;NIL&quot;);
</a> 		for(j = 0; j &lt; LENGTH(tags); j++) {
 			m-&gt;dc.w = textw(m, tags[j]);
 			if(m-&gt;seltags[j]) {
 				drawtext(m, tags[j], m-&gt;dc.sel, isurgent(i, j));
<a href="#h0-1-14" id="h0-1-14" class="d">-				drawsquare(m, sel &amp;&amp; sel-&gt;tags[j] &amp;&amp; sel-&gt;monitor == selmonitor,
</a><a href="#h0-1-15" id="h0-1-15" class="d">-						isoccupied(m, j), isurgent(i, j), m-&gt;dc.sel);
</a><a href="#h0-1-16" id="h0-1-16" class="i">+				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
</a><a href="#h0-1-17" id="h0-1-17" class="i">+						isoccupied(i, j), isurgent(i, j), m-&gt;dc.sel);
</a> 			}
 			else {
 				drawtext(m, tags[j], m-&gt;dc.norm, isurgent(i, j));
<a href="#h0-1-21" id="h0-1-21" class="d">-				drawsquare(m, sel &amp;&amp; sel-&gt;tags[j] &amp;&amp; sel-&gt;monitor == selmonitor,
</a><a href="#h0-1-22" id="h0-1-22" class="d">-						isoccupied(m, j), isurgent(i, j), m-&gt;dc.norm);
</a><a href="#h0-1-23" id="h0-1-23" class="i">+				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
</a><a href="#h0-1-24" id="h0-1-24" class="i">+						isoccupied(i, j), isurgent(i, j), m-&gt;dc.norm);
</a> 			}
 			m-&gt;dc.x += m-&gt;dc.w;
 		}
 		m-&gt;dc.w = blw;
 		drawtext(m, m-&gt;layout-&gt;symbol, m-&gt;dc.norm, False);
 		x = m-&gt;dc.x + m-&gt;dc.w;
<a href="#h0-1-31" id="h0-1-31" class="d">-		m-&gt;dc.w = textw(m, stext);
</a><a href="#h0-1-32" id="h0-1-32" class="d">-		m-&gt;dc.x = m-&gt;sw - m-&gt;dc.w;
</a><a href="#h0-1-33" id="h0-1-33" class="d">-		if(m-&gt;dc.x &lt; x) {
</a><a href="#h0-1-34" id="h0-1-34" class="d">-			m-&gt;dc.x = x;
</a><a href="#h0-1-35" id="h0-1-35" class="d">-			m-&gt;dc.w = m-&gt;sw - x;
</a><a href="#h0-1-36" id="h0-1-36" class="i">+		if(i == selmonitor) {
</a><a href="#h0-1-37" id="h0-1-37" class="i">+			m-&gt;dc.w = textw(m, stext);
</a><a href="#h0-1-38" id="h0-1-38" class="i">+			m-&gt;dc.x = m-&gt;sw - m-&gt;dc.w;
</a><a href="#h0-1-39" id="h0-1-39" class="i">+			if(m-&gt;dc.x &lt; x) {
</a><a href="#h0-1-40" id="h0-1-40" class="i">+				m-&gt;dc.x = x;
</a><a href="#h0-1-41" id="h0-1-41" class="i">+				m-&gt;dc.w = m-&gt;sw - x;
</a><a href="#h0-1-42" id="h0-1-42" class="i">+			}
</a><a href="#h0-1-43" id="h0-1-43" class="i">+			drawtext(m, stext, m-&gt;dc.norm, False);
</a> 		}
<a href="#h0-1-45" id="h0-1-45" class="d">-		drawtext(m, stext, m-&gt;dc.norm, False);
</a><a href="#h0-1-46" id="h0-1-46" class="i">+		else
</a><a href="#h0-1-47" id="h0-1-47" class="i">+			m-&gt;dc.x = m-&gt;sw;
</a> 		if((m-&gt;dc.w = m-&gt;dc.x - x) &gt; bh) {
 			m-&gt;dc.x = x;
<a href="#h0-1-50" id="h0-1-50" class="d">-			if(sel &amp;&amp; sel-&gt;monitor == selmonitor) {
</a><a href="#h0-1-51" id="h0-1-51" class="d">-				drawtext(m, sel-&gt;name, m-&gt;dc.sel, False);
</a><a href="#h0-1-52" id="h0-1-52" class="d">-				drawsquare(m, False, sel-&gt;isfloating, False, m-&gt;dc.sel);
</a><a href="#h0-1-53" id="h0-1-53" class="i">+			if(c) {
</a><a href="#h0-1-54" id="h0-1-54" class="i">+				drawtext(m, c-&gt;name, m-&gt;dc.sel, False);
</a><a href="#h0-1-55" id="h0-1-55" class="i">+				drawsquare(m, False, c-&gt;isfloating, False, m-&gt;dc.sel);
</a> 			}
 			else
 				drawtext(m, NULL, m-&gt;dc.norm, False);
<a href="#h0-2" id="h0-2" class="h">@@ -679,8 +686,10 @@ enternotify(XEvent *e) {
</a> 	Client *c;
 	XCrossingEvent *ev = &amp;e-&gt;xcrossing;
 
<a href="#h0-2-3" id="h0-2-3" class="d">-	if(ev-&gt;mode != NotifyNormal || ev-&gt;detail == NotifyInferior);
</a><a href="#h0-2-4" id="h0-2-4" class="d">-		//return;
</a><a href="#h0-2-5" id="h0-2-5" class="i">+	if(ev-&gt;mode != NotifyNormal || ev-&gt;detail == NotifyInferior) {
</a><a href="#h0-2-6" id="h0-2-6" class="i">+		if(!isxinerama || ev-&gt;window != monitors[selmonitor].root)
</a><a href="#h0-2-7" id="h0-2-7" class="i">+			return;
</a><a href="#h0-2-8" id="h0-2-8" class="i">+	}
</a> 	if((c = getclient(ev-&gt;window)))
 		focus(c);
 	else {
<a href="#h0-3" id="h0-3" class="h">@@ -747,6 +756,7 @@ focus(Client *c) {
</a> 	}
 	else {
 		XSetInputFocus(dpy, m-&gt;root, RevertToPointerRoot, CurrentTime);
<a href="#h0-3-3" id="h0-3-3" class="i">+		drawbar();
</a> 	}
 }
 
<a href="#h0-4" id="h0-4" class="h">@@ -972,11 +982,11 @@ initfont(Monitor *m, const char *fontstr) {
</a> }
 
 Bool
<a href="#h0-4-3" id="h0-4-3" class="d">-isoccupied(Monitor *m, unsigned int t) {
</a><a href="#h0-4-4" id="h0-4-4" class="i">+isoccupied(unsigned int monitor, unsigned int t) {
</a> 	Client *c;
 
 	for(c = clients; c; c = c-&gt;next)
<a href="#h0-4-8" id="h0-4-8" class="d">-		if(c-&gt;tags[t] &amp;&amp; c-&gt;monitor == selmonitor)
</a><a href="#h0-4-9" id="h0-4-9" class="i">+		if(c-&gt;tags[t] &amp;&amp; c-&gt;monitor == monitor)
</a> 			return True;
 	return False;
 }
<a href="#h0-5" id="h0-5" class="h">@@ -997,7 +1007,7 @@ isprotodel(Client *c) {
</a> }
 
 Bool
<a href="#h0-5-3" id="h0-5-3" class="d">-isurgent(int monitor, unsigned int t) {
</a><a href="#h0-5-4" id="h0-5-4" class="i">+isurgent(unsigned int monitor, unsigned int t) {
</a> 	Client *c;
 
 	for(c = clients; c; c = c-&gt;next)
<a href="#h0-6" id="h0-6" class="h">@@ -1010,8 +1020,10 @@ Bool
</a> isvisible(Client *c, int monitor) {
 	unsigned int i;
 
<a href="#h0-6-3" id="h0-6-3" class="i">+	if(c-&gt;monitor != monitor)
</a><a href="#h0-6-4" id="h0-6-4" class="i">+		return False;
</a> 	for(i = 0; i &lt; LENGTH(tags); i++)
<a href="#h0-6-6" id="h0-6-6" class="d">-		if(c-&gt;tags[i] &amp;&amp; monitors[c-&gt;monitor].seltags[i] &amp;&amp; c-&gt;monitor == monitor)
</a><a href="#h0-6-7" id="h0-6-7" class="i">+		if(c-&gt;tags[i] &amp;&amp; monitors[c-&gt;monitor].seltags[i])
</a> 			return True;
 	return False;
 }
</pre>
</div>
</body>
</html>
