<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>implemented urgent hint handling (with multihead support) - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/012710a3cee6a15e4b8284edb57d39332ddd60b4.html">012710a3cee6a15e4b8284edb57d39332ddd60b4</a>
<b>parent</b> <a href="../commit/c2c54cc0faad89483edf3ffddee3e3ff20cf8263.html">c2c54cc0faad89483edf3ffddee3e3ff20cf8263</a>
<b>Author:</b> anselm@aab &lt;<a href="mailto:unknown">unknown</a>&gt;
<b>Date:</b>   Mon, 11 Feb 2008 20:34:17 +0000

implemented urgent hint handling (with multihead support)
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">48</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
</table></pre><pre>1 file changed, 37 insertions(+), 11 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -68,7 +68,7 @@ struct Client {
</a> 	int minax, maxax, minay, maxay;
 	long flags;
 	unsigned int border, oldborder;
<a href="#h0-0-3" id="h0-0-3" class="d">-	Bool isbanned, isfixed, isfloating;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	Bool isbanned, isfixed, isfloating, isurgent;
</a> 	Bool *tags;
 	Client *next;
 	Client *prev;
<a href="#h0-1" id="h0-1" class="h">@@ -146,7 +146,7 @@ void detach(Client *c);
</a> void detachstack(Client *c);
 void drawbar(void);
 void drawsquare(Monitor *, Bool filled, Bool empty, unsigned long col[ColLast]);
<a href="#h0-1-3" id="h0-1-3" class="d">-void drawtext(Monitor *, const char *text, unsigned long col[ColLast]);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+void drawtext(Monitor *, const char *text, unsigned long col[ColLast], Bool invert);
</a> void *emallocz(unsigned int size);
 void enternotify(XEvent *e);
 void eprint(const char *errstr, ...);
<a href="#h0-2" id="h0-2" class="h">@@ -166,6 +166,7 @@ unsigned int idxoftag(const char *tag);
</a> void initfont(Monitor*, const char *fontstr);
 Bool isoccupied(Monitor *m, unsigned int t);
 Bool isprotodel(Client *c);
<a href="#h0-2-3" id="h0-2-3" class="i">+Bool isurgent(int monitor, unsigned int t);
</a> Bool isvisible(Client *c, int monitor);
 void keypress(XEvent *e);
 void killclient(const char *arg);
<a href="#h0-3" id="h0-3" class="h">@@ -201,6 +202,7 @@ void unmapnotify(XEvent *e);
</a> void updatebarpos(Monitor *m);
 void updatesizehints(Client *c);
 void updatetitle(Client *c);
<a href="#h0-3-3" id="h0-3-3" class="i">+void updatewmhints(Client *c);
</a> void view(const char *arg);
 void viewprevtag(const char *arg);	/* views previous selected tags */
 int xerror(Display *dpy, XErrorEvent *ee);
<a href="#h0-4" id="h0-4" class="h">@@ -573,17 +575,17 @@ drawbar(void) {
</a> 		for(j = 0; j &lt; LENGTH(tags); j++) {
 			m-&gt;dc.w = textw(m, tags[j]);
 			if(m-&gt;seltags[j]) {
<a href="#h0-4-3" id="h0-4-3" class="d">-				drawtext(m, tags[j], m-&gt;dc.sel);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+				drawtext(m, tags[j], m-&gt;dc.sel, isurgent(i, j));
</a> 				drawsquare(m, sel &amp;&amp; sel-&gt;tags[j] &amp;&amp; sel-&gt;monitor == selmonitor, isoccupied(m, j), m-&gt;dc.sel);
 			}
 			else {
<a href="#h0-4-8" id="h0-4-8" class="d">-				drawtext(m, tags[j], m-&gt;dc.norm);
</a><a href="#h0-4-9" id="h0-4-9" class="i">+				drawtext(m, tags[j], m-&gt;dc.norm, isurgent(i, j));
</a> 				drawsquare(m, sel &amp;&amp; sel-&gt;tags[j] &amp;&amp; sel-&gt;monitor == selmonitor, isoccupied(m, j), m-&gt;dc.norm);
 			}
 			m-&gt;dc.x += m-&gt;dc.w;
 		}
 		m-&gt;dc.w = blw;
<a href="#h0-4-15" id="h0-4-15" class="d">-		drawtext(m, m-&gt;layout-&gt;symbol, m-&gt;dc.norm);
</a><a href="#h0-4-16" id="h0-4-16" class="i">+		drawtext(m, m-&gt;layout-&gt;symbol, m-&gt;dc.norm, False);
</a> 		x = m-&gt;dc.x + m-&gt;dc.w;
 		m-&gt;dc.w = textw(m, stext);
 		m-&gt;dc.x = m-&gt;sw - m-&gt;dc.w;
<a href="#h0-5" id="h0-5" class="h">@@ -591,15 +593,15 @@ drawbar(void) {
</a> 			m-&gt;dc.x = x;
 			m-&gt;dc.w = m-&gt;sw - x;
 		}
<a href="#h0-5-3" id="h0-5-3" class="d">-		drawtext(m, stext, m-&gt;dc.norm);
</a><a href="#h0-5-4" id="h0-5-4" class="i">+		drawtext(m, stext, m-&gt;dc.norm, False);
</a> 		if((m-&gt;dc.w = m-&gt;dc.x - x) &gt; bh) {
 			m-&gt;dc.x = x;
 			if(sel &amp;&amp; sel-&gt;monitor == selmonitor) {
<a href="#h0-5-8" id="h0-5-8" class="d">-				drawtext(m, sel-&gt;name, m-&gt;dc.sel);
</a><a href="#h0-5-9" id="h0-5-9" class="i">+				drawtext(m, sel-&gt;name, m-&gt;dc.sel, False);
</a> 				drawsquare(m, False, sel-&gt;isfloating, m-&gt;dc.sel);
 			}
 			else
<a href="#h0-5-13" id="h0-5-13" class="d">-				drawtext(m, NULL, m-&gt;dc.norm);
</a><a href="#h0-5-14" id="h0-5-14" class="i">+				drawtext(m, NULL, m-&gt;dc.norm, False);
</a> 		}
 		XCopyArea(dpy, m-&gt;dc.drawable, m-&gt;barwin, m-&gt;dc.gc, 0, 0, m-&gt;sw, bh, 0, 0);
 		XSync(dpy, False);
<a href="#h0-6" id="h0-6" class="h">@@ -628,13 +630,13 @@ drawsquare(Monitor *m, Bool filled, Bool empty, unsigned long col[ColLast]) {
</a> }
 
 void
<a href="#h0-6-3" id="h0-6-3" class="d">-drawtext(Monitor *m, const char *text, unsigned long col[ColLast]) {
</a><a href="#h0-6-4" id="h0-6-4" class="i">+drawtext(Monitor *m, const char *text, unsigned long col[ColLast], Bool invert) {
</a> 	int x, y, w, h;
 	static char buf[256];
 	unsigned int len, olen;
 	XRectangle r = { m-&gt;dc.x, m-&gt;dc.y, m-&gt;dc.w, m-&gt;dc.h };
 
<a href="#h0-6-10" id="h0-6-10" class="d">-	XSetForeground(dpy, m-&gt;dc.gc, col[ColBG]);
</a><a href="#h0-6-11" id="h0-6-11" class="i">+	XSetForeground(dpy, m-&gt;dc.gc, col[invert ? ColFG : ColBG]);
</a> 	XFillRectangles(dpy, m-&gt;dc.drawable, m-&gt;dc.gc, &amp;r, 1);
 	if(!text)
 		return;
<a href="#h0-7" id="h0-7" class="h">@@ -660,7 +662,7 @@ drawtext(Monitor *m, const char *text, unsigned long col[ColLast]) {
</a> 	}
 	if(w &gt; m-&gt;dc.w)
 		return; /* too long */
<a href="#h0-7-3" id="h0-7-3" class="d">-	XSetForeground(dpy, m-&gt;dc.gc, col[ColFG]);
</a><a href="#h0-7-4" id="h0-7-4" class="i">+	XSetForeground(dpy, m-&gt;dc.gc, col[invert ? ColBG : ColFG]);
</a> 	if(m-&gt;dc.font.set)
 		XmbDrawString(dpy, m-&gt;dc.drawable, m-&gt;dc.font.set, m-&gt;dc.gc, x, y, buf, len);
 	else
<a href="#h0-8" id="h0-8" class="h">@@ -999,6 +1001,16 @@ isprotodel(Client *c) {
</a> }
 
 Bool
<a href="#h0-8-3" id="h0-8-3" class="i">+isurgent(int monitor, unsigned int t) {
</a><a href="#h0-8-4" id="h0-8-4" class="i">+	Client *c;
</a><a href="#h0-8-5" id="h0-8-5" class="i">+
</a><a href="#h0-8-6" id="h0-8-6" class="i">+	for(c = clients; c; c = c-&gt;next)
</a><a href="#h0-8-7" id="h0-8-7" class="i">+		if(c-&gt;monitor == monitor &amp;&amp; c-&gt;isurgent &amp;&amp; c-&gt;tags[t])
</a><a href="#h0-8-8" id="h0-8-8" class="i">+			return True;
</a><a href="#h0-8-9" id="h0-8-9" class="i">+	return False;
</a><a href="#h0-8-10" id="h0-8-10" class="i">+}
</a><a href="#h0-8-11" id="h0-8-11" class="i">+
</a><a href="#h0-8-12" id="h0-8-12" class="i">+Bool
</a> isvisible(Client *c, int monitor) {
 	unsigned int i;
 
<a href="#h0-9" id="h0-9" class="h">@@ -1215,6 +1227,10 @@ propertynotify(XEvent *e) {
</a> 			case XA_WM_NORMAL_HINTS:
 				updatesizehints(c);
 				break;
<a href="#h0-9-3" id="h0-9-3" class="i">+			case XA_WM_HINTS:
</a><a href="#h0-9-4" id="h0-9-4" class="i">+				updatewmhints(c);
</a><a href="#h0-9-5" id="h0-9-5" class="i">+				drawbar();
</a><a href="#h0-9-6" id="h0-9-6" class="i">+				break;
</a> 		}
 		if(ev-&gt;atom == XA_WM_NAME || ev-&gt;atom == netatom[NetWMName]) {
 			updatetitle(c);
<a href="#h0-10" id="h0-10" class="h">@@ -1916,6 +1932,16 @@ updatetitle(Client *c) {
</a> 		gettextprop(c-&gt;win, wmatom[WMName], c-&gt;name, sizeof c-&gt;name);
 }
 
<a href="#h0-10-3" id="h0-10-3" class="i">+void
</a><a href="#h0-10-4" id="h0-10-4" class="i">+updatewmhints(Client *c) {
</a><a href="#h0-10-5" id="h0-10-5" class="i">+	XWMHints *wmh;
</a><a href="#h0-10-6" id="h0-10-6" class="i">+
</a><a href="#h0-10-7" id="h0-10-7" class="i">+	if((wmh = XGetWMHints(dpy, c-&gt;win))) {
</a><a href="#h0-10-8" id="h0-10-8" class="i">+		c-&gt;isurgent = (wmh-&gt;flags &amp; XUrgencyHint) ? True : False;
</a><a href="#h0-10-9" id="h0-10-9" class="i">+		XFree(wmh);
</a><a href="#h0-10-10" id="h0-10-10" class="i">+	}
</a><a href="#h0-10-11" id="h0-10-11" class="i">+}
</a><a href="#h0-10-12" id="h0-10-12" class="i">+
</a> /* There&#39;s no way to check accesses to destroyed windows, thus those cases are
  * ignored (especially on UnmapNotify&#39;s).  Other types of errors call Xlibs
  * default error handler, which may call exit.  */
</pre>
</div>
</body>
</html>
