<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>experimental xinerama support, two new actions, Mod1-w/e and Mod1-Shift-w/e - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/2ce37bc69ee72af7ea88376c73133f8a833204cf.html">2ce37bc69ee72af7ea88376c73133f8a833204cf</a>
<b>parent</b> <a href="../commit/f27ccc5c60e4518c90f33bb20e68ea7bb23a2947.html">f27ccc5c60e4518c90f33bb20e68ea7bb23a2947</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:anselm@garbe.us">anselm@garbe.us</a>&gt;
<b>Date:</b>   Sat, 20 Jun 2009 15:10:04 +0100

experimental xinerama support, two new actions, Mod1-w/e and Mod1-Shift-w/e
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.mk</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">dwm.c</a></td><td> | </td><td class="num">310</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------</span></td></tr>
</table></pre><pre>3 files changed, 209 insertions(+), 121 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -13,6 +13,7 @@ static unsigned int snap            = 32;       /* snap pixel */
</a> static Bool showbar                 = True;     /* False means no bar */
 static Bool topbar                  = True;     /* False means bottom bar */
 
<a href="#h0-0-3" id="h0-0-3" class="i">+
</a> /* tagging */
 static const char *tags[] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot; };
 static unsigned int tagset[] = {1, 1}; /* after start, first tag is selected */
<a href="#h0-1" id="h0-1" class="h">@@ -20,7 +21,8 @@ static unsigned int tagset[] = {1, 1}; /* after start, first tag is selected */
</a> static Rule rules[] = {
 	/* class      instance    title       tags mask     isfloating */
 	{ &quot;Gimp&quot;,     NULL,       NULL,       0,            True },
<a href="#h0-1-3" id="h0-1-3" class="d">-	{ &quot;Firefox&quot;,  NULL,       NULL,       1 &lt;&lt; 8,       True },
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	{ &quot;Firefox&quot;,  NULL,       NULL,       1 &lt;&lt; 8,       False },
</a><a href="#h0-1-5" id="h0-1-5" class="i">+
</a> };
 
 /* layout(s) */
<a href="#h0-2" id="h0-2" class="h">@@ -68,6 +70,12 @@ static Key keys[] = {
</a> 	{ MODKEY|ShiftMask,             XK_space,  togglefloating, {0} },
 	{ MODKEY,                       XK_0,      view,           {.ui = ~0 } },
 	{ MODKEY|ShiftMask,             XK_0,      tag,            {.ui = ~0 } },
<a href="#h0-2-3" id="h0-2-3" class="i">+#ifdef XINERAMA
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	{ MODKEY,                       XK_w,      focusmon,       {.ui = 0 } },
</a><a href="#h0-2-5" id="h0-2-5" class="i">+	{ MODKEY,                       XK_e,      focusmon,       {.ui = 1 } },
</a><a href="#h0-2-6" id="h0-2-6" class="i">+	{ MODKEY|ShiftMask,             XK_w,      tagmon,         {.ui = 0 } },
</a><a href="#h0-2-7" id="h0-2-7" class="i">+	{ MODKEY|ShiftMask,             XK_e,      tagmon,         {.ui = 1 } },
</a><a href="#h0-2-8" id="h0-2-8" class="i">+#endif /* XINERAMA */
</a> 	TAGKEYS(                        XK_1,                      0)
 	TAGKEYS(                        XK_2,                      1)
 	TAGKEYS(                        XK_3,                      2)
<b>diff --git a/<a id="h1" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -11,8 +11,8 @@ X11INC = /usr/X11R6/include
</a> X11LIB = /usr/X11R6/lib
 
 # Xinerama, un-comment if you want it
<a href="#h1-0-3" id="h1-0-3" class="d">-#XINERAMALIBS = -L${X11LIB} -lXinerama
</a><a href="#h1-0-4" id="h1-0-4" class="d">-#XINERAMAFLAGS = -DXINERAMA
</a><a href="#h1-0-5" id="h1-0-5" class="i">+XINERAMALIBS = -L${X11LIB} -lXinerama
</a><a href="#h1-0-6" id="h1-0-6" class="i">+XINERAMAFLAGS = -DXINERAMA
</a> 
 # includes and libs
 INCS = -I. -I/usr/include -I${X11INC}
<a href="#h1-1" id="h1-1" class="h">@@ -20,8 +20,10 @@ LIBS = -L/usr/lib -lc -L${X11LIB} -lX11 ${XINERAMALIBS}
</a> 
 # flags
 CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot; ${XINERAMAFLAGS}
<a href="#h1-1-3" id="h1-1-3" class="d">-CFLAGS = -std=c99 -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
</a><a href="#h1-1-4" id="h1-1-4" class="d">-LDFLAGS = -s ${LIBS}
</a><a href="#h1-1-5" id="h1-1-5" class="i">+CFLAGS = -g -std=c99 -pedantic -Wall -O0 ${INCS} ${CPPFLAGS}
</a><a href="#h1-1-6" id="h1-1-6" class="i">+#CFLAGS = -std=c99 -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
</a><a href="#h1-1-7" id="h1-1-7" class="i">+LDFLAGS = -g ${LIBS}
</a><a href="#h1-1-8" id="h1-1-8" class="i">+#LDFLAGS = -s ${LIBS}
</a> 
 # Solaris
 #CFLAGS = -fast ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
<b>diff --git a/<a id="h2" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -38,13 +38,13 @@
</a> #include &lt;X11/Xutil.h&gt;
 #ifdef XINERAMA
 #include &lt;X11/extensions/Xinerama.h&gt;
<a href="#h2-0-3" id="h2-0-3" class="d">-#endif
</a><a href="#h2-0-4" id="h2-0-4" class="i">+#endif /* XINERAMA */
</a> 
 /* macros */
 #define BUTTONMASK              (ButtonPressMask|ButtonReleaseMask)
 #define CLEANMASK(mask)         (mask &amp; ~(numlockmask|LockMask))
 #define INRECT(X,Y,RX,RY,RW,RH) ((X) &gt;= (RX) &amp;&amp; (X) &lt; (RX) + (RW) &amp;&amp; (Y) &gt;= (RY) &amp;&amp; (Y) &lt; (RY) + (RH))
<a href="#h2-0-10" id="h2-0-10" class="d">-#define ISVISIBLE(x)            (x-&gt;tags &amp; tagset[selmon-&gt;seltags])
</a><a href="#h2-0-11" id="h2-0-11" class="i">+#define ISVISIBLE(x)            (x-&gt;tags &amp; tagset[mon[x-&gt;mon].seltags])
</a> #define LENGTH(x)               (sizeof x / sizeof x[0])
 #define MAX(a, b)               ((a) &gt; (b) ? (a) : (b))
 #define MIN(a, b)               ((a) &lt; (b) ? (a) : (b))
<a href="#h2-1" id="h2-1" class="h">@@ -115,17 +115,22 @@ typedef struct {
</a> } Key;
 
 typedef struct {
<a href="#h2-1-3" id="h2-1-3" class="d">-	const char *symbol;
</a><a href="#h2-1-4" id="h2-1-4" class="d">-	void (*arrange)(void);
</a><a href="#h2-1-5" id="h2-1-5" class="d">-} Layout;
</a><a href="#h2-1-6" id="h2-1-6" class="d">-
</a><a href="#h2-1-7" id="h2-1-7" class="d">-typedef struct {
</a><a href="#h2-1-8" id="h2-1-8" class="d">-	int wx, wy, ww, wh;
</a><a href="#h2-1-9" id="h2-1-9" class="i">+	char symbol[4];
</a><a href="#h2-1-10" id="h2-1-10" class="i">+	int by, btx;          /* bar geometry */
</a><a href="#h2-1-11" id="h2-1-11" class="i">+	int wx, wy, ww, wh;   /* window area  */
</a> 	unsigned int seltags;
 	unsigned int sellt;
<a href="#h2-1-14" id="h2-1-14" class="i">+	Bool showbar;
</a><a href="#h2-1-15" id="h2-1-15" class="i">+	Bool topbar;
</a><a href="#h2-1-16" id="h2-1-16" class="i">+	Window barwin;
</a> } Monitor;
 
 typedef struct {
<a href="#h2-1-20" id="h2-1-20" class="i">+	const char *symbol;
</a><a href="#h2-1-21" id="h2-1-21" class="i">+	void (*arrange)(Monitor *);
</a><a href="#h2-1-22" id="h2-1-22" class="i">+} Layout;
</a><a href="#h2-1-23" id="h2-1-23" class="i">+
</a><a href="#h2-1-24" id="h2-1-24" class="i">+typedef struct {
</a> 	const char *class;
 	const char *instance;
 	const char *title;
<a href="#h2-2" id="h2-2" class="h">@@ -150,7 +155,8 @@ static void destroynotify(XEvent *e);
</a> static void detach(Client *c);
 static void detachstack(Client *c);
 static void die(const char *errstr, ...);
<a href="#h2-2-3" id="h2-2-3" class="d">-static void drawbar(void);
</a><a href="#h2-2-4" id="h2-2-4" class="i">+static void drawbar(Monitor *m);
</a><a href="#h2-2-5" id="h2-2-5" class="i">+static void drawbars();
</a> static void drawsquare(Bool filled, Bool empty, Bool invert, unsigned long col[ColLast]);
 static void drawtext(const char *text, unsigned long col[ColLast], Bool invert);
 static void enternotify(XEvent *e);
<a href="#h2-3" id="h2-3" class="h">@@ -171,14 +177,14 @@ static void killclient(const Arg *arg);
</a> static void manage(Window w, XWindowAttributes *wa);
 static void mappingnotify(XEvent *e);
 static void maprequest(XEvent *e);
<a href="#h2-3-3" id="h2-3-3" class="d">-static void monocle(void);
</a><a href="#h2-3-4" id="h2-3-4" class="i">+static void monocle(Monitor *m);
</a> static void movemouse(const Arg *arg);
<a href="#h2-3-6" id="h2-3-6" class="d">-static Client *nexttiled(Client *c);
</a><a href="#h2-3-7" id="h2-3-7" class="i">+static Client *nexttiled(Monitor *m, Client *c);
</a> static void propertynotify(XEvent *e);
 static void quit(const Arg *arg);
 static void resize(Client *c, int x, int y, int w, int h);
 static void resizemouse(const Arg *arg);
<a href="#h2-3-12" id="h2-3-12" class="d">-static void restack(void);
</a><a href="#h2-3-13" id="h2-3-13" class="i">+static void restack(Monitor *m);
</a> static void run(void);
 static void scan(void);
 static void setclientstate(Client *c, long state);
<a href="#h2-4" id="h2-4" class="h">@@ -190,14 +196,13 @@ static void sigchld(int signal);
</a> static void spawn(const Arg *arg);
 static void tag(const Arg *arg);
 static int textnw(const char *text, unsigned int len);
<a href="#h2-4-3" id="h2-4-3" class="d">-static void tile(void);
</a><a href="#h2-4-4" id="h2-4-4" class="i">+static void tile(Monitor *);
</a> static void togglebar(const Arg *arg);
 static void togglefloating(const Arg *arg);
 static void toggletag(const Arg *arg);
 static void toggleview(const Arg *arg);
 static void unmanage(Client *c);
 static void unmapnotify(XEvent *e);
<a href="#h2-4-11" id="h2-4-11" class="d">-static void updatebar(void);
</a> static void updategeom(void);
 static void updatenumlockmask(void);
 static void updatesizehints(Client *c);
<a href="#h2-5" id="h2-5" class="h">@@ -209,12 +214,16 @@ static int xerror(Display *dpy, XErrorEvent *ee);
</a> static int xerrordummy(Display *dpy, XErrorEvent *ee);
 static int xerrorstart(Display *dpy, XErrorEvent *ee);
 static void zoom(const Arg *arg);
<a href="#h2-5-3" id="h2-5-3" class="i">+#ifdef XINERAMA
</a><a href="#h2-5-4" id="h2-5-4" class="i">+static void focusmon(const Arg *arg);
</a><a href="#h2-5-5" id="h2-5-5" class="i">+static void tagmon(const Arg *arg);
</a><a href="#h2-5-6" id="h2-5-6" class="i">+#endif /* XINERAMA */
</a> 
 /* variables */
 static char stext[256];
 static int screen;
<a href="#h2-5-11" id="h2-5-11" class="d">-static int sx, sy, sw, sh; /* X display screen geometry x, y, width, height */ 
</a><a href="#h2-5-12" id="h2-5-12" class="d">-static int by, bh, blw;    /* bar geometry y, height and layout symbol width */
</a><a href="#h2-5-13" id="h2-5-13" class="i">+static int sx, sy, sw, sh;   /* X display screen geometry x, y, width, height */
</a><a href="#h2-5-14" id="h2-5-14" class="i">+static int bh, blw = 0;      /* bar geometry */
</a> static int (*xerrorxlib)(Display *, XErrorEvent *);
 static unsigned int numlockmask = 0;
 static void (*handler[LASTEvent]) (XEvent *) = {
<a href="#h2-6" id="h2-6" class="h">@@ -243,7 +252,7 @@ static DC dc;
</a> static Layout *lt[] = { NULL, NULL };
 static Monitor *mon = NULL, *selmon = NULL;
 static unsigned int nmons;
<a href="#h2-6-3" id="h2-6-3" class="d">-static Window root, barwin;
</a><a href="#h2-6-4" id="h2-6-4" class="i">+static Window root;
</a> /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
 
<a href="#h2-7" id="h2-7" class="h">@@ -266,7 +275,7 @@ applyrules(Client *c) {
</a> 			&amp;&amp; (!r-&gt;class || (ch.res_class &amp;&amp; strstr(ch.res_class, r-&gt;class)))
 			&amp;&amp; (!r-&gt;instance || (ch.res_name &amp;&amp; strstr(ch.res_name, r-&gt;instance)))) {
 				c-&gt;isfloating = r-&gt;isfloating;
<a href="#h2-7-3" id="h2-7-3" class="d">-				c-&gt;tags |= r-&gt;tags; 
</a><a href="#h2-7-4" id="h2-7-4" class="i">+				c-&gt;tags |= r-&gt;tags;
</a> 			}
 		}
 		if(ch.res_class)
<a href="#h2-8" id="h2-8" class="h">@@ -344,11 +353,14 @@ applysizehints(Client *c, int *x, int *y, int *w, int *h) {
</a> 
 void
 arrange(void) {
<a href="#h2-8-3" id="h2-8-3" class="i">+	unsigned int i;
</a> 	showhide(stack);
 	focus(NULL);
<a href="#h2-8-6" id="h2-8-6" class="d">-	if(lt[selmon-&gt;sellt]-&gt;arrange)
</a><a href="#h2-8-7" id="h2-8-7" class="d">-		lt[selmon-&gt;sellt]-&gt;arrange();
</a><a href="#h2-8-8" id="h2-8-8" class="d">-	restack();
</a><a href="#h2-8-9" id="h2-8-9" class="i">+	for(i = 0; i &lt; nmons; i++) {
</a><a href="#h2-8-10" id="h2-8-10" class="i">+		if(lt[mon[i].sellt]-&gt;arrange)
</a><a href="#h2-8-11" id="h2-8-11" class="i">+			lt[mon[i].sellt]-&gt;arrange(&amp;mon[i]);
</a><a href="#h2-8-12" id="h2-8-12" class="i">+		restack(&amp;mon[i]);
</a><a href="#h2-8-13" id="h2-8-13" class="i">+	}
</a> }
 
 void
<a href="#h2-9" id="h2-9" class="h">@@ -371,9 +383,12 @@ buttonpress(XEvent *e) {
</a> 	XButtonPressedEvent *ev = &amp;e-&gt;xbutton;
 
 	click = ClkRootWin;
<a href="#h2-9-3" id="h2-9-3" class="d">-	if(ev-&gt;window == barwin) {
</a><a href="#h2-9-4" id="h2-9-4" class="d">-		i = x = 0;
</a><a href="#h2-9-5" id="h2-9-5" class="d">-		do x += TEXTW(tags[i]); while(ev-&gt;x &gt;= x &amp;&amp; ++i &lt; LENGTH(tags));
</a><a href="#h2-9-6" id="h2-9-6" class="i">+	if(ev-&gt;window == selmon-&gt;barwin) {
</a><a href="#h2-9-7" id="h2-9-7" class="i">+		i = 0;
</a><a href="#h2-9-8" id="h2-9-8" class="i">+		x = selmon-&gt;btx;
</a><a href="#h2-9-9" id="h2-9-9" class="i">+		do
</a><a href="#h2-9-10" id="h2-9-10" class="i">+			x += TEXTW(tags[i]);
</a><a href="#h2-9-11" id="h2-9-11" class="i">+		while(ev-&gt;x &gt;= x &amp;&amp; ++i &lt; LENGTH(tags));
</a> 		if(i &lt; LENGTH(tags)) {
 			click = ClkTagBar;
 			arg.ui = 1 &lt;&lt; i;
<a href="#h2-10" id="h2-10" class="h">@@ -412,6 +427,7 @@ checkotherwm(void) {
</a> 
 void
 cleanup(void) {
<a href="#h2-10-3" id="h2-10-3" class="i">+	unsigned int i;
</a> 	Arg a = {.ui = ~0};
 	Layout foo = { &quot;&quot;, NULL };
 
<a href="#h2-11" id="h2-11" class="h">@@ -429,7 +445,9 @@ cleanup(void) {
</a> 	XFreeCursor(dpy, cursor[CurNormal]);
 	XFreeCursor(dpy, cursor[CurResize]);
 	XFreeCursor(dpy, cursor[CurMove]);
<a href="#h2-11-3" id="h2-11-3" class="d">-	XDestroyWindow(dpy, barwin);
</a><a href="#h2-11-4" id="h2-11-4" class="i">+	for(i = 0; i &lt; nmons; i++)
</a><a href="#h2-11-5" id="h2-11-5" class="i">+		XDestroyWindow(dpy, mon[i].barwin);
</a><a href="#h2-11-6" id="h2-11-6" class="i">+	free(mon);
</a> 	XSync(dpy, False);
 	XSetInputFocus(dpy, PointerRoot, RevertToPointerRoot, CurrentTime);
 }
<a href="#h2-12" id="h2-12" class="h">@@ -466,13 +484,18 @@ configure(Client *c) {
</a> 
 void
 configurenotify(XEvent *e) {
<a href="#h2-12-3" id="h2-12-3" class="i">+	unsigned int i;
</a> 	XConfigureEvent *ev = &amp;e-&gt;xconfigure;
 
 	if(ev-&gt;window == root &amp;&amp; (ev-&gt;width != sw || ev-&gt;height != sh)) {
 		sw = ev-&gt;width;
 		sh = ev-&gt;height;
 		updategeom();
<a href="#h2-12-10" id="h2-12-10" class="d">-		updatebar();
</a><a href="#h2-12-11" id="h2-12-11" class="i">+		if(dc.drawable != 0)
</a><a href="#h2-12-12" id="h2-12-12" class="i">+			XFreePixmap(dpy, dc.drawable);
</a><a href="#h2-12-13" id="h2-12-13" class="i">+		dc.drawable = XCreatePixmap(dpy, root, DisplayWidth(dpy, screen), bh, DefaultDepth(dpy, screen));
</a><a href="#h2-12-14" id="h2-12-14" class="i">+		for(i = 0; i &lt; nmons; i++)
</a><a href="#h2-12-15" id="h2-12-15" class="i">+			XMoveResizeWindow(dpy, mon[i].barwin, mon[i].wx, mon[i].by, mon[i].ww, bh);
</a> 		arrange();
 	}
 }
<a href="#h2-13" id="h2-13" class="h">@@ -556,54 +579,79 @@ die(const char *errstr, ...) {
</a> }
 
 void
<a href="#h2-13-3" id="h2-13-3" class="d">-drawbar(void) {
</a><a href="#h2-13-4" id="h2-13-4" class="i">+drawbar(Monitor *m) {
</a> 	int x;
 	unsigned int i, occ = 0, urg = 0;
 	unsigned long *col;
 	Client *c;
 
 	for(c = clients; c; c = c-&gt;next) {
<a href="#h2-13-11" id="h2-13-11" class="d">-		occ |= c-&gt;tags;
</a><a href="#h2-13-12" id="h2-13-12" class="d">-		if(c-&gt;isurgent)
</a><a href="#h2-13-13" id="h2-13-13" class="d">-			urg |= c-&gt;tags;
</a><a href="#h2-13-14" id="h2-13-14" class="i">+		if(m == &amp;mon[c-&gt;mon]) {
</a><a href="#h2-13-15" id="h2-13-15" class="i">+			occ |= c-&gt;tags;
</a><a href="#h2-13-16" id="h2-13-16" class="i">+			if(c-&gt;isurgent)
</a><a href="#h2-13-17" id="h2-13-17" class="i">+				urg |= c-&gt;tags;
</a><a href="#h2-13-18" id="h2-13-18" class="i">+		}
</a> 	}
 
 	dc.x = 0;
<a href="#h2-13-22" id="h2-13-22" class="i">+#ifdef XINERAMA
</a><a href="#h2-13-23" id="h2-13-23" class="i">+	{
</a><a href="#h2-13-24" id="h2-13-24" class="i">+		dc.w = TEXTW(m-&gt;symbol);
</a><a href="#h2-13-25" id="h2-13-25" class="i">+		drawtext(m-&gt;symbol, selmon == m ? dc.sel : dc.norm, False);
</a><a href="#h2-13-26" id="h2-13-26" class="i">+		dc.x += dc.w;
</a><a href="#h2-13-27" id="h2-13-27" class="i">+	}
</a><a href="#h2-13-28" id="h2-13-28" class="i">+#endif /* XINERAMA */
</a><a href="#h2-13-29" id="h2-13-29" class="i">+	m-&gt;btx = dc.x;
</a> 	for(i = 0; i &lt; LENGTH(tags); i++) {
 		dc.w = TEXTW(tags[i]);
<a href="#h2-13-32" id="h2-13-32" class="d">-		col = tagset[selmon-&gt;seltags] &amp; 1 &lt;&lt; i ? dc.sel : dc.norm;
</a><a href="#h2-13-33" id="h2-13-33" class="i">+		col = tagset[m-&gt;seltags] &amp; 1 &lt;&lt; i ? dc.sel : dc.norm;
</a> 		drawtext(tags[i], col, urg &amp; 1 &lt;&lt; i);
<a href="#h2-13-35" id="h2-13-35" class="d">-		drawsquare(sel &amp;&amp; sel-&gt;tags &amp; 1 &lt;&lt; i, occ &amp; 1 &lt;&lt; i, urg &amp; 1 &lt;&lt; i, col);
</a><a href="#h2-13-36" id="h2-13-36" class="i">+		drawsquare(m == selmon &amp;&amp; sel &amp;&amp; sel-&gt;tags &amp; 1 &lt;&lt; i,
</a><a href="#h2-13-37" id="h2-13-37" class="i">+		           occ &amp; 1 &lt;&lt; i, urg &amp; 1 &lt;&lt; i, col);
</a> 		dc.x += dc.w;
 	}
 	if(blw &gt; 0) {
 		dc.w = blw;
<a href="#h2-13-42" id="h2-13-42" class="d">-		drawtext(lt[selmon-&gt;sellt]-&gt;symbol, dc.norm, False);
</a><a href="#h2-13-43" id="h2-13-43" class="i">+		drawtext(lt[m-&gt;sellt]-&gt;symbol, dc.norm, False);
</a> 		x = dc.x + dc.w;
 	}
 	else
 		x = dc.x;
<a href="#h2-13-48" id="h2-13-48" class="d">-	dc.w = TEXTW(stext);
</a><a href="#h2-13-49" id="h2-13-49" class="d">-	dc.x = selmon-&gt;ww - dc.w;
</a><a href="#h2-13-50" id="h2-13-50" class="d">-	if(dc.x &lt; x) {
</a><a href="#h2-13-51" id="h2-13-51" class="d">-		dc.x = x;
</a><a href="#h2-13-52" id="h2-13-52" class="d">-		dc.w = selmon-&gt;ww - x;
</a><a href="#h2-13-53" id="h2-13-53" class="d">-	}
</a><a href="#h2-13-54" id="h2-13-54" class="d">-	drawtext(stext, dc.norm, False);
</a><a href="#h2-13-55" id="h2-13-55" class="d">-	if((dc.w = dc.x - x) &gt; bh) {
</a><a href="#h2-13-56" id="h2-13-56" class="d">-		dc.x = x;
</a><a href="#h2-13-57" id="h2-13-57" class="d">-		if(sel) {
</a><a href="#h2-13-58" id="h2-13-58" class="d">-			drawtext(sel-&gt;name, dc.sel, False);
</a><a href="#h2-13-59" id="h2-13-59" class="d">-			drawsquare(sel-&gt;isfixed, sel-&gt;isfloating, False, dc.sel);
</a><a href="#h2-13-60" id="h2-13-60" class="i">+	if(m == selmon) {
</a><a href="#h2-13-61" id="h2-13-61" class="i">+		dc.w = TEXTW(stext);
</a><a href="#h2-13-62" id="h2-13-62" class="i">+		dc.x = m-&gt;ww - dc.w;
</a><a href="#h2-13-63" id="h2-13-63" class="i">+		if(dc.x &lt; x) {
</a><a href="#h2-13-64" id="h2-13-64" class="i">+			dc.x = x;
</a><a href="#h2-13-65" id="h2-13-65" class="i">+			dc.w = m-&gt;ww - x;
</a><a href="#h2-13-66" id="h2-13-66" class="i">+		}
</a><a href="#h2-13-67" id="h2-13-67" class="i">+		drawtext(stext, dc.norm, False);
</a><a href="#h2-13-68" id="h2-13-68" class="i">+		if((dc.w = dc.x - x) &gt; bh) {
</a><a href="#h2-13-69" id="h2-13-69" class="i">+			dc.x = x;
</a><a href="#h2-13-70" id="h2-13-70" class="i">+			if(sel) {
</a><a href="#h2-13-71" id="h2-13-71" class="i">+				drawtext(sel-&gt;name, dc.sel, False);
</a><a href="#h2-13-72" id="h2-13-72" class="i">+				drawsquare(sel-&gt;isfixed, sel-&gt;isfloating, False, dc.sel);
</a><a href="#h2-13-73" id="h2-13-73" class="i">+			}
</a><a href="#h2-13-74" id="h2-13-74" class="i">+			else
</a><a href="#h2-13-75" id="h2-13-75" class="i">+				drawtext(NULL, dc.norm, False);
</a> 		}
<a href="#h2-13-77" id="h2-13-77" class="d">-		else
</a><a href="#h2-13-78" id="h2-13-78" class="d">-			drawtext(NULL, dc.norm, False);
</a> 	}
<a href="#h2-13-80" id="h2-13-80" class="d">-	XCopyArea(dpy, dc.drawable, barwin, dc.gc, 0, 0, selmon-&gt;ww, bh, 0, 0);
</a><a href="#h2-13-81" id="h2-13-81" class="i">+	else {
</a><a href="#h2-13-82" id="h2-13-82" class="i">+		dc.w = m-&gt;ww - x;
</a><a href="#h2-13-83" id="h2-13-83" class="i">+		drawtext(NULL, dc.norm, False);
</a><a href="#h2-13-84" id="h2-13-84" class="i">+	}
</a><a href="#h2-13-85" id="h2-13-85" class="i">+	XCopyArea(dpy, dc.drawable, m-&gt;barwin, dc.gc, 0, 0, m-&gt;ww, bh, 0, 0);
</a> 	XSync(dpy, False);
 }
 
 void
<a href="#h2-13-90" id="h2-13-90" class="i">+drawbars() {
</a><a href="#h2-13-91" id="h2-13-91" class="i">+	unsigned int i;
</a><a href="#h2-13-92" id="h2-13-92" class="i">+
</a><a href="#h2-13-93" id="h2-13-93" class="i">+	for(i = 0; i &lt; nmons; i++)
</a><a href="#h2-13-94" id="h2-13-94" class="i">+		drawbar(&amp;mon[i]);
</a><a href="#h2-13-95" id="h2-13-95" class="i">+}
</a><a href="#h2-13-96" id="h2-13-96" class="i">+
</a><a href="#h2-13-97" id="h2-13-97" class="i">+void
</a> drawsquare(Bool filled, Bool empty, Bool invert, unsigned long col[ColLast]) {
 	int x;
 	XGCValues gcv;
<a href="#h2-14" id="h2-14" class="h">@@ -667,10 +715,14 @@ enternotify(XEvent *e) {
</a> 
 void
 expose(XEvent *e) {
<a href="#h2-14-3" id="h2-14-3" class="i">+	unsigned int i;
</a> 	XExposeEvent *ev = &amp;e-&gt;xexpose;
 
<a href="#h2-14-6" id="h2-14-6" class="d">-	if(ev-&gt;count == 0 &amp;&amp; (ev-&gt;window == barwin))
</a><a href="#h2-14-7" id="h2-14-7" class="d">-		drawbar();
</a><a href="#h2-14-8" id="h2-14-8" class="i">+	for(i = 0; i &lt; nmons; i++)
</a><a href="#h2-14-9" id="h2-14-9" class="i">+		if(ev-&gt;count == 0 &amp;&amp; (ev-&gt;window == mon[i].barwin)) {
</a><a href="#h2-14-10" id="h2-14-10" class="i">+			drawbar(&amp;mon[i]);
</a><a href="#h2-14-11" id="h2-14-11" class="i">+			break;
</a><a href="#h2-14-12" id="h2-14-12" class="i">+		}
</a> }
 
 void
<a href="#h2-15" id="h2-15" class="h">@@ -693,7 +745,9 @@ focus(Client *c) {
</a> 	else
 		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
 	sel = c;
<a href="#h2-15-3" id="h2-15-3" class="d">-	drawbar();
</a><a href="#h2-15-4" id="h2-15-4" class="i">+	if(c)
</a><a href="#h2-15-5" id="h2-15-5" class="i">+		selmon = &amp;mon[c-&gt;mon];
</a><a href="#h2-15-6" id="h2-15-6" class="i">+	drawbars();
</a> }
 
 void
<a href="#h2-16" id="h2-16" class="h">@@ -704,13 +758,24 @@ focusin(XEvent *e) { /* there are some broken focus acquiring clients */
</a> 		XSetInputFocus(dpy, sel-&gt;win, RevertToPointerRoot, CurrentTime);
 }
 
<a href="#h2-16-3" id="h2-16-3" class="i">+#ifdef XINERAMA
</a><a href="#h2-16-4" id="h2-16-4" class="i">+void
</a><a href="#h2-16-5" id="h2-16-5" class="i">+focusmon(const Arg *arg) {
</a><a href="#h2-16-6" id="h2-16-6" class="i">+	if(arg-&gt;ui &gt;= nmons)
</a><a href="#h2-16-7" id="h2-16-7" class="i">+		return;
</a><a href="#h2-16-8" id="h2-16-8" class="i">+	selmon = &amp;mon[arg-&gt;ui];
</a><a href="#h2-16-9" id="h2-16-9" class="i">+	focus(NULL);
</a><a href="#h2-16-10" id="h2-16-10" class="i">+	drawbars();
</a><a href="#h2-16-11" id="h2-16-11" class="i">+}
</a><a href="#h2-16-12" id="h2-16-12" class="i">+#endif /* XINERAMA */
</a><a href="#h2-16-13" id="h2-16-13" class="i">+
</a> void
 focusstack(const Arg *arg) {
 	Client *c = NULL, *i;
 
 	if(!sel)
 		return;
<a href="#h2-16-20" id="h2-16-20" class="d">-	if (arg-&gt;i &gt; 0) {
</a><a href="#h2-16-21" id="h2-16-21" class="i">+	if(arg-&gt;i &gt; 0) {
</a> 		for(c = sel-&gt;next; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;next);
 		if(!c)
 			for(c = clients; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;next);
<a href="#h2-17" id="h2-17" class="h">@@ -726,7 +791,7 @@ focusstack(const Arg *arg) {
</a> 	}
 	if(c) {
 		focus(c);
<a href="#h2-17-3" id="h2-17-3" class="d">-		restack();
</a><a href="#h2-17-4" id="h2-17-4" class="i">+		restack(selmon);
</a> 	}
 }
 
<a href="#h2-18" id="h2-18" class="h">@@ -946,9 +1011,8 @@ manage(Window w, XWindowAttributes *wa) {
</a> 			c-&gt;y = sy + sh - HEIGHT(c);
 		c-&gt;x = MAX(c-&gt;x, sx);
 		/* only fix client y-offset, if the client center might cover the bar */
<a href="#h2-18-3" id="h2-18-3" class="d">-		/* TODO: is c always attached to selmon? */
</a><a href="#h2-18-4" id="h2-18-4" class="d">-		c-&gt;y = MAX(c-&gt;y, ((by == 0) &amp;&amp; (c-&gt;x + (c-&gt;w / 2) &gt;= selmon-&gt;wx)
</a><a href="#h2-18-5" id="h2-18-5" class="d">-		                            &amp;&amp; (c-&gt;x + (c-&gt;w / 2) &lt; selmon-&gt;wx + selmon-&gt;ww)) ? bh : sy);
</a><a href="#h2-18-6" id="h2-18-6" class="i">+		c-&gt;y = MAX(c-&gt;y, ((selmon-&gt;by == 0) &amp;&amp; (c-&gt;x + (c-&gt;w / 2) &gt;= selmon-&gt;wx)
</a><a href="#h2-18-7" id="h2-18-7" class="i">+		           &amp;&amp; (c-&gt;x + (c-&gt;w / 2) &lt; selmon-&gt;wx + selmon-&gt;ww)) ? bh : sy);
</a> 		c-&gt;bw = borderpx;
 	}
 
<a href="#h2-19" id="h2-19" class="h">@@ -1001,14 +1065,11 @@ maprequest(XEvent *e) {
</a> }
 
 void
<a href="#h2-19-3" id="h2-19-3" class="d">-monocle(void) {
</a><a href="#h2-19-4" id="h2-19-4" class="i">+monocle(Monitor *m) {
</a> 	Client *c;
<a href="#h2-19-6" id="h2-19-6" class="d">-	Monitor *m;
</a> 
<a href="#h2-19-8" id="h2-19-8" class="d">-	for(c = nexttiled(clients); c; c = nexttiled(c-&gt;next)) {
</a><a href="#h2-19-9" id="h2-19-9" class="d">-		m = &amp;mon[c-&gt;mon];
</a><a href="#h2-19-10" id="h2-19-10" class="i">+	for(c = nexttiled(m, clients); c; c = nexttiled(m, c-&gt;next))
</a> 		resize(c, m-&gt;wx, m-&gt;wy, m-&gt;ww - 2 * c-&gt;bw, m-&gt;wh - 2 * c-&gt;bw);
<a href="#h2-19-12" id="h2-19-12" class="d">-	}
</a> }
 
 void
<a href="#h2-20" id="h2-20" class="h">@@ -1021,7 +1082,7 @@ movemouse(const Arg *arg) {
</a> 
 	if(!(c = sel))
 		return;
<a href="#h2-20-3" id="h2-20-3" class="d">-	restack();
</a><a href="#h2-20-4" id="h2-20-4" class="i">+	restack(selmon);
</a> 	ocx = c-&gt;x;
 	ocy = c-&gt;y;
 	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
<a href="#h2-21" id="h2-21" class="h">@@ -1063,8 +1124,9 @@ movemouse(const Arg *arg) {
</a> }
 
 Client *
<a href="#h2-21-3" id="h2-21-3" class="d">-nexttiled(Client *c) {
</a><a href="#h2-21-4" id="h2-21-4" class="d">-	for(; c &amp;&amp; (c-&gt;isfloating || !ISVISIBLE(c)); c = c-&gt;next);
</a><a href="#h2-21-5" id="h2-21-5" class="i">+nexttiled(Monitor *m, Client *c) {
</a><a href="#h2-21-6" id="h2-21-6" class="i">+	// TODO: m handling
</a><a href="#h2-21-7" id="h2-21-7" class="i">+	for(; c &amp;&amp; (c-&gt;isfloating || m != &amp;mon[c-&gt;mon] || !ISVISIBLE(c)); c = c-&gt;next);
</a> 	return c;
 }
 
<a href="#h2-22" id="h2-22" class="h">@@ -1091,13 +1153,13 @@ propertynotify(XEvent *e) {
</a> 			break;
 		case XA_WM_HINTS:
 			updatewmhints(c);
<a href="#h2-22-3" id="h2-22-3" class="d">-			drawbar();
</a><a href="#h2-22-4" id="h2-22-4" class="i">+			drawbars();
</a> 			break;
 		}
 		if(ev-&gt;atom == XA_WM_NAME || ev-&gt;atom == netatom[NetWMName]) {
 			updatetitle(c);
 			if(c == sel)
<a href="#h2-22-10" id="h2-22-10" class="d">-				drawbar();
</a><a href="#h2-22-11" id="h2-22-11" class="i">+				drawbars();
</a> 		}
 	}
 }
<a href="#h2-23" id="h2-23" class="h">@@ -1133,7 +1195,7 @@ resizemouse(const Arg *arg) {
</a> 
 	if(!(c = sel))
 		return;
<a href="#h2-23-3" id="h2-23-3" class="d">-	restack();
</a><a href="#h2-23-4" id="h2-23-4" class="i">+	restack(selmon);
</a> 	ocx = c-&gt;x;
 	ocy = c-&gt;y;
 	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
<a href="#h2-24" id="h2-24" class="h">@@ -1170,21 +1232,21 @@ resizemouse(const Arg *arg) {
</a> }
 
 void
<a href="#h2-24-3" id="h2-24-3" class="d">-restack(void) {
</a><a href="#h2-24-4" id="h2-24-4" class="i">+restack(Monitor *m) {
</a> 	Client *c;
 	XEvent ev;
 	XWindowChanges wc;
 
<a href="#h2-24-9" id="h2-24-9" class="d">-	drawbar();
</a><a href="#h2-24-10" id="h2-24-10" class="i">+	drawbars();
</a> 	if(!sel)
 		return;
<a href="#h2-24-13" id="h2-24-13" class="d">-	if(sel-&gt;isfloating || !lt[selmon-&gt;sellt]-&gt;arrange)
</a><a href="#h2-24-14" id="h2-24-14" class="i">+	if(m == selmon &amp;&amp; (sel-&gt;isfloating || !lt[m-&gt;sellt]-&gt;arrange))
</a> 		XRaiseWindow(dpy, sel-&gt;win);
<a href="#h2-24-16" id="h2-24-16" class="d">-	if(lt[selmon-&gt;sellt]-&gt;arrange) {
</a><a href="#h2-24-17" id="h2-24-17" class="i">+	if(lt[m-&gt;sellt]-&gt;arrange) {
</a> 		wc.stack_mode = Below;
<a href="#h2-24-19" id="h2-24-19" class="d">-		wc.sibling = barwin;
</a><a href="#h2-24-20" id="h2-24-20" class="i">+		wc.sibling = m-&gt;barwin;
</a> 		for(c = stack; c; c = c-&gt;snext)
<a href="#h2-24-22" id="h2-24-22" class="d">-			if(!c-&gt;isfloating &amp;&amp; ISVISIBLE(c)) {
</a><a href="#h2-24-23" id="h2-24-23" class="i">+			if(!c-&gt;isfloating &amp;&amp; m == &amp;mon[c-&gt;mon] &amp;&amp; ISVISIBLE(c)) {
</a> 				XConfigureWindow(dpy, c-&gt;win, CWSibling|CWStackMode, &amp;wc);
 				wc.sibling = c-&gt;win;
 			}
<a href="#h2-25" id="h2-25" class="h">@@ -1248,7 +1310,7 @@ setlayout(const Arg *arg) {
</a> 	if(sel)
 		arrange();
 	else
<a href="#h2-25-3" id="h2-25-3" class="d">-		drawbar();
</a><a href="#h2-25-4" id="h2-25-4" class="i">+		drawbars();
</a> }
 
 /* arg &gt; 1.0 will set mfact absolutly */
<a href="#h2-26" id="h2-26" class="h">@@ -1309,21 +1371,23 @@ setup(void) {
</a> 	if(!dc.font.set)
 		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
 
<a href="#h2-26-3" id="h2-26-3" class="d">-	/* init bar */
</a><a href="#h2-26-4" id="h2-26-4" class="i">+	/* init bars */
</a><a href="#h2-26-5" id="h2-26-5" class="i">+	wa.override_redirect = True;
</a><a href="#h2-26-6" id="h2-26-6" class="i">+	wa.background_pixmap = ParentRelative;
</a><a href="#h2-26-7" id="h2-26-7" class="i">+	wa.event_mask = ButtonPressMask|ExposureMask;
</a> 	for(blw = i = 0; LENGTH(layouts) &gt; 1 &amp;&amp; i &lt; LENGTH(layouts); i++) {
 		w = TEXTW(layouts[i].symbol);
 		blw = MAX(blw, w);
 	}
 
<a href="#h2-26-13" id="h2-26-13" class="d">-	wa.override_redirect = True;
</a><a href="#h2-26-14" id="h2-26-14" class="d">-	wa.background_pixmap = ParentRelative;
</a><a href="#h2-26-15" id="h2-26-15" class="d">-	wa.event_mask = ButtonPressMask|ExposureMask;
</a><a href="#h2-26-16" id="h2-26-16" class="i">+	for(i = 0; i &lt; nmons; i++) {
</a><a href="#h2-26-17" id="h2-26-17" class="i">+		mon[i].barwin = XCreateWindow(dpy, root, mon[i].wx, mon[i].by, mon[i].ww, bh, 0, DefaultDepth(dpy, screen),
</a> 
<a href="#h2-26-19" id="h2-26-19" class="d">-	barwin = XCreateWindow(dpy, root, selmon-&gt;wx, by, selmon-&gt;ww, bh, 0, DefaultDepth(dpy, screen),
</a><a href="#h2-26-20" id="h2-26-20" class="d">-			CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h2-26-21" id="h2-26-21" class="d">-			CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
</a><a href="#h2-26-22" id="h2-26-22" class="d">-	XDefineCursor(dpy, barwin, cursor[CurNormal]);
</a><a href="#h2-26-23" id="h2-26-23" class="d">-	XMapRaised(dpy, barwin);
</a><a href="#h2-26-24" id="h2-26-24" class="i">+		                              CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h2-26-25" id="h2-26-25" class="i">+		                              CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
</a><a href="#h2-26-26" id="h2-26-26" class="i">+		XDefineCursor(dpy, mon[i].barwin, cursor[CurNormal]);
</a><a href="#h2-26-27" id="h2-26-27" class="i">+		XMapRaised(dpy, mon[i].barwin);
</a><a href="#h2-26-28" id="h2-26-28" class="i">+	}
</a> 	updatestatus();
 
 	/* EWMH support per view */
<a href="#h2-27" id="h2-27" class="h">@@ -1384,6 +1448,16 @@ tag(const Arg *arg) {
</a> 	}
 }
 
<a href="#h2-27-3" id="h2-27-3" class="i">+#ifdef XINERAMA
</a><a href="#h2-27-4" id="h2-27-4" class="i">+void
</a><a href="#h2-27-5" id="h2-27-5" class="i">+tagmon(const Arg *arg) {
</a><a href="#h2-27-6" id="h2-27-6" class="i">+	if(!sel || arg-&gt;ui &gt;= nmons)
</a><a href="#h2-27-7" id="h2-27-7" class="i">+		return;
</a><a href="#h2-27-8" id="h2-27-8" class="i">+	sel-&gt;mon = arg-&gt;ui;
</a><a href="#h2-27-9" id="h2-27-9" class="i">+	arrange();
</a><a href="#h2-27-10" id="h2-27-10" class="i">+}
</a><a href="#h2-27-11" id="h2-27-11" class="i">+#endif /* XINERAMA */
</a><a href="#h2-27-12" id="h2-27-12" class="i">+
</a> int
 textnw(const char *text, unsigned int len) {
 	XRectangle r;
<a href="#h2-28" id="h2-28" class="h">@@ -1396,19 +1470,17 @@ textnw(const char *text, unsigned int len) {
</a> }
 
 void
<a href="#h2-28-3" id="h2-28-3" class="d">-tile(void) {
</a><a href="#h2-28-4" id="h2-28-4" class="i">+tile(Monitor *m) {
</a> 	int x, y, h, w, mw;
 	unsigned int i, n;
 	Client *c;
<a href="#h2-28-8" id="h2-28-8" class="d">-	Monitor *m;
</a> 
<a href="#h2-28-10" id="h2-28-10" class="d">-	for(n = 0, c = nexttiled(clients); c; c = nexttiled(c-&gt;next), n++);
</a><a href="#h2-28-11" id="h2-28-11" class="i">+	for(n = 0, c = nexttiled(m, clients); c; c = nexttiled(m, c-&gt;next), n++);
</a> 	if(n == 0)
 		return;
 
 	/* master */
<a href="#h2-28-16" id="h2-28-16" class="d">-	c = nexttiled(clients);
</a><a href="#h2-28-17" id="h2-28-17" class="d">-	m = &amp;mon[c-&gt;mon];
</a><a href="#h2-28-18" id="h2-28-18" class="i">+	c = nexttiled(m, clients);
</a> 	mw = mfact * m-&gt;ww;
 	resize(c, m-&gt;wx, m-&gt;wy, (n == 1 ? m-&gt;ww : mw) - 2 * c-&gt;bw, m-&gt;wh - 2 * c-&gt;bw);
 
<a href="#h2-29" id="h2-29" class="h">@@ -1423,7 +1495,7 @@ tile(void) {
</a> 	if(h &lt; bh)
 		h = m-&gt;wh;
 
<a href="#h2-29-3" id="h2-29-3" class="d">-	for(i = 0, c = nexttiled(c-&gt;next); c; c = nexttiled(c-&gt;next), i++) {
</a><a href="#h2-29-4" id="h2-29-4" class="i">+	for(i = 0, c = nexttiled(m, c-&gt;next); c; c = nexttiled(m, c-&gt;next), i++) {
</a> 		resize(c, x, y, w - 2 * c-&gt;bw, /* remainder */ ((i + 1 == n)
 		       ? m-&gt;wy + m-&gt;wh - y - 2 * c-&gt;bw : h - 2 * c-&gt;bw));
 		if(h != m-&gt;wh)
<a href="#h2-30" id="h2-30" class="h">@@ -1433,9 +1505,9 @@ tile(void) {
</a> 
 void
 togglebar(const Arg *arg) {
<a href="#h2-30-3" id="h2-30-3" class="d">-	showbar = !showbar;
</a><a href="#h2-30-4" id="h2-30-4" class="i">+	selmon-&gt;showbar = !selmon-&gt;showbar;
</a> 	updategeom();
<a href="#h2-30-6" id="h2-30-6" class="d">-	updatebar();
</a><a href="#h2-30-7" id="h2-30-7" class="i">+	XMoveResizeWindow(dpy, selmon-&gt;barwin, selmon-&gt;wx, selmon-&gt;by, selmon-&gt;ww, bh);
</a> 	arrange();
 }
 
<a href="#h2-31" id="h2-31" class="h">@@ -1453,7 +1525,7 @@ void
</a> toggletag(const Arg *arg) {
 	unsigned int mask;
 
<a href="#h2-31-3" id="h2-31-3" class="d">-	if (!sel)
</a><a href="#h2-31-4" id="h2-31-4" class="i">+	if(!sel)
</a> 		return;
 	
 	mask = sel-&gt;tags ^ (arg-&gt;ui &amp; TAGMASK);
<a href="#h2-32" id="h2-32" class="h">@@ -1505,14 +1577,6 @@ unmapnotify(XEvent *e) {
</a> }
 
 void
<a href="#h2-32-3" id="h2-32-3" class="d">-updatebar(void) {
</a><a href="#h2-32-4" id="h2-32-4" class="d">-	if(dc.drawable != 0)
</a><a href="#h2-32-5" id="h2-32-5" class="d">-		XFreePixmap(dpy, dc.drawable);
</a><a href="#h2-32-6" id="h2-32-6" class="d">-	dc.drawable = XCreatePixmap(dpy, root, selmon-&gt;ww, bh, DefaultDepth(dpy, screen));
</a><a href="#h2-32-7" id="h2-32-7" class="d">-	XMoveResizeWindow(dpy, barwin, selmon-&gt;wx, by, selmon-&gt;ww, bh);
</a><a href="#h2-32-8" id="h2-32-8" class="d">-}
</a><a href="#h2-32-9" id="h2-32-9" class="d">-
</a><a href="#h2-32-10" id="h2-32-10" class="d">-void
</a> updategeom(void) {
 #ifdef XINERAMA
 	int di, x, y, n;
<a href="#h2-33" id="h2-33" class="h">@@ -1523,7 +1587,7 @@ updategeom(void) {
</a> 	XineramaScreenInfo *info = NULL;
 
 	/* window area geometry */
<a href="#h2-33-3" id="h2-33-3" class="d">-	if(XineramaIsActive(dpy) &amp;&amp; (info = XineramaQueryScreens(dpy, &amp;n))) { 
</a><a href="#h2-33-4" id="h2-33-4" class="i">+	if(XineramaIsActive(dpy) &amp;&amp; (info = XineramaQueryScreens(dpy, &amp;n))) {
</a> 		nmons = (unsigned int)n;
 		for(c = clients; c; c = c-&gt;next)
 			if(c-&gt;mon &gt;= nmons)
<a href="#h2-34" id="h2-34" class="h">@@ -1533,37 +1597,51 @@ updategeom(void) {
</a> 		pquery = XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, &amp;x, &amp;y, &amp;di, &amp;di, &amp;dui);
 		for(i = 0; i &lt; nmons; i++) {
 			/* TODO: consider re-using XineramaScreenInfo */
<a href="#h2-34-3" id="h2-34-3" class="i">+			mon[i].symbol[0] = &#39;[&#39;;
</a><a href="#h2-34-4" id="h2-34-4" class="i">+			mon[i].symbol[1] = &#39;0&#39; + info[i].screen_number;
</a><a href="#h2-34-5" id="h2-34-5" class="i">+			mon[i].symbol[2] = &#39;]&#39;;
</a><a href="#h2-34-6" id="h2-34-6" class="i">+			mon[i].symbol[3] = 0;
</a><a href="#h2-34-7" id="h2-34-7" class="i">+			mon[i].showbar = showbar;
</a><a href="#h2-34-8" id="h2-34-8" class="i">+			mon[i].topbar = topbar;
</a> 			mon[i].wx = info[i].x_org;
<a href="#h2-34-10" id="h2-34-10" class="d">-			mon[i].wy = info[i].y_org;
</a><a href="#h2-34-11" id="h2-34-11" class="i">+			mon[i].wy = mon[i].showbar &amp;&amp; mon[i].topbar ? info[i].y_org + bh : info[i].y_org;
</a> 			mon[i].ww = info[i].width;
<a href="#h2-34-13" id="h2-34-13" class="d">-			mon[i].wh = info[i].height;
</a><a href="#h2-34-14" id="h2-34-14" class="i">+			mon[i].wh = mon[i].showbar ? info[i].height - bh : info[i].height;
</a> 			mon[i].seltags = 0;
 			mon[i].sellt = 0;
<a href="#h2-34-17" id="h2-34-17" class="i">+			if(mon[i].showbar)
</a><a href="#h2-34-18" id="h2-34-18" class="i">+				mon[i].by = mon[i].topbar ? info[i].y_org : mon[i].wy + mon[i].wh;
</a><a href="#h2-34-19" id="h2-34-19" class="i">+			else
</a><a href="#h2-34-20" id="h2-34-20" class="i">+				mon[i].by = -bh;
</a> 			if(pquery &amp;&amp; INRECT(x, y, info[i].x_org, info[i].y_org, info[i].width, info[i].height))
 				selmon = &amp;mon[i];
 		}
<a href="#h2-34-24" id="h2-34-24" class="d">-		/* bar adjustments of selmon */
</a><a href="#h2-34-25" id="h2-34-25" class="d">-		selmon-&gt;wy = showbar &amp;&amp; topbar ?  selmon-&gt;wy + bh : selmon-&gt;wy;
</a><a href="#h2-34-26" id="h2-34-26" class="d">-		selmon-&gt;wh = showbar ? selmon-&gt;wh - bh : selmon-&gt;wh;
</a> 		XFree(info);
 	}
 	else
<a href="#h2-34-30" id="h2-34-30" class="d">-#endif
</a><a href="#h2-34-31" id="h2-34-31" class="i">+#endif /* XINERAMA */
</a> 	{
 		nmons = 1;
 		if(!(mon = (Monitor *)realloc(mon, sizeof(Monitor))))
 			die(&quot;fatal: could not realloc() %u bytes\n&quot;, sizeof(Monitor));
 		selmon = &amp;mon[0];
<a href="#h2-34-37" id="h2-34-37" class="i">+		mon[0].symbol[0] = &#39;[&#39;;
</a><a href="#h2-34-38" id="h2-34-38" class="i">+		mon[0].symbol[1] = &#39;0&#39;;
</a><a href="#h2-34-39" id="h2-34-39" class="i">+		mon[0].symbol[2] = &#39;]&#39;;
</a><a href="#h2-34-40" id="h2-34-40" class="i">+		mon[0].symbol[3] = 0;
</a><a href="#h2-34-41" id="h2-34-41" class="i">+		mon[0].showbar = showbar;
</a><a href="#h2-34-42" id="h2-34-42" class="i">+		mon[0].topbar = topbar;
</a> 		mon[0].wx = sx;
<a href="#h2-34-44" id="h2-34-44" class="d">-		mon[0].wy = showbar &amp;&amp; topbar ? sy + bh : sy;
</a><a href="#h2-34-45" id="h2-34-45" class="i">+		mon[0].wy = mon[0].showbar &amp;&amp; mon[0].topbar ? sy + bh : sy;
</a> 		mon[0].ww = sw;
<a href="#h2-34-47" id="h2-34-47" class="d">-		mon[0].wh = showbar ? sh - bh : sh;
</a><a href="#h2-34-48" id="h2-34-48" class="i">+		mon[0].wh = mon[0].showbar ? sh - bh : sh;
</a> 		mon[0].seltags = 0;
 		mon[0].sellt = 0;
<a href="#h2-34-51" id="h2-34-51" class="i">+		if(mon[0].showbar)
</a><a href="#h2-34-52" id="h2-34-52" class="i">+			mon[0].by = mon[0].topbar ? sy : mon[0].wy + mon[0].wh;
</a><a href="#h2-34-53" id="h2-34-53" class="i">+		else
</a><a href="#h2-34-54" id="h2-34-54" class="i">+			mon[0].by = -bh;
</a> 	}
<a href="#h2-34-56" id="h2-34-56" class="d">-
</a><a href="#h2-34-57" id="h2-34-57" class="d">-	/* bar position */
</a><a href="#h2-34-58" id="h2-34-58" class="d">-	by = showbar ? (topbar ? selmon-&gt;wy - bh : selmon-&gt;wy + selmon-&gt;wh) : -bh;
</a> }
 
 void
<a href="#h2-35" id="h2-35" class="h">@@ -1588,7 +1666,7 @@ updatesizehints(Client *c) {
</a> 
 	if(!XGetWMNormalHints(dpy, c-&gt;win, &amp;size, &amp;msize))
 		/* size is uninitialized, ensure that size.flags aren&#39;t used */
<a href="#h2-35-3" id="h2-35-3" class="d">-		size.flags = PSize; 
</a><a href="#h2-35-4" id="h2-35-4" class="i">+		size.flags = PSize;
</a> 	if(size.flags &amp; PBaseSize) {
 		c-&gt;basew = size.base_width;
 		c-&gt;baseh = size.base_height;
<a href="#h2-36" id="h2-36" class="h">@@ -1641,7 +1719,7 @@ void
</a> updatestatus() {
 	if(!gettextprop(root, XA_WM_NAME, stext, sizeof(stext)))
 		strcpy(stext, &quot;dwm-&quot;VERSION);
<a href="#h2-36-3" id="h2-36-3" class="d">-	drawbar();
</a><a href="#h2-36-4" id="h2-36-4" class="i">+	drawbar(selmon);
</a> }
 
 void
<a href="#h2-37" id="h2-37" class="h">@@ -1709,8 +1787,8 @@ zoom(const Arg *arg) {
</a> 
 	if(!lt[selmon-&gt;sellt]-&gt;arrange || lt[selmon-&gt;sellt]-&gt;arrange == monocle || (sel &amp;&amp; sel-&gt;isfloating))
 		return;
<a href="#h2-37-3" id="h2-37-3" class="d">-	if(c == nexttiled(clients))
</a><a href="#h2-37-4" id="h2-37-4" class="d">-		if(!c || !(c = nexttiled(c-&gt;next)))
</a><a href="#h2-37-5" id="h2-37-5" class="i">+	if(c == nexttiled(selmon, clients))
</a><a href="#h2-37-6" id="h2-37-6" class="i">+		if(!c || !(c = nexttiled(selmon, c-&gt;next)))
</a> 			return;
 	detach(c);
 	attach(c);
</pre>
</div>
</body>
</html>
