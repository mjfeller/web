<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>made restack, drawbar also Monitor-related only - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/55edd2d6ecd66782852db665996c1fda824b5e8c.html">55edd2d6ecd66782852db665996c1fda824b5e8c</a>
<b>parent</b> <a href="../commit/2e8e5509d9cad9229d2d79a1de75038d94032cfb.html">2e8e5509d9cad9229d2d79a1de75038d94032cfb</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Thu, 21 Feb 2008 10:31:06 +0000

made restack, drawbar also Monitor-related only
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">180</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 91 insertions(+), 89 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -144,9 +144,9 @@ void configurerequest(XEvent *e);
</a> void destroynotify(XEvent *e);
 void detach(Client *c);
 void detachstack(Client *c);
<a href="#h0-0-3" id="h0-0-3" class="d">-void drawbar(void);
</a><a href="#h0-0-4" id="h0-0-4" class="d">-void drawsquare(Monitor *, Bool filled, Bool empty, Bool invert, unsigned long col[ColLast]);
</a><a href="#h0-0-5" id="h0-0-5" class="d">-void drawtext(Monitor *, const char *text, unsigned long col[ColLast], Bool invert);
</a><a href="#h0-0-6" id="h0-0-6" class="i">+void drawbar(Monitor *m);
</a><a href="#h0-0-7" id="h0-0-7" class="i">+void drawsquare(Monitor *m, Bool filled, Bool empty, Bool invert, unsigned long col[ColLast]);
</a><a href="#h0-0-8" id="h0-0-8" class="i">+void drawtext(Monitor *m, const char *text, unsigned long col[ColLast], Bool invert);
</a> void *emallocz(unsigned int size);
 void enternotify(XEvent *e);
 void eprint(const char *errstr, ...);
<a href="#h0-1" id="h0-1" class="h">@@ -158,6 +158,7 @@ void focusnext(const char *arg);
</a> void focusprev(const char *arg);
 Client *getclient(Window w);
 unsigned long getcolor(const char *colstr);
<a href="#h0-1-3" id="h0-1-3" class="i">+Monitor *getmonitor(Window barwin);
</a> long getstate(Window w);
 Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 void grabbuttons(Client *c, Bool focused);
<a href="#h0-2" id="h0-2" class="h">@@ -180,7 +181,7 @@ void quit(const char *arg);
</a> void reapply(const char *arg);
 void resize(Client *c, int x, int y, int w, int h, Bool sizehints);
 void resizemouse(Client *c);
<a href="#h0-2-3" id="h0-2-3" class="d">-void restack(void);
</a><a href="#h0-2-4" id="h0-2-4" class="i">+void restack(Monitor *m);
</a> void run(void);
 void scan(void);
 void setclientstate(Client *c, long state);
<a href="#h0-3" id="h0-3" class="h">@@ -309,7 +310,7 @@ arrange(void) {
</a> 
 	monitors[selmonitor].layout-&gt;arrange(&amp;monitors[selmonitor]);
 	focus(NULL);
<a href="#h0-3-3" id="h0-3-3" class="d">-	restack();
</a><a href="#h0-3-4" id="h0-3-4" class="i">+	restack(&amp;monitors[selmonitor]);
</a> }
 
 void
<a href="#h0-4" id="h0-4" class="h">@@ -370,7 +371,7 @@ buttonpress(XEvent *e) {
</a> 		if(CLEANMASK(ev-&gt;state) != MODKEY)
 			return;
 		if(ev-&gt;button == Button1) {
<a href="#h0-4-3" id="h0-4-3" class="d">-			restack();
</a><a href="#h0-4-4" id="h0-4-4" class="i">+			restack(&amp;monitors[c-&gt;monitor]);
</a> 			movemouse(c);
 		}
 		else if(ev-&gt;button == Button2) {
<a href="#h0-5" id="h0-5" class="h">@@ -380,7 +381,7 @@ buttonpress(XEvent *e) {
</a> 				zoom(NULL);
 		}
 		else if(ev-&gt;button == Button3 &amp;&amp; !c-&gt;isfixed) {
<a href="#h0-5-3" id="h0-5-3" class="d">-			restack();
</a><a href="#h0-5-4" id="h0-5-4" class="i">+			restack(&amp;monitors[c-&gt;monitor]);
</a> 			resizemouse(c);
 		}
 	}
<a href="#h0-6" id="h0-6" class="h">@@ -562,55 +563,51 @@ detachstack(Client *c) {
</a> }
 
 void
<a href="#h0-6-3" id="h0-6-3" class="d">-drawbar(void) {
</a><a href="#h0-6-4" id="h0-6-4" class="d">-	int i, j, x;
</a><a href="#h0-6-5" id="h0-6-5" class="i">+drawbar(Monitor *m) {
</a><a href="#h0-6-6" id="h0-6-6" class="i">+	int j, x;
</a> 	Client *c;
 
<a href="#h0-6-9" id="h0-6-9" class="d">-	for(i = 0; i &lt; mcount; i++) {
</a><a href="#h0-6-10" id="h0-6-10" class="d">-		Monitor *m = &amp;monitors[i];
</a><a href="#h0-6-11" id="h0-6-11" class="d">-		dc.x = 0;
</a><a href="#h0-6-12" id="h0-6-12" class="d">-		for(c = stack; c &amp;&amp; !isvisible(c, i); c = c-&gt;snext);
</a><a href="#h0-6-13" id="h0-6-13" class="d">-		fprintf(stderr, &quot;m%d %s\n&quot;, i, c ? c-&gt;name : &quot;NIL&quot;);
</a><a href="#h0-6-14" id="h0-6-14" class="d">-		for(j = 0; j &lt; LENGTH(tags); j++) {
</a><a href="#h0-6-15" id="h0-6-15" class="d">-			dc.w = textw(tags[j]);
</a><a href="#h0-6-16" id="h0-6-16" class="d">-			if(m-&gt;seltags[j]) {
</a><a href="#h0-6-17" id="h0-6-17" class="d">-				drawtext(m, tags[j], dc.sel, isurgent(i, j));
</a><a href="#h0-6-18" id="h0-6-18" class="d">-				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
</a><a href="#h0-6-19" id="h0-6-19" class="d">-						isoccupied(i, j), isurgent(i, j), dc.sel);
</a><a href="#h0-6-20" id="h0-6-20" class="d">-			}
</a><a href="#h0-6-21" id="h0-6-21" class="d">-			else {
</a><a href="#h0-6-22" id="h0-6-22" class="d">-				drawtext(m, tags[j], dc.norm, isurgent(i, j));
</a><a href="#h0-6-23" id="h0-6-23" class="d">-				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
</a><a href="#h0-6-24" id="h0-6-24" class="d">-						isoccupied(i, j), isurgent(i, j), dc.norm);
</a><a href="#h0-6-25" id="h0-6-25" class="d">-			}
</a><a href="#h0-6-26" id="h0-6-26" class="d">-			dc.x += dc.w;
</a><a href="#h0-6-27" id="h0-6-27" class="i">+	dc.x = 0;
</a><a href="#h0-6-28" id="h0-6-28" class="i">+	for(c = stack; c &amp;&amp; !isvisible(c, m-&gt;id); c = c-&gt;snext);
</a><a href="#h0-6-29" id="h0-6-29" class="i">+	for(j = 0; j &lt; LENGTH(tags); j++) {
</a><a href="#h0-6-30" id="h0-6-30" class="i">+		dc.w = textw(tags[j]);
</a><a href="#h0-6-31" id="h0-6-31" class="i">+		if(m-&gt;seltags[j]) {
</a><a href="#h0-6-32" id="h0-6-32" class="i">+			drawtext(m, tags[j], dc.sel, isurgent(m-&gt;id, j));
</a><a href="#h0-6-33" id="h0-6-33" class="i">+			drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == m-&gt;id,
</a><a href="#h0-6-34" id="h0-6-34" class="i">+					isoccupied(m-&gt;id, j), isurgent(m-&gt;id, j), dc.sel);
</a> 		}
<a href="#h0-6-36" id="h0-6-36" class="d">-		dc.w = blw;
</a><a href="#h0-6-37" id="h0-6-37" class="d">-		drawtext(m, m-&gt;layout-&gt;symbol, dc.norm, False);
</a><a href="#h0-6-38" id="h0-6-38" class="d">-		x = dc.x + dc.w;
</a><a href="#h0-6-39" id="h0-6-39" class="d">-		if(i == selmonitor) {
</a><a href="#h0-6-40" id="h0-6-40" class="d">-			dc.w = textw(stext);
</a><a href="#h0-6-41" id="h0-6-41" class="d">-			dc.x = m-&gt;sw - dc.w;
</a><a href="#h0-6-42" id="h0-6-42" class="d">-			if(dc.x &lt; x) {
</a><a href="#h0-6-43" id="h0-6-43" class="d">-				dc.x = x;
</a><a href="#h0-6-44" id="h0-6-44" class="d">-				dc.w = m-&gt;sw - x;
</a><a href="#h0-6-45" id="h0-6-45" class="d">-			}
</a><a href="#h0-6-46" id="h0-6-46" class="d">-			drawtext(m, stext, dc.norm, False);
</a><a href="#h0-6-47" id="h0-6-47" class="i">+		else {
</a><a href="#h0-6-48" id="h0-6-48" class="i">+			drawtext(m, tags[j], dc.norm, isurgent(m-&gt;id, j));
</a><a href="#h0-6-49" id="h0-6-49" class="i">+			drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == m-&gt;id,
</a><a href="#h0-6-50" id="h0-6-50" class="i">+					isoccupied(m-&gt;id, j), isurgent(m-&gt;id, j), dc.norm);
</a> 		}
<a href="#h0-6-52" id="h0-6-52" class="d">-		else
</a><a href="#h0-6-53" id="h0-6-53" class="d">-			dc.x = m-&gt;sw;
</a><a href="#h0-6-54" id="h0-6-54" class="d">-		if((dc.w = dc.x - x) &gt; bh) {
</a><a href="#h0-6-55" id="h0-6-55" class="i">+		dc.x += dc.w;
</a><a href="#h0-6-56" id="h0-6-56" class="i">+	}
</a><a href="#h0-6-57" id="h0-6-57" class="i">+	dc.w = blw;
</a><a href="#h0-6-58" id="h0-6-58" class="i">+	drawtext(m, m-&gt;layout-&gt;symbol, dc.norm, False);
</a><a href="#h0-6-59" id="h0-6-59" class="i">+	x = dc.x + dc.w;
</a><a href="#h0-6-60" id="h0-6-60" class="i">+	if(m-&gt;id == selmonitor) {
</a><a href="#h0-6-61" id="h0-6-61" class="i">+		dc.w = textw(stext);
</a><a href="#h0-6-62" id="h0-6-62" class="i">+		dc.x = m-&gt;sw - dc.w;
</a><a href="#h0-6-63" id="h0-6-63" class="i">+		if(dc.x &lt; x) {
</a> 			dc.x = x;
<a href="#h0-6-65" id="h0-6-65" class="d">-			if(c) {
</a><a href="#h0-6-66" id="h0-6-66" class="d">-				drawtext(m, c-&gt;name, dc.sel, False);
</a><a href="#h0-6-67" id="h0-6-67" class="d">-				drawsquare(m, False, c-&gt;isfloating, False, dc.sel);
</a><a href="#h0-6-68" id="h0-6-68" class="d">-			}
</a><a href="#h0-6-69" id="h0-6-69" class="d">-			else
</a><a href="#h0-6-70" id="h0-6-70" class="d">-				drawtext(m, NULL, dc.norm, False);
</a><a href="#h0-6-71" id="h0-6-71" class="i">+			dc.w = m-&gt;sw - x;
</a> 		}
<a href="#h0-6-73" id="h0-6-73" class="d">-		XCopyArea(dpy, dc.drawable, m-&gt;barwin, dc.gc, 0, 0, m-&gt;sw, bh, 0, 0);
</a><a href="#h0-6-74" id="h0-6-74" class="d">-		XSync(dpy, False);
</a><a href="#h0-6-75" id="h0-6-75" class="i">+		drawtext(m, stext, dc.norm, False);
</a><a href="#h0-6-76" id="h0-6-76" class="i">+	}
</a><a href="#h0-6-77" id="h0-6-77" class="i">+	else
</a><a href="#h0-6-78" id="h0-6-78" class="i">+		dc.x = m-&gt;sw;
</a><a href="#h0-6-79" id="h0-6-79" class="i">+	if((dc.w = dc.x - x) &gt; bh) {
</a><a href="#h0-6-80" id="h0-6-80" class="i">+		dc.x = x;
</a><a href="#h0-6-81" id="h0-6-81" class="i">+		if(c) {
</a><a href="#h0-6-82" id="h0-6-82" class="i">+			drawtext(m, c-&gt;name, dc.sel, False);
</a><a href="#h0-6-83" id="h0-6-83" class="i">+			drawsquare(m, False, c-&gt;isfloating, False, dc.sel);
</a><a href="#h0-6-84" id="h0-6-84" class="i">+		}
</a><a href="#h0-6-85" id="h0-6-85" class="i">+		else
</a><a href="#h0-6-86" id="h0-6-86" class="i">+			drawtext(m, NULL, dc.norm, False);
</a> 	}
<a href="#h0-6-88" id="h0-6-88" class="i">+	XCopyArea(dpy, dc.drawable, m-&gt;barwin, dc.gc, 0, 0, m-&gt;sw, bh, 0, 0);
</a><a href="#h0-6-89" id="h0-6-89" class="i">+	XSync(dpy, False);
</a> }
 
 void
<a href="#h0-7" id="h0-7" class="h">@@ -713,12 +710,11 @@ eprint(const char *errstr, ...) {
</a> 
 void
 expose(XEvent *e) {
<a href="#h0-7-3" id="h0-7-3" class="i">+	Monitor *m;
</a> 	XExposeEvent *ev = &amp;e-&gt;xexpose;
 
<a href="#h0-7-6" id="h0-7-6" class="d">-	if(ev-&gt;count == 0) {
</a><a href="#h0-7-7" id="h0-7-7" class="d">-		if(ev-&gt;window == monitors[selmonitor].barwin)
</a><a href="#h0-7-8" id="h0-7-8" class="d">-			drawbar();
</a><a href="#h0-7-9" id="h0-7-9" class="d">-	}
</a><a href="#h0-7-10" id="h0-7-10" class="i">+	if(ev-&gt;count == 0 &amp;&amp; (m = getmonitor(ev-&gt;window)))
</a><a href="#h0-7-11" id="h0-7-11" class="i">+		drawbar(m);
</a> }
 
 void
<a href="#h0-8" id="h0-8" class="h">@@ -750,16 +746,14 @@ focus(Client *c) {
</a> 		grabbuttons(c, True);
 	}
 	sel = c;
<a href="#h0-8-3" id="h0-8-3" class="d">-	drawbar();
</a> 	if(c) {
 		XSetWindowBorder(dpy, c-&gt;win, dc.sel[ColBorder]);
 		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
 		selmonitor = c-&gt;monitor;
 	}
<a href="#h0-8-9" id="h0-8-9" class="d">-	else {
</a><a href="#h0-8-10" id="h0-8-10" class="i">+	else
</a> 		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
<a href="#h0-8-12" id="h0-8-12" class="d">-		drawbar();
</a><a href="#h0-8-13" id="h0-8-13" class="d">-	}
</a><a href="#h0-8-14" id="h0-8-14" class="i">+	drawbar(&amp;monitors[selmonitor]);
</a> }
 
 void
<a href="#h0-9" id="h0-9" class="h">@@ -781,7 +775,7 @@ focusnext(const char *arg) {
</a> 		for(c = clients; c &amp;&amp; !isvisible(c, selmonitor); c = c-&gt;next);
 	if(c) {
 		focus(c);
<a href="#h0-9-3" id="h0-9-3" class="d">-		restack();
</a><a href="#h0-9-4" id="h0-9-4" class="i">+		restack(&amp;monitors[c-&gt;monitor]);
</a> 	}
 }
 
<a href="#h0-10" id="h0-10" class="h">@@ -798,7 +792,7 @@ focusprev(const char *arg) {
</a> 	}
 	if(c) {
 		focus(c);
<a href="#h0-10-3" id="h0-10-3" class="d">-		restack();
</a><a href="#h0-10-4" id="h0-10-4" class="i">+		restack(&amp;monitors[c-&gt;monitor]);
</a> 	}
 }
 
<a href="#h0-11" id="h0-11" class="h">@@ -820,6 +814,16 @@ getcolor(const char *colstr) {
</a> 	return color.pixel;
 }
 
<a href="#h0-11-3" id="h0-11-3" class="i">+Monitor *
</a><a href="#h0-11-4" id="h0-11-4" class="i">+getmonitor(Window barwin) {
</a><a href="#h0-11-5" id="h0-11-5" class="i">+	unsigned int i;
</a><a href="#h0-11-6" id="h0-11-6" class="i">+
</a><a href="#h0-11-7" id="h0-11-7" class="i">+	for(i = 0; i &lt; mcount; i++)
</a><a href="#h0-11-8" id="h0-11-8" class="i">+		if(monitors[i].barwin == barwin)
</a><a href="#h0-11-9" id="h0-11-9" class="i">+			return &amp;monitors[i];
</a><a href="#h0-11-10" id="h0-11-10" class="i">+	return NULL;
</a><a href="#h0-11-11" id="h0-11-11" class="i">+}
</a><a href="#h0-11-12" id="h0-11-12" class="i">+
</a> long
 getstate(Window w) {
 	int format, status;
<a href="#h0-12" id="h0-12" class="h">@@ -1225,24 +1229,24 @@ propertynotify(XEvent *e) {
</a> 		return; /* ignore */
 	if((c = getclient(ev-&gt;window))) {
 		switch (ev-&gt;atom) {
<a href="#h0-12-3" id="h0-12-3" class="d">-			default: break;
</a><a href="#h0-12-4" id="h0-12-4" class="d">-			case XA_WM_TRANSIENT_FOR:
</a><a href="#h0-12-5" id="h0-12-5" class="d">-				XGetTransientForHint(dpy, c-&gt;win, &amp;trans);
</a><a href="#h0-12-6" id="h0-12-6" class="d">-				if(!c-&gt;isfloating &amp;&amp; (c-&gt;isfloating = (getclient(trans) != NULL)))
</a><a href="#h0-12-7" id="h0-12-7" class="d">-					arrange();
</a><a href="#h0-12-8" id="h0-12-8" class="d">-				break;
</a><a href="#h0-12-9" id="h0-12-9" class="d">-			case XA_WM_NORMAL_HINTS:
</a><a href="#h0-12-10" id="h0-12-10" class="d">-				updatesizehints(c);
</a><a href="#h0-12-11" id="h0-12-11" class="d">-				break;
</a><a href="#h0-12-12" id="h0-12-12" class="d">-			case XA_WM_HINTS:
</a><a href="#h0-12-13" id="h0-12-13" class="d">-				updatewmhints(c);
</a><a href="#h0-12-14" id="h0-12-14" class="d">-				drawbar();
</a><a href="#h0-12-15" id="h0-12-15" class="d">-				break;
</a><a href="#h0-12-16" id="h0-12-16" class="i">+		default: break;
</a><a href="#h0-12-17" id="h0-12-17" class="i">+		case XA_WM_TRANSIENT_FOR:
</a><a href="#h0-12-18" id="h0-12-18" class="i">+			XGetTransientForHint(dpy, c-&gt;win, &amp;trans);
</a><a href="#h0-12-19" id="h0-12-19" class="i">+			if(!c-&gt;isfloating &amp;&amp; (c-&gt;isfloating = (getclient(trans) != NULL)))
</a><a href="#h0-12-20" id="h0-12-20" class="i">+				arrange();
</a><a href="#h0-12-21" id="h0-12-21" class="i">+			break;
</a><a href="#h0-12-22" id="h0-12-22" class="i">+		case XA_WM_NORMAL_HINTS:
</a><a href="#h0-12-23" id="h0-12-23" class="i">+			updatesizehints(c);
</a><a href="#h0-12-24" id="h0-12-24" class="i">+			break;
</a><a href="#h0-12-25" id="h0-12-25" class="i">+		case XA_WM_HINTS:
</a><a href="#h0-12-26" id="h0-12-26" class="i">+			updatewmhints(c);
</a><a href="#h0-12-27" id="h0-12-27" class="i">+			drawbar(&amp;monitors[c-&gt;monitor]);
</a><a href="#h0-12-28" id="h0-12-28" class="i">+			break;
</a> 		}
 		if(ev-&gt;atom == XA_WM_NAME || ev-&gt;atom == netatom[NetWMName]) {
 			updatetitle(c);
 			if(c == sel)
<a href="#h0-12-33" id="h0-12-33" class="d">-				drawbar();
</a><a href="#h0-12-34" id="h0-12-34" class="i">+				drawbar(&amp;monitors[c-&gt;monitor]);
</a> 		}
 	}
 }
<a href="#h0-13" id="h0-13" class="h">@@ -1375,31 +1379,28 @@ resizemouse(Client *c) {
</a> }
 
 void
<a href="#h0-13-3" id="h0-13-3" class="d">-restack(void) {
</a><a href="#h0-13-4" id="h0-13-4" class="d">-	unsigned int i;
</a><a href="#h0-13-5" id="h0-13-5" class="i">+restack(Monitor *m) {
</a> 	Client *c;
 	XEvent ev;
 	XWindowChanges wc;
 
<a href="#h0-13-10" id="h0-13-10" class="d">-	drawbar();
</a><a href="#h0-13-11" id="h0-13-11" class="i">+	drawbar(m);
</a> 	if(!sel)
 		return;
<a href="#h0-13-14" id="h0-13-14" class="d">-	if(sel-&gt;isfloating || (monitors[selmonitor].layout-&gt;arrange == floating))
</a><a href="#h0-13-15" id="h0-13-15" class="i">+	if(sel-&gt;isfloating || (m-&gt;layout-&gt;arrange == floating))
</a> 		XRaiseWindow(dpy, sel-&gt;win);
<a href="#h0-13-17" id="h0-13-17" class="d">-	if(monitors[selmonitor].layout-&gt;arrange != floating) {
</a><a href="#h0-13-18" id="h0-13-18" class="i">+	if(m-&gt;layout-&gt;arrange != floating) {
</a> 		wc.stack_mode = Below;
<a href="#h0-13-20" id="h0-13-20" class="d">-		wc.sibling = monitors[selmonitor].barwin;
</a><a href="#h0-13-21" id="h0-13-21" class="i">+		wc.sibling = m-&gt;barwin;
</a> 		if(!sel-&gt;isfloating) {
 			XConfigureWindow(dpy, sel-&gt;win, CWSibling | CWStackMode, &amp;wc);
 			wc.sibling = sel-&gt;win;
 		}
<a href="#h0-13-26" id="h0-13-26" class="d">-		for(i = 0; i &lt; mcount; i++) {
</a><a href="#h0-13-27" id="h0-13-27" class="d">-			for(c = nexttiled(clients, i); c; c = nexttiled(c-&gt;next, i)) {
</a><a href="#h0-13-28" id="h0-13-28" class="d">-				if(c == sel)
</a><a href="#h0-13-29" id="h0-13-29" class="d">-					continue;
</a><a href="#h0-13-30" id="h0-13-30" class="d">-				XConfigureWindow(dpy, c-&gt;win, CWSibling | CWStackMode, &amp;wc);
</a><a href="#h0-13-31" id="h0-13-31" class="d">-				wc.sibling = c-&gt;win;
</a><a href="#h0-13-32" id="h0-13-32" class="d">-			}
</a><a href="#h0-13-33" id="h0-13-33" class="i">+		for(c = nexttiled(clients, m-&gt;id); c; c = nexttiled(c-&gt;next, m-&gt;id)) {
</a><a href="#h0-13-34" id="h0-13-34" class="i">+			if(c == sel)
</a><a href="#h0-13-35" id="h0-13-35" class="i">+				continue;
</a><a href="#h0-13-36" id="h0-13-36" class="i">+			XConfigureWindow(dpy, c-&gt;win, CWSibling | CWStackMode, &amp;wc);
</a><a href="#h0-13-37" id="h0-13-37" class="i">+			wc.sibling = c-&gt;win;
</a> 		}
 	}
 	XSync(dpy, False);
<a href="#h0-14" id="h0-14" class="h">@@ -1456,7 +1457,7 @@ run(void) {
</a> 					}
 				break;
 			}
<a href="#h0-14-3" id="h0-14-3" class="d">-			drawbar();
</a><a href="#h0-14-4" id="h0-14-4" class="i">+			drawbar(&amp;monitors[selmonitor]);
</a> 		}
 		while(XPending(dpy)) {
 			XNextEvent(dpy, &amp;ev);
<a href="#h0-15" id="h0-15" class="h">@@ -1522,7 +1523,7 @@ setlayout(const char *arg) {
</a> 	if(sel)
 		arrange();
 	else
<a href="#h0-15-3" id="h0-15-3" class="d">-		drawbar();
</a><a href="#h0-15-4" id="h0-15-4" class="i">+		drawbar(m);
</a> }
 
 void
<a href="#h0-16" id="h0-16" class="h">@@ -1651,6 +1652,8 @@ setup(void) {
</a> 				| EnterWindowMask | LeaveWindowMask | StructureNotifyMask;
 		XChangeWindowAttributes(dpy, root, CWEventMask | CWCursor, &amp;wa);
 		XSelectInput(dpy, root, wa.event_mask);
<a href="#h0-16-3" id="h0-16-3" class="i">+
</a><a href="#h0-16-4" id="h0-16-4" class="i">+		drawbar(m);
</a> 	}
 	if(info)
 		XFree(info);
<a href="#h0-17" id="h0-17" class="h">@@ -2054,7 +2057,6 @@ main(int argc, char *argv[]) {
</a> 
 	checkotherwm();
 	setup();
<a href="#h0-17-3" id="h0-17-3" class="d">-	drawbar();
</a> 	scan();
 	run();
 	cleanup();
</pre>
</div>
</body>
</html>
