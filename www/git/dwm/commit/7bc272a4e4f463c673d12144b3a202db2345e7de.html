<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>made the basics of the tagging concept working -- if people want dynamic tags, that&#39;s even possible with this concept, the vtags[] array needs to be modified during runtime for this -- the new code is quite experimental, ugly and needs polishing - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/7bc272a4e4f463c673d12144b3a202db2345e7de.html">7bc272a4e4f463c673d12144b3a202db2345e7de</a>
<b>parent</b> <a href="../commit/f1719ac2de2aba270c2460807eacae137d3aeadf.html">f1719ac2de2aba270c2460807eacae137d3aeadf</a>
<b>Author:</b> anselm@anselm1 &lt;<a href="mailto:unknown">unknown</a>&gt;
<b>Date:</b>   Thu, 28 Feb 2008 21:38:53 +0000

made the basics of the tagging concept working -- if people want dynamic tags, that&#39;s even possible with this concept, the vtags[] array needs to be modified during runtime for this -- the new code is quite experimental, ugly and needs polishing
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.mk</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">dwm.c</a></td><td> | </td><td class="num">145</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------</span></td></tr>
</table></pre><pre>2 files changed, 93 insertions(+), 54 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -17,7 +17,7 @@ LIBS = -L/usr/lib -lc -L${X11LIB} -lX11 -lXinerama
</a> # flags
 CFLAGS = -Os ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
 LDFLAGS = -s ${LIBS}
<a href="#h0-0-3" id="h0-0-3" class="d">-CFLAGS = -g -std=c99 -pedantic -Wall -O2 ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+CFLAGS = -g -std=c99 -pedantic -Wall -O2 ${INCS} -DVERSION=\&quot;${VERSION}\&quot; -DAIM_XINERAMA
</a> LDFLAGS = -g ${LIBS}
 
 # Solaris
<b>diff --git a/<a id="h1" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -71,7 +71,6 @@ struct Client {
</a> 	unsigned int border, oldborder;
 	Bool isbanned, isfixed, isfloating, isurgent;
 	Bool *tags;
<a href="#h1-0-3" id="h1-0-3" class="d">-	View *view;
</a> 	Client *next;
 	Client *prev;
 	Client *snext;
<a href="#h1-1" id="h1-1" class="h">@@ -120,7 +119,6 @@ struct View {
</a> };
 
 /* function declarations */
<a href="#h1-1-3" id="h1-1-3" class="d">-void addtag(Client *c, const char *t);
</a> void applyrules(Client *c);
 void arrange(void);
 void attach(Client *c);
<a href="#h1-2" id="h1-2" class="h">@@ -132,6 +130,7 @@ void cleanup(void);
</a> void configure(Client *c);
 void configurenotify(XEvent *e);
 void configurerequest(XEvent *e);
<a href="#h1-2-3" id="h1-2-3" class="i">+Bool conflicts(Client *c, unsigned int tidx);
</a> void destroynotify(XEvent *e);
 void detach(Client *c);
 void detachstack(Client *c);
<a href="#h1-3" id="h1-3" class="h">@@ -142,6 +141,7 @@ void *emallocz(unsigned int size);
</a> void enternotify(XEvent *e);
 void eprint(const char *errstr, ...);
 void expose(XEvent *e);
<a href="#h1-3-3" id="h1-3-3" class="i">+unsigned int firstag(View *v);
</a> void floating(View *v); /* default floating layout */
 void focus(Client *c);
 void focusin(XEvent *e);
<a href="#h1-4" id="h1-4" class="h">@@ -149,6 +149,7 @@ void focusnext(const char *arg);
</a> void focusprev(const char *arg);
 Client *getclient(Window w);
 unsigned long getcolor(const char *colstr);
<a href="#h1-4-3" id="h1-4-3" class="i">+View *getview(Client *c);
</a> View *getviewbar(Window barwin);
 long getstate(Window w);
 Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
<a href="#h1-5" id="h1-5" class="h">@@ -248,20 +249,10 @@ Window root;
</a> #define TAGSZ (LENGTH(tags) * sizeof(Bool))
 
 /* function implementations */
<a href="#h1-5-3" id="h1-5-3" class="d">-void
</a><a href="#h1-5-4" id="h1-5-4" class="d">-addtag(Client *c, const char *t) {
</a><a href="#h1-5-5" id="h1-5-5" class="d">-	unsigned int i, tidx = idxoftag(t);
</a><a href="#h1-5-6" id="h1-5-6" class="d">-
</a><a href="#h1-5-7" id="h1-5-7" class="d">-	for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-5-8" id="h1-5-8" class="d">-		if(c-&gt;tags[i] &amp;&amp; vtags[i] != vtags[tidx])
</a><a href="#h1-5-9" id="h1-5-9" class="d">-			return; /* conflict */
</a><a href="#h1-5-10" id="h1-5-10" class="d">-	c-&gt;tags[tidx] = True;
</a><a href="#h1-5-11" id="h1-5-11" class="d">-	c-&gt;view = &amp;views[vtags[tidx]];
</a><a href="#h1-5-12" id="h1-5-12" class="d">-}
</a> 
 void
 applyrules(Client *c) {
<a href="#h1-5-16" id="h1-5-16" class="d">-	unsigned int i;
</a><a href="#h1-5-17" id="h1-5-17" class="i">+	unsigned int i, idx;
</a> 	Bool matched = False;
 	Rule *r;
 	XClassHint ch = { 0 };
<a href="#h1-6" id="h1-6" class="h">@@ -275,8 +266,8 @@ applyrules(Client *c) {
</a> 		|| (ch.res_name &amp;&amp; strstr(ch.res_name, r-&gt;prop)))
 		{
 			c-&gt;isfloating = r-&gt;isfloating;
<a href="#h1-6-3" id="h1-6-3" class="d">-			if(r-&gt;tag) {
</a><a href="#h1-6-4" id="h1-6-4" class="d">-				addtag(c, r-&gt;tag);
</a><a href="#h1-6-5" id="h1-6-5" class="i">+			if(r-&gt;tag &amp;&amp; !conflicts(c, (idx = idxoftag(r-&gt;tag)))) {
</a><a href="#h1-6-6" id="h1-6-6" class="i">+				c-&gt;tags[idx] = True;
</a> 				matched = True;
 			}
 		}
<a href="#h1-7" id="h1-7" class="h">@@ -286,8 +277,9 @@ applyrules(Client *c) {
</a> 	if(ch.res_name)
 		XFree(ch.res_name);
 	if(!matched) {
<a href="#h1-7-3" id="h1-7-3" class="d">-		memcpy(c-&gt;tags, seltags, TAGSZ);
</a><a href="#h1-7-4" id="h1-7-4" class="d">-		c-&gt;view = selview;
</a><a href="#h1-7-5" id="h1-7-5" class="i">+		for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-7-6" id="h1-7-6" class="i">+			if(seltags[i] &amp;&amp; vtags[i] == selview-&gt;id)
</a><a href="#h1-7-7" id="h1-7-7" class="i">+				c-&gt;tags[i] = True;
</a> 	}
 }
 
<a href="#h1-8" id="h1-8" class="h">@@ -327,7 +319,7 @@ void
</a> ban(Client *c) {
 	if(c-&gt;isbanned)
 		return;
<a href="#h1-8-3" id="h1-8-3" class="d">-	XMoveWindow(dpy, c-&gt;win, c-&gt;x + 3 * c-&gt;view-&gt;w, c-&gt;y);
</a><a href="#h1-8-4" id="h1-8-4" class="i">+	XMoveWindow(dpy, c-&gt;win, c-&gt;x + 3 * getview(c)-&gt;w, c-&gt;y);
</a> 	c-&gt;isbanned = True;
 }
 
<a href="#h1-9" id="h1-9" class="h">@@ -367,17 +359,17 @@ buttonpress(XEvent *e) {
</a> 		if(CLEANMASK(ev-&gt;state) != MODKEY)
 			return;
 		if(ev-&gt;button == Button1) {
<a href="#h1-9-3" id="h1-9-3" class="d">-			restack(c-&gt;view);
</a><a href="#h1-9-4" id="h1-9-4" class="i">+			restack(getview(c));
</a> 			movemouse(c);
 		}
 		else if(ev-&gt;button == Button2) {
<a href="#h1-9-8" id="h1-9-8" class="d">-			if((floating != c-&gt;view-&gt;layout-&gt;arrange) &amp;&amp; c-&gt;isfloating)
</a><a href="#h1-9-9" id="h1-9-9" class="i">+			if((floating != getview(c)-&gt;layout-&gt;arrange) &amp;&amp; c-&gt;isfloating)
</a> 				togglefloating(NULL);
 			else
 				zoom(NULL);
 		}
 		else if(ev-&gt;button == Button3 &amp;&amp; !c-&gt;isfixed) {
<a href="#h1-9-15" id="h1-9-15" class="d">-			restack(c-&gt;view);
</a><a href="#h1-9-16" id="h1-9-16" class="i">+			restack(getview(c));
</a> 			resizemouse(c);
 		}
 	}
<a href="#h1-10" id="h1-10" class="h">@@ -466,7 +458,7 @@ configurerequest(XEvent *e) {
</a> 	XWindowChanges wc;
 
 	if((c = getclient(ev-&gt;window))) {
<a href="#h1-10-3" id="h1-10-3" class="d">-		View *v = c-&gt;view;
</a><a href="#h1-10-4" id="h1-10-4" class="i">+		View *v = getview(c);
</a> 		if(ev-&gt;value_mask &amp; CWBorderWidth)
 			c-&gt;border = ev-&gt;border_width;
 		if(c-&gt;isfixed || c-&gt;isfloating || (floating == v-&gt;layout-&gt;arrange)) {
<a href="#h1-11" id="h1-11" class="h">@@ -504,6 +496,16 @@ configurerequest(XEvent *e) {
</a> 	XSync(dpy, False);
 }
 
<a href="#h1-11-3" id="h1-11-3" class="i">+Bool
</a><a href="#h1-11-4" id="h1-11-4" class="i">+conflicts(Client *c, unsigned int tidx) {
</a><a href="#h1-11-5" id="h1-11-5" class="i">+	unsigned int i;
</a><a href="#h1-11-6" id="h1-11-6" class="i">+
</a><a href="#h1-11-7" id="h1-11-7" class="i">+	for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-11-8" id="h1-11-8" class="i">+		if(c-&gt;tags[i] &amp;&amp; vtags[i] != vtags[tidx])
</a><a href="#h1-11-9" id="h1-11-9" class="i">+			return True; /* conflict */
</a><a href="#h1-11-10" id="h1-11-10" class="i">+	return False;
</a><a href="#h1-11-11" id="h1-11-11" class="i">+}
</a><a href="#h1-11-12" id="h1-11-12" class="i">+
</a> void
 destroynotify(XEvent *e) {
 	Client *c;
<a href="#h1-12" id="h1-12" class="h">@@ -538,7 +540,7 @@ drawbar(View *v) {
</a> 	Client *c;
 
 	dc.x = 0;
<a href="#h1-12-3" id="h1-12-3" class="d">-	for(c = stack; c &amp;&amp; (!isvisible(c) || c-&gt;view != v); c = c-&gt;snext);
</a><a href="#h1-12-4" id="h1-12-4" class="i">+	for(c = stack; c &amp;&amp; (!isvisible(c) || getview(c) != v); c = c-&gt;snext);
</a> 	for(i = 0; i &lt; LENGTH(tags); i++) {
 		if(&amp;views[vtags[i]] != v)
 			continue;
<a href="#h1-13" id="h1-13" class="h">@@ -681,6 +683,16 @@ expose(XEvent *e) {
</a> 		drawbar(v);
 }
 
<a href="#h1-13-3" id="h1-13-3" class="i">+unsigned int
</a><a href="#h1-13-4" id="h1-13-4" class="i">+firstag(View *v) {
</a><a href="#h1-13-5" id="h1-13-5" class="i">+	unsigned int i;
</a><a href="#h1-13-6" id="h1-13-6" class="i">+
</a><a href="#h1-13-7" id="h1-13-7" class="i">+	for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-13-8" id="h1-13-8" class="i">+		if(vtags[i] == v-&gt;id)
</a><a href="#h1-13-9" id="h1-13-9" class="i">+			return i;
</a><a href="#h1-13-10" id="h1-13-10" class="i">+	return 0; /* safe fallback */
</a><a href="#h1-13-11" id="h1-13-11" class="i">+}
</a><a href="#h1-13-12" id="h1-13-12" class="i">+
</a> void
 floating(View *v) { /* default floating layout */
 	Client *c;
<a href="#h1-14" id="h1-14" class="h">@@ -695,13 +707,12 @@ void
</a> focus(Client *c) {
 	View *v = selview;
 	if(c)
<a href="#h1-14-3" id="h1-14-3" class="d">-		selview = c-&gt;view;
</a><a href="#h1-14-4" id="h1-14-4" class="d">-	else
</a><a href="#h1-14-5" id="h1-14-5" class="d">-		selview = viewat();
</a><a href="#h1-14-6" id="h1-14-6" class="i">+		selview = getview(c);
</a> 	if(selview != v)
 		drawbar(v);
 	if(!c || (c &amp;&amp; !isvisible(c)))
<a href="#h1-14-10" id="h1-14-10" class="d">-		for(c = stack; c &amp;&amp; (!isvisible(c) || c-&gt;view != selview); c = c-&gt;snext);
</a><a href="#h1-14-11" id="h1-14-11" class="i">+		/* TODO: isvisible might take getview(c) as constraint? */
</a><a href="#h1-14-12" id="h1-14-12" class="i">+		for(c = stack; c &amp;&amp; (!isvisible(c) || getview(c) != selview); c = c-&gt;snext);
</a> 	if(sel &amp;&amp; sel != c) {
 		grabbuttons(sel, False);
 		XSetWindowBorder(dpy, sel-&gt;win, dc.norm[ColBorder]);
<a href="#h1-15" id="h1-15" class="h">@@ -715,7 +726,7 @@ focus(Client *c) {
</a> 	if(c) {
 		XSetWindowBorder(dpy, c-&gt;win, dc.sel[ColBorder]);
 		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
<a href="#h1-15-3" id="h1-15-3" class="d">-		selview = c-&gt;view;
</a><a href="#h1-15-4" id="h1-15-4" class="i">+		selview = getview(c);
</a> 	}
 	else
 		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
<a href="#h1-16" id="h1-16" class="h">@@ -741,7 +752,7 @@ focusnext(const char *arg) {
</a> 		for(c = clients; c &amp;&amp; !isvisible(c); c = c-&gt;next);
 	if(c) {
 		focus(c);
<a href="#h1-16-3" id="h1-16-3" class="d">-		restack(c-&gt;view);
</a><a href="#h1-16-4" id="h1-16-4" class="i">+		restack(getview(c));
</a> 	}
 }
 
<a href="#h1-17" id="h1-17" class="h">@@ -758,7 +769,7 @@ focusprev(const char *arg) {
</a> 	}
 	if(c) {
 		focus(c);
<a href="#h1-17-3" id="h1-17-3" class="d">-		restack(c-&gt;view);
</a><a href="#h1-17-4" id="h1-17-4" class="i">+		restack(getview(c));
</a> 	}
 }
 
<a href="#h1-18" id="h1-18" class="h">@@ -781,6 +792,16 @@ getcolor(const char *colstr) {
</a> }
 
 View *
<a href="#h1-18-3" id="h1-18-3" class="i">+getview(Client *c) {
</a><a href="#h1-18-4" id="h1-18-4" class="i">+	unsigned int i;
</a><a href="#h1-18-5" id="h1-18-5" class="i">+
</a><a href="#h1-18-6" id="h1-18-6" class="i">+	for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-18-7" id="h1-18-7" class="i">+		if(c-&gt;tags[i])
</a><a href="#h1-18-8" id="h1-18-8" class="i">+			return &amp;views[vtags[i]];
</a><a href="#h1-18-9" id="h1-18-9" class="i">+	return NULL;
</a><a href="#h1-18-10" id="h1-18-10" class="i">+}
</a><a href="#h1-18-11" id="h1-18-11" class="i">+
</a><a href="#h1-18-12" id="h1-18-12" class="i">+View *
</a> getviewbar(Window barwin) {
 	unsigned int i;
 
<a href="#h1-19" id="h1-19" class="h">@@ -905,7 +926,7 @@ idxoftag(const char *t) {
</a> 	unsigned int i;
 
 	for(i = 0; (i &lt; LENGTH(tags)) &amp;&amp; (tags[i] != t); i++);
<a href="#h1-19-3" id="h1-19-3" class="d">-	return (i &lt; LENGTH(tags)) ? i : 0;
</a><a href="#h1-19-4" id="h1-19-4" class="i">+	return (i &lt; LENGTH(tags)) ? i : firstag(selview);
</a> }
 
 void
<a href="#h1-20" id="h1-20" class="h">@@ -1045,7 +1066,7 @@ manage(Window w, XWindowAttributes *wa) {
</a> 
 	applyrules(c);
 
<a href="#h1-20-3" id="h1-20-3" class="d">-	v = c-&gt;view;
</a><a href="#h1-20-4" id="h1-20-4" class="i">+	v = getview(c);
</a> 
 	c-&gt;x = wa-&gt;x + v-&gt;x;
 	c-&gt;y = wa-&gt;y + v-&gt;y;
<a href="#h1-21" id="h1-21" class="h">@@ -1124,7 +1145,7 @@ movemouse(Client *c) {
</a> 
 	ocx = nx = c-&gt;x;
 	ocy = ny = c-&gt;y;
<a href="#h1-21-3" id="h1-21-3" class="d">-	v = c-&gt;view;
</a><a href="#h1-21-4" id="h1-21-4" class="i">+	v = getview(c);
</a> 	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
 			None, cursor[CurMove], CurrentTime) != GrabSuccess)
 		return;
<a href="#h1-22" id="h1-22" class="h">@@ -1163,7 +1184,7 @@ movemouse(Client *c) {
</a> 
 Client *
 nexttiled(Client *c, View *v) {
<a href="#h1-22-3" id="h1-22-3" class="d">-	for(; c &amp;&amp; (c-&gt;isfloating || c-&gt;view != v || !isvisible(c)); c = c-&gt;next);
</a><a href="#h1-22-4" id="h1-22-4" class="i">+	for(; c &amp;&amp; (c-&gt;isfloating || getview(c) != v || !isvisible(c)); c = c-&gt;next);
</a> 	return c;
 }
 
<a href="#h1-23" id="h1-23" class="h">@@ -1188,7 +1209,7 @@ propertynotify(XEvent *e) {
</a> 			break;
 		case XA_WM_HINTS:
 			updatewmhints(c);
<a href="#h1-23-3" id="h1-23-3" class="d">-			drawbar(c-&gt;view);
</a><a href="#h1-23-4" id="h1-23-4" class="i">+			drawbar(getview(c));
</a> 			break;
 		}
 		if(ev-&gt;atom == XA_WM_NAME || ev-&gt;atom == netatom[NetWMName]) {
<a href="#h1-24" id="h1-24" class="h">@@ -1221,7 +1242,7 @@ resize(Client *c, int x, int y, int w, int h, Bool sizehints) {
</a> 	View *v;
 	XWindowChanges wc;
 
<a href="#h1-24-3" id="h1-24-3" class="d">-	v = c-&gt;view;
</a><a href="#h1-24-4" id="h1-24-4" class="i">+	v = getview(c);
</a> 	if(sizehints) {
 		/* set minimum possible */
 		if (w &lt; 1)
<a href="#h1-25" id="h1-25" class="h">@@ -1292,7 +1313,7 @@ resizemouse(Client *c) {
</a> 
 	ocx = c-&gt;x;
 	ocy = c-&gt;y;
<a href="#h1-25-3" id="h1-25-3" class="d">-	v = c-&gt;view;
</a><a href="#h1-25-4" id="h1-25-4" class="i">+	v = getview(c);
</a> 	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
 			None, cursor[CurResize], CurrentTime) != GrabSuccess)
 		return;
<a href="#h1-26" id="h1-26" class="h">@@ -1560,14 +1581,11 @@ nviews = 2; /* aim Xinerama */
</a> 	for(i = 0; i &lt; nviews; i++) {
 		/* init geometry */
 		v = &amp;views[i];
<a href="#h1-26-3" id="h1-26-3" class="i">+		v-&gt;id = i;
</a> 
<a href="#h1-26-5" id="h1-26-5" class="d">-		/* select first tag in each view */
</a><a href="#h1-26-6" id="h1-26-6" class="d">-		for(j = 0; j &lt; LENGTH(tags); j++)
</a><a href="#h1-26-7" id="h1-26-7" class="d">-			if(vtags[j] == i) {
</a><a href="#h1-26-8" id="h1-26-8" class="d">-				seltags[j] = prevtags[j] = True; 
</a><a href="#h1-26-9" id="h1-26-9" class="d">-				break;
</a><a href="#h1-26-10" id="h1-26-10" class="d">-			}
</a><a href="#h1-26-11" id="h1-26-11" class="d">-
</a><a href="#h1-26-12" id="h1-26-12" class="i">+		/* select first tag of view */
</a><a href="#h1-26-13" id="h1-26-13" class="i">+		j = firstag(v);
</a><a href="#h1-26-14" id="h1-26-14" class="i">+		seltags[j] = prevtags[j] = True; 
</a> 
 		if(info) {
 
<a href="#h1-27" id="h1-27" class="h">@@ -1661,8 +1679,10 @@ tag(const char *arg) {
</a> 	if(!sel)
 		return;
 	for(i = 0; i &lt; LENGTH(tags); i++)
<a href="#h1-27-3" id="h1-27-3" class="d">-		sel-&gt;tags[i] = (NULL == arg);
</a><a href="#h1-27-4" id="h1-27-4" class="d">-	sel-&gt;tags[idxoftag(arg)] = True;
</a><a href="#h1-27-5" id="h1-27-5" class="i">+		sel-&gt;tags[i] = (NULL == arg) &amp;&amp; (vtags[i] == getview(sel)-&gt;id);
</a><a href="#h1-27-6" id="h1-27-6" class="i">+	i = idxoftag(arg);
</a><a href="#h1-27-7" id="h1-27-7" class="i">+	if(!conflicts(sel, i))
</a><a href="#h1-27-8" id="h1-27-8" class="i">+		sel-&gt;tags[idxoftag(arg)] = True;
</a> 	arrange();
 }
 
<a href="#h1-28" id="h1-28" class="h">@@ -1753,6 +1773,8 @@ toggletag(const char *arg) {
</a> 	if(!sel)
 		return;
 	i = idxoftag(arg);
<a href="#h1-28-3" id="h1-28-3" class="i">+	if(conflicts(sel, i))
</a><a href="#h1-28-4" id="h1-28-4" class="i">+		return;
</a> 	sel-&gt;tags[i] = !sel-&gt;tags[i];
 	for(j = 0; j &lt; LENGTH(tags) &amp;&amp; !sel-&gt;tags[j]; j++);
 	if(j == LENGTH(tags))
<a href="#h1-29" id="h1-29" class="h">@@ -1908,13 +1930,30 @@ updatewmhints(Client *c) {
</a> 
 void
 view(const char *arg) {
<a href="#h1-29-3" id="h1-29-3" class="d">-	unsigned int i;
</a><a href="#h1-29-4" id="h1-29-4" class="i">+	unsigned int i, j;
</a> 	Bool tmp[LENGTH(tags)];
 
<a href="#h1-29-7" id="h1-29-7" class="d">-	for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-29-8" id="h1-29-8" class="d">-		tmp[i] = (NULL == arg);
</a><a href="#h1-29-9" id="h1-29-9" class="d">-	tmp[idxoftag(arg)] = True;
</a><a href="#h1-29-10" id="h1-29-10" class="d">-
</a><a href="#h1-29-11" id="h1-29-11" class="i">+	memcpy(tmp, seltags, TAGSZ);
</a><a href="#h1-29-12" id="h1-29-12" class="i">+	if(arg == NULL) {
</a><a href="#h1-29-13" id="h1-29-13" class="i">+		for(i = 0; i &lt; LENGTH(tags); i++)
</a><a href="#h1-29-14" id="h1-29-14" class="i">+			tmp[i] = (vtags[i] == selview-&gt;id);
</a><a href="#h1-29-15" id="h1-29-15" class="i">+	}
</a><a href="#h1-29-16" id="h1-29-16" class="i">+	else {
</a><a href="#h1-29-17" id="h1-29-17" class="i">+		i = idxoftag(arg);
</a><a href="#h1-29-18" id="h1-29-18" class="i">+		for(j = 0; j &lt; LENGTH(tags); j++)
</a><a href="#h1-29-19" id="h1-29-19" class="i">+			if(selview-&gt;id == vtags[i]) {
</a><a href="#h1-29-20" id="h1-29-20" class="i">+				/* view tag of selview */
</a><a href="#h1-29-21" id="h1-29-21" class="i">+				if(selview-&gt;id == vtags[j])
</a><a href="#h1-29-22" id="h1-29-22" class="i">+					tmp[j] = False;
</a><a href="#h1-29-23" id="h1-29-23" class="i">+			}
</a><a href="#h1-29-24" id="h1-29-24" class="i">+			else {
</a><a href="#h1-29-25" id="h1-29-25" class="i">+				/* only touch the view the focus should go */
</a><a href="#h1-29-26" id="h1-29-26" class="i">+				if(vtags[j] == vtags[i])
</a><a href="#h1-29-27" id="h1-29-27" class="i">+					tmp[j] = False;
</a><a href="#h1-29-28" id="h1-29-28" class="i">+			}
</a><a href="#h1-29-29" id="h1-29-29" class="i">+		selview = &amp;views[vtags[i]];
</a><a href="#h1-29-30" id="h1-29-30" class="i">+		tmp[i] = True;
</a><a href="#h1-29-31" id="h1-29-31" class="i">+	}
</a> 	if(memcmp(seltags, tmp, TAGSZ) != 0) {
 		memcpy(prevtags, seltags, TAGSZ);
 		memcpy(seltags, tmp, TAGSZ);
<a href="#h1-30" id="h1-30" class="h">@@ -1985,8 +2024,8 @@ zoom(const char *arg) {
</a> 
 	if(!sel || !dozoom || sel-&gt;isfloating)
 		return;
<a href="#h1-30-3" id="h1-30-3" class="d">-	if(c == nexttiled(clients, c-&gt;view))
</a><a href="#h1-30-4" id="h1-30-4" class="d">-		if(!(c = nexttiled(c-&gt;next, c-&gt;view)))
</a><a href="#h1-30-5" id="h1-30-5" class="i">+	if(c == nexttiled(clients, getview(c)))
</a><a href="#h1-30-6" id="h1-30-6" class="i">+		if(!(c = nexttiled(c-&gt;next, getview(c))))
</a> 			return;
 	detach(c);
 	attach(c);
</pre>
</div>
</body>
</html>
