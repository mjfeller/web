<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>implemented better fullscreen handling, please test - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/62d3caa9990e4fd936850341095da4dd1bf4c846.html">62d3caa9990e4fd936850341095da4dd1bf4c846</a>
<b>parent</b> <a href="../commit/4c9b397ff9653277b6e0e35d7c79dca76756b7ba.html">4c9b397ff9653277b6e0e35d7c79dca76756b7ba</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:anselm@garbe.us">anselm@garbe.us</a>&gt;
<b>Date:</b>   Sun, 30 May 2010 10:02:56 +0100

implemented better fullscreen handling, please test
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">105</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
</table></pre><pre>1 file changed, 75 insertions(+), 30 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -57,7 +57,8 @@
</a> /* enums */
 enum { CurNormal, CurResize, CurMove, CurLast };        /* cursor */
 enum { ColBorder, ColFG, ColBG, ColLast };              /* color */
<a href="#h0-0-3" id="h0-0-3" class="d">-enum { NetSupported, NetWMName, NetWMState, NetLast };  /* EWMH atoms */
</a><a href="#h0-0-4" id="h0-0-4" class="i">+enum { NetSupported, NetWMName, NetWMState,
</a><a href="#h0-0-5" id="h0-0-5" class="i">+       NetWMFullscreen, NetLast };                      /* EWMH atoms */
</a> enum { WMProtocols, WMDelete, WMState, WMLast };        /* default atoms */
 enum { ClkTagBar, ClkLtSymbol, ClkStatusText, ClkWinTitle,
        ClkClientWin, ClkRootWin, ClkLast };             /* clicks */
<a href="#h0-1" id="h0-1" class="h">@@ -83,10 +84,11 @@ struct Client {
</a> 	char name[256];
 	float mina, maxa;
 	int x, y, w, h;
<a href="#h0-1-3" id="h0-1-3" class="i">+	int oldx, oldy, oldw, oldh;
</a> 	int basew, baseh, incw, inch, maxw, maxh, minw, minh;
 	int bw, oldbw;
 	unsigned int tags;
<a href="#h0-1-7" id="h0-1-7" class="d">-	Bool isfixed, isfloating, isurgent;
</a><a href="#h0-1-8" id="h0-1-8" class="i">+	Bool isfixed, isfloating, isurgent, oldstate;
</a> 	Client *next;
 	Client *snext;
 	Monitor *mon;
<a href="#h0-2" id="h0-2" class="h">@@ -161,6 +163,7 @@ static void checkotherwm(void);
</a> static void cleanup(void);
 static void cleanupmon(Monitor *mon);
 static void clearurgent(Client *c);
<a href="#h0-2-3" id="h0-2-3" class="i">+static void clientmessage(XEvent *e);
</a> static void configure(Client *c);
 static void configurenotify(XEvent *e);
 static void configurerequest(XEvent *e);
<a href="#h0-3" id="h0-3" class="h">@@ -200,6 +203,7 @@ static Monitor *ptrtomon(int x, int y);
</a> static void propertynotify(XEvent *e);
 static void quit(const Arg *arg);
 static void resize(Client *c, int x, int y, int w, int h, Bool interact);
<a href="#h0-3-3" id="h0-3-3" class="i">+static void resizeclient(Client *c, int x, int y, int w, int h);
</a> static void resizemouse(const Arg *arg);
 static void restack(Monitor *m);
 static void run(void);
<a href="#h0-4" id="h0-4" class="h">@@ -220,7 +224,7 @@ static void togglebar(const Arg *arg);
</a> static void togglefloating(const Arg *arg);
 static void toggletag(const Arg *arg);
 static void toggleview(const Arg *arg);
<a href="#h0-4-3" id="h0-4-3" class="d">-static void unfocus(Client *c);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+static void unfocus(Client *c, Bool setfocus);
</a> static void unmanage(Client *c, Bool destroyed);
 static void unmapnotify(XEvent *e);
 static Bool updategeom(void);
<a href="#h0-5" id="h0-5" class="h">@@ -249,6 +253,7 @@ static int (*xerrorxlib)(Display *, XErrorEvent *);
</a> static unsigned int numlockmask = 0;
 static void (*handler[LASTEvent]) (XEvent *) = {
 	[ButtonPress] = buttonpress,
<a href="#h0-5-3" id="h0-5-3" class="i">+	[ClientMessage] = clientmessage,
</a> 	[ConfigureRequest] = configurerequest,
 	[ConfigureNotify] = configurenotify,
 	[DestroyNotify] = destroynotify,
<a href="#h0-6" id="h0-6" class="h">@@ -423,7 +428,7 @@ buttonpress(XEvent *e) {
</a> 	click = ClkRootWin;
 	/* focus monitor if necessary */
 	if((m = wintomon(ev-&gt;window)) &amp;&amp; m != selmon) {
<a href="#h0-6-3" id="h0-6-3" class="d">-		unfocus(selmon-&gt;sel);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+		unfocus(selmon-&gt;sel, True);
</a> 		selmon = m;
 		focus(NULL);
 	}
<a href="#h0-7" id="h0-7" class="h">@@ -792,7 +797,7 @@ enternotify(XEvent *e) {
</a> 	if((ev-&gt;mode != NotifyNormal || ev-&gt;detail == NotifyInferior) &amp;&amp; ev-&gt;window != root)
 		return;
 	if((m = wintomon(ev-&gt;window)) &amp;&amp; m != selmon) {
<a href="#h0-7-3" id="h0-7-3" class="d">-		unfocus(selmon-&gt;sel);
</a><a href="#h0-7-4" id="h0-7-4" class="i">+		unfocus(selmon-&gt;sel, True);
</a> 		selmon = m;
 	}
 	if((c = wintoclient(ev-&gt;window)))
<a href="#h0-8" id="h0-8" class="h">@@ -814,8 +819,9 @@ void
</a> focus(Client *c) {
 	if(!c || !ISVISIBLE(c))
 		for(c = selmon-&gt;stack; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;snext);
<a href="#h0-8-3" id="h0-8-3" class="d">-	if(selmon-&gt;sel)
</a><a href="#h0-8-4" id="h0-8-4" class="d">-		unfocus(selmon-&gt;sel);
</a><a href="#h0-8-5" id="h0-8-5" class="i">+	/* was if(selmon-&gt;sel) */
</a><a href="#h0-8-6" id="h0-8-6" class="i">+	if(selmon-&gt;sel &amp;&amp; selmon-&gt;sel != c)
</a><a href="#h0-8-7" id="h0-8-7" class="i">+		unfocus(selmon-&gt;sel, False);
</a> 	if(c) {
 		if(c-&gt;mon != selmon)
 			selmon = c-&gt;mon;
<a href="#h0-9" id="h0-9" class="h">@@ -849,7 +855,7 @@ focusmon(const Arg *arg) {
</a> 		return;
 	if((m = dirtomon(arg-&gt;i)) == selmon)
 		return;
<a href="#h0-9-3" id="h0-9-3" class="d">-	unfocus(selmon-&gt;sel);
</a><a href="#h0-9-4" id="h0-9-4" class="i">+	unfocus(selmon-&gt;sel, True);
</a> 	selmon = m;
 	focus(NULL);
 }
<a href="#h0-10" id="h0-10" class="h">@@ -901,15 +907,14 @@ getrootptr(int *x, int *y) {
</a> 
 long
 getstate(Window w) {
<a href="#h0-10-3" id="h0-10-3" class="d">-	int format, status;
</a><a href="#h0-10-4" id="h0-10-4" class="i">+	int format;
</a> 	long result = -1;
 	unsigned char *p = NULL;
 	unsigned long n, extra;
 	Atom real;
 
<a href="#h0-10-10" id="h0-10-10" class="d">-	status = XGetWindowProperty(dpy, w, wmatom[WMState], 0L, 2L, False, wmatom[WMState],
</a><a href="#h0-10-11" id="h0-10-11" class="d">-	                            &amp;real, &amp;format, &amp;n, &amp;extra, (unsigned char **)&amp;p);
</a><a href="#h0-10-12" id="h0-10-12" class="d">-	if(status != Success)
</a><a href="#h0-10-13" id="h0-10-13" class="i">+	if(XGetWindowProperty(dpy, w, wmatom[WMState], 0L, 2L, False, wmatom[WMState],
</a><a href="#h0-10-14" id="h0-10-14" class="i">+	                      &amp;real, &amp;format, &amp;n, &amp;extra, (unsigned char **)&amp;p) != Success)
</a> 		return -1;
 	if(n != 0)
 		result = *p;
<a href="#h0-11" id="h0-11" class="h">@@ -1110,12 +1115,13 @@ manage(Window w, XWindowAttributes *wa) {
</a> 		applyrules(c);
 	}
 	/* geometry */
<a href="#h0-11-3" id="h0-11-3" class="d">-	c-&gt;x = wa-&gt;x + c-&gt;mon-&gt;wx;
</a><a href="#h0-11-4" id="h0-11-4" class="d">-	c-&gt;y = wa-&gt;y + c-&gt;mon-&gt;wy;
</a><a href="#h0-11-5" id="h0-11-5" class="d">-	c-&gt;w = wa-&gt;width;
</a><a href="#h0-11-6" id="h0-11-6" class="d">-	c-&gt;h = wa-&gt;height;
</a><a href="#h0-11-7" id="h0-11-7" class="i">+	c-&gt;x = c-&gt;oldx = wa-&gt;x + c-&gt;mon-&gt;wx;
</a><a href="#h0-11-8" id="h0-11-8" class="i">+	c-&gt;y = c-&gt;oldy = wa-&gt;y + c-&gt;mon-&gt;wy;
</a><a href="#h0-11-9" id="h0-11-9" class="i">+	c-&gt;w = c-&gt;oldw = wa-&gt;width;
</a><a href="#h0-11-10" id="h0-11-10" class="i">+	c-&gt;h = c-&gt;oldh = wa-&gt;height;
</a> 	c-&gt;oldbw = wa-&gt;border_width;
 	if(c-&gt;w == c-&gt;mon-&gt;mw &amp;&amp; c-&gt;h == c-&gt;mon-&gt;mh) {
<a href="#h0-11-13" id="h0-11-13" class="i">+		c-&gt;isfloating = 1;
</a> 		c-&gt;x = c-&gt;mon-&gt;mx;
 		c-&gt;y = c-&gt;mon-&gt;my;
 		c-&gt;bw = 0;
<a href="#h0-12" id="h0-12" class="h">@@ -1139,7 +1145,7 @@ manage(Window w, XWindowAttributes *wa) {
</a> 	XSelectInput(dpy, w, EnterWindowMask|FocusChangeMask|PropertyChangeMask|StructureNotifyMask);
 	grabbuttons(c, False);
 	if(!c-&gt;isfloating)
<a href="#h0-12-3" id="h0-12-3" class="d">-		c-&gt;isfloating = trans != None || c-&gt;isfixed;
</a><a href="#h0-12-4" id="h0-12-4" class="i">+		c-&gt;isfloating = c-&gt;oldstate = trans != None || c-&gt;isfixed;
</a> 	if(c-&gt;isfloating)
 		XRaiseWindow(dpy, c-&gt;win);
 	attach(c);
<a href="#h0-13" id="h0-13" class="h">@@ -1292,24 +1298,61 @@ propertynotify(XEvent *e) {
</a> }
 
 void
<a href="#h0-13-3" id="h0-13-3" class="i">+clientmessage(XEvent *e) {
</a><a href="#h0-13-4" id="h0-13-4" class="i">+	XClientMessageEvent *cme = &amp;e-&gt;xclient;
</a><a href="#h0-13-5" id="h0-13-5" class="i">+	Client *c;
</a><a href="#h0-13-6" id="h0-13-6" class="i">+
</a><a href="#h0-13-7" id="h0-13-7" class="i">+	if((c = wintoclient(cme-&gt;window))
</a><a href="#h0-13-8" id="h0-13-8" class="i">+	&amp;&amp; (cme-&gt;message_type == netatom[NetWMState] &amp;&amp; cme-&gt;data.l[1] == netatom[NetWMFullscreen]))
</a><a href="#h0-13-9" id="h0-13-9" class="i">+	{
</a><a href="#h0-13-10" id="h0-13-10" class="i">+		if(cme-&gt;data.l[0]) {
</a><a href="#h0-13-11" id="h0-13-11" class="i">+			XChangeProperty(dpy, cme-&gt;window, netatom[NetWMState], XA_ATOM, 32,
</a><a href="#h0-13-12" id="h0-13-12" class="i">+			                PropModeReplace, (unsigned char*)&amp;netatom[NetWMFullscreen], 1);
</a><a href="#h0-13-13" id="h0-13-13" class="i">+			c-&gt;oldstate = c-&gt;isfloating;
</a><a href="#h0-13-14" id="h0-13-14" class="i">+			c-&gt;oldbw = c-&gt;bw;
</a><a href="#h0-13-15" id="h0-13-15" class="i">+			c-&gt;bw = 0;
</a><a href="#h0-13-16" id="h0-13-16" class="i">+			c-&gt;isfloating = 1;
</a><a href="#h0-13-17" id="h0-13-17" class="i">+			resizeclient(c, c-&gt;mon-&gt;mx, c-&gt;mon-&gt;my, c-&gt;mon-&gt;mw, c-&gt;mon-&gt;mh);
</a><a href="#h0-13-18" id="h0-13-18" class="i">+			XRaiseWindow(dpy, c-&gt;win);
</a><a href="#h0-13-19" id="h0-13-19" class="i">+		}
</a><a href="#h0-13-20" id="h0-13-20" class="i">+		else {
</a><a href="#h0-13-21" id="h0-13-21" class="i">+			XChangeProperty(dpy, cme-&gt;window, netatom[NetWMState], XA_ATOM, 32,
</a><a href="#h0-13-22" id="h0-13-22" class="i">+			                PropModeReplace, (unsigned char*)0, 0);
</a><a href="#h0-13-23" id="h0-13-23" class="i">+			c-&gt;isfloating = c-&gt;oldstate;
</a><a href="#h0-13-24" id="h0-13-24" class="i">+			c-&gt;bw = c-&gt;oldbw;
</a><a href="#h0-13-25" id="h0-13-25" class="i">+			c-&gt;x = c-&gt;oldx;
</a><a href="#h0-13-26" id="h0-13-26" class="i">+			c-&gt;y = c-&gt;oldy;
</a><a href="#h0-13-27" id="h0-13-27" class="i">+			c-&gt;w = c-&gt;oldw;
</a><a href="#h0-13-28" id="h0-13-28" class="i">+			c-&gt;h = c-&gt;oldh;
</a><a href="#h0-13-29" id="h0-13-29" class="i">+			resizeclient(c, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h);
</a><a href="#h0-13-30" id="h0-13-30" class="i">+			arrange(c-&gt;mon);
</a><a href="#h0-13-31" id="h0-13-31" class="i">+		}
</a><a href="#h0-13-32" id="h0-13-32" class="i">+	}
</a><a href="#h0-13-33" id="h0-13-33" class="i">+}
</a><a href="#h0-13-34" id="h0-13-34" class="i">+
</a><a href="#h0-13-35" id="h0-13-35" class="i">+void
</a> quit(const Arg *arg) {
 	running = False;
 }
 
 void
 resize(Client *c, int x, int y, int w, int h, Bool interact) {
<a href="#h0-13-42" id="h0-13-42" class="i">+	if(applysizehints(c, &amp;x, &amp;y, &amp;w, &amp;h, interact))
</a><a href="#h0-13-43" id="h0-13-43" class="i">+		resizeclient(c, x, y, w, h);
</a><a href="#h0-13-44" id="h0-13-44" class="i">+}
</a><a href="#h0-13-45" id="h0-13-45" class="i">+
</a><a href="#h0-13-46" id="h0-13-46" class="i">+void
</a><a href="#h0-13-47" id="h0-13-47" class="i">+resizeclient(Client *c, int x, int y, int w, int h) {
</a> 	XWindowChanges wc;
 
<a href="#h0-13-50" id="h0-13-50" class="d">-	if(applysizehints(c, &amp;x, &amp;y, &amp;w, &amp;h, interact)) {
</a><a href="#h0-13-51" id="h0-13-51" class="d">-		c-&gt;x = wc.x = x;
</a><a href="#h0-13-52" id="h0-13-52" class="d">-		c-&gt;y = wc.y = y;
</a><a href="#h0-13-53" id="h0-13-53" class="d">-		c-&gt;w = wc.width = w;
</a><a href="#h0-13-54" id="h0-13-54" class="d">-		c-&gt;h = wc.height = h;
</a><a href="#h0-13-55" id="h0-13-55" class="d">-		wc.border_width = c-&gt;bw;
</a><a href="#h0-13-56" id="h0-13-56" class="d">-		XConfigureWindow(dpy, c-&gt;win, CWX|CWY|CWWidth|CWHeight|CWBorderWidth, &amp;wc);
</a><a href="#h0-13-57" id="h0-13-57" class="d">-		configure(c);
</a><a href="#h0-13-58" id="h0-13-58" class="d">-		XSync(dpy, False);
</a><a href="#h0-13-59" id="h0-13-59" class="d">-	}
</a><a href="#h0-13-60" id="h0-13-60" class="i">+	c-&gt;oldx = c-&gt;x; c-&gt;x = wc.x = x;
</a><a href="#h0-13-61" id="h0-13-61" class="i">+	c-&gt;oldy = c-&gt;y; c-&gt;y = wc.y = y;
</a><a href="#h0-13-62" id="h0-13-62" class="i">+	c-&gt;oldw = c-&gt;w; c-&gt;w = wc.width = w;
</a><a href="#h0-13-63" id="h0-13-63" class="i">+	c-&gt;oldh = c-&gt;h; c-&gt;h = wc.height = h;
</a><a href="#h0-13-64" id="h0-13-64" class="i">+	wc.border_width = c-&gt;bw;
</a><a href="#h0-13-65" id="h0-13-65" class="i">+	XConfigureWindow(dpy, c-&gt;win, CWX|CWY|CWWidth|CWHeight|CWBorderWidth, &amp;wc);
</a><a href="#h0-13-66" id="h0-13-66" class="i">+	configure(c);
</a><a href="#h0-13-67" id="h0-13-67" class="i">+	XSync(dpy, False);
</a> }
 
 void
<a href="#h0-14" id="h0-14" class="h">@@ -1427,7 +1470,7 @@ void
</a> sendmon(Client *c, Monitor *m) {
 	if(c-&gt;mon == m)
 		return;
<a href="#h0-14-3" id="h0-14-3" class="d">-	unfocus(c);
</a><a href="#h0-14-4" id="h0-14-4" class="i">+	unfocus(c, True);
</a> 	detach(c);
 	detachstack(c);
 	c-&gt;mon = m;
<a href="#h0-15" id="h0-15" class="h">@@ -1495,6 +1538,7 @@ setup(void) {
</a> 	netatom[NetSupported] = XInternAtom(dpy, &quot;_NET_SUPPORTED&quot;, False);
 	netatom[NetWMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
 	netatom[NetWMState] = XInternAtom(dpy, &quot;_NET_WM_STATE&quot;, False);
<a href="#h0-15-3" id="h0-15-3" class="i">+	netatom[NetWMFullscreen] = XInternAtom(dpy, &quot;_NET_WM_STATE_FULLSCREEN&quot;, False);
</a> 	/* init cursors */
 	cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
 	cursor[CurResize] = XCreateFontCursor(dpy, XC_sizing);
<a href="#h0-16" id="h0-16" class="h">@@ -1663,12 +1707,13 @@ toggleview(const Arg *arg) {
</a> }
 
 void
<a href="#h0-16-3" id="h0-16-3" class="d">-unfocus(Client *c) {
</a><a href="#h0-16-4" id="h0-16-4" class="i">+unfocus(Client *c, Bool setfocus) {
</a> 	if(!c)
 		return;
 	grabbuttons(c, False);
 	XSetWindowBorder(dpy, c-&gt;win, dc.norm[ColBorder]);
<a href="#h0-16-9" id="h0-16-9" class="d">-	XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h0-16-10" id="h0-16-10" class="i">+	if(setfocus)
</a><a href="#h0-16-11" id="h0-16-11" class="i">+		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a> }
 
 void
</pre>
</div>
</body>
</html>
