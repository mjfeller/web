<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>first step to a more flexible dotile() algorithm - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/14d05e7c725a4a07136ceb123cf760272afc1a87.html">14d05e7c725a4a07136ceb123cf760272afc1a87</a>
<b>parent</b> <a href="../commit/a118a57fe3fd13036f24ebe093a5c329608a0600.html">a118a57fe3fd13036f24ebe093a5c329608a0600</a>
<b>Author:</b> Anselm R. Garbe &lt;<a href="mailto:arg@10kloc.org">arg@10kloc.org</a>&gt;
<b>Date:</b>   Fri, 29 Sep 2006 12:38:27 +0200

first step to a more flexible dotile() algorithm
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.arg.h</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.default.h</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">config.mk</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">dwm.h</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">event.c</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">main.c</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">view.c</a></td><td> | </td><td class="num">58</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d">---------------------------</span></td></tr>
</table></pre><pre>7 files changed, 52 insertions(+), 35 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.arg.h.html">config.arg.h</a> b/<a href="../file/config.arg.h.html">config.arg.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -6,9 +6,11 @@
</a> #define TAGS \
 const char *tags[] = { &quot;dev&quot;, &quot;work&quot;, &quot;net&quot;, &quot;fnord&quot;, NULL };
 
<a href="#h0-0-3" id="h0-0-3" class="d">-#define DEFMODE			dotile /* dofloat */
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#define DEFMODE			dotile		/* dofloat */
</a> #define FLOATSYMBOL		&quot;&gt;&lt;&gt;&quot;
<a href="#h0-0-6" id="h0-0-6" class="i">+#define STACKPOS		StackRight	/* StackLeft, StackBottom */
</a> #define TILESYMBOL		&quot;[]=&quot;
<a href="#h0-0-8" id="h0-0-8" class="i">+#define VERTICALSTACK		True		/* False == horizontal stack  */
</a> 
 #define FONT			&quot;-*-terminus-medium-*-*-*-12-*-*-*-*-*-iso10646-*&quot;
 #define NORMBGCOLOR		&quot;#333333&quot;
<a href="#h0-1" id="h0-1" class="h">@@ -18,7 +20,7 @@ const char *tags[] = { &quot;dev&quot;, &quot;work&quot;, &quot;net&quot;, &quot;fnord&quot;, NULL };
</a> #define STATUSBGCOLOR		&quot;#222222&quot;
 #define STATUSFGCOLOR		&quot;#9999cc&quot;
 
<a href="#h0-1-3" id="h0-1-3" class="d">-#define MASTERW			60 /* percent */
</a><a href="#h0-1-4" id="h0-1-4" class="i">+#define MASTER			60 /* percent */
</a> #define MODKEY			Mod1Mask
 
 #define KEYS \
<b>diff --git a/<a id="h1" href="../file/config.default.h.html">config.default.h</a> b/<a href="../file/config.default.h.html">config.default.h</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -8,7 +8,9 @@ const char *tags[] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, NULL };
</a> 
 #define DEFMODE			dotile /* dofloat */
 #define FLOATSYMBOL		&quot;&gt;&lt;&gt;&quot;
<a href="#h1-0-3" id="h1-0-3" class="i">+#define STACKPOS		StackRight	/* StackLeft, StackBottom */
</a> #define TILESYMBOL		&quot;[]=&quot;
<a href="#h1-0-5" id="h1-0-5" class="i">+#define VERTICALSTACK		True		/* False == horizontal stack  */
</a> 
 #define FONT			&quot;fixed&quot;
 #define NORMBGCOLOR		&quot;#333366&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -18,7 +20,7 @@ const char *tags[] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, NULL };
</a> #define STATUSBGCOLOR		&quot;#dddddd&quot;
 #define STATUSFGCOLOR		&quot;#222222&quot;
 
<a href="#h1-1-3" id="h1-1-3" class="d">-#define MASTERW			60 /* percent */
</a><a href="#h1-1-4" id="h1-1-4" class="i">+#define MASTER			60 /* percent */
</a> #define MODKEY			Mod1Mask
 
 #define KEYS \
<b>diff --git a/<a id="h2" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,5 @@
</a> # dwm version
<a href="#h2-0-1" id="h2-0-1" class="d">-VERSION = 1.7.1
</a><a href="#h2-0-2" id="h2-0-2" class="i">+VERSION = 1.8
</a> 
 # Customize below to fit your system
 
<b>diff --git a/<a id="h3" href="../file/dwm.h.html">dwm.h</a> b/<a href="../file/dwm.h.html">dwm.h</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -48,6 +48,10 @@ enum { CurNormal, CurResize, CurMove, CurLast };	/* cursor */
</a> enum { ColFG, ColBG, ColLast };				/* color */
 
 typedef enum {
<a href="#h3-0-3" id="h3-0-3" class="i">+	StackLeft, StackBottom, StackRight
</a><a href="#h3-0-4" id="h3-0-4" class="i">+} StackPos; /* stack position*/
</a><a href="#h3-0-5" id="h3-0-5" class="i">+
</a><a href="#h3-0-6" id="h3-0-6" class="i">+typedef enum {
</a> 	TopLeft, TopRight, BotLeft, BotRight
 } Corner; /* window corners */
 
<a href="#h3-1" id="h3-1" class="h">@@ -97,16 +101,18 @@ struct Client {
</a> extern const char *tags[];			/* all tags */
 extern char stext[1024];			/* status text */
 extern int bx, by, bw, bh, bmw;			/* bar geometry, bar mode label width */
<a href="#h3-1-3" id="h3-1-3" class="d">-extern int mw, screen, sx, sy, sw, sh;		/* screen geometry, master width */
</a><a href="#h3-1-4" id="h3-1-4" class="i">+extern int master, screen, sx, sy, sw, sh;	/* screen geometry, master width */
</a> extern unsigned int ntags, numlockmask;		/* number of tags, dynamic lock mask */
 extern void (*handler[LASTEvent])(XEvent *);	/* event handler */
 extern void (*arrange)(Arg *);			/* arrange function, indicates mode  */
 extern Atom wmatom[WMLast], netatom[NetLast];
 extern Bool running, issel, *seltag;		/* seltag is array of Bool */
<a href="#h3-1-10" id="h3-1-10" class="i">+extern Bool isvertical;				/* stack direction */
</a> extern Client *clients, *sel, *stack;		/* global client list and stack */
 extern Cursor cursor[CurLast];
 extern DC dc;					/* global draw context */
 extern Display *dpy;
<a href="#h3-1-15" id="h3-1-15" class="i">+extern StackPos stackpos;
</a> extern Window root, barwin;
 
 /* client.c */
<b>diff --git a/<a id="h4" href="../file/event.c.html">event.c</a> b/<a href="../file/event.c.html">event.c</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -176,8 +176,11 @@ configurerequest(XEvent *e) {
</a> 		else
 			configure(c);
 		XSync(dpy, False);
<a href="#h4-0-3" id="h4-0-3" class="d">-		if(c-&gt;isfloat)
</a><a href="#h4-0-4" id="h4-0-4" class="i">+		if(c-&gt;isfloat) {
</a> 			resize(c, False, TopLeft);
<a href="#h4-0-6" id="h4-0-6" class="i">+			if(!isvisible(c))
</a><a href="#h4-0-7" id="h4-0-7" class="i">+				ban(c);
</a><a href="#h4-0-8" id="h4-0-8" class="i">+		}
</a> 		else
 			arrange(NULL);
 	}
<b>diff --git a/<a id="h5" href="../file/main.c.html">main.c</a> b/<a href="../file/main.c.html">main.c</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -19,7 +19,7 @@
</a> 
 char stext[1024];
 Bool *seltag;
<a href="#h5-0-3" id="h5-0-3" class="d">-int bx, by, bw, bh, bmw, mw, screen, sx, sy, sw, sh;
</a><a href="#h5-0-4" id="h5-0-4" class="i">+int bx, by, bw, bh, bmw, master, screen, sx, sy, sw, sh;
</a> unsigned int ntags, numlockmask;
 Atom wmatom[WMLast], netatom[NetLast];
 Bool running = True;
<a href="#h5-1" id="h5-1" class="h">@@ -133,7 +133,7 @@ setup(void) {
</a> 	sx = sy = 0;
 	sw = DisplayWidth(dpy, screen);
 	sh = DisplayHeight(dpy, screen);
<a href="#h5-1-3" id="h5-1-3" class="d">-	mw = (sw * MASTERW) / 100;
</a><a href="#h5-1-4" id="h5-1-4" class="i">+	master = ((stackpos == StackBottom ? sh - bh : sw) * MASTER) / 100;
</a> 
 	bx = by = 0;
 	bw = sw;
<b>diff --git a/<a id="h6" href="../file/view.c.html">view.c</a> b/<a href="../file/view.c.html">view.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -65,6 +65,8 @@ togglemax(Client *c)
</a> /* extern */
 
 void (*arrange)(Arg *) = DEFMODE;
<a href="#h6-0-3" id="h6-0-3" class="i">+Bool isvertical = VERTICALSTACK;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+StackPos stackpos = STACKPOS;
</a> 
 void
 detach(Client *c) {
<a href="#h6-1" id="h6-1" class="h">@@ -97,35 +99,37 @@ dofloat(Arg *arg) {
</a> 
 /* This algorithm is based on a (M)aster area and a (S)tacking area.
  * It supports following arrangements:
<a href="#h6-1-3" id="h6-1-3" class="d">- *
</a><a href="#h6-1-4" id="h6-1-4" class="d">- * 	MMMS		MMMM
</a><a href="#h6-1-5" id="h6-1-5" class="d">- * 	MMMS		MMMM
</a><a href="#h6-1-6" id="h6-1-6" class="d">- * 	MMMS		SSSS
</a><a href="#h6-1-7" id="h6-1-7" class="d">- *
</a><a href="#h6-1-8" id="h6-1-8" class="d">- * The stacking area can be set to arrange clients vertically or horizontally.
</a><a href="#h6-1-9" id="h6-1-9" class="d">- * Through inverting the algorithm it can be used to achieve following setup in
</a><a href="#h6-1-10" id="h6-1-10" class="d">- * a dual head environment (due to running two dwm instances concurrently on
</a><a href="#h6-1-11" id="h6-1-11" class="d">- * the specific screen):
</a><a href="#h6-1-12" id="h6-1-12" class="d">- *
</a><a href="#h6-1-13" id="h6-1-13" class="d">- * 	SMM MMS		MMM MMM
</a><a href="#h6-1-14" id="h6-1-14" class="d">- * 	SMM MMS		MMM MMM
</a><a href="#h6-1-15" id="h6-1-15" class="d">- * 	SMM MMS		SSS SSS
</a><a href="#h6-1-16" id="h6-1-16" class="d">- *
</a><a href="#h6-1-17" id="h6-1-17" class="d">- * This uses the center of the two screens for master areas.
</a><a href="#h6-1-18" id="h6-1-18" class="i">+ * 	MMMS		MMMM		SMMM
</a><a href="#h6-1-19" id="h6-1-19" class="i">+ * 	MMMS		MMMM		SMMM
</a><a href="#h6-1-20" id="h6-1-20" class="i">+ * 	MMMS		SSSS		SMMM
</a>  */
 void
 dotile(Arg *arg) {
 	int h, i, n, w;
 	Client *c;
 
<a href="#h6-1-27" id="h6-1-27" class="d">-	w = sw - mw;
</a> 	for(n = 0, c = nexttiled(clients); c; c = nexttiled(c-&gt;next))
 		n++;
 
<a href="#h6-1-31" id="h6-1-31" class="d">-	if(n &gt; 1)
</a><a href="#h6-1-32" id="h6-1-32" class="d">-		h = (sh - bh) / (n - 1);
</a><a href="#h6-1-33" id="h6-1-33" class="d">-	else
</a><a href="#h6-1-34" id="h6-1-34" class="d">-		h = sh - bh;
</a><a href="#h6-1-35" id="h6-1-35" class="i">+	if(isvertical) {
</a><a href="#h6-1-36" id="h6-1-36" class="i">+		if(stackpos == StackBottom) {
</a><a href="#h6-1-37" id="h6-1-37" class="i">+			w = sw;
</a><a href="#h6-1-38" id="h6-1-38" class="i">+			if(n &gt; 1)
</a><a href="#h6-1-39" id="h6-1-39" class="i">+				h = (sh - bh) / (n - 1);
</a><a href="#h6-1-40" id="h6-1-40" class="i">+			else
</a><a href="#h6-1-41" id="h6-1-41" class="i">+				h = sh - bh;
</a><a href="#h6-1-42" id="h6-1-42" class="i">+		}
</a><a href="#h6-1-43" id="h6-1-43" class="i">+		else {
</a><a href="#h6-1-44" id="h6-1-44" class="i">+			w = sw - master;
</a><a href="#h6-1-45" id="h6-1-45" class="i">+			if(n &gt; 1)
</a><a href="#h6-1-46" id="h6-1-46" class="i">+				h = (sh - bh) / (n - 1);
</a><a href="#h6-1-47" id="h6-1-47" class="i">+			else
</a><a href="#h6-1-48" id="h6-1-48" class="i">+				h = sh - bh;
</a><a href="#h6-1-49" id="h6-1-49" class="i">+		}
</a><a href="#h6-1-50" id="h6-1-50" class="i">+	}
</a><a href="#h6-1-51" id="h6-1-51" class="i">+	else { /* horizontal stack */
</a><a href="#h6-1-52" id="h6-1-52" class="i">+
</a><a href="#h6-1-53" id="h6-1-53" class="i">+	}
</a> 
 	for(i = 0, c = clients; c; c = c-&gt;next) {
 		if(isvisible(c)) {
<a href="#h6-2" id="h6-2" class="h">@@ -143,11 +147,11 @@ dotile(Arg *arg) {
</a> 			else if(i == 0) {
 				c-&gt;x = sx;
 				c-&gt;y = sy + bh;
<a href="#h6-2-3" id="h6-2-3" class="d">-				c-&gt;w = mw - 2 * BORDERPX;
</a><a href="#h6-2-4" id="h6-2-4" class="i">+				c-&gt;w = master - 2 * BORDERPX;
</a> 				c-&gt;h = sh - 2 * BORDERPX - bh;
 			}
 			else if(h &gt; bh) {
<a href="#h6-2-8" id="h6-2-8" class="d">-				c-&gt;x = sx + mw;
</a><a href="#h6-2-9" id="h6-2-9" class="i">+				c-&gt;x = sx + master;
</a> 				c-&gt;y = sy + (i - 1) * h + bh;
 				c-&gt;w = w - 2 * BORDERPX;
 				if(i + 1 == n)
<a href="#h6-3" id="h6-3" class="h">@@ -156,7 +160,7 @@ dotile(Arg *arg) {
</a> 					c-&gt;h = h - 2 * BORDERPX;
 			}
 			else { /* fallback if h &lt; bh */
<a href="#h6-3-3" id="h6-3-3" class="d">-				c-&gt;x = sx + mw;
</a><a href="#h6-3-4" id="h6-3-4" class="i">+				c-&gt;x = sx + master;
</a> 				c-&gt;y = sy + bh;
 				c-&gt;w = w - 2 * BORDERPX;
 				c-&gt;h = sh - 2 * BORDERPX - bh;
<a href="#h6-4" id="h6-4" class="h">@@ -228,14 +232,14 @@ resizecol(Arg *arg) {
</a> 		return;
 
 	if(sel == getnext(clients)) {
<a href="#h6-4-3" id="h6-4-3" class="d">-		if(mw + arg-&gt;i &gt; sw - 100 || mw + arg-&gt;i &lt; 100)
</a><a href="#h6-4-4" id="h6-4-4" class="i">+		if(master + arg-&gt;i &gt; sw - 100 || master + arg-&gt;i &lt; 100)
</a> 			return;
<a href="#h6-4-6" id="h6-4-6" class="d">-		mw += arg-&gt;i;
</a><a href="#h6-4-7" id="h6-4-7" class="i">+		master += arg-&gt;i;
</a> 	}
 	else {
<a href="#h6-4-10" id="h6-4-10" class="d">-		if(mw - arg-&gt;i &gt; sw - 100 || mw - arg-&gt;i &lt; 100)
</a><a href="#h6-4-11" id="h6-4-11" class="i">+		if(master - arg-&gt;i &gt; sw - 100 || master - arg-&gt;i &lt; 100)
</a> 			return;
<a href="#h6-4-13" id="h6-4-13" class="d">-		mw -= arg-&gt;i;
</a><a href="#h6-4-14" id="h6-4-14" class="i">+		master -= arg-&gt;i;
</a> 	}
 	arrange(NULL);
 }
</pre>
</div>
</body>
</html>
