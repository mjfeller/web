<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>changes monitor structure to be a list - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/78f56672b5164f2d8f7ecabc3be0a9bbe0ae98bf.html">78f56672b5164f2d8f7ecabc3be0a9bbe0ae98bf</a>
<b>parent</b> <a href="../commit/c2fff604a760d271c7e9311c2927954e87ac3a6e.html">c2fff604a760d271c7e9311c2927954e87ac3a6e</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Mon, 22 Jun 2009 14:58:08 +0100

changes monitor structure to be a list
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">302</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 169 insertions(+), 133 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -44,7 +44,7 @@
</a> #define BUTTONMASK              (ButtonPressMask|ButtonReleaseMask)
 #define CLEANMASK(mask)         (mask &amp; ~(numlockmask|LockMask))
 #define INRECT(X,Y,RX,RY,RW,RH) ((X) &gt;= (RX) &amp;&amp; (X) &lt; (RX) + (RW) &amp;&amp; (Y) &gt;= (RY) &amp;&amp; (Y) &lt; (RY) + (RH))
<a href="#h0-0-3" id="h0-0-3" class="d">-#define ISVISIBLE(M, C)         ((M) == (&amp;mon[C-&gt;mon]) &amp;&amp; (C-&gt;tags &amp; M-&gt;tagset[M-&gt;seltags]))
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#define ISVISIBLE(M, C)         ((M) == (C-&gt;m) &amp;&amp; (C-&gt;tags &amp; M-&gt;tagset[M-&gt;seltags]))
</a> #define LENGTH(X)               (sizeof X / sizeof X[0])
 #define MAX(A, B)               ((A) &gt; (B) ? (A) : (B))
 #define MIN(A, B)               ((A) &lt; (B) ? (A) : (B))
<a href="#h0-1" id="h0-1" class="h">@@ -77,6 +77,7 @@ typedef struct {
</a> 	const Arg arg;
 } Button;
 
<a href="#h0-1-3" id="h0-1-3" class="i">+typedef struct Monitor Monitor;
</a> typedef struct Client Client;
 struct Client {
 	char name[256];
<a href="#h0-2" id="h0-2" class="h">@@ -85,10 +86,10 @@ struct Client {
</a> 	int basew, baseh, incw, inch, maxw, maxh, minw, minh;
 	int bw, oldbw;
 	unsigned int tags;
<a href="#h0-2-3" id="h0-2-3" class="d">-	unsigned int mon;
</a> 	Bool isfixed, isfloating, isurgent;
 	Client *next;
 	Client *snext;
<a href="#h0-2-7" id="h0-2-7" class="i">+	Monitor *m;
</a> 	Window win;
 };
 
<a href="#h0-3" id="h0-3" class="h">@@ -115,7 +116,12 @@ typedef struct {
</a> } Key;
 
 typedef struct {
<a href="#h0-3-3" id="h0-3-3" class="d">-	char symbol[4];
</a><a href="#h0-3-4" id="h0-3-4" class="i">+	const char *symbol;
</a><a href="#h0-3-5" id="h0-3-5" class="i">+	void (*arrange)(Monitor *);
</a><a href="#h0-3-6" id="h0-3-6" class="i">+} Layout;
</a><a href="#h0-3-7" id="h0-3-7" class="i">+
</a><a href="#h0-3-8" id="h0-3-8" class="i">+struct Monitor {
</a><a href="#h0-3-9" id="h0-3-9" class="i">+	int screen_number;
</a> 	float mfact;
 	int by, btx;          /* bar geometry */
 	int wx, wy, ww, wh;   /* window area  */
<a href="#h0-4" id="h0-4" class="h">@@ -125,12 +131,8 @@ typedef struct {
</a> 	Bool showbar;
 	Bool topbar;
 	Window barwin;
<a href="#h0-4-3" id="h0-4-3" class="d">-} Monitor;
</a><a href="#h0-4-4" id="h0-4-4" class="d">-
</a><a href="#h0-4-5" id="h0-4-5" class="d">-typedef struct {
</a><a href="#h0-4-6" id="h0-4-6" class="d">-	const char *symbol;
</a><a href="#h0-4-7" id="h0-4-7" class="d">-	void (*arrange)(Monitor *);
</a><a href="#h0-4-8" id="h0-4-8" class="d">-} Layout;
</a><a href="#h0-4-9" id="h0-4-9" class="i">+	Monitor *next;
</a><a href="#h0-4-10" id="h0-4-10" class="i">+};
</a> 
 typedef struct {
 	const char *class;
<a href="#h0-5" id="h0-5" class="h">@@ -149,6 +151,7 @@ static void attachstack(Client *c);
</a> static void buttonpress(XEvent *e);
 static void checkotherwm(void);
 static void cleanup(void);
<a href="#h0-5-3" id="h0-5-3" class="i">+static void cleanupmons(void);
</a> static void clearurgent(Client *c);
 static void configure(Client *c);
 static void configurenotify(XEvent *e);
<a href="#h0-6" id="h0-6" class="h">@@ -206,6 +209,7 @@ static void toggleview(const Arg *arg);
</a> static void unmanage(Client *c);
 static void unmapnotify(XEvent *e);
 static void updategeom(void);
<a href="#h0-6-3" id="h0-6-3" class="i">+static void updatebars(void);
</a> static void updatenumlockmask(void);
 static void updatesizehints(Client *c);
 static void updatestatus(void);
<a href="#h0-7" id="h0-7" class="h">@@ -252,8 +256,7 @@ static Cursor cursor[CurLast];
</a> static Display *dpy;
 static DC dc;
 static Layout *lt[] = { NULL, NULL };
<a href="#h0-7-3" id="h0-7-3" class="d">-static Monitor *mon = NULL, *selmon = NULL;
</a><a href="#h0-7-4" id="h0-7-4" class="d">-static unsigned int nmons = 0;
</a><a href="#h0-7-5" id="h0-7-5" class="i">+static Monitor *mons = NULL, *selmon = NULL;
</a> static Window root;
 /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
<a href="#h0-8" id="h0-8" class="h">@@ -285,7 +288,7 @@ applyrules(Client *c) {
</a> 		if(ch.res_name)
 			XFree(ch.res_name);
 	}
<a href="#h0-8-3" id="h0-8-3" class="d">-	c-&gt;tags = c-&gt;tags &amp; TAGMASK ? c-&gt;tags &amp; TAGMASK : mon[c-&gt;mon].tagset[mon[c-&gt;mon].seltags];
</a><a href="#h0-8-4" id="h0-8-4" class="i">+	c-&gt;tags = c-&gt;tags &amp; TAGMASK ? c-&gt;tags &amp; TAGMASK : c-&gt;m-&gt;tagset[c-&gt;m-&gt;seltags];
</a> }
 
 Bool
<a href="#h0-9" id="h0-9" class="h">@@ -355,13 +358,14 @@ applysizehints(Client *c, int *x, int *y, int *w, int *h) {
</a> 
 void
 arrange(void) {
<a href="#h0-9-3" id="h0-9-3" class="d">-	unsigned int i;
</a><a href="#h0-9-4" id="h0-9-4" class="i">+	Monitor *m;
</a><a href="#h0-9-5" id="h0-9-5" class="i">+
</a> 	showhide(stack);
 	focus(NULL);
<a href="#h0-9-8" id="h0-9-8" class="d">-	for(i = 0; i &lt; nmons; i++) {
</a><a href="#h0-9-9" id="h0-9-9" class="d">-		if(lt[mon[i].sellt]-&gt;arrange)
</a><a href="#h0-9-10" id="h0-9-10" class="d">-			lt[mon[i].sellt]-&gt;arrange(&amp;mon[i]);
</a><a href="#h0-9-11" id="h0-9-11" class="d">-		restack(&amp;mon[i]);
</a><a href="#h0-9-12" id="h0-9-12" class="i">+	for(m = mons; m; m = m-&gt;next) {
</a><a href="#h0-9-13" id="h0-9-13" class="i">+		if(lt[m-&gt;sellt]-&gt;arrange)
</a><a href="#h0-9-14" id="h0-9-14" class="i">+			lt[m-&gt;sellt]-&gt;arrange(m);
</a><a href="#h0-9-15" id="h0-9-15" class="i">+		restack(m);
</a> 	}
 }
 
<a href="#h0-10" id="h0-10" class="h">@@ -429,7 +433,6 @@ checkotherwm(void) {
</a> 
 void
 cleanup(void) {
<a href="#h0-10-3" id="h0-10-3" class="d">-	unsigned int i;
</a> 	Arg a = {.ui = ~0};
 	Layout foo = { &quot;&quot;, NULL };
 
<a href="#h0-11" id="h0-11" class="h">@@ -447,14 +450,25 @@ cleanup(void) {
</a> 	XFreeCursor(dpy, cursor[CurNormal]);
 	XFreeCursor(dpy, cursor[CurResize]);
 	XFreeCursor(dpy, cursor[CurMove]);
<a href="#h0-11-3" id="h0-11-3" class="d">-	for(i = 0; i &lt; nmons; i++)
</a><a href="#h0-11-4" id="h0-11-4" class="d">-		XDestroyWindow(dpy, mon[i].barwin);
</a><a href="#h0-11-5" id="h0-11-5" class="d">-	free(mon);
</a><a href="#h0-11-6" id="h0-11-6" class="i">+	cleanupmons();
</a> 	XSync(dpy, False);
 	XSetInputFocus(dpy, PointerRoot, RevertToPointerRoot, CurrentTime);
 }
 
 void
<a href="#h0-11-12" id="h0-11-12" class="i">+cleanupmons(void) {
</a><a href="#h0-11-13" id="h0-11-13" class="i">+	Monitor *m;
</a><a href="#h0-11-14" id="h0-11-14" class="i">+
</a><a href="#h0-11-15" id="h0-11-15" class="i">+	while(mons) {
</a><a href="#h0-11-16" id="h0-11-16" class="i">+		m = mons-&gt;next;
</a><a href="#h0-11-17" id="h0-11-17" class="i">+		XUnmapWindow(dpy, mons-&gt;barwin);
</a><a href="#h0-11-18" id="h0-11-18" class="i">+		XDestroyWindow(dpy, mons-&gt;barwin);
</a><a href="#h0-11-19" id="h0-11-19" class="i">+		free(mons);
</a><a href="#h0-11-20" id="h0-11-20" class="i">+		mons = m;
</a><a href="#h0-11-21" id="h0-11-21" class="i">+	}
</a><a href="#h0-11-22" id="h0-11-22" class="i">+}
</a><a href="#h0-11-23" id="h0-11-23" class="i">+
</a><a href="#h0-11-24" id="h0-11-24" class="i">+void
</a> clearurgent(Client *c) {
 	XWMHints *wmh;
 
<a href="#h0-12" id="h0-12" class="h">@@ -486,7 +500,7 @@ configure(Client *c) {
</a> 
 void
 configurenotify(XEvent *e) {
<a href="#h0-12-3" id="h0-12-3" class="d">-	unsigned int i;
</a><a href="#h0-12-4" id="h0-12-4" class="i">+	Monitor *m;
</a> 	XConfigureEvent *ev = &amp;e-&gt;xconfigure;
 
 	if(ev-&gt;window == root &amp;&amp; (ev-&gt;width != sw || ev-&gt;height != sh)) {
<a href="#h0-13" id="h0-13" class="h">@@ -496,8 +510,9 @@ configurenotify(XEvent *e) {
</a> 		if(dc.drawable != 0)
 			XFreePixmap(dpy, dc.drawable);
 		dc.drawable = XCreatePixmap(dpy, root, sw, bh, DefaultDepth(dpy, screen));
<a href="#h0-13-3" id="h0-13-3" class="d">-		for(i = 0; i &lt; nmons; i++)
</a><a href="#h0-13-4" id="h0-13-4" class="d">-			XMoveResizeWindow(dpy, mon[i].barwin, mon[i].wx, mon[i].by, mon[i].ww, bh);
</a><a href="#h0-13-5" id="h0-13-5" class="i">+		updatebars();
</a><a href="#h0-13-6" id="h0-13-6" class="i">+		for(m = mons; m; m = m-&gt;next)
</a><a href="#h0-13-7" id="h0-13-7" class="i">+			XMoveResizeWindow(dpy, m-&gt;barwin, m-&gt;wx, m-&gt;by, m-&gt;ww, bh);
</a> 		arrange();
 	}
 }
<a href="#h0-14" id="h0-14" class="h">@@ -526,7 +541,7 @@ configurerequest(XEvent *e) {
</a> 				c-&gt;y = sy + (sh / 2 - c-&gt;h / 2); /* center in y direction */
 			if((ev-&gt;value_mask &amp; (CWX|CWY)) &amp;&amp; !(ev-&gt;value_mask &amp; (CWWidth|CWHeight)))
 				configure(c);
<a href="#h0-14-3" id="h0-14-3" class="d">-			if(ISVISIBLE((&amp;mon[c-&gt;mon]), c))
</a><a href="#h0-14-4" id="h0-14-4" class="i">+			if(ISVISIBLE((c-&gt;m), c))
</a> 				XMoveResizeWindow(dpy, c-&gt;win, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h);
 		}
 		else
<a href="#h0-15" id="h0-15" class="h">@@ -588,7 +603,7 @@ drawbar(Monitor *m) {
</a> 	Client *c;
 
 	for(c = clients; c; c = c-&gt;next) {
<a href="#h0-15-3" id="h0-15-3" class="d">-		if(m == &amp;mon[c-&gt;mon]) {
</a><a href="#h0-15-4" id="h0-15-4" class="i">+		if(m == c-&gt;m) {
</a> 			occ |= c-&gt;tags;
 			if(c-&gt;isurgent)
 				urg |= c-&gt;tags;
<a href="#h0-16" id="h0-16" class="h">@@ -598,9 +613,11 @@ drawbar(Monitor *m) {
</a> 	dc.x = 0;
 #ifdef XINERAMA
 	{
<a href="#h0-16-3" id="h0-16-3" class="i">+		/*
</a> 		dc.w = TEXTW(m-&gt;symbol);
<a href="#h0-16-5" id="h0-16-5" class="d">-		drawtext(m-&gt;symbol, selmon == m ? dc.sel : dc.norm, False);
</a><a href="#h0-16-6" id="h0-16-6" class="i">+		drawtext(NULL, selmon == m ? dc.sel : dc.norm, False);
</a> 		dc.x += dc.w;
<a href="#h0-16-8" id="h0-16-8" class="i">+		*/
</a> 	}
 #endif /* XINERAMA */
 	m-&gt;btx = dc.x;
<a href="#h0-17" id="h0-17" class="h">@@ -648,10 +665,10 @@ drawbar(Monitor *m) {
</a> 
 void
 drawbars() {
<a href="#h0-17-3" id="h0-17-3" class="d">-	unsigned int i;
</a><a href="#h0-17-4" id="h0-17-4" class="i">+	Monitor *m;
</a> 
<a href="#h0-17-6" id="h0-17-6" class="d">-	for(i = 0; i &lt; nmons; i++)
</a><a href="#h0-17-7" id="h0-17-7" class="d">-		drawbar(&amp;mon[i]);
</a><a href="#h0-17-8" id="h0-17-8" class="i">+	for(m = mons; m; m = m-&gt;next)
</a><a href="#h0-17-9" id="h0-17-9" class="i">+		drawbar(m);
</a> }
 
 void
<a href="#h0-18" id="h0-18" class="h">@@ -718,20 +735,20 @@ enternotify(XEvent *e) {
</a> 
 void
 expose(XEvent *e) {
<a href="#h0-18-3" id="h0-18-3" class="d">-	unsigned int i;
</a><a href="#h0-18-4" id="h0-18-4" class="i">+	Monitor *m;
</a> 	XExposeEvent *ev = &amp;e-&gt;xexpose;
 
 	if(ev-&gt;count == 0)
<a href="#h0-18-8" id="h0-18-8" class="d">-		for(i = 0; i &lt; nmons; i++)
</a><a href="#h0-18-9" id="h0-18-9" class="d">-			if(ev-&gt;window == mon[i].barwin) {
</a><a href="#h0-18-10" id="h0-18-10" class="d">-				drawbar(&amp;mon[i]);
</a><a href="#h0-18-11" id="h0-18-11" class="i">+		for(m = mons; m; m = m-&gt;next)
</a><a href="#h0-18-12" id="h0-18-12" class="i">+			if(ev-&gt;window == m-&gt;barwin) {
</a><a href="#h0-18-13" id="h0-18-13" class="i">+				drawbar(m);
</a> 				break;
 			}
 }
 
 void
 focus(Client *c) {
<a href="#h0-18-20" id="h0-18-20" class="d">-	if(!c || !ISVISIBLE((&amp;mon[c-&gt;mon]), c))
</a><a href="#h0-18-21" id="h0-18-21" class="i">+	if(!c || !ISVISIBLE((c-&gt;m), c))
</a> 		for(c = stack; c &amp;&amp; !ISVISIBLE(selmon, c); c = c-&gt;snext);
 	if(sel &amp;&amp; sel != c) {
 		grabbuttons(sel, False);
<a href="#h0-19" id="h0-19" class="h">@@ -763,11 +780,16 @@ focusin(XEvent *e) { /* there are some broken focus acquiring clients */
</a> #ifdef XINERAMA
 void
 focusmon(const Arg *arg) {
<a href="#h0-19-3" id="h0-19-3" class="d">-	if(arg-&gt;ui &gt;= nmons)
</a><a href="#h0-19-4" id="h0-19-4" class="d">-		return;
</a><a href="#h0-19-5" id="h0-19-5" class="d">-	selmon = &amp;mon[arg-&gt;ui];
</a><a href="#h0-19-6" id="h0-19-6" class="d">-	focus(NULL);
</a><a href="#h0-19-7" id="h0-19-7" class="d">-	drawbars();
</a><a href="#h0-19-8" id="h0-19-8" class="i">+	unsigned int i;
</a><a href="#h0-19-9" id="h0-19-9" class="i">+	Monitor *m; 
</a><a href="#h0-19-10" id="h0-19-10" class="i">+
</a><a href="#h0-19-11" id="h0-19-11" class="i">+	for(i = 0, m = mons; m; m = m-&gt;next, i++)
</a><a href="#h0-19-12" id="h0-19-12" class="i">+		if(i == arg-&gt;ui) {
</a><a href="#h0-19-13" id="h0-19-13" class="i">+			selmon = m;
</a><a href="#h0-19-14" id="h0-19-14" class="i">+			focus(NULL);
</a><a href="#h0-19-15" id="h0-19-15" class="i">+			drawbars();
</a><a href="#h0-19-16" id="h0-19-16" class="i">+			break;
</a><a href="#h0-19-17" id="h0-19-17" class="i">+		}
</a> }
 #endif /* XINERAMA */
 
<a href="#h0-20" id="h0-20" class="h">@@ -993,7 +1015,7 @@ manage(Window w, XWindowAttributes *wa) {
</a> 		die(&quot;fatal: could not malloc() %u bytes\n&quot;, sizeof(Client));
 	*c = cz;
 	c-&gt;win = w;
<a href="#h0-20-3" id="h0-20-3" class="d">-	for(c-&gt;mon = 0; selmon != &amp;mon[c-&gt;mon]; c-&gt;mon++);
</a><a href="#h0-20-4" id="h0-20-4" class="i">+	c-&gt;m = selmon;
</a> 
 	/* geometry */
 	c-&gt;x = wa-&gt;x;
<a href="#h0-21" id="h0-21" class="h">@@ -1356,7 +1378,7 @@ setup(void) {
</a> 	netatom[NetWMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
 
 	/* init cursors */
<a href="#h0-21-3" id="h0-21-3" class="d">-	wa.cursor = cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
</a><a href="#h0-21-4" id="h0-21-4" class="i">+	cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
</a> 	cursor[CurResize] = XCreateFontCursor(dpy, XC_sizing);
 	cursor[CurMove] = XCreateFontCursor(dpy, XC_fleur);
 
<a href="#h0-22" id="h0-22" class="h">@@ -1374,22 +1396,11 @@ setup(void) {
</a> 		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
 
 	/* init bars */
<a href="#h0-22-3" id="h0-22-3" class="d">-	wa.override_redirect = True;
</a><a href="#h0-22-4" id="h0-22-4" class="d">-	wa.background_pixmap = ParentRelative;
</a><a href="#h0-22-5" id="h0-22-5" class="d">-	wa.event_mask = ButtonPressMask|ExposureMask;
</a> 	for(blw = i = 0; LENGTH(layouts) &gt; 1 &amp;&amp; i &lt; LENGTH(layouts); i++) {
 		w = TEXTW(layouts[i].symbol);
 		blw = MAX(blw, w);
 	}
<a href="#h0-22-10" id="h0-22-10" class="d">-
</a><a href="#h0-22-11" id="h0-22-11" class="d">-	for(i = 0; i &lt; nmons; i++) {
</a><a href="#h0-22-12" id="h0-22-12" class="d">-		mon[i].barwin = XCreateWindow(dpy, root, mon[i].wx, mon[i].by, mon[i].ww, bh, 0, DefaultDepth(dpy, screen),
</a><a href="#h0-22-13" id="h0-22-13" class="d">-
</a><a href="#h0-22-14" id="h0-22-14" class="d">-		                              CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h0-22-15" id="h0-22-15" class="d">-		                              CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
</a><a href="#h0-22-16" id="h0-22-16" class="d">-		XDefineCursor(dpy, mon[i].barwin, cursor[CurNormal]);
</a><a href="#h0-22-17" id="h0-22-17" class="d">-		XMapRaised(dpy, mon[i].barwin);
</a><a href="#h0-22-18" id="h0-22-18" class="d">-	}
</a><a href="#h0-22-19" id="h0-22-19" class="i">+	updatebars();
</a> 	updatestatus();
 
 	/* EWMH support per view */
<a href="#h0-23" id="h0-23" class="h">@@ -1410,9 +1421,9 @@ void
</a> showhide(Client *c) {
 	if(!c)
 		return;
<a href="#h0-23-3" id="h0-23-3" class="d">-	if(ISVISIBLE((&amp;mon[c-&gt;mon]), c)) { /* show clients top down */
</a><a href="#h0-23-4" id="h0-23-4" class="i">+	if(ISVISIBLE((c-&gt;m), c)) { /* show clients top down */
</a> 		XMoveWindow(dpy, c-&gt;win, c-&gt;x, c-&gt;y);
<a href="#h0-23-6" id="h0-23-6" class="d">-		if(!lt[mon[c-&gt;mon].sellt]-&gt;arrange || c-&gt;isfloating)
</a><a href="#h0-23-7" id="h0-23-7" class="i">+		if(!lt[c-&gt;m-&gt;sellt]-&gt;arrange || c-&gt;isfloating)
</a> 			resize(c, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h);
 		showhide(c-&gt;snext);
 	}
<a href="#h0-24" id="h0-24" class="h">@@ -1453,10 +1464,15 @@ tag(const Arg *arg) {
</a> #ifdef XINERAMA
 void
 tagmon(const Arg *arg) {
<a href="#h0-24-3" id="h0-24-3" class="d">-	if(!sel || arg-&gt;ui &gt;= nmons)
</a><a href="#h0-24-4" id="h0-24-4" class="d">-		return;
</a><a href="#h0-24-5" id="h0-24-5" class="d">-	sel-&gt;mon = arg-&gt;ui;
</a><a href="#h0-24-6" id="h0-24-6" class="d">-	arrange();
</a><a href="#h0-24-7" id="h0-24-7" class="i">+	unsigned int i;
</a><a href="#h0-24-8" id="h0-24-8" class="i">+	Monitor *m;
</a><a href="#h0-24-9" id="h0-24-9" class="i">+
</a><a href="#h0-24-10" id="h0-24-10" class="i">+	for(i = 0, m = mons; m; m = m-&gt;next, i++)
</a><a href="#h0-24-11" id="h0-24-11" class="i">+		if(i == arg-&gt;ui) {
</a><a href="#h0-24-12" id="h0-24-12" class="i">+			sel-&gt;m = m;
</a><a href="#h0-24-13" id="h0-24-13" class="i">+			arrange();
</a><a href="#h0-24-14" id="h0-24-14" class="i">+			break;
</a><a href="#h0-24-15" id="h0-24-15" class="i">+		}
</a> }
 #endif /* XINERAMA */
 
<a href="#h0-25" id="h0-25" class="h">@@ -1579,91 +1595,111 @@ unmapnotify(XEvent *e) {
</a> }
 
 void
<a href="#h0-25-3" id="h0-25-3" class="i">+updatebars(void) {
</a><a href="#h0-25-4" id="h0-25-4" class="i">+	Monitor *m;
</a><a href="#h0-25-5" id="h0-25-5" class="i">+	XSetWindowAttributes wa;
</a><a href="#h0-25-6" id="h0-25-6" class="i">+
</a><a href="#h0-25-7" id="h0-25-7" class="i">+	wa.cursor = cursor[CurNormal];
</a><a href="#h0-25-8" id="h0-25-8" class="i">+	wa.override_redirect = True;
</a><a href="#h0-25-9" id="h0-25-9" class="i">+	wa.background_pixmap = ParentRelative;
</a><a href="#h0-25-10" id="h0-25-10" class="i">+	wa.event_mask = ButtonPressMask|ExposureMask;
</a><a href="#h0-25-11" id="h0-25-11" class="i">+
</a><a href="#h0-25-12" id="h0-25-12" class="i">+	for(m = mons; m; m = m-&gt;next) {
</a><a href="#h0-25-13" id="h0-25-13" class="i">+		m-&gt;barwin = XCreateWindow(dpy, root, m-&gt;wx, m-&gt;by, m-&gt;ww, bh, 0, DefaultDepth(dpy, screen),
</a><a href="#h0-25-14" id="h0-25-14" class="i">+
</a><a href="#h0-25-15" id="h0-25-15" class="i">+		                          CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h0-25-16" id="h0-25-16" class="i">+		                          CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
</a><a href="#h0-25-17" id="h0-25-17" class="i">+		XDefineCursor(dpy, m-&gt;barwin, cursor[CurNormal]);
</a><a href="#h0-25-18" id="h0-25-18" class="i">+		XMapRaised(dpy, m-&gt;barwin);
</a><a href="#h0-25-19" id="h0-25-19" class="i">+	}
</a><a href="#h0-25-20" id="h0-25-20" class="i">+}
</a><a href="#h0-25-21" id="h0-25-21" class="i">+
</a><a href="#h0-25-22" id="h0-25-22" class="i">+void
</a> updategeom(void) {
<a href="#h0-25-24" id="h0-25-24" class="d">-#ifdef XINERAMA
</a><a href="#h0-25-25" id="h0-25-25" class="d">-	int n;
</a><a href="#h0-25-26" id="h0-25-26" class="d">-	unsigned int i = 0;
</a><a href="#h0-25-27" id="h0-25-27" class="i">+	int i, n;
</a> 	Client *c;
<a href="#h0-25-29" id="h0-25-29" class="i">+	Monitor *newmons = NULL, *m;
</a><a href="#h0-25-30" id="h0-25-30" class="i">+
</a><a href="#h0-25-31" id="h0-25-31" class="i">+#ifdef XINERAMA
</a> 	XineramaScreenInfo *info = NULL;
 
<a href="#h0-25-34" id="h0-25-34" class="d">-	/* window area geometry */
</a><a href="#h0-25-35" id="h0-25-35" class="d">-	if(XineramaIsActive(dpy) &amp;&amp; (info = XineramaQueryScreens(dpy, &amp;n))) {
</a><a href="#h0-25-36" id="h0-25-36" class="d">-		if(n != nmons) {
</a><a href="#h0-25-37" id="h0-25-37" class="d">-			for(c = clients; c; c = c-&gt;next)
</a><a href="#h0-25-38" id="h0-25-38" class="d">-				if(c-&gt;mon &gt;= n)
</a><a href="#h0-25-39" id="h0-25-39" class="d">-					c-&gt;mon = n - 1;
</a><a href="#h0-25-40" id="h0-25-40" class="d">-			if(!(mon = (Monitor *)realloc(mon, sizeof(Monitor) * n)))
</a><a href="#h0-25-41" id="h0-25-41" class="d">-				die(&quot;fatal: could not realloc() %u bytes\n&quot;, sizeof(Monitor) * nmons);
</a><a href="#h0-25-42" id="h0-25-42" class="d">-			selmon = NULL;
</a><a href="#h0-25-43" id="h0-25-43" class="d">-		}
</a><a href="#h0-25-44" id="h0-25-44" class="d">-		for(i = 0; i &lt; n ; i++) {
</a><a href="#h0-25-45" id="h0-25-45" class="d">-			/* TODO: consider re-using XineramaScreenInfo */
</a><a href="#h0-25-46" id="h0-25-46" class="d">-			mon[i].symbol[0] = &#39;[&#39;;
</a><a href="#h0-25-47" id="h0-25-47" class="d">-			mon[i].symbol[1] = &#39;0&#39; + info[i].screen_number;
</a><a href="#h0-25-48" id="h0-25-48" class="d">-			mon[i].symbol[2] = &#39;]&#39;;
</a><a href="#h0-25-49" id="h0-25-49" class="d">-			mon[i].symbol[3] = 0;
</a><a href="#h0-25-50" id="h0-25-50" class="d">-			if(!selmon) { /* not initialised yet */
</a><a href="#h0-25-51" id="h0-25-51" class="d">-				mon[i].mfact = mfact;
</a><a href="#h0-25-52" id="h0-25-52" class="d">-				mon[i].showbar = showbar;
</a><a href="#h0-25-53" id="h0-25-53" class="d">-				mon[i].topbar = topbar;
</a><a href="#h0-25-54" id="h0-25-54" class="d">-				mon[i].tagset[0] = mon[i].tagset[1] = 1;
</a><a href="#h0-25-55" id="h0-25-55" class="d">-			}
</a><a href="#h0-25-56" id="h0-25-56" class="d">-			mon[i].wx = info[i].x_org;
</a><a href="#h0-25-57" id="h0-25-57" class="d">-			mon[i].wy = mon[i].showbar &amp;&amp; mon[i].topbar ? info[i].y_org + bh : info[i].y_org;
</a><a href="#h0-25-58" id="h0-25-58" class="d">-			mon[i].ww = info[i].width;
</a><a href="#h0-25-59" id="h0-25-59" class="d">-			mon[i].wh = mon[i].showbar ? info[i].height - bh : info[i].height;
</a><a href="#h0-25-60" id="h0-25-60" class="d">-			mon[i].seltags = 0;
</a><a href="#h0-25-61" id="h0-25-61" class="d">-			mon[i].sellt = 0;
</a><a href="#h0-25-62" id="h0-25-62" class="d">-			if(mon[i].showbar)
</a><a href="#h0-25-63" id="h0-25-63" class="d">-				mon[i].by = mon[i].topbar ? info[i].y_org : mon[i].wy + mon[i].wh;
</a><a href="#h0-25-64" id="h0-25-64" class="d">-			else
</a><a href="#h0-25-65" id="h0-25-65" class="d">-				mon[i].by = -bh;
</a><a href="#h0-25-66" id="h0-25-66" class="d">-		}
</a><a href="#h0-25-67" id="h0-25-67" class="d">-		nmons = (unsigned int)n;
</a><a href="#h0-25-68" id="h0-25-68" class="d">-		if(!selmon) {
</a><a href="#h0-25-69" id="h0-25-69" class="d">-			selmon = &amp;mon[0];
</a><a href="#h0-25-70" id="h0-25-70" class="d">-			int di, x, y;
</a><a href="#h0-25-71" id="h0-25-71" class="d">-			unsigned int dui;
</a><a href="#h0-25-72" id="h0-25-72" class="d">-			Window dummy;
</a><a href="#h0-25-73" id="h0-25-73" class="d">-			if(XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, &amp;x, &amp;y, &amp;di, &amp;di, &amp;dui)) 
</a><a href="#h0-25-74" id="h0-25-74" class="d">-				for(i = 0; i &lt; nmons; i++)
</a><a href="#h0-25-75" id="h0-25-75" class="d">-					if(INRECT(x, y, info[i].x_org, info[i].y_org, info[i].width, info[i].height)) {
</a><a href="#h0-25-76" id="h0-25-76" class="d">-						selmon = &amp;mon[i];
</a><a href="#h0-25-77" id="h0-25-77" class="d">-						break;
</a><a href="#h0-25-78" id="h0-25-78" class="d">-					}
</a><a href="#h0-25-79" id="h0-25-79" class="i">+	if(XineramaIsActive(dpy))
</a><a href="#h0-25-80" id="h0-25-80" class="i">+		info = XineramaQueryScreens(dpy, &amp;n);
</a><a href="#h0-25-81" id="h0-25-81" class="i">+#endif
</a><a href="#h0-25-82" id="h0-25-82" class="i">+	/* allocate monitor(s) for the new geometry setup */
</a><a href="#h0-25-83" id="h0-25-83" class="i">+	for(i = 0; i &lt; n; i++) {
</a><a href="#h0-25-84" id="h0-25-84" class="i">+		m = (Monitor *)malloc(sizeof(Monitor));
</a><a href="#h0-25-85" id="h0-25-85" class="i">+		m-&gt;next = newmons;
</a><a href="#h0-25-86" id="h0-25-86" class="i">+		newmons = m;
</a><a href="#h0-25-87" id="h0-25-87" class="i">+	}
</a><a href="#h0-25-88" id="h0-25-88" class="i">+
</a><a href="#h0-25-89" id="h0-25-89" class="i">+	/* initialise monitor(s) */
</a><a href="#h0-25-90" id="h0-25-90" class="i">+#ifdef XINERAMA
</a><a href="#h0-25-91" id="h0-25-91" class="i">+	if(XineramaIsActive(dpy)) {
</a><a href="#h0-25-92" id="h0-25-92" class="i">+		for(i = 0, m = newmons; m; m = m-&gt;next, i++) {
</a><a href="#h0-25-93" id="h0-25-93" class="i">+			m-&gt;screen_number = info[i].screen_number;
</a><a href="#h0-25-94" id="h0-25-94" class="i">+			m-&gt;wx = info[i].x_org;
</a><a href="#h0-25-95" id="h0-25-95" class="i">+			m-&gt;wy = info[i].y_org;
</a><a href="#h0-25-96" id="h0-25-96" class="i">+			m-&gt;ww = info[i].width;
</a><a href="#h0-25-97" id="h0-25-97" class="i">+			m-&gt;wh = info[i].height;
</a> 		}
 		XFree(info);
 	}
 	else
<a href="#h0-25-102" id="h0-25-102" class="d">-#endif /* XINERAMA */
</a><a href="#h0-25-103" id="h0-25-103" class="i">+#endif
</a><a href="#h0-25-104" id="h0-25-104" class="i">+	/* default monitor setup */
</a> 	{
<a href="#h0-25-106" id="h0-25-106" class="d">-		if(!mon) {
</a><a href="#h0-25-107" id="h0-25-107" class="d">-			nmons = 1;
</a><a href="#h0-25-108" id="h0-25-108" class="d">-			if(!(mon = (Monitor *)malloc(sizeof(Monitor))))
</a><a href="#h0-25-109" id="h0-25-109" class="d">-				die(&quot;fatal: could not malloc() %u bytes\n&quot;, sizeof(Monitor));
</a><a href="#h0-25-110" id="h0-25-110" class="d">-		}
</a><a href="#h0-25-111" id="h0-25-111" class="d">-		if(!selmon) {
</a><a href="#h0-25-112" id="h0-25-112" class="d">-			mon[0].symbol[0] = &#39;[&#39;;
</a><a href="#h0-25-113" id="h0-25-113" class="d">-			mon[0].symbol[1] = &#39;0&#39;;
</a><a href="#h0-25-114" id="h0-25-114" class="d">-			mon[0].symbol[2] = &#39;]&#39;;
</a><a href="#h0-25-115" id="h0-25-115" class="d">-			mon[0].symbol[3] = 0;
</a><a href="#h0-25-116" id="h0-25-116" class="d">-			mon[0].mfact = mfact;
</a><a href="#h0-25-117" id="h0-25-117" class="d">-			mon[0].showbar = showbar;
</a><a href="#h0-25-118" id="h0-25-118" class="d">-			mon[0].topbar = topbar;
</a><a href="#h0-25-119" id="h0-25-119" class="d">-			mon[0].tagset[0] = mon[0].tagset[1] = 1;
</a><a href="#h0-25-120" id="h0-25-120" class="i">+		m-&gt;screen_number = 0;
</a><a href="#h0-25-121" id="h0-25-121" class="i">+		m-&gt;wx = sx;
</a><a href="#h0-25-122" id="h0-25-122" class="i">+		m-&gt;wy = sy;
</a><a href="#h0-25-123" id="h0-25-123" class="i">+		m-&gt;ww = sw;
</a><a href="#h0-25-124" id="h0-25-124" class="i">+		m-&gt;wh = sh;
</a><a href="#h0-25-125" id="h0-25-125" class="i">+	}
</a><a href="#h0-25-126" id="h0-25-126" class="i">+
</a><a href="#h0-25-127" id="h0-25-127" class="i">+	/* bar geometry setup */
</a><a href="#h0-25-128" id="h0-25-128" class="i">+	for(m = newmons; m; m = m-&gt;next) {
</a><a href="#h0-25-129" id="h0-25-129" class="i">+		/* TODO: consider removing the following values from config.h */
</a><a href="#h0-25-130" id="h0-25-130" class="i">+		m-&gt;seltags = 0;
</a><a href="#h0-25-131" id="h0-25-131" class="i">+		m-&gt;sellt = 0;
</a><a href="#h0-25-132" id="h0-25-132" class="i">+		m-&gt;tagset[0] = m-&gt;tagset[1] = 1;
</a><a href="#h0-25-133" id="h0-25-133" class="i">+		m-&gt;mfact = mfact;
</a><a href="#h0-25-134" id="h0-25-134" class="i">+		m-&gt;showbar = showbar;
</a><a href="#h0-25-135" id="h0-25-135" class="i">+		m-&gt;topbar = topbar;
</a><a href="#h0-25-136" id="h0-25-136" class="i">+		if(m-&gt;showbar) {
</a><a href="#h0-25-137" id="h0-25-137" class="i">+			m-&gt;wh -= bh;
</a><a href="#h0-25-138" id="h0-25-138" class="i">+			m-&gt;by = m-&gt;topbar ? m-&gt;wy : m-&gt;wy + m-&gt;wh;
</a><a href="#h0-25-139" id="h0-25-139" class="i">+			m-&gt;wy = m-&gt;topbar ? m-&gt;wy + bh : m-&gt;wy;
</a> 		}
<a href="#h0-25-141" id="h0-25-141" class="d">-		mon[0].wx = sx;
</a><a href="#h0-25-142" id="h0-25-142" class="d">-		mon[0].wy = mon[0].showbar &amp;&amp; mon[0].topbar ? sy + bh : sy;
</a><a href="#h0-25-143" id="h0-25-143" class="d">-		mon[0].ww = sw;
</a><a href="#h0-25-144" id="h0-25-144" class="d">-		mon[0].wh = mon[0].showbar ? sh - bh : sh;
</a><a href="#h0-25-145" id="h0-25-145" class="d">-		mon[0].seltags = 0;
</a><a href="#h0-25-146" id="h0-25-146" class="d">-		mon[0].sellt = 0;
</a><a href="#h0-25-147" id="h0-25-147" class="d">-		if(mon[0].showbar)
</a><a href="#h0-25-148" id="h0-25-148" class="d">-			mon[0].by = mon[0].topbar ? sy : mon[0].wy + mon[0].wh;
</a> 		else
<a href="#h0-25-150" id="h0-25-150" class="d">-			mon[0].by = -bh;
</a><a href="#h0-25-151" id="h0-25-151" class="d">-		selmon = &amp;mon[0];
</a><a href="#h0-25-152" id="h0-25-152" class="i">+			m-&gt;by = -bh;
</a><a href="#h0-25-153" id="h0-25-153" class="i">+		/* reassign all clients with same screen number */
</a><a href="#h0-25-154" id="h0-25-154" class="i">+		for(c = clients; c; c = c-&gt;next)
</a><a href="#h0-25-155" id="h0-25-155" class="i">+			if(c-&gt;m-&gt;screen_number == m-&gt;screen_number)
</a><a href="#h0-25-156" id="h0-25-156" class="i">+				c-&gt;m = m;
</a><a href="#h0-25-157" id="h0-25-157" class="i">+	}
</a><a href="#h0-25-158" id="h0-25-158" class="i">+
</a><a href="#h0-25-159" id="h0-25-159" class="i">+	/* reassign left over clients with disappeared screen number */
</a><a href="#h0-25-160" id="h0-25-160" class="i">+	for(c = clients; c; c = c-&gt;next)
</a><a href="#h0-25-161" id="h0-25-161" class="i">+		if(c-&gt;m-&gt;screen_number &gt;= n)
</a><a href="#h0-25-162" id="h0-25-162" class="i">+			c-&gt;m = newmons;
</a><a href="#h0-25-163" id="h0-25-163" class="i">+
</a><a href="#h0-25-164" id="h0-25-164" class="i">+	/* select focused monitor */
</a><a href="#h0-25-165" id="h0-25-165" class="i">+	if(!selmon) {
</a><a href="#h0-25-166" id="h0-25-166" class="i">+		selmon = newmons;
</a><a href="#h0-25-167" id="h0-25-167" class="i">+		int di, x, y;
</a><a href="#h0-25-168" id="h0-25-168" class="i">+		unsigned int dui;
</a><a href="#h0-25-169" id="h0-25-169" class="i">+		Window dummy;
</a><a href="#h0-25-170" id="h0-25-170" class="i">+		if(XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, &amp;x, &amp;y, &amp;di, &amp;di, &amp;dui)) 
</a><a href="#h0-25-171" id="h0-25-171" class="i">+			for(m = newmons; m; m = m-&gt;next)
</a><a href="#h0-25-172" id="h0-25-172" class="i">+				if(INRECT(x, y, m-&gt;wx, m-&gt;wy, m-&gt;ww, m-&gt;wh)) {
</a><a href="#h0-25-173" id="h0-25-173" class="i">+					selmon = m;
</a><a href="#h0-25-174" id="h0-25-174" class="i">+					break;
</a><a href="#h0-25-175" id="h0-25-175" class="i">+				}
</a> 	}
<a href="#h0-25-177" id="h0-25-177" class="i">+
</a><a href="#h0-25-178" id="h0-25-178" class="i">+	/* final assignment of new monitors */
</a><a href="#h0-25-179" id="h0-25-179" class="i">+	cleanupmons();
</a><a href="#h0-25-180" id="h0-25-180" class="i">+	mons = newmons;
</a> }
 
 void
</pre>
</div>
</body>
</html>
