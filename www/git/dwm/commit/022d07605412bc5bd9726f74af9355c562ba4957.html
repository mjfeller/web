<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Button passthrough when client is not focused - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/022d07605412bc5bd9726f74af9355c562ba4957.html">022d07605412bc5bd9726f74af9355c562ba4957</a>
<b>parent</b> <a href="../commit/2952b68db88f38be8d34b80c7a7d2c7eb5b2484d.html">2952b68db88f38be8d34b80c7a7d2c7eb5b2484d</a>
<b>Author:</b> Markus Teich &lt;<a href="mailto:markus.teich@stusta.mhn.de">markus.teich@stusta.mhn.de</a>&gt;
<b>Date:</b>   Sat,  7 Jan 2017 17:21:29 +0100

Button passthrough when client is not focused

Before this change it is not possible to press a button in a client on the first
click if the client is not yet focused. The first click on the button would
only focus the client and a second click on the button is needed to activate it.
This situation can occur when moving the mouse over a client (therefore focusing
it) and then moving the focus to another client with keyboard shortcuts.

After this commit the behavior is fixed and button presses on unfocused clients
are passed to the client correctly.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++</span><span class="d">----------</span></td></tr>
</table></pre><pre>1 file changed, 11 insertions(+), 10 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -446,6 +446,8 @@ buttonpress(XEvent *e)
</a> 			click = ClkWinTitle;
 	} else if ((c = wintoclient(ev-&gt;window))) {
 		focus(c);
<a href="#h0-0-3" id="h0-0-3" class="i">+		restack(selmon);
</a><a href="#h0-0-4" id="h0-0-4" class="i">+		XAllowEvents(dpy, ReplayPointer, CurrentTime);
</a> 		click = ClkClientWin;
 	}
 	for (i = 0; i &lt; LENGTH(buttons); i++)
<a href="#h0-1" id="h0-1" class="h">@@ -932,17 +934,16 @@ grabbuttons(Client *c, int focused)
</a> 		unsigned int i, j;
 		unsigned int modifiers[] = { 0, LockMask, numlockmask, numlockmask|LockMask };
 		XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
<a href="#h0-1-3" id="h0-1-3" class="d">-		if (focused) {
</a><a href="#h0-1-4" id="h0-1-4" class="d">-			for (i = 0; i &lt; LENGTH(buttons); i++)
</a><a href="#h0-1-5" id="h0-1-5" class="d">-				if (buttons[i].click == ClkClientWin)
</a><a href="#h0-1-6" id="h0-1-6" class="d">-					for (j = 0; j &lt; LENGTH(modifiers); j++)
</a><a href="#h0-1-7" id="h0-1-7" class="d">-						XGrabButton(dpy, buttons[i].button,
</a><a href="#h0-1-8" id="h0-1-8" class="d">-						            buttons[i].mask | modifiers[j],
</a><a href="#h0-1-9" id="h0-1-9" class="d">-						            c-&gt;win, False, BUTTONMASK,
</a><a href="#h0-1-10" id="h0-1-10" class="d">-						            GrabModeAsync, GrabModeSync, None, None);
</a><a href="#h0-1-11" id="h0-1-11" class="d">-		} else
</a><a href="#h0-1-12" id="h0-1-12" class="i">+		if (!focused)
</a> 			XGrabButton(dpy, AnyButton, AnyModifier, c-&gt;win, False,
<a href="#h0-1-14" id="h0-1-14" class="d">-			            BUTTONMASK, GrabModeAsync, GrabModeSync, None, None);
</a><a href="#h0-1-15" id="h0-1-15" class="i">+			            BUTTONMASK, GrabModeSync, GrabModeSync, None, None);
</a><a href="#h0-1-16" id="h0-1-16" class="i">+		for (i = 0; i &lt; LENGTH(buttons); i++)
</a><a href="#h0-1-17" id="h0-1-17" class="i">+			if (buttons[i].click == ClkClientWin)
</a><a href="#h0-1-18" id="h0-1-18" class="i">+				for (j = 0; j &lt; LENGTH(modifiers); j++)
</a><a href="#h0-1-19" id="h0-1-19" class="i">+					XGrabButton(dpy, buttons[i].button,
</a><a href="#h0-1-20" id="h0-1-20" class="i">+					            buttons[i].mask | modifiers[j],
</a><a href="#h0-1-21" id="h0-1-21" class="i">+					            c-&gt;win, False, BUTTONMASK,
</a><a href="#h0-1-22" id="h0-1-22" class="i">+					            GrabModeAsync, GrabModeSync, None, None);
</a> 	}
 }
 
</pre>
</div>
</body>
</html>
