<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>some more rearrangements - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/9449ea3e002990372383835b85ed18ceaf75e400.html">9449ea3e002990372383835b85ed18ceaf75e400</a>
<b>parent</b> <a href="../commit/49197fe4bf023478108c76c1bed74a7d1ef138de.html">49197fe4bf023478108c76c1bed74a7d1ef138de</a>
<b>Author:</b> Anselm R. Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Sun, 16 Sep 2007 12:34:08 +0200

some more rearrangements
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">290</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 143 insertions(+), 147 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -112,14 +112,14 @@ typedef struct {
</a> 	regex_t *tagregex;
 } Regs;
 
<a href="#h0-0-3" id="h0-0-3" class="d">-/* functions */
</a><a href="#h0-0-4" id="h0-0-4" class="d">-
</a><a href="#h0-0-5" id="h0-0-5" class="i">+/* forward declarations */
</a> static void applyrules(Client *c);
 static void arrange(void);
 static void attach(Client *c);
 static void attachstack(Client *c);
 static void ban(Client *c);
 static void buttonpress(XEvent *e);
<a href="#h0-0-12" id="h0-0-12" class="i">+static void checkotherwm(void);
</a> static void cleanup(void);
 static void compileregs(void);
 static void configure(Client *c);
<a href="#h0-1" id="h0-1" class="h">@@ -140,17 +140,13 @@ static void focus(Client *c);
</a> static void focusnext(const char *arg);
 static void focusprev(const char *arg);
 static Client *getclient(Window w);
<a href="#h0-1-3" id="h0-1-3" class="i">+static unsigned long getcolor(const char *colstr);
</a> static long getstate(Window w);
 static Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 static void grabbuttons(Client *c, Bool focused);
 static unsigned int idxoftag(const char *tag);
<a href="#h0-1-8" id="h0-1-8" class="d">-static void initbar(void);
</a><a href="#h0-1-9" id="h0-1-9" class="d">-static unsigned long initcolor(const char *colstr);
</a> static void initfont(const char *fontstr);
<a href="#h0-1-11" id="h0-1-11" class="d">-static void initlayouts(void);
</a><a href="#h0-1-12" id="h0-1-12" class="d">-static void initstyle(void);
</a> static Bool isarrange(void (*func)());
<a href="#h0-1-14" id="h0-1-14" class="d">-static Bool isfloating(void);
</a> static Bool isoccupied(unsigned int t);
 static Bool isprotodel(Client *c);
 static Bool isvisible(Client *c);
<a href="#h0-2" id="h0-2" class="h">@@ -167,6 +163,7 @@ static void quit(const char *arg);
</a> static void resize(Client *c, int x, int y, int w, int h, Bool sizehints);
 static void resizemouse(Client *c);
 static void restack(void);
<a href="#h0-2-3" id="h0-2-3" class="i">+static void run(void);
</a> static void scan(void);
 static void setclientstate(Client *c, long state);
 static void setlayout(const char *arg);
<a href="#h0-3" id="h0-3" class="h">@@ -236,7 +233,7 @@ static Regs *regs = NULL;
</a> /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
 
<a href="#h0-3-3" id="h0-3-3" class="d">-/* implementation */
</a><a href="#h0-3-4" id="h0-3-4" class="i">+/* functions*/
</a> static void
 applyrules(Client *c) {
 	static char buf[512];
<a href="#h0-4" id="h0-4" class="h">@@ -338,14 +335,14 @@ buttonpress(XEvent *e) {
</a> 		focus(c);
 		if(CLEANMASK(ev-&gt;state) != MODKEY)
 			return;
<a href="#h0-4-3" id="h0-4-3" class="d">-		if(ev-&gt;button == Button1 &amp;&amp; (isfloating() || c-&gt;isfloating)) {
</a><a href="#h0-4-4" id="h0-4-4" class="i">+		if(ev-&gt;button == Button1 &amp;&amp; (isarrange(floating) || c-&gt;isfloating)) {
</a> 			restack();
 			movemouse(c);
 		}
 		else if(ev-&gt;button == Button2)
 			zoom(NULL);
 		else if(ev-&gt;button == Button3
<a href="#h0-4-11" id="h0-4-11" class="d">-		&amp;&amp; (isfloating() || c-&gt;isfloating) &amp;&amp; !c-&gt;isfixed)
</a><a href="#h0-4-12" id="h0-4-12" class="i">+		&amp;&amp; (isarrange(floating) || c-&gt;isfloating) &amp;&amp; !c-&gt;isfixed)
</a> 		{
 			restack();
 			resizemouse(c);
<a href="#h0-5" id="h0-5" class="h">@@ -354,6 +351,22 @@ buttonpress(XEvent *e) {
</a> }
 
 static void
<a href="#h0-5-3" id="h0-5-3" class="i">+checkotherwm(void) {
</a><a href="#h0-5-4" id="h0-5-4" class="i">+	otherwm = False;
</a><a href="#h0-5-5" id="h0-5-5" class="i">+	XSetErrorHandler(xerrorstart);
</a><a href="#h0-5-6" id="h0-5-6" class="i">+
</a><a href="#h0-5-7" id="h0-5-7" class="i">+	/* this causes an error if some other window manager is running */
</a><a href="#h0-5-8" id="h0-5-8" class="i">+	XSelectInput(dpy, root, SubstructureRedirectMask);
</a><a href="#h0-5-9" id="h0-5-9" class="i">+	XSync(dpy, False);
</a><a href="#h0-5-10" id="h0-5-10" class="i">+	if(otherwm)
</a><a href="#h0-5-11" id="h0-5-11" class="i">+		eprint(&quot;dwm: another window manager is already running\n&quot;);
</a><a href="#h0-5-12" id="h0-5-12" class="i">+	XSync(dpy, False);
</a><a href="#h0-5-13" id="h0-5-13" class="i">+	XSetErrorHandler(NULL);
</a><a href="#h0-5-14" id="h0-5-14" class="i">+	xerrorxlib = XSetErrorHandler(xerror);
</a><a href="#h0-5-15" id="h0-5-15" class="i">+	XSync(dpy, False);
</a><a href="#h0-5-16" id="h0-5-16" class="i">+}
</a><a href="#h0-5-17" id="h0-5-17" class="i">+
</a><a href="#h0-5-18" id="h0-5-18" class="i">+static void
</a> cleanup(void) {
 	close(STDIN_FILENO);
 	while(stack) {
<a href="#h0-6" id="h0-6" class="h">@@ -446,7 +459,7 @@ configurerequest(XEvent *e) {
</a> 		c-&gt;ismax = False;
 		if(ev-&gt;value_mask &amp; CWBorderWidth)
 			c-&gt;border = ev-&gt;border_width;
<a href="#h0-6-3" id="h0-6-3" class="d">-		if(c-&gt;isfixed || c-&gt;isfloating || isfloating()) {
</a><a href="#h0-6-4" id="h0-6-4" class="i">+		if(c-&gt;isfixed || c-&gt;isfloating || isarrange(floating)) {
</a> 			if(ev-&gt;value_mask &amp; CWX)
 				c-&gt;x = ev-&gt;x;
 			if(ev-&gt;value_mask &amp; CWY)
<a href="#h0-7" id="h0-7" class="h">@@ -728,6 +741,16 @@ getclient(Window w) {
</a> 	return c;
 }
 
<a href="#h0-7-3" id="h0-7-3" class="i">+static unsigned long
</a><a href="#h0-7-4" id="h0-7-4" class="i">+getcolor(const char *colstr) {
</a><a href="#h0-7-5" id="h0-7-5" class="i">+	Colormap cmap = DefaultColormap(dpy, screen);
</a><a href="#h0-7-6" id="h0-7-6" class="i">+	XColor color;
</a><a href="#h0-7-7" id="h0-7-7" class="i">+
</a><a href="#h0-7-8" id="h0-7-8" class="i">+	if(!XAllocNamedColor(dpy, cmap, colstr, &amp;color, &amp;color))
</a><a href="#h0-7-9" id="h0-7-9" class="i">+		eprint(&quot;error, cannot allocate color &#39;%s&#39;\n&quot;, colstr);
</a><a href="#h0-7-10" id="h0-7-10" class="i">+	return color.pixel;
</a><a href="#h0-7-11" id="h0-7-11" class="i">+}
</a><a href="#h0-7-12" id="h0-7-12" class="i">+
</a> static long
 getstate(Window w) {
 	int format, status;
<a href="#h0-8" id="h0-8" class="h">@@ -821,37 +844,6 @@ idxoftag(const char *tag) {
</a> }
 
 static void
<a href="#h0-8-3" id="h0-8-3" class="d">-initbar(void) {
</a><a href="#h0-8-4" id="h0-8-4" class="d">-	XSetWindowAttributes wa;
</a><a href="#h0-8-5" id="h0-8-5" class="d">-
</a><a href="#h0-8-6" id="h0-8-6" class="d">-	wa.override_redirect = 1;
</a><a href="#h0-8-7" id="h0-8-7" class="d">-	wa.background_pixmap = ParentRelative;
</a><a href="#h0-8-8" id="h0-8-8" class="d">-	wa.event_mask = ButtonPressMask | ExposureMask;
</a><a href="#h0-8-9" id="h0-8-9" class="d">-	barwin = XCreateWindow(dpy, root, sx, sy, sw, bh, 0,
</a><a href="#h0-8-10" id="h0-8-10" class="d">-			DefaultDepth(dpy, screen), CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h0-8-11" id="h0-8-11" class="d">-			CWOverrideRedirect | CWBackPixmap | CWEventMask, &amp;wa);
</a><a href="#h0-8-12" id="h0-8-12" class="d">-	XDefineCursor(dpy, barwin, cursor[CurNormal]);
</a><a href="#h0-8-13" id="h0-8-13" class="d">-	updatebarpos();
</a><a href="#h0-8-14" id="h0-8-14" class="d">-	XMapRaised(dpy, barwin);
</a><a href="#h0-8-15" id="h0-8-15" class="d">-	strcpy(stext, &quot;dwm-&quot;VERSION);
</a><a href="#h0-8-16" id="h0-8-16" class="d">-	dc.drawable = XCreatePixmap(dpy, root, sw, bh, DefaultDepth(dpy, screen));
</a><a href="#h0-8-17" id="h0-8-17" class="d">-	dc.gc = XCreateGC(dpy, root, 0, 0);
</a><a href="#h0-8-18" id="h0-8-18" class="d">-	XSetLineAttributes(dpy, dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h0-8-19" id="h0-8-19" class="d">-	if(!dc.font.set)
</a><a href="#h0-8-20" id="h0-8-20" class="d">-		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
</a><a href="#h0-8-21" id="h0-8-21" class="d">-}
</a><a href="#h0-8-22" id="h0-8-22" class="d">-
</a><a href="#h0-8-23" id="h0-8-23" class="d">-static unsigned long
</a><a href="#h0-8-24" id="h0-8-24" class="d">-initcolor(const char *colstr) {
</a><a href="#h0-8-25" id="h0-8-25" class="d">-	Colormap cmap = DefaultColormap(dpy, screen);
</a><a href="#h0-8-26" id="h0-8-26" class="d">-	XColor color;
</a><a href="#h0-8-27" id="h0-8-27" class="d">-
</a><a href="#h0-8-28" id="h0-8-28" class="d">-	if(!XAllocNamedColor(dpy, cmap, colstr, &amp;color, &amp;color))
</a><a href="#h0-8-29" id="h0-8-29" class="d">-		eprint(&quot;error, cannot allocate color &#39;%s&#39;\n&quot;, colstr);
</a><a href="#h0-8-30" id="h0-8-30" class="d">-	return color.pixel;
</a><a href="#h0-8-31" id="h0-8-31" class="d">-}
</a><a href="#h0-8-32" id="h0-8-32" class="d">-
</a><a href="#h0-8-33" id="h0-8-33" class="d">-static void
</a> initfont(const char *fontstr) {
 	char *def, **missing;
 	int i, n;
<a href="#h0-9" id="h0-9" class="h">@@ -893,30 +885,6 @@ initfont(const char *fontstr) {
</a> 	dc.font.height = dc.font.ascent + dc.font.descent;
 }
 
<a href="#h0-9-3" id="h0-9-3" class="d">-static void
</a><a href="#h0-9-4" id="h0-9-4" class="d">-initlayouts(void) {
</a><a href="#h0-9-5" id="h0-9-5" class="d">-	unsigned int i, w;
</a><a href="#h0-9-6" id="h0-9-6" class="d">-
</a><a href="#h0-9-7" id="h0-9-7" class="d">-	nlayouts = sizeof layouts / sizeof layouts[0];
</a><a href="#h0-9-8" id="h0-9-8" class="d">-	for(blw = i = 0; i &lt; nlayouts; i++) {
</a><a href="#h0-9-9" id="h0-9-9" class="d">-		w = textw(layouts[i].symbol);
</a><a href="#h0-9-10" id="h0-9-10" class="d">-		if(w &gt; blw)
</a><a href="#h0-9-11" id="h0-9-11" class="d">-			blw = w;
</a><a href="#h0-9-12" id="h0-9-12" class="d">-	}
</a><a href="#h0-9-13" id="h0-9-13" class="d">-}
</a><a href="#h0-9-14" id="h0-9-14" class="d">-
</a><a href="#h0-9-15" id="h0-9-15" class="d">-static void
</a><a href="#h0-9-16" id="h0-9-16" class="d">-initstyle(void) {
</a><a href="#h0-9-17" id="h0-9-17" class="d">-	dc.norm[ColBorder] = initcolor(NORMBORDERCOLOR);
</a><a href="#h0-9-18" id="h0-9-18" class="d">-	dc.norm[ColBG] = initcolor(NORMBGCOLOR);
</a><a href="#h0-9-19" id="h0-9-19" class="d">-	dc.norm[ColFG] = initcolor(NORMFGCOLOR);
</a><a href="#h0-9-20" id="h0-9-20" class="d">-	dc.sel[ColBorder] = initcolor(SELBORDERCOLOR);
</a><a href="#h0-9-21" id="h0-9-21" class="d">-	dc.sel[ColBG] = initcolor(SELBGCOLOR);
</a><a href="#h0-9-22" id="h0-9-22" class="d">-	dc.sel[ColFG] = initcolor(SELFGCOLOR);
</a><a href="#h0-9-23" id="h0-9-23" class="d">-	initfont(FONT);
</a><a href="#h0-9-24" id="h0-9-24" class="d">-	dc.h = bh = dc.font.height + 2;
</a><a href="#h0-9-25" id="h0-9-25" class="d">-}
</a><a href="#h0-9-26" id="h0-9-26" class="d">-
</a> static Bool
 isarrange(void (*func)())
 {
<a href="#h0-10" id="h0-10" class="h">@@ -924,11 +892,6 @@ isarrange(void (*func)())
</a> }
 
 static Bool
<a href="#h0-10-3" id="h0-10-3" class="d">-isfloating(void) {
</a><a href="#h0-10-4" id="h0-10-4" class="d">-	return layouts[ltidx].arrange == floating;
</a><a href="#h0-10-5" id="h0-10-5" class="d">-}
</a><a href="#h0-10-6" id="h0-10-6" class="d">-
</a><a href="#h0-10-7" id="h0-10-7" class="d">-static Bool
</a> isoccupied(unsigned int t) {
 	Client *c;
 
<a href="#h0-11" id="h0-11" class="h">@@ -1300,9 +1263,9 @@ restack(void) {
</a> 	drawbar();
 	if(!sel)
 		return;
<a href="#h0-11-3" id="h0-11-3" class="d">-	if(sel-&gt;isfloating || isfloating())
</a><a href="#h0-11-4" id="h0-11-4" class="i">+	if(sel-&gt;isfloating || isarrange(floating))
</a> 		XRaiseWindow(dpy, sel-&gt;win);
<a href="#h0-11-6" id="h0-11-6" class="d">-	if(!isfloating()) {
</a><a href="#h0-11-7" id="h0-11-7" class="i">+	if(!isarrange(floating)) {
</a> 		wc.stack_mode = Below;
 		wc.sibling = barwin;
 		if(!sel-&gt;isfloating) {
<a href="#h0-12" id="h0-12" class="h">@@ -1321,6 +1284,54 @@ restack(void) {
</a> }
 
 static void
<a href="#h0-12-3" id="h0-12-3" class="i">+run(void) {
</a><a href="#h0-12-4" id="h0-12-4" class="i">+	char *p;
</a><a href="#h0-12-5" id="h0-12-5" class="i">+	int r, xfd;
</a><a href="#h0-12-6" id="h0-12-6" class="i">+	fd_set rd;
</a><a href="#h0-12-7" id="h0-12-7" class="i">+	XEvent ev;
</a><a href="#h0-12-8" id="h0-12-8" class="i">+
</a><a href="#h0-12-9" id="h0-12-9" class="i">+	/* main event loop, also reads status text from stdin */
</a><a href="#h0-12-10" id="h0-12-10" class="i">+	XSync(dpy, False);
</a><a href="#h0-12-11" id="h0-12-11" class="i">+	xfd = ConnectionNumber(dpy);
</a><a href="#h0-12-12" id="h0-12-12" class="i">+	readin = True;
</a><a href="#h0-12-13" id="h0-12-13" class="i">+	while(running) {
</a><a href="#h0-12-14" id="h0-12-14" class="i">+		FD_ZERO(&amp;rd);
</a><a href="#h0-12-15" id="h0-12-15" class="i">+		if(readin)
</a><a href="#h0-12-16" id="h0-12-16" class="i">+			FD_SET(STDIN_FILENO, &amp;rd);
</a><a href="#h0-12-17" id="h0-12-17" class="i">+		FD_SET(xfd, &amp;rd);
</a><a href="#h0-12-18" id="h0-12-18" class="i">+		if(select(xfd + 1, &amp;rd, NULL, NULL, NULL) == -1) {
</a><a href="#h0-12-19" id="h0-12-19" class="i">+			if(errno == EINTR)
</a><a href="#h0-12-20" id="h0-12-20" class="i">+				continue;
</a><a href="#h0-12-21" id="h0-12-21" class="i">+			eprint(&quot;select failed\n&quot;);
</a><a href="#h0-12-22" id="h0-12-22" class="i">+		}
</a><a href="#h0-12-23" id="h0-12-23" class="i">+		if(FD_ISSET(STDIN_FILENO, &amp;rd)) {
</a><a href="#h0-12-24" id="h0-12-24" class="i">+			switch(r = read(STDIN_FILENO, stext, sizeof stext - 1)) {
</a><a href="#h0-12-25" id="h0-12-25" class="i">+			case -1:
</a><a href="#h0-12-26" id="h0-12-26" class="i">+				strncpy(stext, strerror(errno), sizeof stext - 1);
</a><a href="#h0-12-27" id="h0-12-27" class="i">+				stext[sizeof stext - 1] = &#39;\0&#39;;
</a><a href="#h0-12-28" id="h0-12-28" class="i">+				readin = False;
</a><a href="#h0-12-29" id="h0-12-29" class="i">+				break;
</a><a href="#h0-12-30" id="h0-12-30" class="i">+			case 0:
</a><a href="#h0-12-31" id="h0-12-31" class="i">+				strncpy(stext, &quot;EOF&quot;, 4);
</a><a href="#h0-12-32" id="h0-12-32" class="i">+				readin = False;
</a><a href="#h0-12-33" id="h0-12-33" class="i">+				break;
</a><a href="#h0-12-34" id="h0-12-34" class="i">+			default:
</a><a href="#h0-12-35" id="h0-12-35" class="i">+				for(stext[r] = &#39;\0&#39;, p = stext + strlen(stext) - 1; p &gt;= stext &amp;&amp; *p == &#39;\n&#39;; *p-- = &#39;\0&#39;);
</a><a href="#h0-12-36" id="h0-12-36" class="i">+				for(; p &gt;= stext &amp;&amp; *p != &#39;\n&#39;; --p);
</a><a href="#h0-12-37" id="h0-12-37" class="i">+				if(p &gt; stext)
</a><a href="#h0-12-38" id="h0-12-38" class="i">+					strncpy(stext, p + 1, sizeof stext);
</a><a href="#h0-12-39" id="h0-12-39" class="i">+			}
</a><a href="#h0-12-40" id="h0-12-40" class="i">+			drawbar();
</a><a href="#h0-12-41" id="h0-12-41" class="i">+		}
</a><a href="#h0-12-42" id="h0-12-42" class="i">+		while(XPending(dpy)) {
</a><a href="#h0-12-43" id="h0-12-43" class="i">+			XNextEvent(dpy, &amp;ev);
</a><a href="#h0-12-44" id="h0-12-44" class="i">+			if(handler[ev.type])
</a><a href="#h0-12-45" id="h0-12-45" class="i">+				(handler[ev.type])(&amp;ev); /* call handler */
</a><a href="#h0-12-46" id="h0-12-46" class="i">+		}
</a><a href="#h0-12-47" id="h0-12-47" class="i">+	}
</a><a href="#h0-12-48" id="h0-12-48" class="i">+}
</a><a href="#h0-12-49" id="h0-12-49" class="i">+
</a><a href="#h0-12-50" id="h0-12-50" class="i">+static void
</a> scan(void) {
 	unsigned int i, num;
 	Window *wins, d1, d2;
<a href="#h0-13" id="h0-13" class="h">@@ -1401,8 +1412,7 @@ setmwfact(const char *arg) {
</a> 
 static void
 setup(void) {
<a href="#h0-13-3" id="h0-13-3" class="d">-	int i, j;
</a><a href="#h0-13-4" id="h0-13-4" class="d">-	unsigned int mask;
</a><a href="#h0-13-5" id="h0-13-5" class="i">+	unsigned int i, j, mask;
</a> 	Window w;
 	XModifierKeymap *modmap;
 	XSetWindowAttributes wa;
<a href="#h0-14" id="h0-14" class="h">@@ -1416,37 +1426,80 @@ setup(void) {
</a> 	netatom[NetWMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
 	XChangeProperty(dpy, root, netatom[NetSupported], XA_ATOM, 32,
 			PropModeReplace, (unsigned char *) netatom, NetLast);
<a href="#h0-14-3" id="h0-14-3" class="i">+
</a> 	/* init cursors */
 	cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
 	cursor[CurResize] = XCreateFontCursor(dpy, XC_sizing);
 	cursor[CurMove] = XCreateFontCursor(dpy, XC_fleur);
<a href="#h0-14-8" id="h0-14-8" class="i">+
</a><a href="#h0-14-9" id="h0-14-9" class="i">+	/* init geometry */
</a><a href="#h0-14-10" id="h0-14-10" class="i">+	sx = sy = 0;
</a><a href="#h0-14-11" id="h0-14-11" class="i">+	sw = DisplayWidth(dpy, screen);
</a><a href="#h0-14-12" id="h0-14-12" class="i">+	sh = DisplayHeight(dpy, screen);
</a><a href="#h0-14-13" id="h0-14-13" class="i">+
</a> 	/* init modifier map */
 	modmap = XGetModifierMapping(dpy);
<a href="#h0-14-16" id="h0-14-16" class="d">-	for (i = 0; i &lt; 8; i++)
</a><a href="#h0-14-17" id="h0-14-17" class="d">-		for (j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
</a><a href="#h0-14-18" id="h0-14-18" class="i">+	for(i = 0; i &lt; 8; i++)
</a><a href="#h0-14-19" id="h0-14-19" class="i">+		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
</a> 			if(modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j]
<a href="#h0-14-21" id="h0-14-21" class="d">-					== XKeysymToKeycode(dpy, XK_Num_Lock))
</a><a href="#h0-14-22" id="h0-14-22" class="i">+			== XKeysymToKeycode(dpy, XK_Num_Lock))
</a> 				numlockmask = (1 &lt;&lt; i);
 		}
 	XFreeModifiermap(modmap);
<a href="#h0-14-26" id="h0-14-26" class="i">+
</a> 	/* select for events */
 	wa.event_mask = SubstructureRedirectMask | SubstructureNotifyMask
 		| EnterWindowMask | LeaveWindowMask | StructureNotifyMask;
 	wa.cursor = cursor[CurNormal];
 	XChangeWindowAttributes(dpy, root, CWEventMask | CWCursor, &amp;wa);
 	XSelectInput(dpy, root, wa.event_mask);
<a href="#h0-14-33" id="h0-14-33" class="d">-	keypress(NULL); /* grabkeys */
</a><a href="#h0-14-34" id="h0-14-34" class="i">+
</a><a href="#h0-14-35" id="h0-14-35" class="i">+	/* grab keys */
</a><a href="#h0-14-36" id="h0-14-36" class="i">+	keypress(NULL);
</a><a href="#h0-14-37" id="h0-14-37" class="i">+
</a><a href="#h0-14-38" id="h0-14-38" class="i">+	/* init tags */
</a> 	compileregs();
 	for(ntags = 0; tags[ntags]; ntags++);
 	seltags = emallocz(sizeof(Bool) * ntags);
 	seltags[0] = True;
<a href="#h0-14-43" id="h0-14-43" class="d">-	/* geometry */
</a><a href="#h0-14-44" id="h0-14-44" class="d">-	sx = sy = 0;
</a><a href="#h0-14-45" id="h0-14-45" class="d">-	sw = DisplayWidth(dpy, screen);
</a><a href="#h0-14-46" id="h0-14-46" class="d">-	sh = DisplayHeight(dpy, screen);
</a><a href="#h0-14-47" id="h0-14-47" class="d">-	initstyle();
</a><a href="#h0-14-48" id="h0-14-48" class="d">-	initlayouts();
</a><a href="#h0-14-49" id="h0-14-49" class="d">-	initbar();
</a><a href="#h0-14-50" id="h0-14-50" class="i">+
</a><a href="#h0-14-51" id="h0-14-51" class="i">+	/* init appearance */
</a><a href="#h0-14-52" id="h0-14-52" class="i">+	dc.norm[ColBorder] = getcolor(NORMBORDERCOLOR);
</a><a href="#h0-14-53" id="h0-14-53" class="i">+	dc.norm[ColBG] = getcolor(NORMBGCOLOR);
</a><a href="#h0-14-54" id="h0-14-54" class="i">+	dc.norm[ColFG] = getcolor(NORMFGCOLOR);
</a><a href="#h0-14-55" id="h0-14-55" class="i">+	dc.sel[ColBorder] = getcolor(SELBORDERCOLOR);
</a><a href="#h0-14-56" id="h0-14-56" class="i">+	dc.sel[ColBG] = getcolor(SELBGCOLOR);
</a><a href="#h0-14-57" id="h0-14-57" class="i">+	dc.sel[ColFG] = getcolor(SELFGCOLOR);
</a><a href="#h0-14-58" id="h0-14-58" class="i">+	initfont(FONT);
</a><a href="#h0-14-59" id="h0-14-59" class="i">+	dc.h = bh = dc.font.height + 2;
</a><a href="#h0-14-60" id="h0-14-60" class="i">+
</a><a href="#h0-14-61" id="h0-14-61" class="i">+	/* init layouts */
</a><a href="#h0-14-62" id="h0-14-62" class="i">+	mwfact = MWFACT;
</a><a href="#h0-14-63" id="h0-14-63" class="i">+	nlayouts = sizeof layouts / sizeof layouts[0];
</a><a href="#h0-14-64" id="h0-14-64" class="i">+	for(blw = i = 0; i &lt; nlayouts; i++) {
</a><a href="#h0-14-65" id="h0-14-65" class="i">+		j = textw(layouts[i].symbol);
</a><a href="#h0-14-66" id="h0-14-66" class="i">+		if(j &gt; blw)
</a><a href="#h0-14-67" id="h0-14-67" class="i">+			blw = j;
</a><a href="#h0-14-68" id="h0-14-68" class="i">+	}
</a><a href="#h0-14-69" id="h0-14-69" class="i">+
</a><a href="#h0-14-70" id="h0-14-70" class="i">+	/* init bar */
</a><a href="#h0-14-71" id="h0-14-71" class="i">+	bpos = BARPOS;
</a><a href="#h0-14-72" id="h0-14-72" class="i">+	wa.override_redirect = 1;
</a><a href="#h0-14-73" id="h0-14-73" class="i">+	wa.background_pixmap = ParentRelative;
</a><a href="#h0-14-74" id="h0-14-74" class="i">+	wa.event_mask = ButtonPressMask | ExposureMask;
</a><a href="#h0-14-75" id="h0-14-75" class="i">+	barwin = XCreateWindow(dpy, root, sx, sy, sw, bh, 0,
</a><a href="#h0-14-76" id="h0-14-76" class="i">+			DefaultDepth(dpy, screen), CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h0-14-77" id="h0-14-77" class="i">+			CWOverrideRedirect | CWBackPixmap | CWEventMask, &amp;wa);
</a><a href="#h0-14-78" id="h0-14-78" class="i">+	XDefineCursor(dpy, barwin, cursor[CurNormal]);
</a><a href="#h0-14-79" id="h0-14-79" class="i">+	updatebarpos();
</a><a href="#h0-14-80" id="h0-14-80" class="i">+	XMapRaised(dpy, barwin);
</a><a href="#h0-14-81" id="h0-14-81" class="i">+	strcpy(stext, &quot;dwm-&quot;VERSION);
</a><a href="#h0-14-82" id="h0-14-82" class="i">+	dc.drawable = XCreatePixmap(dpy, root, sw, bh, DefaultDepth(dpy, screen));
</a><a href="#h0-14-83" id="h0-14-83" class="i">+	dc.gc = XCreateGC(dpy, root, 0, 0);
</a><a href="#h0-14-84" id="h0-14-84" class="i">+	XSetLineAttributes(dpy, dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h0-14-85" id="h0-14-85" class="i">+	if(!dc.font.set)
</a><a href="#h0-14-86" id="h0-14-86" class="i">+		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
</a><a href="#h0-14-87" id="h0-14-87" class="i">+
</a> 	/* multihead support */
 	selscreen = XQueryPointer(dpy, root, &amp;w, &amp;w, &amp;i, &amp;i, &amp;i, &amp;i, &amp;mask);
 }
<a href="#h0-15" id="h0-15" class="h">@@ -1568,7 +1621,7 @@ static void
</a> togglemax(const char *arg) {
 	XEvent ev;
 
<a href="#h0-15-3" id="h0-15-3" class="d">-	if(!sel || (!isfloating() &amp;&amp; !sel-&gt;isfloating) || sel-&gt;isfixed)
</a><a href="#h0-15-4" id="h0-15-4" class="i">+	if(!sel || (!isarrange(floating) &amp;&amp; !sel-&gt;isfloating) || sel-&gt;isfixed)
</a> 		return;
 	if((sel-&gt;ismax = !sel-&gt;ismax)) {
 		sel-&gt;rx = sel-&gt;x;
<a href="#h0-16" id="h0-16" class="h">@@ -1794,81 +1847,24 @@ zoom(const char *arg) {
</a> 
 int
 main(int argc, char *argv[]) {
<a href="#h0-16-3" id="h0-16-3" class="d">-	char *p;
</a><a href="#h0-16-4" id="h0-16-4" class="d">-	int r, xfd;
</a><a href="#h0-16-5" id="h0-16-5" class="d">-	fd_set rd;
</a><a href="#h0-16-6" id="h0-16-6" class="d">-	XEvent ev;
</a><a href="#h0-16-7" id="h0-16-7" class="d">-
</a> 	if(argc == 2 &amp;&amp; !strcmp(&quot;-v&quot;, argv[1]))
 		eprint(&quot;dwm-&quot;VERSION&quot;, Â© 2006-2007 A. R. Garbe, S. van Dijk, J. Salmi, P. Hruby, S. Nagy\n&quot;);
 	else if(argc != 1)
 		eprint(&quot;usage: dwm [-v]\n&quot;);
 
<a href="#h0-16-13" id="h0-16-13" class="d">-	/* macros from config.h can be used at function level only */
</a><a href="#h0-16-14" id="h0-16-14" class="d">-	mwfact = MWFACT;
</a><a href="#h0-16-15" id="h0-16-15" class="d">-	bpos = BARPOS;
</a><a href="#h0-16-16" id="h0-16-16" class="d">-
</a> 	setlocale(LC_CTYPE, &quot;&quot;);
 	if(!(dpy = XOpenDisplay(0)))
 		eprint(&quot;dwm: cannot open display\n&quot;);
<a href="#h0-16-20" id="h0-16-20" class="d">-	xfd = ConnectionNumber(dpy);
</a> 	screen = DefaultScreen(dpy);
 	root = RootWindow(dpy, screen);
<a href="#h0-16-23" id="h0-16-23" class="d">-	otherwm = False;
</a><a href="#h0-16-24" id="h0-16-24" class="d">-	XSetErrorHandler(xerrorstart);
</a><a href="#h0-16-25" id="h0-16-25" class="d">-	/* this causes an error if some other window manager is running */
</a><a href="#h0-16-26" id="h0-16-26" class="d">-	XSelectInput(dpy, root, SubstructureRedirectMask);
</a><a href="#h0-16-27" id="h0-16-27" class="d">-	XSync(dpy, False);
</a><a href="#h0-16-28" id="h0-16-28" class="d">-	if(otherwm)
</a><a href="#h0-16-29" id="h0-16-29" class="d">-		eprint(&quot;dwm: another window manager is already running\n&quot;);
</a> 
<a href="#h0-16-31" id="h0-16-31" class="d">-	XSync(dpy, False);
</a><a href="#h0-16-32" id="h0-16-32" class="d">-	XSetErrorHandler(NULL);
</a><a href="#h0-16-33" id="h0-16-33" class="d">-	xerrorxlib = XSetErrorHandler(xerror);
</a><a href="#h0-16-34" id="h0-16-34" class="d">-	XSync(dpy, False);
</a><a href="#h0-16-35" id="h0-16-35" class="i">+	checkotherwm();
</a> 	setup();
 	drawbar();
 	scan();
<a href="#h0-16-39" id="h0-16-39" class="d">-
</a><a href="#h0-16-40" id="h0-16-40" class="d">-	/* main event loop, also reads status text from stdin */
</a><a href="#h0-16-41" id="h0-16-41" class="d">-	XSync(dpy, False);
</a><a href="#h0-16-42" id="h0-16-42" class="d">-	readin = True;
</a><a href="#h0-16-43" id="h0-16-43" class="d">-	while(running) {
</a><a href="#h0-16-44" id="h0-16-44" class="d">-		FD_ZERO(&amp;rd);
</a><a href="#h0-16-45" id="h0-16-45" class="d">-		if(readin)
</a><a href="#h0-16-46" id="h0-16-46" class="d">-			FD_SET(STDIN_FILENO, &amp;rd);
</a><a href="#h0-16-47" id="h0-16-47" class="d">-		FD_SET(xfd, &amp;rd);
</a><a href="#h0-16-48" id="h0-16-48" class="d">-		if(select(xfd + 1, &amp;rd, NULL, NULL, NULL) == -1) {
</a><a href="#h0-16-49" id="h0-16-49" class="d">-			if(errno == EINTR)
</a><a href="#h0-16-50" id="h0-16-50" class="d">-				continue;
</a><a href="#h0-16-51" id="h0-16-51" class="d">-			eprint(&quot;select failed\n&quot;);
</a><a href="#h0-16-52" id="h0-16-52" class="d">-		}
</a><a href="#h0-16-53" id="h0-16-53" class="d">-		if(FD_ISSET(STDIN_FILENO, &amp;rd)) {
</a><a href="#h0-16-54" id="h0-16-54" class="d">-			switch(r = read(STDIN_FILENO, stext, sizeof stext - 1)) {
</a><a href="#h0-16-55" id="h0-16-55" class="d">-			case -1:
</a><a href="#h0-16-56" id="h0-16-56" class="d">-				strncpy(stext, strerror(errno), sizeof stext - 1);
</a><a href="#h0-16-57" id="h0-16-57" class="d">-				stext[sizeof stext - 1] = &#39;\0&#39;;
</a><a href="#h0-16-58" id="h0-16-58" class="d">-				readin = False;
</a><a href="#h0-16-59" id="h0-16-59" class="d">-				break;
</a><a href="#h0-16-60" id="h0-16-60" class="d">-			case 0:
</a><a href="#h0-16-61" id="h0-16-61" class="d">-				strncpy(stext, &quot;EOF&quot;, 4);
</a><a href="#h0-16-62" id="h0-16-62" class="d">-				readin = False;
</a><a href="#h0-16-63" id="h0-16-63" class="d">-				break;
</a><a href="#h0-16-64" id="h0-16-64" class="d">-			default:
</a><a href="#h0-16-65" id="h0-16-65" class="d">-				for(stext[r] = &#39;\0&#39;, p = stext + strlen(stext) - 1; p &gt;= stext &amp;&amp; *p == &#39;\n&#39;; *p-- = &#39;\0&#39;);
</a><a href="#h0-16-66" id="h0-16-66" class="d">-				for(; p &gt;= stext &amp;&amp; *p != &#39;\n&#39;; --p);
</a><a href="#h0-16-67" id="h0-16-67" class="d">-				if(p &gt; stext)
</a><a href="#h0-16-68" id="h0-16-68" class="d">-					strncpy(stext, p + 1, sizeof stext);
</a><a href="#h0-16-69" id="h0-16-69" class="d">-			}
</a><a href="#h0-16-70" id="h0-16-70" class="d">-			drawbar();
</a><a href="#h0-16-71" id="h0-16-71" class="d">-		}
</a><a href="#h0-16-72" id="h0-16-72" class="d">-		while(XPending(dpy)) {
</a><a href="#h0-16-73" id="h0-16-73" class="d">-			XNextEvent(dpy, &amp;ev);
</a><a href="#h0-16-74" id="h0-16-74" class="d">-			if(handler[ev.type])
</a><a href="#h0-16-75" id="h0-16-75" class="d">-				(handler[ev.type])(&amp;ev); /* call handler */
</a><a href="#h0-16-76" id="h0-16-76" class="d">-		}
</a><a href="#h0-16-77" id="h0-16-77" class="d">-	}
</a><a href="#h0-16-78" id="h0-16-78" class="i">+	run();
</a> 	cleanup();
<a href="#h0-16-80" id="h0-16-80" class="i">+
</a> 	XCloseDisplay(dpy);
 	return 0;
 }
</pre>
</div>
</body>
</html>
