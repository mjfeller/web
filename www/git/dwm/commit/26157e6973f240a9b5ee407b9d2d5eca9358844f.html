<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>applied Sanders max_and_focus.patch - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/26157e6973f240a9b5ee407b9d2d5eca9358844f.html">26157e6973f240a9b5ee407b9d2d5eca9358844f</a>
<b>parent</b> <a href="../commit/6d22782e8f991a99f9adef56b2b729e5ab5454d2.html">6d22782e8f991a99f9adef56b2b729e5ab5454d2</a>
<b>Author:</b> Anselm R. Garbe &lt;<a href="mailto:arg@10kloc.org">arg@10kloc.org</a>&gt;
<b>Date:</b>   Mon,  4 Sep 2006 08:55:49 +0200

applied Sanders max_and_focus.patch
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">client.c</a></td><td> | </td><td class="num">50</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">dwm.h</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">event.c</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">main.c</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">view.c</a></td><td> | </td><td class="num">30</td><td><span class="i">+++++++++++++</span><span class="d">-----------------</span></td></tr>
</table></pre><pre>5 files changed, 48 insertions(+), 44 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/client.c.html">client.c</a> b/<a href="../file/client.c.html">client.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -82,22 +82,29 @@ ban(Client *c)
</a> void
 focus(Client *c)
 {
<a href="#h0-0-3" id="h0-0-3" class="d">-	Client *old = sel;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	Client *old;
</a> 
 	if(!issel)
 		return;
 	if(!sel)
 		sel = c;
 	else if(sel != c) {
<a href="#h0-0-11" id="h0-0-11" class="d">-		if(sel-&gt;ismax)
</a><a href="#h0-0-12" id="h0-0-12" class="i">+		if(maximized)
</a> 			togglemax(NULL);
<a href="#h0-0-14" id="h0-0-14" class="i">+		old = sel;
</a> 		sel = c;
<a href="#h0-0-16" id="h0-0-16" class="d">-		grabbuttons(old, False);
</a><a href="#h0-0-17" id="h0-0-17" class="d">-		drawtitle(old);
</a><a href="#h0-0-18" id="h0-0-18" class="i">+		if(old) {
</a><a href="#h0-0-19" id="h0-0-19" class="i">+			grabbuttons(old, False);
</a><a href="#h0-0-20" id="h0-0-20" class="i">+			drawtitle(old);
</a><a href="#h0-0-21" id="h0-0-21" class="i">+		}
</a><a href="#h0-0-22" id="h0-0-22" class="i">+	}
</a><a href="#h0-0-23" id="h0-0-23" class="i">+	if(c) {
</a><a href="#h0-0-24" id="h0-0-24" class="i">+		grabbuttons(c, True);
</a><a href="#h0-0-25" id="h0-0-25" class="i">+		drawtitle(c);
</a><a href="#h0-0-26" id="h0-0-26" class="i">+		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
</a> 	}
<a href="#h0-0-28" id="h0-0-28" class="d">-	grabbuttons(c, True);
</a><a href="#h0-0-29" id="h0-0-29" class="d">-	drawtitle(c);
</a><a href="#h0-0-30" id="h0-0-30" class="d">-	XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
</a><a href="#h0-0-31" id="h0-0-31" class="i">+	else
</a><a href="#h0-0-32" id="h0-0-32" class="i">+		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a> }
 
 Client *
<a href="#h0-1" id="h0-1" class="h">@@ -247,8 +254,6 @@ manage(Window w, XWindowAttributes *wa)
</a> 	clients = c;
 
 	settitle(c);
<a href="#h0-1-3" id="h0-1-3" class="d">-	if(isvisible(c))
</a><a href="#h0-1-4" id="h0-1-4" class="d">-		sel = c;
</a> 	arrange(NULL);
 	XMapWindow(dpy, c-&gt;win);
 	XMapWindow(dpy, c-&gt;twin);
<a href="#h0-2" id="h0-2" class="h">@@ -366,12 +371,13 @@ void
</a> togglemax(Arg *arg)
 {
 	int ox, oy, ow, oh;
<a href="#h0-2-3" id="h0-2-3" class="i">+	Client *c;
</a> 	XEvent ev;
 
 	if(!sel)
 		return;
 
<a href="#h0-2-9" id="h0-2-9" class="d">-	if((sel-&gt;ismax = !sel-&gt;ismax)) {
</a><a href="#h0-2-10" id="h0-2-10" class="i">+	if((maximized = !maximized)) {
</a> 		ox = sel-&gt;x;
 		oy = sel-&gt;y;
 		ow = sel-&gt;w;
<a href="#h0-3" id="h0-3" class="h">@@ -382,6 +388,9 @@ togglemax(Arg *arg)
</a> 		sel-&gt;h = sh - 2 - bh;
 
 		restack();
<a href="#h0-3-3" id="h0-3-3" class="i">+		for(c = getnext(clients); c; c = getnext(c-&gt;next))
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			if(c != sel)
</a><a href="#h0-3-5" id="h0-3-5" class="i">+				ban(c);
</a> 		resize(sel, arrange == dofloat, TopLeft);
 
 		sel-&gt;x = ox;
<a href="#h0-4" id="h0-4" class="h">@@ -390,37 +399,36 @@ togglemax(Arg *arg)
</a> 		sel-&gt;h = oh;
 	}
 	else
<a href="#h0-4-3" id="h0-4-3" class="d">-		resize(sel, False, TopLeft);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+		arrange(NULL);
</a> 	while(XCheckMaskEvent(dpy, EnterWindowMask, &amp;ev));
 }
 
 void
 unmanage(Client *c)
 {
<a href="#h0-4-11" id="h0-4-11" class="d">-	Client *tc;
</a><a href="#h0-4-12" id="h0-4-12" class="i">+	Client *tc, *fc;
</a> 	Window trans;
 	XGrabServer(dpy);
 	XSetErrorHandler(xerrordummy);
 
<a href="#h0-4-17" id="h0-4-17" class="d">-	XGetTransientForHint(dpy, c-&gt;win, &amp;trans);
</a><a href="#h0-4-18" id="h0-4-18" class="d">-
</a><a href="#h0-4-19" id="h0-4-19" class="d">-	XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
</a><a href="#h0-4-20" id="h0-4-20" class="d">-	XDestroyWindow(dpy, c-&gt;twin);
</a><a href="#h0-4-21" id="h0-4-21" class="d">-
</a> 	detach(c);
 	if(sel == c) {
<a href="#h0-4-24" id="h0-4-24" class="i">+		XGetTransientForHint(dpy, c-&gt;win, &amp;trans);
</a> 		if(trans &amp;&amp; (tc = getclient(trans)) &amp;&amp; isvisible(tc))
<a href="#h0-4-26" id="h0-4-26" class="d">-			sel = tc;
</a><a href="#h0-4-27" id="h0-4-27" class="i">+			fc = tc;
</a> 		else
<a href="#h0-4-29" id="h0-4-29" class="d">-			sel = getnext(clients);
</a><a href="#h0-4-30" id="h0-4-30" class="i">+			fc = getnext(clients);
</a><a href="#h0-4-31" id="h0-4-31" class="i">+		focus(fc);
</a> 	}
<a href="#h0-4-33" id="h0-4-33" class="i">+
</a><a href="#h0-4-34" id="h0-4-34" class="i">+	XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
</a><a href="#h0-4-35" id="h0-4-35" class="i">+	XDestroyWindow(dpy, c-&gt;twin);
</a><a href="#h0-4-36" id="h0-4-36" class="i">+
</a> 	free(c-&gt;tags);
 	free(c);
 
 	XSync(dpy, False);
 	XSetErrorHandler(xerror);
 	XUngrabServer(dpy);
<a href="#h0-4-43" id="h0-4-43" class="d">-	if(sel)
</a><a href="#h0-4-44" id="h0-4-44" class="d">-		focus(sel);
</a> 	arrange(NULL);
 }
<b>diff --git a/<a id="h1" href="../file/dwm.h.html">dwm.h</a> b/<a href="../file/dwm.h.html">dwm.h</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -58,7 +58,6 @@ struct Client {
</a> 	long flags; 
 	unsigned int border, weight;
 	Bool isfloat;
<a href="#h1-0-3" id="h1-0-3" class="d">-	Bool ismax;
</a> 	Bool *tags;
 	Client *next;
 	Client *prev;
<a href="#h1-1" id="h1-1" class="h">@@ -73,7 +72,7 @@ extern unsigned int ntags, numlockmask;
</a> extern void (*handler[LASTEvent])(XEvent *);
 extern void (*arrange)(Arg *);
 extern Atom wmatom[WMLast], netatom[NetLast];
<a href="#h1-1-3" id="h1-1-3" class="d">-extern Bool running, issel, *seltag;
</a><a href="#h1-1-4" id="h1-1-4" class="i">+extern Bool running, issel, maximized, *seltag;
</a> extern Client *clients, *sel;
 extern Cursor cursor[CurLast];
 extern DC dc;
<b>diff --git a/<a id="h2" href="../file/event.c.html">event.c</a> b/<a href="../file/event.c.html">event.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -131,15 +131,15 @@ buttonpress(XEvent *e)
</a> 	}
 	else if((c = getclient(ev-&gt;window))) {
 		focus(c);
<a href="#h2-0-3" id="h2-0-3" class="d">-		if(c-&gt;ismax || CLEANMASK(ev-&gt;state) != MODKEY)
</a><a href="#h2-0-4" id="h2-0-4" class="i">+		if(maximized || CLEANMASK(ev-&gt;state) != MODKEY)
</a> 			return;
<a href="#h2-0-6" id="h2-0-6" class="d">-		if((ev-&gt;button == Button1) &amp;&amp; ((arrange == dofloat) || c-&gt;isfloat)) {
</a><a href="#h2-0-7" id="h2-0-7" class="i">+		if(ev-&gt;button == Button1 &amp;&amp; (arrange == dofloat || c-&gt;isfloat)) {
</a> 			restack(c);
 			movemouse(c);
 		}
 		else if(ev-&gt;button == Button2)
 			zoom(NULL);
<a href="#h2-0-13" id="h2-0-13" class="d">-		else if(ev-&gt;button == Button3 &amp;&amp; ((arrange == dofloat) || c-&gt;isfloat)) {
</a><a href="#h2-0-14" id="h2-0-14" class="i">+		else if(ev-&gt;button == Button3 &amp;&amp; (arrange == dofloat || c-&gt;isfloat)) {
</a> 			restack(c);
 			resizemouse(c);
 		}
<a href="#h2-1" id="h2-1" class="h">@@ -173,7 +173,7 @@ configurerequest(XEvent *e)
</a> 	XWindowChanges wc;
 
 	if((c = getclient(ev-&gt;window))) {
<a href="#h2-1-3" id="h2-1-3" class="d">-		if(!c-&gt;isfloat &amp;&amp; (arrange != dofloat) &amp;&amp; c-&gt;ismax) {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+		if((c == sel) &amp;&amp; !c-&gt;isfloat &amp;&amp; (arrange != dofloat) &amp;&amp; maximized) {
</a> 			synconfig(c, sx, sy + bh, sw - 2, sh - 2 - bh, ev-&gt;border_width);
 			XSync(dpy, False);
 			return;
<b>diff --git a/<a id="h3" href="../file/main.c.html">main.c</a> b/<a href="../file/main.c.html">main.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -24,6 +24,7 @@ unsigned int ntags, numlockmask;
</a> Atom wmatom[WMLast], netatom[NetLast];
 Bool running = True;
 Bool issel = True;
<a href="#h3-0-3" id="h3-0-3" class="i">+Bool maximized = False;
</a> Client *clients = NULL;
 Client *sel = NULL;
 Cursor cursor[CurLast];
<b>diff --git a/<a id="h4" href="../file/view.c.html">view.c</a> b/<a href="../file/view.c.html">view.c</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -57,22 +57,20 @@ detach(Client *c)
</a> void
 dofloat(Arg *arg)
 {
<a href="#h4-0-3" id="h4-0-3" class="d">-	Client *c;
</a><a href="#h4-0-4" id="h4-0-4" class="i">+	Client *c, *fc;
</a><a href="#h4-0-5" id="h4-0-5" class="i">+
</a><a href="#h4-0-6" id="h4-0-6" class="i">+	maximized = False;
</a> 
 	for(c = clients; c; c = c-&gt;next) {
<a href="#h4-0-9" id="h4-0-9" class="d">-		c-&gt;ismax = False;
</a> 		if(isvisible(c)) {
 			resize(c, True, TopLeft);
 		}
 		else
 			ban(c);
 	}
<a href="#h4-0-16" id="h4-0-16" class="d">-	if(!sel || !isvisible(sel))
</a><a href="#h4-0-17" id="h4-0-17" class="d">-		sel = getnext(clients);
</a><a href="#h4-0-18" id="h4-0-18" class="d">-	if(sel)
</a><a href="#h4-0-19" id="h4-0-19" class="d">-		focus(sel);
</a><a href="#h4-0-20" id="h4-0-20" class="d">-	else
</a><a href="#h4-0-21" id="h4-0-21" class="d">-		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h4-0-22" id="h4-0-22" class="i">+	if(!(fc = sel) || !isvisible(fc))
</a><a href="#h4-0-23" id="h4-0-23" class="i">+		fc = getnext(clients);
</a><a href="#h4-0-24" id="h4-0-24" class="i">+	focus(fc);
</a> 	restack();
 }
 
<a href="#h4-1" id="h4-1" class="h">@@ -80,7 +78,9 @@ void
</a> dotile(Arg *arg)
 {
 	int h, i, n, w;
<a href="#h4-1-3" id="h4-1-3" class="d">-	Client *c;
</a><a href="#h4-1-4" id="h4-1-4" class="i">+	Client *c, *fc;
</a><a href="#h4-1-5" id="h4-1-5" class="i">+
</a><a href="#h4-1-6" id="h4-1-6" class="i">+	maximized = False;
</a> 
 	w = sw - mw;
 	for(n = 0, c = clients; c; c = c-&gt;next)
<a href="#h4-2" id="h4-2" class="h">@@ -93,7 +93,6 @@ dotile(Arg *arg)
</a> 		h = sh - bh;
 
 	for(i = 0, c = clients; c; c = c-&gt;next) {
<a href="#h4-2-3" id="h4-2-3" class="d">-		c-&gt;ismax = False;
</a> 		if(isvisible(c)) {
 			if(c-&gt;isfloat) {
 				resize(c, True, TopLeft);
<a href="#h4-3" id="h4-3" class="h">@@ -132,12 +131,9 @@ dotile(Arg *arg)
</a> 		else
 			ban(c);
 	}
<a href="#h4-3-3" id="h4-3-3" class="d">-	if(!sel || !isvisible(sel))
</a><a href="#h4-3-4" id="h4-3-4" class="d">-		sel = getnext(clients);
</a><a href="#h4-3-5" id="h4-3-5" class="d">-	if(sel)
</a><a href="#h4-3-6" id="h4-3-6" class="d">-		focus(sel);
</a><a href="#h4-3-7" id="h4-3-7" class="d">-	else
</a><a href="#h4-3-8" id="h4-3-8" class="d">-		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h4-3-9" id="h4-3-9" class="i">+	if(!(fc = sel) || !isvisible(fc))
</a><a href="#h4-3-10" id="h4-3-10" class="i">+		fc = getnext(clients);
</a><a href="#h4-3-11" id="h4-3-11" class="i">+	focus(fc);
</a> 	restack();
 }
 
<a href="#h4-4" id="h4-4" class="h">@@ -289,7 +285,7 @@ zoom(Arg *arg)
</a> {
 	Client *c = sel;
 
<a href="#h4-4-3" id="h4-4-3" class="d">-	if(!c || (arrange != dotile) || c-&gt;isfloat || c-&gt;ismax)
</a><a href="#h4-4-4" id="h4-4-4" class="i">+	if(!c || (arrange != dotile) || c-&gt;isfloat || maximized)
</a> 		return;
 
 	if(c == getnext(clients))
</pre>
</div>
</body>
</html>
