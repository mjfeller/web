<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>several simplifications - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/1ddfc571ae90b842446b0524f2a38c74868bb326.html">1ddfc571ae90b842446b0524f2a38c74868bb326</a>
<b>parent</b> <a href="../commit/21cd59a6307ae041ed91098e06d49b3e9036cbea.html">21cd59a6307ae041ed91098e06d49b3e9036cbea</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:anselm@garbe.us">anselm@garbe.us</a>&gt;
<b>Date:</b>   Tue, 30 Jun 2009 19:39:59 +0100

several simplifications
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">dwm.c</a></td><td> | </td><td class="num">187</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------------</span></td></tr>
</table></pre><pre>2 files changed, 83 insertions(+), 109 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,6 +1,8 @@
</a> /* See LICENSE file for copyright and license details. */
 
 /* appearance */
<a href="#h0-0-3" id="h0-0-3" class="i">+#define SHOWBAR                       True      /* False means no bar */
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#define TOPBAR                        True      /* False means bottom bar */
</a> static const char font[]            = &quot;-*-*-medium-*-*-*-14-*-*-*-*-*-*-*&quot;;
 static const char normbordercolor[] = &quot;#cccccc&quot;;
 static const char normbgcolor[]     = &quot;#cccccc&quot;;
<a href="#h0-1" id="h0-1" class="h">@@ -10,9 +12,6 @@ static const char selbgcolor[]      = &quot;#0066ff&quot;;
</a> static const char selfgcolor[]      = &quot;#ffffff&quot;;
 static unsigned int borderpx        = 1;        /* border pixel of windows */
 static unsigned int snap            = 32;       /* snap pixel */
<a href="#h0-1-3" id="h0-1-3" class="d">-static Bool showbar                 = True;     /* False means no bar */
</a><a href="#h0-1-4" id="h0-1-4" class="d">-static Bool topbar                  = True;     /* False means bottom bar */
</a><a href="#h0-1-5" id="h0-1-5" class="d">-
</a> 
 /* tagging */
 static const char *tags[] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot; };
<b>diff --git a/<a id="h1" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,4 +1,3 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-//#define XINULATOR /* debug, simulates dual head */
</a> /* See LICENSE file for copyright and license details.
  *
  * dynamic window manager is designed like any other X client as well. It is
<a href="#h1-1" id="h1-1" class="h">@@ -174,16 +173,13 @@ static void expose(XEvent *e);
</a> static void focus(Client *c);
 static void focusin(XEvent *e);
 static void focusstack(const Arg *arg);
<a href="#h1-1-3" id="h1-1-3" class="d">-static Client *getclient(Window w);
</a> static unsigned long getcolor(const char *colstr);
<a href="#h1-1-5" id="h1-1-5" class="d">-static Monitor *getmon(Window w);
</a><a href="#h1-1-6" id="h1-1-6" class="d">-static Monitor *getmonn(unsigned int n);
</a><a href="#h1-1-7" id="h1-1-7" class="d">-static Monitor *getmonxy(int x, int y);
</a> static Bool getrootpointer(int *x, int *y);
 static long getstate(Window w);
 static Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 static void grabbuttons(Client *c, Bool focused);
 static void grabkeys(void);
<a href="#h1-1-13" id="h1-1-13" class="i">+static Monitor *idxtomon(unsigned int n);
</a> static void initfont(const char *fontstr);
 static Bool isprotodel(Client *c);
 static void keypress(XEvent *e);
<a href="#h1-2" id="h1-2" class="h">@@ -194,6 +190,7 @@ static void maprequest(XEvent *e);
</a> static void monocle(Monitor *m);
 static void movemouse(const Arg *arg);
 static Client *nexttiled(Client *c);
<a href="#h1-2-3" id="h1-2-3" class="i">+static Monitor *pointertomon(int x, int y);
</a> static void propertynotify(XEvent *e);
 static void quit(const Arg *arg);
 static void resize(Client *c, int x, int y, int w, int h);
<a href="#h1-3" id="h1-3" class="h">@@ -228,6 +225,8 @@ static void updatestatus(void);
</a> static void updatetitle(Client *c);
 static void updatewmhints(Client *c);
 static void view(const Arg *arg);
<a href="#h1-3-3" id="h1-3-3" class="i">+static Client *wintoclient(Window w);
</a><a href="#h1-3-4" id="h1-3-4" class="i">+static Monitor *wintomon(Window w);
</a> static int xerror(Display *dpy, XErrorEvent *ee);
 static int xerrordummy(Display *dpy, XErrorEvent *ee);
 static int xerrorstart(Display *dpy, XErrorEvent *ee);
<a href="#h1-4" id="h1-4" class="h">@@ -402,7 +401,7 @@ buttonpress(XEvent *e) {
</a> 
 	click = ClkRootWin;
 	/* focus monitor if necessary */
<a href="#h1-4-3" id="h1-4-3" class="d">-	if((m = getmon(ev-&gt;window)) &amp;&amp; m != selmon) {
</a><a href="#h1-4-4" id="h1-4-4" class="i">+	if((m = wintomon(ev-&gt;window)) &amp;&amp; m != selmon) {
</a> 		unfocus(selmon-&gt;sel);
 		selmon = m;
 		focus(NULL);
<a href="#h1-5" id="h1-5" class="h">@@ -424,7 +423,7 @@ buttonpress(XEvent *e) {
</a> 		else
 			click = ClkWinTitle;
 	}
<a href="#h1-5-3" id="h1-5-3" class="d">-	else if((c = getclient(ev-&gt;window))) {
</a><a href="#h1-5-4" id="h1-5-4" class="i">+	else if((c = wintoclient(ev-&gt;window))) {
</a> 		focus(c);
 		click = ClkClientWin;
 	}
<a href="#h1-6" id="h1-6" class="h">@@ -457,8 +456,6 @@ cleanup(void) {
</a> 
 	view(&amp;a);
 	lt[selmon-&gt;sellt] = &amp;foo;
<a href="#h1-6-3" id="h1-6-3" class="d">-
</a><a href="#h1-6-4" id="h1-6-4" class="d">-	/* TODO: consider simplifying cleanup code of the stack, perhaps do that in cleanmons() ? */
</a> 	for(m = mons; m; m = m-&gt;next)
 		while(m-&gt;stack)
 			unmanage(m-&gt;stack);
<a href="#h1-7" id="h1-7" class="h">@@ -546,7 +543,7 @@ configurerequest(XEvent *e) {
</a> 	XConfigureRequestEvent *ev = &amp;e-&gt;xconfigurerequest;
 	XWindowChanges wc;
 
<a href="#h1-7-3" id="h1-7-3" class="d">-	if((c = getclient(ev-&gt;window))) {
</a><a href="#h1-7-4" id="h1-7-4" class="i">+	if((c = wintoclient(ev-&gt;window))) {
</a> 		if(ev-&gt;value_mask &amp; CWBorderWidth)
 			c-&gt;bw = ev-&gt;border_width;
 		else if(c-&gt;isfloating || !lt[selmon-&gt;sellt]-&gt;arrange) {
<a href="#h1-8" id="h1-8" class="h">@@ -589,7 +586,7 @@ destroynotify(XEvent *e) {
</a> 	Client *c;
 	XDestroyWindowEvent *ev = &amp;e-&gt;xdestroywindow;
 
<a href="#h1-8-3" id="h1-8-3" class="d">-	if((c = getclient(ev-&gt;window)))
</a><a href="#h1-8-4" id="h1-8-4" class="i">+	if((c = wintoclient(ev-&gt;window)))
</a> 		unmanage(c);
 }
 
<a href="#h1-9" id="h1-9" class="h">@@ -607,6 +604,11 @@ detachstack(Client *c) {
</a> 
 	for(tc = &amp;c-&gt;mon-&gt;stack; *tc &amp;&amp; *tc != c; tc = &amp;(*tc)-&gt;snext);
 	*tc = c-&gt;snext;
<a href="#h1-9-3" id="h1-9-3" class="i">+
</a><a href="#h1-9-4" id="h1-9-4" class="i">+	if(c == c-&gt;mon-&gt;sel) {
</a><a href="#h1-9-5" id="h1-9-5" class="i">+		for(*tc = c-&gt;mon-&gt;stack; *tc &amp;&amp; !ISVISIBLE((*tc)); *tc = (*tc)-&gt;snext);
</a><a href="#h1-9-6" id="h1-9-6" class="i">+		c-&gt;mon-&gt;sel = *tc;
</a><a href="#h1-9-7" id="h1-9-7" class="i">+	}
</a> }
 
 void
<a href="#h1-10" id="h1-10" class="h">@@ -750,11 +752,11 @@ enternotify(XEvent *e) {
</a> 
 	if((ev-&gt;mode != NotifyNormal || ev-&gt;detail == NotifyInferior) &amp;&amp; ev-&gt;window != root)
 		return;
<a href="#h1-10-3" id="h1-10-3" class="d">-	if((m = getmon(ev-&gt;window)) &amp;&amp; m != selmon) {
</a><a href="#h1-10-4" id="h1-10-4" class="i">+	if((m = wintomon(ev-&gt;window)) &amp;&amp; m != selmon) {
</a> 		unfocus(selmon-&gt;sel);
 		selmon = m;
 	}
<a href="#h1-10-8" id="h1-10-8" class="d">-	if((c = getclient(ev-&gt;window)))
</a><a href="#h1-10-9" id="h1-10-9" class="i">+	if((c = wintoclient(ev-&gt;window)))
</a> 		focus(c);
 	else
 		focus(NULL);
<a href="#h1-11" id="h1-11" class="h">@@ -765,7 +767,7 @@ expose(XEvent *e) {
</a> 	Monitor *m;
 	XExposeEvent *ev = &amp;e-&gt;xexpose;
 
<a href="#h1-11-3" id="h1-11-3" class="d">-	if(ev-&gt;count == 0 &amp;&amp; (m = getmon(ev-&gt;window)))
</a><a href="#h1-11-4" id="h1-11-4" class="i">+	if(ev-&gt;count == 0 &amp;&amp; (m = wintomon(ev-&gt;window)))
</a> 		drawbar(m);
 }
 
<a href="#h1-12" id="h1-12" class="h">@@ -805,7 +807,7 @@ void
</a> focusmon(const Arg *arg) {
 	Monitor *m;
 
<a href="#h1-12-3" id="h1-12-3" class="d">-	if(!(m = getmonn(arg-&gt;ui)) || m == selmon)
</a><a href="#h1-12-4" id="h1-12-4" class="i">+	if(!(m = idxtomon(arg-&gt;ui)) || m == selmon)
</a> 		return;
 	unfocus(selmon-&gt;sel);
 	selmon = m;
<a href="#h1-13" id="h1-13" class="h">@@ -839,18 +841,6 @@ focusstack(const Arg *arg) {
</a> 	}
 }
 
<a href="#h1-13-3" id="h1-13-3" class="d">-Client *
</a><a href="#h1-13-4" id="h1-13-4" class="d">-getclient(Window w) {
</a><a href="#h1-13-5" id="h1-13-5" class="d">-	Client *c;
</a><a href="#h1-13-6" id="h1-13-6" class="d">-	Monitor *m;
</a><a href="#h1-13-7" id="h1-13-7" class="d">-
</a><a href="#h1-13-8" id="h1-13-8" class="d">-	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-13-9" id="h1-13-9" class="d">-		for(c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h1-13-10" id="h1-13-10" class="d">-			if(c-&gt;win == w)
</a><a href="#h1-13-11" id="h1-13-11" class="d">-				return c;
</a><a href="#h1-13-12" id="h1-13-12" class="d">-	return NULL;
</a><a href="#h1-13-13" id="h1-13-13" class="d">-}
</a><a href="#h1-13-14" id="h1-13-14" class="d">-
</a> unsigned long
 getcolor(const char *colstr) {
 	Colormap cmap = DefaultColormap(dpy, screen);
<a href="#h1-14" id="h1-14" class="h">@@ -861,41 +851,6 @@ getcolor(const char *colstr) {
</a> 	return color.pixel;
 }
 
<a href="#h1-14-3" id="h1-14-3" class="d">-Monitor *
</a><a href="#h1-14-4" id="h1-14-4" class="d">-getmon(Window w) {
</a><a href="#h1-14-5" id="h1-14-5" class="d">-	int x, y;
</a><a href="#h1-14-6" id="h1-14-6" class="d">-	Client *c;
</a><a href="#h1-14-7" id="h1-14-7" class="d">-	Monitor *m;
</a><a href="#h1-14-8" id="h1-14-8" class="d">-
</a><a href="#h1-14-9" id="h1-14-9" class="d">-	if(w == root &amp;&amp; getrootpointer(&amp;x, &amp;y))
</a><a href="#h1-14-10" id="h1-14-10" class="d">-		return getmonxy(x, y);
</a><a href="#h1-14-11" id="h1-14-11" class="d">-	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-14-12" id="h1-14-12" class="d">-		if(w == m-&gt;barwin)
</a><a href="#h1-14-13" id="h1-14-13" class="d">-			return m;
</a><a href="#h1-14-14" id="h1-14-14" class="d">-	if((c = getclient(w)))
</a><a href="#h1-14-15" id="h1-14-15" class="d">-		return c-&gt;mon;
</a><a href="#h1-14-16" id="h1-14-16" class="d">-	return mons;
</a><a href="#h1-14-17" id="h1-14-17" class="d">-}
</a><a href="#h1-14-18" id="h1-14-18" class="d">-
</a><a href="#h1-14-19" id="h1-14-19" class="d">-Monitor *
</a><a href="#h1-14-20" id="h1-14-20" class="d">-getmonn(unsigned int n) {
</a><a href="#h1-14-21" id="h1-14-21" class="d">-	unsigned int i;
</a><a href="#h1-14-22" id="h1-14-22" class="d">-	Monitor *m;
</a><a href="#h1-14-23" id="h1-14-23" class="d">-
</a><a href="#h1-14-24" id="h1-14-24" class="d">-	for(m = mons, i = 0; m &amp;&amp; i != n; m = m-&gt;next, i++);
</a><a href="#h1-14-25" id="h1-14-25" class="d">-	return m;
</a><a href="#h1-14-26" id="h1-14-26" class="d">-}
</a><a href="#h1-14-27" id="h1-14-27" class="d">-
</a><a href="#h1-14-28" id="h1-14-28" class="d">-Monitor *
</a><a href="#h1-14-29" id="h1-14-29" class="d">-getmonxy(int x, int y) {
</a><a href="#h1-14-30" id="h1-14-30" class="d">-	Monitor *m;
</a><a href="#h1-14-31" id="h1-14-31" class="d">-
</a><a href="#h1-14-32" id="h1-14-32" class="d">-	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-14-33" id="h1-14-33" class="d">-		if(INRECT(x, y, m-&gt;wx, m-&gt;wy, m-&gt;ww, m-&gt;wh))
</a><a href="#h1-14-34" id="h1-14-34" class="d">-			return m;
</a><a href="#h1-14-35" id="h1-14-35" class="d">-	return mons;
</a><a href="#h1-14-36" id="h1-14-36" class="d">-}
</a><a href="#h1-14-37" id="h1-14-37" class="d">-
</a> Bool
 getrootpointer(int *x, int *y) {
 	int di;
<a href="#h1-15" id="h1-15" class="h">@@ -987,6 +942,15 @@ grabkeys(void) {
</a> 	}
 }
 
<a href="#h1-15-3" id="h1-15-3" class="i">+Monitor *
</a><a href="#h1-15-4" id="h1-15-4" class="i">+idxtomon(unsigned int n) {
</a><a href="#h1-15-5" id="h1-15-5" class="i">+	unsigned int i;
</a><a href="#h1-15-6" id="h1-15-6" class="i">+	Monitor *m;
</a><a href="#h1-15-7" id="h1-15-7" class="i">+
</a><a href="#h1-15-8" id="h1-15-8" class="i">+	for(m = mons, i = 0; m &amp;&amp; i != n; m = m-&gt;next, i++);
</a><a href="#h1-15-9" id="h1-15-9" class="i">+	return m;
</a><a href="#h1-15-10" id="h1-15-10" class="i">+}
</a><a href="#h1-15-11" id="h1-15-11" class="i">+
</a> void
 initfont(const char *fontstr) {
 	char *def, **missing;
<a href="#h1-16" id="h1-16" class="h">@@ -1116,7 +1080,7 @@ manage(Window w, XWindowAttributes *wa) {
</a> 	grabbuttons(c, False);
 	updatetitle(c);
 	if(XGetTransientForHint(dpy, w, &amp;trans))
<a href="#h1-16-3" id="h1-16-3" class="d">-		t = getclient(trans);
</a><a href="#h1-16-4" id="h1-16-4" class="i">+		t = wintoclient(trans);
</a> 	if(t)
 		c-&gt;tags = t-&gt;tags;
 	else
<a href="#h1-17" id="h1-17" class="h">@@ -1151,7 +1115,7 @@ maprequest(XEvent *e) {
</a> 		return;
 	if(wa.override_redirect)
 		return;
<a href="#h1-17-3" id="h1-17-3" class="d">-	if(!getclient(ev-&gt;window))
</a><a href="#h1-17-4" id="h1-17-4" class="i">+	if(!wintoclient(ev-&gt;window))
</a> 		manage(ev-&gt;window, &amp;wa);
 }
 
<a href="#h1-18" id="h1-18" class="h">@@ -1212,7 +1176,7 @@ movemouse(const Arg *arg) {
</a> 	}
 	while(ev.type != ButtonRelease);
 	XUngrabPointer(dpy, CurrentTime);
<a href="#h1-18-3" id="h1-18-3" class="d">-	if((m = getmonxy(c-&gt;x + c-&gt;w / 2, c-&gt;y + c-&gt;h / 2)) != selmon) {
</a><a href="#h1-18-4" id="h1-18-4" class="i">+	if((m = pointertomon(c-&gt;x + c-&gt;w / 2, c-&gt;y + c-&gt;h / 2)) != selmon) {
</a> 		sendmon(c, m);
 		selmon = m;
 		focus(NULL);
<a href="#h1-19" id="h1-19" class="h">@@ -1225,6 +1189,16 @@ nexttiled(Client *c) {
</a> 	return c;
 }
 
<a href="#h1-19-3" id="h1-19-3" class="i">+Monitor *
</a><a href="#h1-19-4" id="h1-19-4" class="i">+pointertomon(int x, int y) {
</a><a href="#h1-19-5" id="h1-19-5" class="i">+	Monitor *m;
</a><a href="#h1-19-6" id="h1-19-6" class="i">+
</a><a href="#h1-19-7" id="h1-19-7" class="i">+	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-19-8" id="h1-19-8" class="i">+		if(INRECT(x, y, m-&gt;wx, m-&gt;wy, m-&gt;ww, m-&gt;wh))
</a><a href="#h1-19-9" id="h1-19-9" class="i">+			return m;
</a><a href="#h1-19-10" id="h1-19-10" class="i">+	return mons;
</a><a href="#h1-19-11" id="h1-19-11" class="i">+}
</a><a href="#h1-19-12" id="h1-19-12" class="i">+
</a> void
 propertynotify(XEvent *e) {
 	Client *c;
<a href="#h1-20" id="h1-20" class="h">@@ -1235,12 +1209,12 @@ propertynotify(XEvent *e) {
</a> 		updatestatus();
 	else if(ev-&gt;state == PropertyDelete)
 		return; /* ignore */
<a href="#h1-20-3" id="h1-20-3" class="d">-	else if((c = getclient(ev-&gt;window))) {
</a><a href="#h1-20-4" id="h1-20-4" class="i">+	else if((c = wintoclient(ev-&gt;window))) {
</a> 		switch (ev-&gt;atom) {
 		default: break;
 		case XA_WM_TRANSIENT_FOR:
 			XGetTransientForHint(dpy, c-&gt;win, &amp;trans);
<a href="#h1-20-9" id="h1-20-9" class="d">-			if(!c-&gt;isfloating &amp;&amp; (c-&gt;isfloating = (getclient(trans) != NULL)))
</a><a href="#h1-20-10" id="h1-20-10" class="i">+			if(!c-&gt;isfloating &amp;&amp; (c-&gt;isfloating = (wintoclient(trans) != NULL)))
</a> 				arrange();
 			break;
 		case XA_WM_NORMAL_HINTS:
<a href="#h1-21" id="h1-21" class="h">@@ -1324,7 +1298,7 @@ resizemouse(const Arg *arg) {
</a> 	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;bw - 1, c-&gt;h + c-&gt;bw - 1);
 	XUngrabPointer(dpy, CurrentTime);
 	while(XCheckMaskEvent(dpy, EnterWindowMask, &amp;ev));
<a href="#h1-21-3" id="h1-21-3" class="d">-	if((m = getmonxy(c-&gt;x + c-&gt;w / 2, c-&gt;y + c-&gt;h / 2)) != selmon) {
</a><a href="#h1-21-4" id="h1-21-4" class="i">+	if((m = pointertomon(c-&gt;x + c-&gt;w / 2, c-&gt;y + c-&gt;h / 2)) != selmon) {
</a> 		sendmon(c, m);
 		selmon = m;
 		focus(NULL);
<a href="#h1-22" id="h1-22" class="h">@@ -1557,7 +1531,7 @@ void
</a> tagmon(const Arg *arg) {
 	Monitor *m;
 
<a href="#h1-22-3" id="h1-22-3" class="d">-	if(!selmon-&gt;sel || !(m = getmonn(arg-&gt;ui)))
</a><a href="#h1-22-4" id="h1-22-4" class="i">+	if(!selmon-&gt;sel || !(m = idxtomon(arg-&gt;ui)))
</a> 		return;
 	sendmon(selmon-&gt;sel, m);
 }
<a href="#h1-23" id="h1-23" class="h">@@ -1670,19 +1644,13 @@ unmanage(Client *c) {
</a> 	XConfigureWindow(dpy, c-&gt;win, CWBorderWidth, &amp;wc); /* restore border */
 	detach(c);
 	detachstack(c);
<a href="#h1-23-3" id="h1-23-3" class="d">-	if(c-&gt;mon-&gt;sel == c) {
</a><a href="#h1-23-4" id="h1-23-4" class="d">-		/* TODO: consider separate the next code into a function or into detachstack? */
</a><a href="#h1-23-5" id="h1-23-5" class="d">-		Client *tc;
</a><a href="#h1-23-6" id="h1-23-6" class="d">-		for(tc = c-&gt;mon-&gt;stack; tc &amp;&amp; !ISVISIBLE(tc); tc = tc-&gt;snext);
</a><a href="#h1-23-7" id="h1-23-7" class="d">-		c-&gt;mon-&gt;sel = tc;
</a><a href="#h1-23-8" id="h1-23-8" class="d">-		focus(NULL);
</a><a href="#h1-23-9" id="h1-23-9" class="d">-	}
</a> 	XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
 	setclientstate(c, WithdrawnState);
 	free(c);
 	XSync(dpy, False);
 	XSetErrorHandler(xerror);
 	XUngrabServer(dpy);
<a href="#h1-23-16" id="h1-23-16" class="i">+	focus(NULL);
</a> 	arrange();
 }
 
<a href="#h1-24" id="h1-24" class="h">@@ -1691,7 +1659,7 @@ unmapnotify(XEvent *e) {
</a> 	Client *c;
 	XUnmapEvent *ev = &amp;e-&gt;xunmap;
 
<a href="#h1-24-3" id="h1-24-3" class="d">-	if((c = getclient(ev-&gt;window)))
</a><a href="#h1-24-4" id="h1-24-4" class="i">+	if((c = wintoclient(ev-&gt;window)))
</a> 		unmanage(c);
 }
 
<a href="#h1-25" id="h1-25" class="h">@@ -1733,14 +1701,12 @@ updategeom(void) {
</a> 	Client *c;
 	Monitor *newmons = NULL, *m, *tm;
 
<a href="#h1-25-3" id="h1-25-3" class="d">-#ifdef XINULATOR
</a><a href="#h1-25-4" id="h1-25-4" class="d">-	n = 2;
</a><a href="#h1-25-5" id="h1-25-5" class="d">-#elif defined(XINERAMA)
</a><a href="#h1-25-6" id="h1-25-6" class="i">+#ifdef XINERAMA
</a> 	XineramaScreenInfo *info = NULL;
 
 	if(XineramaIsActive(dpy))
 		info = XineramaQueryScreens(dpy, &amp;n);
<a href="#h1-25-11" id="h1-25-11" class="d">-#endif
</a><a href="#h1-25-12" id="h1-25-12" class="i">+#endif /* XINERAMA */
</a> 	/* allocate monitor(s) for the new geometry setup */
 	for(i = 0; i &lt; n; i++) {
 		m = (Monitor *)malloc(sizeof(Monitor));
<a href="#h1-26" id="h1-26" class="h">@@ -1749,23 +1715,7 @@ updategeom(void) {
</a> 	}
 
 	/* initialise monitor(s) */
<a href="#h1-26-3" id="h1-26-3" class="d">-#ifdef XINULATOR
</a><a href="#h1-26-4" id="h1-26-4" class="d">-	if(1) {
</a><a href="#h1-26-5" id="h1-26-5" class="d">-		m = newmons;
</a><a href="#h1-26-6" id="h1-26-6" class="d">-		m-&gt;screen_number = 0;
</a><a href="#h1-26-7" id="h1-26-7" class="d">-		m-&gt;wx = sx;
</a><a href="#h1-26-8" id="h1-26-8" class="d">-		m-&gt;my = m-&gt;wy = sy;
</a><a href="#h1-26-9" id="h1-26-9" class="d">-		m-&gt;ww = sw;
</a><a href="#h1-26-10" id="h1-26-10" class="d">-		m-&gt;mh = m-&gt;wh = sh / 2;
</a><a href="#h1-26-11" id="h1-26-11" class="d">-		m = newmons-&gt;next;
</a><a href="#h1-26-12" id="h1-26-12" class="d">-		m-&gt;screen_number = 1;
</a><a href="#h1-26-13" id="h1-26-13" class="d">-		m-&gt;wx = sx;
</a><a href="#h1-26-14" id="h1-26-14" class="d">-		m-&gt;my = m-&gt;wy = sy + sh / 2;
</a><a href="#h1-26-15" id="h1-26-15" class="d">-		m-&gt;ww = sw;
</a><a href="#h1-26-16" id="h1-26-16" class="d">-		m-&gt;mh = m-&gt;wh = sh / 2;
</a><a href="#h1-26-17" id="h1-26-17" class="d">-	}
</a><a href="#h1-26-18" id="h1-26-18" class="d">-	else
</a><a href="#h1-26-19" id="h1-26-19" class="d">-#elif defined(XINERAMA)
</a><a href="#h1-26-20" id="h1-26-20" class="i">+#ifdef XINERAMA
</a> 	if(XineramaIsActive(dpy)) {
 		for(i = 0, m = newmons; m; m = m-&gt;next, i++) {
 			m-&gt;screen_number = info[i].screen_number;
<a href="#h1-27" id="h1-27" class="h">@@ -1777,7 +1727,7 @@ updategeom(void) {
</a> 		XFree(info);
 	}
 	else
<a href="#h1-27-3" id="h1-27-3" class="d">-#endif
</a><a href="#h1-27-4" id="h1-27-4" class="i">+#endif /* XINERAMA */
</a> 	/* default monitor setup */
 	{
 		m-&gt;screen_number = 0;
<a href="#h1-28" id="h1-28" class="h">@@ -1789,16 +1739,13 @@ updategeom(void) {
</a> 
 	/* bar geometry setup */
 	for(m = newmons; m; m = m-&gt;next) {
<a href="#h1-28-3" id="h1-28-3" class="d">-		/* TODO: consider removing the following values from config.h */
</a><a href="#h1-28-4" id="h1-28-4" class="d">-		m-&gt;clients = NULL;
</a><a href="#h1-28-5" id="h1-28-5" class="d">-		m-&gt;sel = NULL;
</a><a href="#h1-28-6" id="h1-28-6" class="d">-		m-&gt;stack = NULL;
</a><a href="#h1-28-7" id="h1-28-7" class="i">+		m-&gt;sel = m-&gt;stack = m-&gt;clients = NULL;
</a> 		m-&gt;seltags = 0;
 		m-&gt;sellt = 0;
 		m-&gt;tagset[0] = m-&gt;tagset[1] = 1;
 		m-&gt;mfact = mfact;
<a href="#h1-28-12" id="h1-28-12" class="d">-		m-&gt;showbar = showbar;
</a><a href="#h1-28-13" id="h1-28-13" class="d">-		m-&gt;topbar = topbar;
</a><a href="#h1-28-14" id="h1-28-14" class="i">+		m-&gt;showbar = SHOWBAR;
</a><a href="#h1-28-15" id="h1-28-15" class="i">+		m-&gt;topbar = TOPBAR;
</a> 		updatebarpos(m);
 	}
 
<a href="#h1-29" id="h1-29" class="h">@@ -1816,7 +1763,7 @@ updategeom(void) {
</a> 	/* select focused monitor */
 	cleanupmons();
 	mons = newmons;
<a href="#h1-29-3" id="h1-29-3" class="d">-	selmon = getmon(root);
</a><a href="#h1-29-4" id="h1-29-4" class="i">+	selmon = wintomon(root);
</a> }
 
 void
<a href="#h1-30" id="h1-30" class="h">@@ -1923,6 +1870,34 @@ view(const Arg *arg) {
</a> 	arrange();
 }
 
<a href="#h1-30-3" id="h1-30-3" class="i">+Client *
</a><a href="#h1-30-4" id="h1-30-4" class="i">+wintoclient(Window w) {
</a><a href="#h1-30-5" id="h1-30-5" class="i">+	Client *c;
</a><a href="#h1-30-6" id="h1-30-6" class="i">+	Monitor *m;
</a><a href="#h1-30-7" id="h1-30-7" class="i">+
</a><a href="#h1-30-8" id="h1-30-8" class="i">+	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-30-9" id="h1-30-9" class="i">+		for(c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h1-30-10" id="h1-30-10" class="i">+			if(c-&gt;win == w)
</a><a href="#h1-30-11" id="h1-30-11" class="i">+				return c;
</a><a href="#h1-30-12" id="h1-30-12" class="i">+	return NULL;
</a><a href="#h1-30-13" id="h1-30-13" class="i">+}
</a><a href="#h1-30-14" id="h1-30-14" class="i">+
</a><a href="#h1-30-15" id="h1-30-15" class="i">+Monitor *
</a><a href="#h1-30-16" id="h1-30-16" class="i">+wintomon(Window w) {
</a><a href="#h1-30-17" id="h1-30-17" class="i">+	int x, y;
</a><a href="#h1-30-18" id="h1-30-18" class="i">+	Client *c;
</a><a href="#h1-30-19" id="h1-30-19" class="i">+	Monitor *m;
</a><a href="#h1-30-20" id="h1-30-20" class="i">+
</a><a href="#h1-30-21" id="h1-30-21" class="i">+	if(w == root &amp;&amp; getrootpointer(&amp;x, &amp;y))
</a><a href="#h1-30-22" id="h1-30-22" class="i">+		return pointertomon(x, y);
</a><a href="#h1-30-23" id="h1-30-23" class="i">+	for(m = mons; m; m = m-&gt;next)
</a><a href="#h1-30-24" id="h1-30-24" class="i">+		if(w == m-&gt;barwin)
</a><a href="#h1-30-25" id="h1-30-25" class="i">+			return m;
</a><a href="#h1-30-26" id="h1-30-26" class="i">+	if((c = wintoclient(w)))
</a><a href="#h1-30-27" id="h1-30-27" class="i">+		return c-&gt;mon;
</a><a href="#h1-30-28" id="h1-30-28" class="i">+	return mons;
</a><a href="#h1-30-29" id="h1-30-29" class="i">+}
</a><a href="#h1-30-30" id="h1-30-30" class="i">+
</a> /* There&#39;s no way to check accesses to destroyed windows, thus those cases are
  * ignored (especially on UnmapNotify&#39;s).  Other types of errors call Xlibs
  * default error handler, which may call exit.  */
</pre>
</div>
</body>
</html>
