<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>removed Monitor-&gt;dc, unnecessary - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/c2737b7b9317743e3430c71bc0a9afcc6b0f70f7.html">c2737b7b9317743e3430c71bc0a9afcc6b0f70f7</a>
<b>parent</b> <a href="../commit/191cb9ce283090c48f17c9518a9b6a553085c8e4.html">191cb9ce283090c48f17c9518a9b6a553085c8e4</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Mon, 18 Feb 2008 17:08:22 +0000

removed Monitor-&gt;dc, unnecessary
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dwm.c</a></td><td> | </td><td class="num">249</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 125 insertions(+), 124 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -117,10 +117,9 @@ typedef struct {
</a> } Regs;
 
 typedef struct {
<a href="#h0-0-3" id="h0-0-3" class="d">-	int screen;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	int monitor;
</a> 	Window barwin;
 	int sx, sy, sw, sh, wax, way, wah, waw;
<a href="#h0-0-7" id="h0-0-7" class="d">-	DC dc;
</a> 	Bool *seltags;
 	Bool *prevtags;
 	Layout *layout;
<a href="#h0-1" id="h0-1" class="h">@@ -156,13 +155,13 @@ void focusin(XEvent *e);
</a> void focusnext(const char *arg);
 void focusprev(const char *arg);
 Client *getclient(Window w);
<a href="#h0-1-3" id="h0-1-3" class="d">-unsigned long getcolor(const char *colstr, int screen);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+unsigned long getcolor(const char *colstr);
</a> long getstate(Window w);
 Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 void grabbuttons(Client *c, Bool focused);
 void grabkeys(void);
 unsigned int idxoftag(const char *tag);
<a href="#h0-1-10" id="h0-1-10" class="d">-void initfont(Monitor*, const char *fontstr);
</a><a href="#h0-1-11" id="h0-1-11" class="i">+void initfont(const char *fontstr);
</a> Bool isoccupied(unsigned int monitor, unsigned int t);
 Bool isprotodel(Client *c);
 Bool isurgent(unsigned int monitor, unsigned int t);
<a href="#h0-2" id="h0-2" class="h">@@ -188,8 +187,8 @@ void setmwfact(const char *arg);
</a> void setup(void);
 void spawn(const char *arg);
 void tag(const char *arg);
<a href="#h0-2-3" id="h0-2-3" class="d">-unsigned int textnw(Monitor*, const char *text, unsigned int len);
</a><a href="#h0-2-4" id="h0-2-4" class="d">-unsigned int textw(Monitor*, const char *text);
</a><a href="#h0-2-5" id="h0-2-5" class="i">+unsigned int textnw(const char *text, unsigned int len);
</a><a href="#h0-2-6" id="h0-2-6" class="i">+unsigned int textw(const char *text);
</a> void tile(void);
 void togglebar(const char *arg);
 void togglefloating(const char *arg);
<a href="#h0-3" id="h0-3" class="h">@@ -216,6 +215,7 @@ void selectmonitor(const char *arg);
</a> char stext[256];
 int mcount = 1;
 int selmonitor = 0;
<a href="#h0-3-3" id="h0-3-3" class="i">+int screen;
</a> int (*xerrorxlib)(Display *, XErrorEvent *);
 unsigned int bh, bpos;
 unsigned int blw = 0;
<a href="#h0-4" id="h0-4" class="h">@@ -343,7 +343,7 @@ buttonpress(XEvent *e) {
</a> 	if(ev-&gt;window == m-&gt;barwin) {
 		x = 0;
 		for(i = 0; i &lt; LENGTH(tags); i++) {
<a href="#h0-4-3" id="h0-4-3" class="d">-			x += textw(m, tags[i]);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+			x += textw(tags[i]);
</a> 			if(ev-&gt;x &lt; x) {
 				if(ev-&gt;button == Button1) {
 					if(ev-&gt;state &amp; MODKEY)
<a href="#h0-5" id="h0-5" class="h">@@ -408,22 +408,21 @@ cleanup(void) {
</a> 		unban(stack);
 		unmanage(stack);
 	}
<a href="#h0-5-3" id="h0-5-3" class="d">-	for(i = 0; i &lt; mcount; i++) {
</a><a href="#h0-5-4" id="h0-5-4" class="d">-		Monitor *m = &amp;monitors[i];
</a><a href="#h0-5-5" id="h0-5-5" class="d">-		if(m-&gt;dc.font.set)
</a><a href="#h0-5-6" id="h0-5-6" class="d">-			XFreeFontSet(dpy, m-&gt;dc.font.set);
</a><a href="#h0-5-7" id="h0-5-7" class="d">-		else
</a><a href="#h0-5-8" id="h0-5-8" class="d">-			XFreeFont(dpy, m-&gt;dc.font.xfont);
</a><a href="#h0-5-9" id="h0-5-9" class="d">-		XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h0-5-10" id="h0-5-10" class="d">-		XFreePixmap(dpy, m-&gt;dc.drawable);
</a><a href="#h0-5-11" id="h0-5-11" class="d">-		XFreeGC(dpy, m-&gt;dc.gc);
</a><a href="#h0-5-12" id="h0-5-12" class="d">-		XDestroyWindow(dpy, m-&gt;barwin);
</a><a href="#h0-5-13" id="h0-5-13" class="d">-		XFreeCursor(dpy, cursor[CurNormal]);
</a><a href="#h0-5-14" id="h0-5-14" class="d">-		XFreeCursor(dpy, cursor[CurResize]);
</a><a href="#h0-5-15" id="h0-5-15" class="d">-		XFreeCursor(dpy, cursor[CurMove]);
</a><a href="#h0-5-16" id="h0-5-16" class="d">-		XSetInputFocus(dpy, PointerRoot, RevertToPointerRoot, CurrentTime);
</a><a href="#h0-5-17" id="h0-5-17" class="d">-		XSync(dpy, False);
</a><a href="#h0-5-18" id="h0-5-18" class="d">-	}
</a><a href="#h0-5-19" id="h0-5-19" class="i">+	if(dc.font.set)
</a><a href="#h0-5-20" id="h0-5-20" class="i">+		XFreeFontSet(dpy, dc.font.set);
</a><a href="#h0-5-21" id="h0-5-21" class="i">+	else
</a><a href="#h0-5-22" id="h0-5-22" class="i">+		XFreeFont(dpy, dc.font.xfont);
</a><a href="#h0-5-23" id="h0-5-23" class="i">+
</a><a href="#h0-5-24" id="h0-5-24" class="i">+	XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h0-5-25" id="h0-5-25" class="i">+	XFreePixmap(dpy, dc.drawable);
</a><a href="#h0-5-26" id="h0-5-26" class="i">+	XFreeGC(dpy, dc.gc);
</a><a href="#h0-5-27" id="h0-5-27" class="i">+	XFreeCursor(dpy, cursor[CurNormal]);
</a><a href="#h0-5-28" id="h0-5-28" class="i">+	XFreeCursor(dpy, cursor[CurResize]);
</a><a href="#h0-5-29" id="h0-5-29" class="i">+	XFreeCursor(dpy, cursor[CurMove]);
</a><a href="#h0-5-30" id="h0-5-30" class="i">+	for(i = 0; i &lt; mcount; i++)
</a><a href="#h0-5-31" id="h0-5-31" class="i">+		XDestroyWindow(dpy, monitors[i].barwin);
</a><a href="#h0-5-32" id="h0-5-32" class="i">+	XSync(dpy, False);
</a><a href="#h0-5-33" id="h0-5-33" class="i">+	XSetInputFocus(dpy, PointerRoot, RevertToPointerRoot, CurrentTime);
</a> }
 
 void
<a href="#h0-6" id="h0-6" class="h">@@ -476,10 +475,11 @@ configurenotify(XEvent *e) {
</a> 	Monitor *m = &amp;monitors[selmonitor];
 
 	if(ev-&gt;window == root &amp;&amp; (ev-&gt;width != m-&gt;sw || ev-&gt;height != m-&gt;sh)) {
<a href="#h0-6-3" id="h0-6-3" class="i">+		/* TODO -- update Xinerama dimensions here */
</a> 		m-&gt;sw = ev-&gt;width;
 		m-&gt;sh = ev-&gt;height;
 		XFreePixmap(dpy, dc.drawable);
<a href="#h0-6-7" id="h0-6-7" class="d">-		dc.drawable = XCreatePixmap(dpy, root, m-&gt;sw, bh, DefaultDepth(dpy, m-&gt;screen));
</a><a href="#h0-6-8" id="h0-6-8" class="i">+		dc.drawable = XCreatePixmap(dpy, root, DisplayWidth(root, screen), bh, DefaultDepth(dpy, screen));
</a> 		XResizeWindow(dpy, m-&gt;barwin, m-&gt;sw, bh);
 		updatebarpos(m);
 		arrange();
<a href="#h0-7" id="h0-7" class="h">@@ -566,47 +566,47 @@ drawbar(void) {
</a> 
 	for(i = 0; i &lt; mcount; i++) {
 		Monitor *m = &amp;monitors[i];
<a href="#h0-7-3" id="h0-7-3" class="d">-		m-&gt;dc.x = 0;
</a><a href="#h0-7-4" id="h0-7-4" class="i">+		dc.x = 0;
</a> 		for(c = stack; c &amp;&amp; !isvisible(c, i); c = c-&gt;snext);
 		fprintf(stderr, &quot;m%d %s\n&quot;, i, c ? c-&gt;name : &quot;NIL&quot;);
 		for(j = 0; j &lt; LENGTH(tags); j++) {
<a href="#h0-7-8" id="h0-7-8" class="d">-			m-&gt;dc.w = textw(m, tags[j]);
</a><a href="#h0-7-9" id="h0-7-9" class="i">+			dc.w = textw(tags[j]);
</a> 			if(m-&gt;seltags[j]) {
<a href="#h0-7-11" id="h0-7-11" class="d">-				drawtext(m, tags[j], m-&gt;dc.sel, isurgent(i, j));
</a><a href="#h0-7-12" id="h0-7-12" class="i">+				drawtext(m, tags[j], dc.sel, isurgent(i, j));
</a> 				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
<a href="#h0-7-14" id="h0-7-14" class="d">-						isoccupied(i, j), isurgent(i, j), m-&gt;dc.sel);
</a><a href="#h0-7-15" id="h0-7-15" class="i">+						isoccupied(i, j), isurgent(i, j), dc.sel);
</a> 			}
 			else {
<a href="#h0-7-18" id="h0-7-18" class="d">-				drawtext(m, tags[j], m-&gt;dc.norm, isurgent(i, j));
</a><a href="#h0-7-19" id="h0-7-19" class="i">+				drawtext(m, tags[j], dc.norm, isurgent(i, j));
</a> 				drawsquare(m, c &amp;&amp; c-&gt;tags[j] &amp;&amp; c-&gt;monitor == i,
<a href="#h0-7-21" id="h0-7-21" class="d">-						isoccupied(i, j), isurgent(i, j), m-&gt;dc.norm);
</a><a href="#h0-7-22" id="h0-7-22" class="i">+						isoccupied(i, j), isurgent(i, j), dc.norm);
</a> 			}
<a href="#h0-7-24" id="h0-7-24" class="d">-			m-&gt;dc.x += m-&gt;dc.w;
</a><a href="#h0-7-25" id="h0-7-25" class="i">+			dc.x += dc.w;
</a> 		}
<a href="#h0-7-27" id="h0-7-27" class="d">-		m-&gt;dc.w = blw;
</a><a href="#h0-7-28" id="h0-7-28" class="d">-		drawtext(m, m-&gt;layout-&gt;symbol, m-&gt;dc.norm, False);
</a><a href="#h0-7-29" id="h0-7-29" class="d">-		x = m-&gt;dc.x + m-&gt;dc.w;
</a><a href="#h0-7-30" id="h0-7-30" class="i">+		dc.w = blw;
</a><a href="#h0-7-31" id="h0-7-31" class="i">+		drawtext(m, m-&gt;layout-&gt;symbol, dc.norm, False);
</a><a href="#h0-7-32" id="h0-7-32" class="i">+		x = dc.x + dc.w;
</a> 		if(i == selmonitor) {
<a href="#h0-7-34" id="h0-7-34" class="d">-			m-&gt;dc.w = textw(m, stext);
</a><a href="#h0-7-35" id="h0-7-35" class="d">-			m-&gt;dc.x = m-&gt;sw - m-&gt;dc.w;
</a><a href="#h0-7-36" id="h0-7-36" class="d">-			if(m-&gt;dc.x &lt; x) {
</a><a href="#h0-7-37" id="h0-7-37" class="d">-				m-&gt;dc.x = x;
</a><a href="#h0-7-38" id="h0-7-38" class="d">-				m-&gt;dc.w = m-&gt;sw - x;
</a><a href="#h0-7-39" id="h0-7-39" class="i">+			dc.w = textw(stext);
</a><a href="#h0-7-40" id="h0-7-40" class="i">+			dc.x = m-&gt;sw - dc.w;
</a><a href="#h0-7-41" id="h0-7-41" class="i">+			if(dc.x &lt; x) {
</a><a href="#h0-7-42" id="h0-7-42" class="i">+				dc.x = x;
</a><a href="#h0-7-43" id="h0-7-43" class="i">+				dc.w = m-&gt;sw - x;
</a> 			}
<a href="#h0-7-45" id="h0-7-45" class="d">-			drawtext(m, stext, m-&gt;dc.norm, False);
</a><a href="#h0-7-46" id="h0-7-46" class="i">+			drawtext(m, stext, dc.norm, False);
</a> 		}
 		else
<a href="#h0-7-49" id="h0-7-49" class="d">-			m-&gt;dc.x = m-&gt;sw;
</a><a href="#h0-7-50" id="h0-7-50" class="d">-		if((m-&gt;dc.w = m-&gt;dc.x - x) &gt; bh) {
</a><a href="#h0-7-51" id="h0-7-51" class="d">-			m-&gt;dc.x = x;
</a><a href="#h0-7-52" id="h0-7-52" class="i">+			dc.x = m-&gt;sw;
</a><a href="#h0-7-53" id="h0-7-53" class="i">+		if((dc.w = dc.x - x) &gt; bh) {
</a><a href="#h0-7-54" id="h0-7-54" class="i">+			dc.x = x;
</a> 			if(c) {
<a href="#h0-7-56" id="h0-7-56" class="d">-				drawtext(m, c-&gt;name, m-&gt;dc.sel, False);
</a><a href="#h0-7-57" id="h0-7-57" class="d">-				drawsquare(m, False, c-&gt;isfloating, False, m-&gt;dc.sel);
</a><a href="#h0-7-58" id="h0-7-58" class="i">+				drawtext(m, c-&gt;name, dc.sel, False);
</a><a href="#h0-7-59" id="h0-7-59" class="i">+				drawsquare(m, False, c-&gt;isfloating, False, dc.sel);
</a> 			}
 			else
<a href="#h0-7-62" id="h0-7-62" class="d">-				drawtext(m, NULL, m-&gt;dc.norm, False);
</a><a href="#h0-7-63" id="h0-7-63" class="i">+				drawtext(m, NULL, dc.norm, False);
</a> 		}
<a href="#h0-7-65" id="h0-7-65" class="d">-		XCopyArea(dpy, m-&gt;dc.drawable, m-&gt;barwin, m-&gt;dc.gc, 0, 0, m-&gt;sw, bh, 0, 0);
</a><a href="#h0-7-66" id="h0-7-66" class="i">+		XCopyArea(dpy, dc.drawable, m-&gt;barwin, dc.gc, 0, 0, m-&gt;sw, bh, 0, 0);
</a> 		XSync(dpy, False);
 	}
 }
<a href="#h0-8" id="h0-8" class="h">@@ -615,20 +615,20 @@ void
</a> drawsquare(Monitor *m, Bool filled, Bool empty, Bool invert, unsigned long col[ColLast]) {
 	int x;
 	XGCValues gcv;
<a href="#h0-8-3" id="h0-8-3" class="d">-	XRectangle r = { m-&gt;dc.x, m-&gt;dc.y, m-&gt;dc.w, m-&gt;dc.h };
</a><a href="#h0-8-4" id="h0-8-4" class="i">+	XRectangle r = { dc.x, dc.y, dc.w, dc.h };
</a> 
 	gcv.foreground = col[invert ? ColBG : ColFG];
<a href="#h0-8-7" id="h0-8-7" class="d">-	XChangeGC(dpy, m-&gt;dc.gc, GCForeground, &amp;gcv);
</a><a href="#h0-8-8" id="h0-8-8" class="d">-	x = (m-&gt;dc.font.ascent + m-&gt;dc.font.descent + 2) / 4;
</a><a href="#h0-8-9" id="h0-8-9" class="d">-	r.x = m-&gt;dc.x + 1;
</a><a href="#h0-8-10" id="h0-8-10" class="d">-	r.y = m-&gt;dc.y + 1;
</a><a href="#h0-8-11" id="h0-8-11" class="i">+	XChangeGC(dpy, dc.gc, GCForeground, &amp;gcv);
</a><a href="#h0-8-12" id="h0-8-12" class="i">+	x = (dc.font.ascent + dc.font.descent + 2) / 4;
</a><a href="#h0-8-13" id="h0-8-13" class="i">+	r.x = dc.x + 1;
</a><a href="#h0-8-14" id="h0-8-14" class="i">+	r.y = dc.y + 1;
</a> 	if(filled) {
 		r.width = r.height = x + 1;
<a href="#h0-8-17" id="h0-8-17" class="d">-		XFillRectangles(dpy, m-&gt;dc.drawable, m-&gt;dc.gc, &amp;r, 1);
</a><a href="#h0-8-18" id="h0-8-18" class="i">+		XFillRectangles(dpy, dc.drawable, dc.gc, &amp;r, 1);
</a> 	}
 	else if(empty) {
 		r.width = r.height = x;
<a href="#h0-8-22" id="h0-8-22" class="d">-		XDrawRectangles(dpy, m-&gt;dc.drawable, m-&gt;dc.gc, &amp;r, 1);
</a><a href="#h0-8-23" id="h0-8-23" class="i">+		XDrawRectangles(dpy, dc.drawable, dc.gc, &amp;r, 1);
</a> 	}
 }
 
<a href="#h0-9" id="h0-9" class="h">@@ -637,10 +637,10 @@ drawtext(Monitor *m, const char *text, unsigned long col[ColLast], Bool invert) 
</a> 	int x, y, w, h;
 	static char buf[256];
 	unsigned int len, olen;
<a href="#h0-9-3" id="h0-9-3" class="d">-	XRectangle r = { m-&gt;dc.x, m-&gt;dc.y, m-&gt;dc.w, m-&gt;dc.h };
</a><a href="#h0-9-4" id="h0-9-4" class="i">+	XRectangle r = { dc.x, dc.y, dc.w, dc.h };
</a> 
<a href="#h0-9-6" id="h0-9-6" class="d">-	XSetForeground(dpy, m-&gt;dc.gc, col[invert ? ColFG : ColBG]);
</a><a href="#h0-9-7" id="h0-9-7" class="d">-	XFillRectangles(dpy, m-&gt;dc.drawable, m-&gt;dc.gc, &amp;r, 1);
</a><a href="#h0-9-8" id="h0-9-8" class="i">+	XSetForeground(dpy, dc.gc, col[invert ? ColFG : ColBG]);
</a><a href="#h0-9-9" id="h0-9-9" class="i">+	XFillRectangles(dpy, dc.drawable, dc.gc, &amp;r, 1);
</a> 	if(!text)
 		return;
 	w = 0;
<a href="#h0-10" id="h0-10" class="h">@@ -649,11 +649,11 @@ drawtext(Monitor *m, const char *text, unsigned long col[ColLast], Bool invert) 
</a> 		len = sizeof buf - 1;
 	memcpy(buf, text, len);
 	buf[len] = 0;
<a href="#h0-10-3" id="h0-10-3" class="d">-	h = m-&gt;dc.font.ascent + m-&gt;dc.font.descent;
</a><a href="#h0-10-4" id="h0-10-4" class="d">-	y = m-&gt;dc.y + (m-&gt;dc.h / 2) - (h / 2) + m-&gt;dc.font.ascent;
</a><a href="#h0-10-5" id="h0-10-5" class="d">-	x = m-&gt;dc.x + (h / 2);
</a><a href="#h0-10-6" id="h0-10-6" class="i">+	h = dc.font.ascent + dc.font.descent;
</a><a href="#h0-10-7" id="h0-10-7" class="i">+	y = dc.y + (dc.h / 2) - (h / 2) + dc.font.ascent;
</a><a href="#h0-10-8" id="h0-10-8" class="i">+	x = dc.x + (h / 2);
</a> 	/* shorten text if necessary */
<a href="#h0-10-10" id="h0-10-10" class="d">-	while(len &amp;&amp; (w = textnw(m, buf, len)) &gt; m-&gt;dc.w - h)
</a><a href="#h0-10-11" id="h0-10-11" class="i">+	while(len &amp;&amp; (w = textnw(buf, len)) &gt; dc.w - h)
</a> 		buf[--len] = 0;
 	if(len &lt; olen) {
 		if(len &gt; 1)
<a href="#h0-11" id="h0-11" class="h">@@ -663,13 +663,13 @@ drawtext(Monitor *m, const char *text, unsigned long col[ColLast], Bool invert) 
</a> 		if(len &gt; 3)
 			buf[len - 3] = &#39;.&#39;;
 	}
<a href="#h0-11-3" id="h0-11-3" class="d">-	if(w &gt; m-&gt;dc.w)
</a><a href="#h0-11-4" id="h0-11-4" class="i">+	if(w &gt; dc.w)
</a> 		return; /* too long */
<a href="#h0-11-6" id="h0-11-6" class="d">-	XSetForeground(dpy, m-&gt;dc.gc, col[invert ? ColBG : ColFG]);
</a><a href="#h0-11-7" id="h0-11-7" class="d">-	if(m-&gt;dc.font.set)
</a><a href="#h0-11-8" id="h0-11-8" class="d">-		XmbDrawString(dpy, m-&gt;dc.drawable, m-&gt;dc.font.set, m-&gt;dc.gc, x, y, buf, len);
</a><a href="#h0-11-9" id="h0-11-9" class="i">+	XSetForeground(dpy, dc.gc, col[invert ? ColBG : ColFG]);
</a><a href="#h0-11-10" id="h0-11-10" class="i">+	if(dc.font.set)
</a><a href="#h0-11-11" id="h0-11-11" class="i">+		XmbDrawString(dpy, dc.drawable, dc.font.set, dc.gc, x, y, buf, len);
</a> 	else
<a href="#h0-11-13" id="h0-11-13" class="d">-		XDrawString(dpy, m-&gt;dc.drawable, m-&gt;dc.gc, x, y, buf, len);
</a><a href="#h0-11-14" id="h0-11-14" class="i">+		XDrawString(dpy, dc.drawable, dc.gc, x, y, buf, len);
</a> }
 
 void *
<a href="#h0-12" id="h0-12" class="h">@@ -740,7 +740,7 @@ focus(Client *c) {
</a> 		for(c = stack; c &amp;&amp; !isvisible(c, c-&gt;monitor); c = c-&gt;snext);
 	if(sel &amp;&amp; sel != c) {
 		grabbuttons(sel, False);
<a href="#h0-12-3" id="h0-12-3" class="d">-		XSetWindowBorder(dpy, sel-&gt;win, monitors[sel-&gt;monitor].dc.norm[ColBorder]);
</a><a href="#h0-12-4" id="h0-12-4" class="i">+		XSetWindowBorder(dpy, sel-&gt;win, dc.norm[ColBorder]);
</a> 	}
 	if(c) {
 		detachstack(c);
<a href="#h0-13" id="h0-13" class="h">@@ -750,7 +750,7 @@ focus(Client *c) {
</a> 	sel = c;
 	drawbar();
 	if(c) {
<a href="#h0-13-3" id="h0-13-3" class="d">-		XSetWindowBorder(dpy, c-&gt;win, m-&gt;dc.sel[ColBorder]);
</a><a href="#h0-13-4" id="h0-13-4" class="i">+		XSetWindowBorder(dpy, c-&gt;win, dc.sel[ColBorder]);
</a> 		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
 		selmonitor = c-&gt;monitor;
 	}
<a href="#h0-14" id="h0-14" class="h">@@ -809,7 +809,7 @@ getclient(Window w) {
</a> }
 
 unsigned long
<a href="#h0-14-3" id="h0-14-3" class="d">-getcolor(const char *colstr, int screen) {
</a><a href="#h0-14-4" id="h0-14-4" class="i">+getcolor(const char *colstr) {
</a> 	Colormap cmap = DefaultColormap(dpy, screen);
 	XColor color;
 
<a href="#h0-15" id="h0-15" class="h">@@ -937,45 +937,45 @@ idxoftag(const char *tag) {
</a> }
 
 void
<a href="#h0-15-3" id="h0-15-3" class="d">-initfont(Monitor *m, const char *fontstr) {
</a><a href="#h0-15-4" id="h0-15-4" class="i">+initfont(const char *fontstr) {
</a> 	char *def, **missing;
 	int i, n;
 
 	missing = NULL;
<a href="#h0-15-9" id="h0-15-9" class="d">-	if(m-&gt;dc.font.set)
</a><a href="#h0-15-10" id="h0-15-10" class="d">-		XFreeFontSet(dpy, m-&gt;dc.font.set);
</a><a href="#h0-15-11" id="h0-15-11" class="d">-	m-&gt;dc.font.set = XCreateFontSet(dpy, fontstr, &amp;missing, &amp;n, &amp;def);
</a><a href="#h0-15-12" id="h0-15-12" class="i">+	if(dc.font.set)
</a><a href="#h0-15-13" id="h0-15-13" class="i">+		XFreeFontSet(dpy, dc.font.set);
</a><a href="#h0-15-14" id="h0-15-14" class="i">+	dc.font.set = XCreateFontSet(dpy, fontstr, &amp;missing, &amp;n, &amp;def);
</a> 	if(missing) {
 		while(n--)
 			fprintf(stderr, &quot;dwm: missing fontset: %s\n&quot;, missing[n]);
 		XFreeStringList(missing);
 	}
<a href="#h0-15-20" id="h0-15-20" class="d">-	if(m-&gt;dc.font.set) {
</a><a href="#h0-15-21" id="h0-15-21" class="i">+	if(dc.font.set) {
</a> 		XFontSetExtents *font_extents;
 		XFontStruct **xfonts;
 		char **font_names;
<a href="#h0-15-25" id="h0-15-25" class="d">-		m-&gt;dc.font.ascent = m-&gt;dc.font.descent = 0;
</a><a href="#h0-15-26" id="h0-15-26" class="d">-		font_extents = XExtentsOfFontSet(m-&gt;dc.font.set);
</a><a href="#h0-15-27" id="h0-15-27" class="d">-		n = XFontsOfFontSet(m-&gt;dc.font.set, &amp;xfonts, &amp;font_names);
</a><a href="#h0-15-28" id="h0-15-28" class="d">-		for(i = 0, m-&gt;dc.font.ascent = 0, m-&gt;dc.font.descent = 0; i &lt; n; i++) {
</a><a href="#h0-15-29" id="h0-15-29" class="d">-			if(m-&gt;dc.font.ascent &lt; (*xfonts)-&gt;ascent)
</a><a href="#h0-15-30" id="h0-15-30" class="d">-				m-&gt;dc.font.ascent = (*xfonts)-&gt;ascent;
</a><a href="#h0-15-31" id="h0-15-31" class="d">-			if(m-&gt;dc.font.descent &lt; (*xfonts)-&gt;descent)
</a><a href="#h0-15-32" id="h0-15-32" class="d">-				m-&gt;dc.font.descent = (*xfonts)-&gt;descent;
</a><a href="#h0-15-33" id="h0-15-33" class="i">+		dc.font.ascent = dc.font.descent = 0;
</a><a href="#h0-15-34" id="h0-15-34" class="i">+		font_extents = XExtentsOfFontSet(dc.font.set);
</a><a href="#h0-15-35" id="h0-15-35" class="i">+		n = XFontsOfFontSet(dc.font.set, &amp;xfonts, &amp;font_names);
</a><a href="#h0-15-36" id="h0-15-36" class="i">+		for(i = 0, dc.font.ascent = 0, dc.font.descent = 0; i &lt; n; i++) {
</a><a href="#h0-15-37" id="h0-15-37" class="i">+			if(dc.font.ascent &lt; (*xfonts)-&gt;ascent)
</a><a href="#h0-15-38" id="h0-15-38" class="i">+				dc.font.ascent = (*xfonts)-&gt;ascent;
</a><a href="#h0-15-39" id="h0-15-39" class="i">+			if(dc.font.descent &lt; (*xfonts)-&gt;descent)
</a><a href="#h0-15-40" id="h0-15-40" class="i">+				dc.font.descent = (*xfonts)-&gt;descent;
</a> 			xfonts++;
 		}
 	}
 	else {
<a href="#h0-15-45" id="h0-15-45" class="d">-		if(m-&gt;dc.font.xfont)
</a><a href="#h0-15-46" id="h0-15-46" class="d">-			XFreeFont(dpy, m-&gt;dc.font.xfont);
</a><a href="#h0-15-47" id="h0-15-47" class="d">-		m-&gt;dc.font.xfont = NULL;
</a><a href="#h0-15-48" id="h0-15-48" class="d">-		if(!(m-&gt;dc.font.xfont = XLoadQueryFont(dpy, fontstr))
</a><a href="#h0-15-49" id="h0-15-49" class="d">-		&amp;&amp; !(m-&gt;dc.font.xfont = XLoadQueryFont(dpy, &quot;fixed&quot;)))
</a><a href="#h0-15-50" id="h0-15-50" class="i">+		if(dc.font.xfont)
</a><a href="#h0-15-51" id="h0-15-51" class="i">+			XFreeFont(dpy, dc.font.xfont);
</a><a href="#h0-15-52" id="h0-15-52" class="i">+		dc.font.xfont = NULL;
</a><a href="#h0-15-53" id="h0-15-53" class="i">+		if(!(dc.font.xfont = XLoadQueryFont(dpy, fontstr))
</a><a href="#h0-15-54" id="h0-15-54" class="i">+		&amp;&amp; !(dc.font.xfont = XLoadQueryFont(dpy, &quot;fixed&quot;)))
</a> 			eprint(&quot;error, cannot load font: &#39;%s&#39;\n&quot;, fontstr);
<a href="#h0-15-56" id="h0-15-56" class="d">-		m-&gt;dc.font.ascent = m-&gt;dc.font.xfont-&gt;ascent;
</a><a href="#h0-15-57" id="h0-15-57" class="d">-		m-&gt;dc.font.descent = m-&gt;dc.font.xfont-&gt;descent;
</a><a href="#h0-15-58" id="h0-15-58" class="i">+		dc.font.ascent = dc.font.xfont-&gt;ascent;
</a><a href="#h0-15-59" id="h0-15-59" class="i">+		dc.font.descent = dc.font.xfont-&gt;descent;
</a> 	}
<a href="#h0-15-61" id="h0-15-61" class="d">-	m-&gt;dc.font.height = m-&gt;dc.font.ascent + m-&gt;dc.font.descent;
</a><a href="#h0-15-62" id="h0-15-62" class="i">+	dc.font.height = dc.font.ascent + dc.font.descent;
</a> }
 
 Bool
<a href="#h0-16" id="h0-16" class="h">@@ -1101,7 +1101,7 @@ manage(Window w, XWindowAttributes *wa) {
</a> 	}
 	wc.border_width = c-&gt;border;
 	XConfigureWindow(dpy, w, CWBorderWidth, &amp;wc);
<a href="#h0-16-3" id="h0-16-3" class="d">-	XSetWindowBorder(dpy, w, m-&gt;dc.norm[ColBorder]);
</a><a href="#h0-16-4" id="h0-16-4" class="i">+	XSetWindowBorder(dpy, w, dc.norm[ColBorder]);
</a> 	configure(c); /* propagates border_width, if size doesn&#39;t change */
 	updatesizehints(c);
 	XSelectInput(dpy, w, EnterWindowMask | FocusChangeMask | PropertyChangeMask | StructureNotifyMask);
<a href="#h0-17" id="h0-17" class="h">@@ -1549,7 +1549,7 @@ setmwfact(const char *arg) {
</a> 
 void
 setup(void) {
<a href="#h0-17-3" id="h0-17-3" class="d">-	unsigned int i, j, k;
</a><a href="#h0-17-4" id="h0-17-4" class="i">+	unsigned int i;
</a> 	Monitor *m;
 	XSetWindowAttributes wa;
 	XineramaScreenInfo *info = NULL;
<a href="#h0-18" id="h0-18" class="h">@@ -1573,13 +1573,34 @@ setup(void) {
</a> 		info = XineramaQueryScreens(dpy, &amp;mcount);
 	monitors = emallocz(mcount * sizeof(Monitor));
 
<a href="#h0-18-3" id="h0-18-3" class="d">-	root = DefaultRootWindow(dpy);
</a><a href="#h0-18-4" id="h0-18-4" class="d">-
</a><a href="#h0-18-5" id="h0-18-5" class="i">+	screen = DefaultScreen(dpy);
</a><a href="#h0-18-6" id="h0-18-6" class="i">+	root = RootWindow(dpy, screen);
</a><a href="#h0-18-7" id="h0-18-7" class="i">+
</a><a href="#h0-18-8" id="h0-18-8" class="i">+	/* init appearance */
</a><a href="#h0-18-9" id="h0-18-9" class="i">+	dc.norm[ColBorder] = getcolor(NORMBORDERCOLOR);
</a><a href="#h0-18-10" id="h0-18-10" class="i">+	dc.norm[ColBG] = getcolor(NORMBGCOLOR);
</a><a href="#h0-18-11" id="h0-18-11" class="i">+	dc.norm[ColFG] = getcolor(NORMFGCOLOR);
</a><a href="#h0-18-12" id="h0-18-12" class="i">+	dc.sel[ColBorder] = getcolor(SELBORDERCOLOR);
</a><a href="#h0-18-13" id="h0-18-13" class="i">+	dc.sel[ColBG] = getcolor(SELBGCOLOR);
</a><a href="#h0-18-14" id="h0-18-14" class="i">+	dc.sel[ColFG] = getcolor(SELFGCOLOR);
</a><a href="#h0-18-15" id="h0-18-15" class="i">+	initfont(FONT);
</a><a href="#h0-18-16" id="h0-18-16" class="i">+	dc.h = bh = dc.font.height + 2;
</a><a href="#h0-18-17" id="h0-18-17" class="i">+	dc.drawable = XCreatePixmap(dpy, root, DisplayWidth(dpy, screen), bh, DefaultDepth(dpy, screen));
</a><a href="#h0-18-18" id="h0-18-18" class="i">+	dc.gc = XCreateGC(dpy, root, 0, 0);
</a><a href="#h0-18-19" id="h0-18-19" class="i">+	XSetLineAttributes(dpy, dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h0-18-20" id="h0-18-20" class="i">+	if(!dc.font.set)
</a><a href="#h0-18-21" id="h0-18-21" class="i">+		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
</a><a href="#h0-18-22" id="h0-18-22" class="i">+
</a><a href="#h0-18-23" id="h0-18-23" class="i">+	for(blw = i = 0; i &lt; LENGTH(layouts); i++) {
</a><a href="#h0-18-24" id="h0-18-24" class="i">+		i = textw(layouts[i].symbol);
</a><a href="#h0-18-25" id="h0-18-25" class="i">+		if(i &gt; blw)
</a><a href="#h0-18-26" id="h0-18-26" class="i">+			blw = i;
</a><a href="#h0-18-27" id="h0-18-27" class="i">+	}
</a> 	for(i = 0; i &lt; mcount; i++) {
 		/* init geometry */
 		m = &amp;monitors[i];
 
<a href="#h0-18-32" id="h0-18-32" class="d">-		m-&gt;screen = isxinerama ? 0 : i;
</a><a href="#h0-18-33" id="h0-18-33" class="i">+		m-&gt;monitor = i;
</a> 
 		if (mcount != 1 &amp;&amp; isxinerama) {
 			m-&gt;sx = info[i].x_org;
<a href="#h0-19" id="h0-19" class="h">@@ -1591,8 +1612,8 @@ setup(void) {
</a> 		else {
 			m-&gt;sx = 0;
 			m-&gt;sy = 0;
<a href="#h0-19-3" id="h0-19-3" class="d">-			m-&gt;sw = DisplayWidth(dpy, m-&gt;screen);
</a><a href="#h0-19-4" id="h0-19-4" class="d">-			m-&gt;sh = DisplayHeight(dpy, m-&gt;screen);
</a><a href="#h0-19-5" id="h0-19-5" class="i">+			m-&gt;sw = DisplayWidth(dpy, screen);
</a><a href="#h0-19-6" id="h0-19-6" class="i">+			m-&gt;sh = DisplayHeight(dpy, screen);
</a> 		}
 
 		m-&gt;seltags = emallocz(sizeof initags);
<a href="#h0-20" id="h0-20" class="h">@@ -1601,24 +1622,9 @@ setup(void) {
</a> 		memcpy(m-&gt;seltags, initags, sizeof initags);
 		memcpy(m-&gt;prevtags, initags, sizeof initags);
 
<a href="#h0-20-3" id="h0-20-3" class="d">-		/* init appearance */
</a><a href="#h0-20-4" id="h0-20-4" class="d">-		m-&gt;dc.norm[ColBorder] = getcolor(NORMBORDERCOLOR, m-&gt;screen);
</a><a href="#h0-20-5" id="h0-20-5" class="d">-		m-&gt;dc.norm[ColBG] = getcolor(NORMBGCOLOR, m-&gt;screen);
</a><a href="#h0-20-6" id="h0-20-6" class="d">-		m-&gt;dc.norm[ColFG] = getcolor(NORMFGCOLOR, m-&gt;screen);
</a><a href="#h0-20-7" id="h0-20-7" class="d">-		m-&gt;dc.sel[ColBorder] = getcolor(SELBORDERCOLOR, m-&gt;screen);
</a><a href="#h0-20-8" id="h0-20-8" class="d">-		m-&gt;dc.sel[ColBG] = getcolor(SELBGCOLOR, m-&gt;screen);
</a><a href="#h0-20-9" id="h0-20-9" class="d">-		m-&gt;dc.sel[ColFG] = getcolor(SELFGCOLOR, m-&gt;screen);
</a><a href="#h0-20-10" id="h0-20-10" class="d">-		initfont(m, FONT);
</a><a href="#h0-20-11" id="h0-20-11" class="d">-		m-&gt;dc.h = bh = m-&gt;dc.font.height + 2;
</a><a href="#h0-20-12" id="h0-20-12" class="d">-
</a> 		/* init layouts */
 		m-&gt;mwfact = MWFACT;
 		m-&gt;layout = &amp;layouts[0];
<a href="#h0-20-16" id="h0-20-16" class="d">-		for(blw = k = 0; k &lt; LENGTH(layouts); k++) {
</a><a href="#h0-20-17" id="h0-20-17" class="d">-			j = textw(m, layouts[k].symbol);
</a><a href="#h0-20-18" id="h0-20-18" class="d">-			if(j &gt; blw)
</a><a href="#h0-20-19" id="h0-20-19" class="d">-				blw = j;
</a><a href="#h0-20-20" id="h0-20-20" class="d">-		}
</a> 
 		// TODO: bpos per screen?
 		bpos = BARPOS;
<a href="#h0-21" id="h0-21" class="h">@@ -1628,17 +1634,12 @@ setup(void) {
</a> 
 		/* init bars */
 		m-&gt;barwin = XCreateWindow(dpy, root, m-&gt;sx, m-&gt;sy, m-&gt;sw, bh, 0,
<a href="#h0-21-3" id="h0-21-3" class="d">-				DefaultDepth(dpy, m-&gt;screen), CopyFromParent, DefaultVisual(dpy, m-&gt;screen),
</a><a href="#h0-21-4" id="h0-21-4" class="i">+				DefaultDepth(dpy, screen), CopyFromParent, DefaultVisual(dpy, screen),
</a> 				CWOverrideRedirect | CWBackPixmap | CWEventMask, &amp;wa);
 		XDefineCursor(dpy, m-&gt;barwin, cursor[CurNormal]);
 		updatebarpos(m);
 		XMapRaised(dpy, m-&gt;barwin);
 		strcpy(stext, &quot;dwm-&quot;VERSION);
<a href="#h0-21-10" id="h0-21-10" class="d">-		m-&gt;dc.drawable = XCreatePixmap(dpy, root, m-&gt;sw, bh, DefaultDepth(dpy, m-&gt;screen));
</a><a href="#h0-21-11" id="h0-21-11" class="d">-		m-&gt;dc.gc = XCreateGC(dpy, root, 0, 0);
</a><a href="#h0-21-12" id="h0-21-12" class="d">-		XSetLineAttributes(dpy, m-&gt;dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h0-21-13" id="h0-21-13" class="d">-		if(!m-&gt;dc.font.set)
</a><a href="#h0-21-14" id="h0-21-14" class="d">-			XSetFont(dpy, m-&gt;dc.gc, m-&gt;dc.font.xfont-&gt;fid);
</a> 
 		/* EWMH support per monitor */
 		XChangeProperty(dpy, root, netatom[NetSupported], XA_ATOM, 32,
<a href="#h0-22" id="h0-22" class="h">@@ -1700,19 +1701,19 @@ tag(const char *arg) {
</a> }
 
 unsigned int
<a href="#h0-22-3" id="h0-22-3" class="d">-textnw(Monitor *m, const char *text, unsigned int len) {
</a><a href="#h0-22-4" id="h0-22-4" class="i">+textnw(const char *text, unsigned int len) {
</a> 	XRectangle r;
 
<a href="#h0-22-7" id="h0-22-7" class="d">-	if(m-&gt;dc.font.set) {
</a><a href="#h0-22-8" id="h0-22-8" class="d">-		XmbTextExtents(m-&gt;dc.font.set, text, len, NULL, &amp;r);
</a><a href="#h0-22-9" id="h0-22-9" class="i">+	if(dc.font.set) {
</a><a href="#h0-22-10" id="h0-22-10" class="i">+		XmbTextExtents(dc.font.set, text, len, NULL, &amp;r);
</a> 		return r.width;
 	}
<a href="#h0-22-13" id="h0-22-13" class="d">-	return XTextWidth(m-&gt;dc.font.xfont, text, len);
</a><a href="#h0-22-14" id="h0-22-14" class="i">+	return XTextWidth(dc.font.xfont, text, len);
</a> }
 
 unsigned int
<a href="#h0-22-18" id="h0-22-18" class="d">-textw(Monitor *m, const char *text) {
</a><a href="#h0-22-19" id="h0-22-19" class="d">-	return textnw(m, text, strlen(text)) + m-&gt;dc.font.height;
</a><a href="#h0-22-20" id="h0-22-20" class="i">+textw(const char *text) {
</a><a href="#h0-22-21" id="h0-22-21" class="i">+	return textnw(text, strlen(text)) + dc.font.height;
</a> }
 
 void
</pre>
</div>
</body>
</html>
