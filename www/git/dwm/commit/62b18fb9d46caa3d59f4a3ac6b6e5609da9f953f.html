<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>proceeded with multihead/Xinerama support - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/62b18fb9d46caa3d59f4a3ac6b6e5609da9f953f.html">62b18fb9d46caa3d59f4a3ac6b6e5609da9f953f</a>
<b>parent</b> <a href="../commit/e0d6451086eba0642cff83c2a8e05ff84be60488.html">e0d6451086eba0642cff83c2a8e05ff84be60488</a>
<b>Author:</b> anselm@anselm1 &lt;<a href="mailto:unknown">unknown</a>&gt;
<b>Date:</b>   Sat, 22 Dec 2007 14:30:47 +0000

proceeded with multihead/Xinerama support
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">LICENSE</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.def.h</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">dwm.c</a></td><td> | </td><td class="num">309</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
</table></pre><pre>3 files changed, 158 insertions(+), 162 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/LICENSE.html">LICENSE</a> b/<a href="../file/LICENSE.html">LICENSE</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -5,6 +5,7 @@ MIT/X Consortium License
</a> © 2006-2007 Jukka Salmi &lt;jukka at salmi dot ch&gt;
 © 2007 Premysl Hruby &lt;dfenze at gmail dot com&gt;
 © 2007 Szabolcs Nagy &lt;nszabolcs at gmail dot com&gt;
<a href="#h0-0-3" id="h0-0-3" class="i">+© 2007 Christof Musik
</a> 
 Permission is hereby granted, free of charge, to any person obtaining a
 copy of this software and associated documentation files (the &quot;Software&quot;),
<b>diff --git a/<a id="h1" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -15,11 +15,11 @@
</a> const char tags[][MAXTAGLEN] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;www&quot; };
 Bool initags[LENGTH(tags)] = {[0] = True};
 Rule rules[] = {
<a href="#h1-0-3" id="h1-0-3" class="d">-	/* class:instance:title regex	tags regex	isfloating */
</a><a href="#h1-0-4" id="h1-0-4" class="d">-	{ &quot;Firefox&quot;,			&quot;www&quot;,		False },
</a><a href="#h1-0-5" id="h1-0-5" class="d">-	{ &quot;Gimp&quot;,			NULL,		True },
</a><a href="#h1-0-6" id="h1-0-6" class="d">-	{ &quot;MPlayer&quot;,			NULL,		True },
</a><a href="#h1-0-7" id="h1-0-7" class="d">-	{ &quot;Acroread&quot;,			NULL,		True },
</a><a href="#h1-0-8" id="h1-0-8" class="i">+	/* class:instance:title regex	tags regex	isfloating */	/* monitor */
</a><a href="#h1-0-9" id="h1-0-9" class="i">+	{ &quot;Firefox&quot;,			&quot;www&quot;,		False,		-1 },
</a><a href="#h1-0-10" id="h1-0-10" class="i">+	{ &quot;Gimp&quot;,			NULL,		True,		-1 },
</a><a href="#h1-0-11" id="h1-0-11" class="i">+	{ &quot;MPlayer&quot;,			NULL,		True,		-1 },
</a><a href="#h1-0-12" id="h1-0-12" class="i">+	{ &quot;Acroread&quot;,			NULL,		True,		-1 },
</a> };
 
 /* layout(s) */
<b>diff --git a/<a id="h2" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -117,10 +117,9 @@ typedef struct {
</a> } Regs;
 
 typedef struct {
<a href="#h2-0-3" id="h2-0-3" class="d">-	int id;
</a><a href="#h2-0-4" id="h2-0-4" class="i">+	int screen;
</a><a href="#h2-0-5" id="h2-0-5" class="i">+	Window root;
</a> 	Window barwin;
<a href="#h2-0-7" id="h2-0-7" class="d">-//TODO: Window root;
</a><a href="#h2-0-8" id="h2-0-8" class="d">-//TODO: int screen;
</a> 	int sx, sy, sw, sh, wax, way, wah, waw;
 	DC dc;
 	Bool *seltags;
<a href="#h2-1" id="h2-1" class="h">@@ -158,7 +157,7 @@ void focusin(XEvent *e);
</a> void focusnext(const char *arg);
 void focusprev(const char *arg);
 Client *getclient(Window w);
<a href="#h2-1-3" id="h2-1-3" class="d">-unsigned long getcolor(const char *colstr);
</a><a href="#h2-1-4" id="h2-1-4" class="i">+unsigned long getcolor(const char *colstr, int screen);
</a> long getstate(Window w);
 Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 void grabbuttons(Client *c, Bool focused);
<a href="#h2-2" id="h2-2" class="h">@@ -170,7 +169,6 @@ Bool isprotodel(Client *c);
</a> Bool isvisible(Client *c, Monitor *m);
 void keypress(XEvent *e);
 void killclient(const char *arg);
<a href="#h2-2-3" id="h2-2-3" class="d">-void leavenotify(XEvent *e);
</a> void manage(Window w, XWindowAttributes *wa);
 void mappingnotify(XEvent *e);
 void maprequest(XEvent *e);
<a href="#h2-3" id="h2-3" class="h">@@ -215,9 +213,8 @@ void selectmonitor(const char *arg);
</a> 
 /* variables */
 char stext[256];
<a href="#h2-3-3" id="h2-3-3" class="d">-int mcount, screen;
</a><a href="#h2-3-4" id="h2-3-4" class="i">+int mcount = 1;
</a> //double mwfact;
<a href="#h2-3-6" id="h2-3-6" class="d">-//int screen, sx, sy, sw, sh, wax, way, waw, wah;
</a> int (*xerrorxlib)(Display *, XErrorEvent *);
 unsigned int bh, bpos;
 unsigned int blw = 0;
<a href="#h2-4" id="h2-4" class="h">@@ -231,7 +228,6 @@ void (*handler[LASTEvent]) (XEvent *) = {
</a> 	[Expose] = expose,
 	[FocusIn] = focusin,
 	[KeyPress] = keypress,
<a href="#h2-4-3" id="h2-4-3" class="d">-	[LeaveNotify] = leavenotify,
</a> 	[MappingNotify] = mappingnotify,
 	[MapRequest] = maprequest,
 	[PropertyNotify] = propertynotify,
<a href="#h2-5" id="h2-5" class="h">@@ -242,16 +238,12 @@ Bool domwfact = True;
</a> Bool dozoom = True;
 Bool otherwm, readin;
 Bool running = True;
<a href="#h2-5-3" id="h2-5-3" class="d">-//Bool selscreen = True;
</a> Client *clients = NULL;
 Client *sel = NULL;
 Client *stack = NULL;
 Cursor cursor[CurLast];
 Display *dpy;
 DC dc = {0};
<a href="#h2-5-10" id="h2-5-10" class="d">-Window root;
</a><a href="#h2-5-11" id="h2-5-11" class="d">-//Layout *layout = NULL;
</a><a href="#h2-5-12" id="h2-5-12" class="d">-//Window barwin, root;
</a> Regs *regs = NULL;
 Monitor *monitors;
 int selmonitor = 0;
<a href="#h2-6" id="h2-6" class="h">@@ -402,7 +394,7 @@ checkotherwm(void) {
</a> 	XSetErrorHandler(xerrorstart);
 
 	/* this causes an error if some other window manager is running */
<a href="#h2-6-3" id="h2-6-3" class="d">-	XSelectInput(dpy, root, SubstructureRedirectMask);
</a><a href="#h2-6-4" id="h2-6-4" class="i">+	XSelectInput(dpy, DefaultRootWindow(dpy), SubstructureRedirectMask);
</a> 	XSync(dpy, False);
 	if(otherwm)
 		eprint(&quot;dwm: another window manager is already running\n&quot;);
<a href="#h2-7" id="h2-7" class="h">@@ -426,7 +418,7 @@ cleanup(void) {
</a> 			XFreeFontSet(dpy, m-&gt;dc.font.set);
 		else
 			XFreeFont(dpy, m-&gt;dc.font.xfont);
<a href="#h2-7-3" id="h2-7-3" class="d">-		XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h2-7-4" id="h2-7-4" class="i">+		XUngrabKey(dpy, AnyKey, AnyModifier, m-&gt;root);
</a> 		XFreePixmap(dpy, m-&gt;dc.drawable);
 		XFreeGC(dpy, m-&gt;dc.gc);
 		XDestroyWindow(dpy, m-&gt;barwin);
<a href="#h2-8" id="h2-8" class="h">@@ -487,11 +479,11 @@ configurenotify(XEvent *e) {
</a> 	XConfigureEvent *ev = &amp;e-&gt;xconfigure;
 	Monitor *m = &amp;monitors[selmonitor];
 
<a href="#h2-8-3" id="h2-8-3" class="d">-	if(ev-&gt;window == root &amp;&amp; (ev-&gt;width != m-&gt;sw || ev-&gt;height != m-&gt;sh)) {
</a><a href="#h2-8-4" id="h2-8-4" class="i">+	if(ev-&gt;window == m-&gt;root &amp;&amp; (ev-&gt;width != m-&gt;sw || ev-&gt;height != m-&gt;sh)) {
</a> 		m-&gt;sw = ev-&gt;width;
 		m-&gt;sh = ev-&gt;height;
 		XFreePixmap(dpy, dc.drawable);
<a href="#h2-8-8" id="h2-8-8" class="d">-		dc.drawable = XCreatePixmap(dpy, root, m-&gt;sw, bh, DefaultDepth(dpy, screen));
</a><a href="#h2-8-9" id="h2-8-9" class="i">+		dc.drawable = XCreatePixmap(dpy, m-&gt;root, m-&gt;sw, bh, DefaultDepth(dpy, m-&gt;screen));
</a> 		XResizeWindow(dpy, m-&gt;barwin, m-&gt;sw, bh);
 		updatebarpos(m);
 		arrange();
<a href="#h2-9" id="h2-9" class="h">@@ -582,11 +574,11 @@ drawbar(void) {
</a> 			m-&gt;dc.w = textw(m, tags[i]);
 			if(m-&gt;seltags[i]) {
 				drawtext(m, tags[i], m-&gt;dc.sel);
<a href="#h2-9-3" id="h2-9-3" class="d">-				drawsquare(m, sel &amp;&amp; sel-&gt;tags[i] &amp;&amp; sel-&gt;monitor == m-&gt;id, isoccupied(m, i), m-&gt;dc.sel);
</a><a href="#h2-9-4" id="h2-9-4" class="i">+				drawsquare(m, sel &amp;&amp; sel-&gt;tags[i] &amp;&amp; sel-&gt;monitor == selmonitor, isoccupied(m, i), m-&gt;dc.sel);
</a> 			}
 			else {
 				drawtext(m, tags[i], m-&gt;dc.norm);
<a href="#h2-9-8" id="h2-9-8" class="d">-				drawsquare(m, sel &amp;&amp; sel-&gt;tags[i] &amp;&amp; sel-&gt;monitor == m-&gt;id, isoccupied(m, i), m-&gt;dc.norm);
</a><a href="#h2-9-9" id="h2-9-9" class="i">+				drawsquare(m, sel &amp;&amp; sel-&gt;tags[i] &amp;&amp; sel-&gt;monitor == selmonitor, isoccupied(m, i), m-&gt;dc.norm);
</a> 			}
 			m-&gt;dc.x += m-&gt;dc.w;
 		}
<a href="#h2-10" id="h2-10" class="h">@@ -602,7 +594,7 @@ drawbar(void) {
</a> 		drawtext(m, stext, m-&gt;dc.norm);
 		if((m-&gt;dc.w = m-&gt;dc.x - x) &gt; bh) {
 			m-&gt;dc.x = x;
<a href="#h2-10-3" id="h2-10-3" class="d">-			if(sel &amp;&amp; sel-&gt;monitor == m-&gt;id) {
</a><a href="#h2-10-4" id="h2-10-4" class="i">+			if(sel &amp;&amp; sel-&gt;monitor == selmonitor) {
</a> 				drawtext(m, sel-&gt;name, m-&gt;dc.sel);
 				drawsquare(m, False, sel-&gt;isfloating, m-&gt;dc.sel);
 			}
<a href="#h2-11" id="h2-11" class="h">@@ -686,6 +678,7 @@ emallocz(unsigned int size) {
</a> 
 void
 enternotify(XEvent *e) {
<a href="#h2-11-3" id="h2-11-3" class="i">+	unsigned int i;
</a> 	Client *c;
 	XCrossingEvent *ev = &amp;e-&gt;xcrossing;
 
<a href="#h2-12" id="h2-12" class="h">@@ -693,9 +686,13 @@ enternotify(XEvent *e) {
</a> 		return;
 	if((c = getclient(ev-&gt;window)))
 		focus(c);
<a href="#h2-12-3" id="h2-12-3" class="d">-	else if(ev-&gt;window == root) {
</a><a href="#h2-12-4" id="h2-12-4" class="d">-		selmonitor = True;
</a><a href="#h2-12-5" id="h2-12-5" class="d">-		focus(NULL);
</a><a href="#h2-12-6" id="h2-12-6" class="i">+	else {
</a><a href="#h2-12-7" id="h2-12-7" class="i">+		for(i = 0; i &lt; mcount; i++)
</a><a href="#h2-12-8" id="h2-12-8" class="i">+			if(ev-&gt;window == monitors[i].root) {
</a><a href="#h2-12-9" id="h2-12-9" class="i">+				selmonitor = i;
</a><a href="#h2-12-10" id="h2-12-10" class="i">+				focus(NULL);
</a><a href="#h2-12-11" id="h2-12-11" class="i">+				break;
</a><a href="#h2-12-12" id="h2-12-12" class="i">+			}
</a> 	}
 }
 
<a href="#h2-13" id="h2-13" class="h">@@ -731,7 +728,7 @@ floating(void) { /* default floating layout */
</a> 
 void
 focus(Client *c) {
<a href="#h2-13-3" id="h2-13-3" class="d">-	Monitor *m = &amp;monitors[monitorat(-1, -1)];
</a><a href="#h2-13-4" id="h2-13-4" class="i">+	Monitor *m = &amp;monitors[c ? c-&gt;monitor : selmonitor];
</a> 	if(!c || (c &amp;&amp; !isvisible(c, m)))
 		for(c = stack; c &amp;&amp; !isvisible(c, m); c = c-&gt;snext);
 	if(sel &amp;&amp; sel != c) {
<a href="#h2-14" id="h2-14" class="h">@@ -746,13 +743,12 @@ focus(Client *c) {
</a> 	sel = c;
 	drawbar();
 	if(c) {
<a href="#h2-14-3" id="h2-14-3" class="d">-		XSetWindowBorder(dpy, c-&gt;win, monitors[c-&gt;monitor].dc.sel[ColBorder]);
</a><a href="#h2-14-4" id="h2-14-4" class="i">+		XSetWindowBorder(dpy, c-&gt;win, m-&gt;dc.sel[ColBorder]);
</a> 		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
<a href="#h2-14-6" id="h2-14-6" class="d">-		selmonitor = monitorat(c-&gt;x, c-&gt;y);
</a><a href="#h2-14-7" id="h2-14-7" class="i">+		selmonitor = c-&gt;monitor;
</a> 	}
 	else {
<a href="#h2-14-10" id="h2-14-10" class="d">-		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h2-14-11" id="h2-14-11" class="d">-		selmonitor = monitorat(-1, -1);
</a><a href="#h2-14-12" id="h2-14-12" class="i">+		XSetInputFocus(dpy, m-&gt;root, RevertToPointerRoot, CurrentTime);
</a> 	}
 }
 
<a href="#h2-15" id="h2-15" class="h">@@ -807,7 +803,7 @@ getclient(Window w) {
</a> }
 
 unsigned long
<a href="#h2-15-3" id="h2-15-3" class="d">-getcolor(const char *colstr) {
</a><a href="#h2-15-4" id="h2-15-4" class="i">+getcolor(const char *colstr, int screen) {
</a> 	Colormap cmap = DefaultColormap(dpy, screen);
 	XColor color;
 
<a href="#h2-16" id="h2-16" class="h">@@ -899,20 +895,33 @@ grabbuttons(Client *c, Bool focused) {
</a> 
 void
 grabkeys(void)  {
<a href="#h2-16-3" id="h2-16-3" class="d">-	unsigned int i;
</a><a href="#h2-16-4" id="h2-16-4" class="i">+	unsigned int i, j;
</a> 	KeyCode code;
<a href="#h2-16-6" id="h2-16-6" class="i">+	XModifierKeymap *modmap;
</a> 
<a href="#h2-16-8" id="h2-16-8" class="d">-	XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h2-16-9" id="h2-16-9" class="d">-	for(i = 0; i &lt; LENGTH(keys); i++) {
</a><a href="#h2-16-10" id="h2-16-10" class="d">-		code = XKeysymToKeycode(dpy, keys[i].keysym);
</a><a href="#h2-16-11" id="h2-16-11" class="d">-		XGrabKey(dpy, code, keys[i].mod, root, True,
</a><a href="#h2-16-12" id="h2-16-12" class="d">-				GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-13" id="h2-16-13" class="d">-		XGrabKey(dpy, code, keys[i].mod | LockMask, root, True,
</a><a href="#h2-16-14" id="h2-16-14" class="d">-				GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-15" id="h2-16-15" class="d">-		XGrabKey(dpy, code, keys[i].mod | numlockmask, root, True,
</a><a href="#h2-16-16" id="h2-16-16" class="d">-				GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-17" id="h2-16-17" class="d">-		XGrabKey(dpy, code, keys[i].mod | numlockmask | LockMask, root, True,
</a><a href="#h2-16-18" id="h2-16-18" class="d">-				GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-19" id="h2-16-19" class="i">+	/* init modifier map */
</a><a href="#h2-16-20" id="h2-16-20" class="i">+	modmap = XGetModifierMapping(dpy);
</a><a href="#h2-16-21" id="h2-16-21" class="i">+	for(i = 0; i &lt; 8; i++)
</a><a href="#h2-16-22" id="h2-16-22" class="i">+		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
</a><a href="#h2-16-23" id="h2-16-23" class="i">+			if(modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j] == XKeysymToKeycode(dpy, XK_Num_Lock))
</a><a href="#h2-16-24" id="h2-16-24" class="i">+				numlockmask = (1 &lt;&lt; i);
</a><a href="#h2-16-25" id="h2-16-25" class="i">+		}
</a><a href="#h2-16-26" id="h2-16-26" class="i">+	XFreeModifiermap(modmap);
</a><a href="#h2-16-27" id="h2-16-27" class="i">+
</a><a href="#h2-16-28" id="h2-16-28" class="i">+	for(i = 0; i &lt; mcount; i++) {
</a><a href="#h2-16-29" id="h2-16-29" class="i">+		Monitor *m = &amp;monitors[i];
</a><a href="#h2-16-30" id="h2-16-30" class="i">+		XUngrabKey(dpy, AnyKey, AnyModifier, m-&gt;root);
</a><a href="#h2-16-31" id="h2-16-31" class="i">+		for(j = 0; j &lt; LENGTH(keys); j++) {
</a><a href="#h2-16-32" id="h2-16-32" class="i">+			code = XKeysymToKeycode(dpy, keys[j].keysym);
</a><a href="#h2-16-33" id="h2-16-33" class="i">+			XGrabKey(dpy, code, keys[j].mod, m-&gt;root, True,
</a><a href="#h2-16-34" id="h2-16-34" class="i">+					GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-35" id="h2-16-35" class="i">+			XGrabKey(dpy, code, keys[j].mod | LockMask, m-&gt;root, True,
</a><a href="#h2-16-36" id="h2-16-36" class="i">+					GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-37" id="h2-16-37" class="i">+			XGrabKey(dpy, code, keys[j].mod | numlockmask, m-&gt;root, True,
</a><a href="#h2-16-38" id="h2-16-38" class="i">+					GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-39" id="h2-16-39" class="i">+			XGrabKey(dpy, code, keys[j].mod | numlockmask | LockMask, m-&gt;root, True,
</a><a href="#h2-16-40" id="h2-16-40" class="i">+					GrabModeAsync, GrabModeAsync);
</a><a href="#h2-16-41" id="h2-16-41" class="i">+		}
</a> 	}
 }
 
<a href="#h2-17" id="h2-17" class="h">@@ -971,7 +980,7 @@ isoccupied(Monitor *m, unsigned int t) {
</a> 	Client *c;
 
 	for(c = clients; c; c = c-&gt;next)
<a href="#h2-17-3" id="h2-17-3" class="d">-		if(c-&gt;tags[t] &amp;&amp; c-&gt;monitor == m-&gt;id)
</a><a href="#h2-17-4" id="h2-17-4" class="i">+		if(c-&gt;tags[t] &amp;&amp; c-&gt;monitor == selmonitor)
</a> 			return True;
 	return False;
 }
<a href="#h2-18" id="h2-18" class="h">@@ -996,7 +1005,7 @@ isvisible(Client *c, Monitor *m) {
</a> 	unsigned int i;
 
 	for(i = 0; i &lt; LENGTH(tags); i++)
<a href="#h2-18-3" id="h2-18-3" class="d">-		if(c-&gt;tags[i] &amp;&amp; monitors[c-&gt;monitor].seltags[i] &amp;&amp; m-&gt;id == c-&gt;monitor)
</a><a href="#h2-18-4" id="h2-18-4" class="i">+		if(c-&gt;tags[i] &amp;&amp; monitors[c-&gt;monitor].seltags[i] &amp;&amp; c-&gt;monitor == selmonitor)
</a> 			return True;
 	return False;
 }
<a href="#h2-19" id="h2-19" class="h">@@ -1038,20 +1047,11 @@ killclient(const char *arg) {
</a> }
 
 void
<a href="#h2-19-3" id="h2-19-3" class="d">-leavenotify(XEvent *e) {
</a><a href="#h2-19-4" id="h2-19-4" class="d">-	XCrossingEvent *ev = &amp;e-&gt;xcrossing;
</a><a href="#h2-19-5" id="h2-19-5" class="d">-
</a><a href="#h2-19-6" id="h2-19-6" class="d">-	if((ev-&gt;window == root) &amp;&amp; !ev-&gt;same_screen) {
</a><a href="#h2-19-7" id="h2-19-7" class="d">-		selmonitor = False;
</a><a href="#h2-19-8" id="h2-19-8" class="d">-		focus(NULL);
</a><a href="#h2-19-9" id="h2-19-9" class="d">-	}
</a><a href="#h2-19-10" id="h2-19-10" class="d">-}
</a><a href="#h2-19-11" id="h2-19-11" class="d">-
</a><a href="#h2-19-12" id="h2-19-12" class="d">-void
</a> manage(Window w, XWindowAttributes *wa) {
 	Client *c, *t = NULL;
<a href="#h2-19-15" id="h2-19-15" class="d">-	Window trans;
</a><a href="#h2-19-16" id="h2-19-16" class="i">+	Monitor *m = &amp;monitors[selmonitor];
</a> 	Status rettrans;
<a href="#h2-19-18" id="h2-19-18" class="i">+	Window trans;
</a> 	XWindowChanges wc;
 
 	c = emallocz(sizeof(Client));
<a href="#h2-20" id="h2-20" class="h">@@ -1059,10 +1059,9 @@ manage(Window w, XWindowAttributes *wa) {
</a> 	c-&gt;win = w;
 
 	applyrules(c);
<a href="#h2-20-3" id="h2-20-3" class="d">-	Monitor *m = &amp;monitors[c-&gt;monitor];
</a> 
<a href="#h2-20-5" id="h2-20-5" class="d">-	c-&gt;x = wa-&gt;x+m-&gt;sx;
</a><a href="#h2-20-6" id="h2-20-6" class="d">-	c-&gt;y = wa-&gt;y+m-&gt;sy;
</a><a href="#h2-20-7" id="h2-20-7" class="i">+	c-&gt;x = wa-&gt;x + m-&gt;sx;
</a><a href="#h2-20-8" id="h2-20-8" class="i">+	c-&gt;y = wa-&gt;y + m-&gt;sy;
</a> 	c-&gt;w = wa-&gt;width;
 	c-&gt;h = wa-&gt;height;
 	c-&gt;oldborder = wa-&gt;border_width;
<a href="#h2-21" id="h2-21" class="h">@@ -1142,10 +1141,10 @@ movemouse(Client *c) {
</a> 
 	ocx = nx = c-&gt;x;
 	ocy = ny = c-&gt;y;
<a href="#h2-21-3" id="h2-21-3" class="d">-	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a><a href="#h2-21-4" id="h2-21-4" class="i">+	if(XGrabPointer(dpy, monitors[selmonitor].root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a> 			None, cursor[CurMove], CurrentTime) != GrabSuccess)
 		return;
<a href="#h2-21-7" id="h2-21-7" class="d">-	XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, &amp;x1, &amp;y1, &amp;di, &amp;di, &amp;dui);
</a><a href="#h2-21-8" id="h2-21-8" class="i">+	XQueryPointer(dpy, monitors[selmonitor].root, &amp;dummy, &amp;dummy, &amp;x1, &amp;y1, &amp;di, &amp;di, &amp;dui);
</a> 	for(;;) {
 		XMaskEvent(dpy, MOUSEMASK | ExposureMask | SubstructureRedirectMask, &amp;ev);
 		switch (ev.type) {
<a href="#h2-22" id="h2-22" class="h">@@ -1232,7 +1231,7 @@ void
</a> resize(Client *c, int x, int y, int w, int h, Bool sizehints) {
 	XWindowChanges wc;
 	Monitor scr = monitors[monitorat(x, y)];
<a href="#h2-22-3" id="h2-22-3" class="d">-	c-&gt;monitor = scr.id;
</a><a href="#h2-22-4" id="h2-22-4" class="i">+	c-&gt;monitor = monitorat(x, y);
</a> 
 	if(sizehints) {
 		/* set minimum possible */
<a href="#h2-23" id="h2-23" class="h">@@ -1305,7 +1304,7 @@ resizemouse(Client *c) {
</a> 
 	ocx = c-&gt;x;
 	ocy = c-&gt;y;
<a href="#h2-23-3" id="h2-23-3" class="d">-	if(XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a><a href="#h2-23-4" id="h2-23-4" class="i">+	if(XGrabPointer(dpy, monitors[selmonitor].root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a> 			None, cursor[CurResize], CurrentTime) != GrabSuccess)
 		return;
 	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;border - 1, c-&gt;h + c-&gt;border - 1);
<a href="#h2-24" id="h2-24" class="h">@@ -1429,29 +1428,32 @@ run(void) {
</a> 
 void
 scan(void) {
<a href="#h2-24-3" id="h2-24-3" class="d">-	unsigned int i, num;
</a><a href="#h2-24-4" id="h2-24-4" class="i">+	unsigned int i, j, num;
</a> 	Window *wins, d1, d2;
 	XWindowAttributes wa;
 
<a href="#h2-24-8" id="h2-24-8" class="d">-	wins = NULL;
</a><a href="#h2-24-9" id="h2-24-9" class="d">-	if(XQueryTree(dpy, root, &amp;d1, &amp;d2, &amp;wins, &amp;num)) {
</a><a href="#h2-24-10" id="h2-24-10" class="d">-		for(i = 0; i &lt; num; i++) {
</a><a href="#h2-24-11" id="h2-24-11" class="d">-			if(!XGetWindowAttributes(dpy, wins[i], &amp;wa)
</a><a href="#h2-24-12" id="h2-24-12" class="d">-			|| wa.override_redirect || XGetTransientForHint(dpy, wins[i], &amp;d1))
</a><a href="#h2-24-13" id="h2-24-13" class="d">-				continue;
</a><a href="#h2-24-14" id="h2-24-14" class="d">-			if(wa.map_state == IsViewable || getstate(wins[i]) == IconicState)
</a><a href="#h2-24-15" id="h2-24-15" class="d">-				manage(wins[i], &amp;wa);
</a><a href="#h2-24-16" id="h2-24-16" class="d">-		}
</a><a href="#h2-24-17" id="h2-24-17" class="d">-		for(i = 0; i &lt; num; i++) { /* now the transients */
</a><a href="#h2-24-18" id="h2-24-18" class="d">-			if(!XGetWindowAttributes(dpy, wins[i], &amp;wa))
</a><a href="#h2-24-19" id="h2-24-19" class="d">-				continue;
</a><a href="#h2-24-20" id="h2-24-20" class="d">-			if(XGetTransientForHint(dpy, wins[i], &amp;d1)
</a><a href="#h2-24-21" id="h2-24-21" class="d">-			&amp;&amp; (wa.map_state == IsViewable || getstate(wins[i]) == IconicState))
</a><a href="#h2-24-22" id="h2-24-22" class="d">-				manage(wins[i], &amp;wa);
</a><a href="#h2-24-23" id="h2-24-23" class="i">+	for(i = 0; i &lt; mcount; i++) {
</a><a href="#h2-24-24" id="h2-24-24" class="i">+		Monitor *m = &amp;monitors[i];
</a><a href="#h2-24-25" id="h2-24-25" class="i">+		wins = NULL;
</a><a href="#h2-24-26" id="h2-24-26" class="i">+		if(XQueryTree(dpy, m-&gt;root, &amp;d1, &amp;d2, &amp;wins, &amp;num)) {
</a><a href="#h2-24-27" id="h2-24-27" class="i">+			for(j = 0; j &lt; num; j++) {
</a><a href="#h2-24-28" id="h2-24-28" class="i">+				if(!XGetWindowAttributes(dpy, wins[j], &amp;wa)
</a><a href="#h2-24-29" id="h2-24-29" class="i">+				|| wa.override_redirect || XGetTransientForHint(dpy, wins[j], &amp;d1))
</a><a href="#h2-24-30" id="h2-24-30" class="i">+					continue;
</a><a href="#h2-24-31" id="h2-24-31" class="i">+				if(wa.map_state == IsViewable || getstate(wins[j]) == IconicState)
</a><a href="#h2-24-32" id="h2-24-32" class="i">+					manage(wins[j], &amp;wa);
</a><a href="#h2-24-33" id="h2-24-33" class="i">+			}
</a><a href="#h2-24-34" id="h2-24-34" class="i">+			for(j = 0; j &lt; num; j++) { /* now the transients */
</a><a href="#h2-24-35" id="h2-24-35" class="i">+				if(!XGetWindowAttributes(dpy, wins[j], &amp;wa))
</a><a href="#h2-24-36" id="h2-24-36" class="i">+					continue;
</a><a href="#h2-24-37" id="h2-24-37" class="i">+				if(XGetTransientForHint(dpy, wins[j], &amp;d1)
</a><a href="#h2-24-38" id="h2-24-38" class="i">+				&amp;&amp; (wa.map_state == IsViewable || getstate(wins[j]) == IconicState))
</a><a href="#h2-24-39" id="h2-24-39" class="i">+					manage(wins[j], &amp;wa);
</a><a href="#h2-24-40" id="h2-24-40" class="i">+			}
</a> 		}
<a href="#h2-24-42" id="h2-24-42" class="i">+		if(wins)
</a><a href="#h2-24-43" id="h2-24-43" class="i">+			XFree(wins);
</a> 	}
<a href="#h2-24-45" id="h2-24-45" class="d">-	if(wins)
</a><a href="#h2-24-46" id="h2-24-46" class="d">-		XFree(wins);
</a> }
 
 void
<a href="#h2-25" id="h2-25" class="h">@@ -1513,10 +1515,8 @@ setmwfact(const char *arg) {
</a> void
 setup(void) {
 	unsigned int i, j, k;
<a href="#h2-25-3" id="h2-25-3" class="d">-	XModifierKeymap *modmap;
</a><a href="#h2-25-4" id="h2-25-4" class="i">+	Monitor *m;
</a> 	XSetWindowAttributes wa;
<a href="#h2-25-6" id="h2-25-6" class="d">-	int s = 1;
</a><a href="#h2-25-7" id="h2-25-7" class="d">-	GC g;
</a> 	XineramaScreenInfo *info = NULL;
 
 	/* init atoms */
<a href="#h2-26" id="h2-26" class="h">@@ -1526,106 +1526,100 @@ setup(void) {
</a> 	wmatom[WMState] = XInternAtom(dpy, &quot;WM_STATE&quot;, False);
 	netatom[NetSupported] = XInternAtom(dpy, &quot;_NET_SUPPORTED&quot;, False);
 	netatom[NetWMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
<a href="#h2-26-3" id="h2-26-3" class="d">-	XChangeProperty(dpy, root, netatom[NetSupported], XA_ATOM, 32,
</a><a href="#h2-26-4" id="h2-26-4" class="d">-			PropModeReplace, (unsigned char *) netatom, NetLast);
</a> 
 	/* init cursors */
<a href="#h2-26-7" id="h2-26-7" class="d">-	cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
</a><a href="#h2-26-8" id="h2-26-8" class="i">+	wa.cursor = cursor[CurNormal] = XCreateFontCursor(dpy, XC_left_ptr);
</a> 	cursor[CurResize] = XCreateFontCursor(dpy, XC_sizing);
 	cursor[CurMove] = XCreateFontCursor(dpy, XC_fleur);
 
<a href="#h2-26-12" id="h2-26-12" class="d">-
</a><a href="#h2-26-13" id="h2-26-13" class="d">-	/* init modifier map */
</a><a href="#h2-26-14" id="h2-26-14" class="d">-	modmap = XGetModifierMapping(dpy);
</a><a href="#h2-26-15" id="h2-26-15" class="d">-	for(i = 0; i &lt; 8; i++)
</a><a href="#h2-26-16" id="h2-26-16" class="d">-		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
</a><a href="#h2-26-17" id="h2-26-17" class="d">-			if(modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j]
</a><a href="#h2-26-18" id="h2-26-18" class="d">-			== XKeysymToKeycode(dpy, XK_Num_Lock))
</a><a href="#h2-26-19" id="h2-26-19" class="d">-				numlockmask = (1 &lt;&lt; i);
</a><a href="#h2-26-20" id="h2-26-20" class="d">-		}
</a><a href="#h2-26-21" id="h2-26-21" class="d">-	XFreeModifiermap(modmap);
</a><a href="#h2-26-22" id="h2-26-22" class="d">-
</a><a href="#h2-26-23" id="h2-26-23" class="d">-	/* select for events */
</a><a href="#h2-26-24" id="h2-26-24" class="d">-	wa.event_mask = SubstructureRedirectMask | SubstructureNotifyMask
</a><a href="#h2-26-25" id="h2-26-25" class="d">-		| EnterWindowMask | LeaveWindowMask | StructureNotifyMask;
</a><a href="#h2-26-26" id="h2-26-26" class="d">-	wa.cursor = cursor[CurNormal];
</a><a href="#h2-26-27" id="h2-26-27" class="d">-	XChangeWindowAttributes(dpy, root, CWEventMask | CWCursor, &amp;wa);
</a><a href="#h2-26-28" id="h2-26-28" class="d">-	XSelectInput(dpy, root, wa.event_mask);
</a><a href="#h2-26-29" id="h2-26-29" class="d">-
</a><a href="#h2-26-30" id="h2-26-30" class="d">-	/* grab keys */
</a><a href="#h2-26-31" id="h2-26-31" class="d">-	grabkeys();
</a><a href="#h2-26-32" id="h2-26-32" class="d">-
</a><a href="#h2-26-33" id="h2-26-33" class="d">-	/* init tags */
</a><a href="#h2-26-34" id="h2-26-34" class="d">-	compileregs();
</a><a href="#h2-26-35" id="h2-26-35" class="d">-
</a><a href="#h2-26-36" id="h2-26-36" class="i">+	// init screens/monitors first
</a> 	if (XineramaIsActive(dpy)) {
<a href="#h2-26-38" id="h2-26-38" class="d">-		info = XineramaQueryScreens(dpy, &amp;s);
</a><a href="#h2-26-39" id="h2-26-39" class="i">+		info = XineramaQueryScreens(dpy, &amp;mcount);
</a> 	}
<a href="#h2-26-41" id="h2-26-41" class="i">+	mcount = 1;
</a><a href="#h2-26-42" id="h2-26-42" class="i">+	monitors = emallocz(mcount * sizeof(Monitor));
</a> 
<a href="#h2-26-44" id="h2-26-44" class="d">-	monitors = emallocz(s*sizeof(Monitor));
</a><a href="#h2-26-45" id="h2-26-45" class="d">-	mcount = s;
</a><a href="#h2-26-46" id="h2-26-46" class="d">-
</a><a href="#h2-26-47" id="h2-26-47" class="d">-	for(i = 0; i &lt; s; i++) {
</a><a href="#h2-26-48" id="h2-26-48" class="i">+	for(i = 0; i &lt; mcount; i++) {
</a> 		/* init geometry */
<a href="#h2-26-50" id="h2-26-50" class="d">-		if (mcount != 1) {
</a><a href="#h2-26-51" id="h2-26-51" class="d">-			monitors[i].sx = info[i].x_org;
</a><a href="#h2-26-52" id="h2-26-52" class="d">-			monitors[i].sy = info[i].y_org;
</a><a href="#h2-26-53" id="h2-26-53" class="d">-			monitors[i].sw = info[i].width;
</a><a href="#h2-26-54" id="h2-26-54" class="d">-			monitors[i].sh = info[i].height;
</a><a href="#h2-26-55" id="h2-26-55" class="i">+		m = &amp;monitors[i];
</a><a href="#h2-26-56" id="h2-26-56" class="i">+
</a><a href="#h2-26-57" id="h2-26-57" class="i">+		m-&gt;screen = i;
</a><a href="#h2-26-58" id="h2-26-58" class="i">+		m-&gt;root = RootWindow(dpy, i);
</a><a href="#h2-26-59" id="h2-26-59" class="i">+
</a><a href="#h2-26-60" id="h2-26-60" class="i">+		if (mcount != 1) { // TODO: Xinerama
</a><a href="#h2-26-61" id="h2-26-61" class="i">+			m-&gt;sx = info[i].x_org;
</a><a href="#h2-26-62" id="h2-26-62" class="i">+			m-&gt;sy = info[i].y_org;
</a><a href="#h2-26-63" id="h2-26-63" class="i">+			m-&gt;sw = info[i].width;
</a><a href="#h2-26-64" id="h2-26-64" class="i">+			m-&gt;sh = info[i].height;
</a> 		}
 		else {
<a href="#h2-26-67" id="h2-26-67" class="d">-			monitors[i].sx = 0;
</a><a href="#h2-26-68" id="h2-26-68" class="d">-			monitors[i].sy = 0;
</a><a href="#h2-26-69" id="h2-26-69" class="d">-			monitors[i].sw = DisplayWidth(dpy, screen);
</a><a href="#h2-26-70" id="h2-26-70" class="d">-			monitors[i].sh = DisplayHeight(dpy, screen);
</a><a href="#h2-26-71" id="h2-26-71" class="i">+			m-&gt;sx = 0;
</a><a href="#h2-26-72" id="h2-26-72" class="i">+			m-&gt;sy = 0;
</a><a href="#h2-26-73" id="h2-26-73" class="i">+			m-&gt;sw = DisplayWidth(dpy, m-&gt;screen);
</a><a href="#h2-26-74" id="h2-26-74" class="i">+			m-&gt;sh = DisplayHeight(dpy, m-&gt;screen);
</a> 		}
 
<a href="#h2-26-77" id="h2-26-77" class="d">-		monitors[i].id = i;
</a><a href="#h2-26-78" id="h2-26-78" class="d">-		monitors[i].seltags = emallocz(sizeof initags);
</a><a href="#h2-26-79" id="h2-26-79" class="d">-		monitors[i].prevtags = emallocz(sizeof initags);
</a><a href="#h2-26-80" id="h2-26-80" class="i">+		m-&gt;seltags = emallocz(sizeof initags);
</a><a href="#h2-26-81" id="h2-26-81" class="i">+		m-&gt;prevtags = emallocz(sizeof initags);
</a> 
<a href="#h2-26-83" id="h2-26-83" class="d">-		memcpy(monitors[i].seltags, initags, sizeof initags);
</a><a href="#h2-26-84" id="h2-26-84" class="d">-		memcpy(monitors[i].prevtags, initags, sizeof initags);
</a><a href="#h2-26-85" id="h2-26-85" class="i">+		memcpy(m-&gt;seltags, initags, sizeof initags);
</a><a href="#h2-26-86" id="h2-26-86" class="i">+		memcpy(m-&gt;prevtags, initags, sizeof initags);
</a> 
 		/* init appearance */
<a href="#h2-26-89" id="h2-26-89" class="d">-		monitors[i].dc.norm[ColBorder] = getcolor(NORMBORDERCOLOR);
</a><a href="#h2-26-90" id="h2-26-90" class="d">-		monitors[i].dc.norm[ColBG] = getcolor(NORMBGCOLOR);
</a><a href="#h2-26-91" id="h2-26-91" class="d">-		monitors[i].dc.norm[ColFG] = getcolor(NORMFGCOLOR);
</a><a href="#h2-26-92" id="h2-26-92" class="d">-		monitors[i].dc.sel[ColBorder] = getcolor(SELBORDERCOLOR);
</a><a href="#h2-26-93" id="h2-26-93" class="d">-		monitors[i].dc.sel[ColBG] = getcolor(SELBGCOLOR);
</a><a href="#h2-26-94" id="h2-26-94" class="d">-		monitors[i].dc.sel[ColFG] = getcolor(SELFGCOLOR);
</a><a href="#h2-26-95" id="h2-26-95" class="d">-		initfont(&amp;(monitors[i]), FONT);
</a><a href="#h2-26-96" id="h2-26-96" class="d">-		monitors[i].dc.h = bh = monitors[i].dc.font.height + 2;
</a><a href="#h2-26-97" id="h2-26-97" class="i">+		m-&gt;dc.norm[ColBorder] = getcolor(NORMBORDERCOLOR, i);
</a><a href="#h2-26-98" id="h2-26-98" class="i">+		m-&gt;dc.norm[ColBG] = getcolor(NORMBGCOLOR, i);
</a><a href="#h2-26-99" id="h2-26-99" class="i">+		m-&gt;dc.norm[ColFG] = getcolor(NORMFGCOLOR, i);
</a><a href="#h2-26-100" id="h2-26-100" class="i">+		m-&gt;dc.sel[ColBorder] = getcolor(SELBORDERCOLOR, i);
</a><a href="#h2-26-101" id="h2-26-101" class="i">+		m-&gt;dc.sel[ColBG] = getcolor(SELBGCOLOR, i);
</a><a href="#h2-26-102" id="h2-26-102" class="i">+		m-&gt;dc.sel[ColFG] = getcolor(SELFGCOLOR, i);
</a><a href="#h2-26-103" id="h2-26-103" class="i">+		initfont(m, FONT);
</a><a href="#h2-26-104" id="h2-26-104" class="i">+		m-&gt;dc.h = bh = m-&gt;dc.font.height + 2;
</a> 
 		/* init layouts */
<a href="#h2-26-107" id="h2-26-107" class="d">-		monitors[i].mwfact = MWFACT;
</a><a href="#h2-26-108" id="h2-26-108" class="d">-		monitors[i].layout = &amp;layouts[0];
</a><a href="#h2-26-109" id="h2-26-109" class="i">+		m-&gt;mwfact = MWFACT;
</a><a href="#h2-26-110" id="h2-26-110" class="i">+		m-&gt;layout = &amp;layouts[0];
</a> 		for(blw = k = 0; k &lt; LENGTH(layouts); k++) {
<a href="#h2-26-112" id="h2-26-112" class="d">-			j = textw(&amp;monitors[i], layouts[k].symbol);
</a><a href="#h2-26-113" id="h2-26-113" class="i">+			j = textw(m, layouts[k].symbol);
</a> 			if(j &gt; blw)
 				blw = j;
 		}
 
<a href="#h2-26-118" id="h2-26-118" class="i">+		// TODO: bpos per screen?
</a> 		bpos = BARPOS;
 		wa.override_redirect = 1;
 		wa.background_pixmap = ParentRelative;
 		wa.event_mask = ButtonPressMask | ExposureMask;
 
 		/* init bars */
<a href="#h2-26-125" id="h2-26-125" class="d">-		monitors[i].barwin = XCreateWindow(dpy, root, monitors[i].sx, monitors[i].sy, monitors[i].sw, bh, 0,
</a><a href="#h2-26-126" id="h2-26-126" class="d">-				DefaultDepth(dpy, screen), CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h2-26-127" id="h2-26-127" class="i">+		m-&gt;barwin = XCreateWindow(dpy, m-&gt;root, m-&gt;sx, m-&gt;sy, m-&gt;sw, bh, 0,
</a><a href="#h2-26-128" id="h2-26-128" class="i">+				DefaultDepth(dpy, m-&gt;screen), CopyFromParent, DefaultVisual(dpy, m-&gt;screen),
</a> 				CWOverrideRedirect | CWBackPixmap | CWEventMask, &amp;wa);
<a href="#h2-26-130" id="h2-26-130" class="d">-		XDefineCursor(dpy, monitors[i].barwin, cursor[CurNormal]);
</a><a href="#h2-26-131" id="h2-26-131" class="d">-		updatebarpos(&amp;monitors[i]);
</a><a href="#h2-26-132" id="h2-26-132" class="d">-		XMapRaised(dpy, monitors[i].barwin);
</a><a href="#h2-26-133" id="h2-26-133" class="i">+		XDefineCursor(dpy, m-&gt;barwin, cursor[CurNormal]);
</a><a href="#h2-26-134" id="h2-26-134" class="i">+		updatebarpos(m);
</a><a href="#h2-26-135" id="h2-26-135" class="i">+		XMapRaised(dpy, m-&gt;barwin);
</a> 		strcpy(stext, &quot;dwm-&quot;VERSION);
<a href="#h2-26-137" id="h2-26-137" class="d">-		monitors[i].dc.drawable = XCreatePixmap(dpy, root, monitors[i].sw, bh, DefaultDepth(dpy, screen));
</a><a href="#h2-26-138" id="h2-26-138" class="d">-		g = XCreateGC(dpy, root, 0, 0);
</a><a href="#h2-26-139" id="h2-26-139" class="d">-		monitors[i].dc.gc = XCreateGC(dpy, root, 0, 0);
</a><a href="#h2-26-140" id="h2-26-140" class="d">-		XSetLineAttributes(dpy, monitors[i].dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h2-26-141" id="h2-26-141" class="d">-		if(!monitors[i].dc.font.set)
</a><a href="#h2-26-142" id="h2-26-142" class="d">-			XSetFont(dpy, monitors[i].dc.gc, monitors[i].dc.font.xfont-&gt;fid);
</a><a href="#h2-26-143" id="h2-26-143" class="i">+		m-&gt;dc.drawable = XCreatePixmap(dpy, m-&gt;root, m-&gt;sw, bh, DefaultDepth(dpy, m-&gt;screen));
</a><a href="#h2-26-144" id="h2-26-144" class="i">+		m-&gt;dc.gc = XCreateGC(dpy, m-&gt;root, 0, 0);
</a><a href="#h2-26-145" id="h2-26-145" class="i">+		XSetLineAttributes(dpy, m-&gt;dc.gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h2-26-146" id="h2-26-146" class="i">+		if(!m-&gt;dc.font.set)
</a><a href="#h2-26-147" id="h2-26-147" class="i">+			XSetFont(dpy, m-&gt;dc.gc, m-&gt;dc.font.xfont-&gt;fid);
</a><a href="#h2-26-148" id="h2-26-148" class="i">+
</a><a href="#h2-26-149" id="h2-26-149" class="i">+		/* EWMH support per monitor */
</a><a href="#h2-26-150" id="h2-26-150" class="i">+		XChangeProperty(dpy, m-&gt;root, netatom[NetSupported], XA_ATOM, 32,
</a><a href="#h2-26-151" id="h2-26-151" class="i">+				PropModeReplace, (unsigned char *) netatom, NetLast);
</a><a href="#h2-26-152" id="h2-26-152" class="i">+
</a><a href="#h2-26-153" id="h2-26-153" class="i">+		/* select for events */
</a><a href="#h2-26-154" id="h2-26-154" class="i">+		wa.event_mask = SubstructureRedirectMask | SubstructureNotifyMask
</a><a href="#h2-26-155" id="h2-26-155" class="i">+				| EnterWindowMask | LeaveWindowMask | StructureNotifyMask;
</a><a href="#h2-26-156" id="h2-26-156" class="i">+		XChangeWindowAttributes(dpy, m-&gt;root, CWEventMask | CWCursor, &amp;wa);
</a><a href="#h2-26-157" id="h2-26-157" class="i">+		XSelectInput(dpy, m-&gt;root, wa.event_mask);
</a> 	}
<a href="#h2-26-159" id="h2-26-159" class="i">+
</a><a href="#h2-26-160" id="h2-26-160" class="i">+	/* grab keys */
</a><a href="#h2-26-161" id="h2-26-161" class="i">+	grabkeys();
</a><a href="#h2-26-162" id="h2-26-162" class="i">+
</a><a href="#h2-26-163" id="h2-26-163" class="i">+	/* init tags */
</a><a href="#h2-26-164" id="h2-26-164" class="i">+	compileregs();
</a> }
 
 void
<a href="#h2-27" id="h2-27" class="h">@@ -1978,21 +1972,24 @@ int
</a> monitorat(int x, int y) {
 	int i;
 
<a href="#h2-27-3" id="h2-27-3" class="i">+	return 0;
</a> 	if(!XineramaIsActive(dpy))
 		return 0;
 
 	if (x &lt; 0 || y &lt; 0) {
 		Window win;
 		unsigned int mask;
<a href="#h2-27-10" id="h2-27-10" class="d">-		XQueryPointer(dpy, root, &amp;win, &amp;win, &amp;x, &amp;y, &amp;i, &amp;i, &amp;mask);
</a><a href="#h2-27-11" id="h2-27-11" class="i">+		XQueryPointer(dpy, DefaultRootWindow(dpy), &amp;win, &amp;win, &amp;x, &amp;y, &amp;i, &amp;i, &amp;mask);
</a> 	}
 
<a href="#h2-27-14" id="h2-27-14" class="d">-	for(i = 0; i &lt; mcount; i++)
</a><a href="#h2-27-15" id="h2-27-15" class="d">-		if((x &lt; 0 || (x &gt;= monitors[i].sx &amp;&amp; x &lt; monitors[i].sx + monitors[i].sw))
</a><a href="#h2-27-16" id="h2-27-16" class="d">-				&amp;&amp; (y &lt; 0 || (y &gt;= monitors[i].sy &amp;&amp; y &lt; monitors[i].sy + monitors[i].sh)))
</a><a href="#h2-27-17" id="h2-27-17" class="i">+	for(i = 0; i &lt; mcount; i++) {
</a><a href="#h2-27-18" id="h2-27-18" class="i">+		Monitor *m = &amp;monitors[i];
</a><a href="#h2-27-19" id="h2-27-19" class="i">+		if((x &lt; 0 || (x &gt;= m-&gt;sx &amp;&amp; x &lt; m-&gt;sx + m-&gt;sw))
</a><a href="#h2-27-20" id="h2-27-20" class="i">+				&amp;&amp; (y &lt; 0 || (y &gt;= m-&gt;sy &amp;&amp; y &lt; m-&gt;sy + m-&gt;sh)))
</a> 		{
 			return i;
 		}
<a href="#h2-27-24" id="h2-27-24" class="i">+	}
</a> 	return 0;
 }
 
<a href="#h2-28" id="h2-28" class="h">@@ -2011,7 +2008,7 @@ void
</a> selectmonitor(const char *arg) {
 	Monitor *m = &amp;monitors[arg ? atoi(arg) : (monitorat(-1, -1)+1) % mcount];
 
<a href="#h2-28-3" id="h2-28-3" class="d">-	XWarpPointer(dpy, None, root, 0, 0, 0, 0, m-&gt;wax+m-&gt;waw/2, m-&gt;way+m-&gt;wah/2);
</a><a href="#h2-28-4" id="h2-28-4" class="i">+	XWarpPointer(dpy, None, m-&gt;root, 0, 0, 0, 0, m-&gt;wax+m-&gt;waw/2, m-&gt;way+m-&gt;wah/2);
</a> 	focus(NULL);
 }
 
<a href="#h2-29" id="h2-29" class="h">@@ -2020,15 +2017,13 @@ int
</a> main(int argc, char *argv[]) {
 	if(argc == 2 &amp;&amp; !strcmp(&quot;-v&quot;, argv[1]))
 		eprint(&quot;dwm-&quot;VERSION&quot;, © 2006-2007 Anselm R. Garbe, Sander van Dijk, &quot;
<a href="#h2-29-3" id="h2-29-3" class="d">-		       &quot;Jukka Salmi, Premysl Hruby, Szabolcs Nagy\n&quot;);
</a><a href="#h2-29-4" id="h2-29-4" class="i">+		       &quot;Jukka Salmi, Premysl Hruby, Szabolcs Nagy, Christof Musik\n&quot;);
</a> 	else if(argc != 1)
 		eprint(&quot;usage: dwm [-v]\n&quot;);
 
 	setlocale(LC_CTYPE, &quot;&quot;);
 	if(!(dpy = XOpenDisplay(0)))
 		eprint(&quot;dwm: cannot open display\n&quot;);
<a href="#h2-29-11" id="h2-29-11" class="d">-	screen = DefaultScreen(dpy);
</a><a href="#h2-29-12" id="h2-29-12" class="d">-	root = RootWindow(dpy, screen);
</a> 
 	checkotherwm();
 	setup();
</pre>
</div>
</body>
</html>
