<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>applied Neale Pickett&#39;s xprop status reading patch, updated README and dwm.1 accordingly - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/0b5dcf229f64a23438e6ef5929d78b7f9bd48355.html">0b5dcf229f64a23438e6ef5929d78b7f9bd48355</a>
<b>parent</b> <a href="../commit/fda92f46aadb4a344e52f3c560a63c9733606e3e.html">fda92f46aadb4a344e52f3c560a63c9733606e3e</a>
<b>Author:</b> a@null &lt;<a href="mailto:unknown">unknown</a>&gt;
<b>Date:</b>   Fri, 12 Dec 2008 19:49:06 +0000

applied Neale Pickett&#39;s xprop status reading patch, updated README and dwm.1 accordingly
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.def.h</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">dwm.1</a></td><td> | </td><td class="num">14</td><td><span class="i">+++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">dwm.c</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++</span><span class="d">----------------------------------------------------------</span></td></tr>
</table></pre><pre>4 files changed, 31 insertions(+), 73 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.html">README</a> b/<a href="../file/README.html">README</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -40,7 +40,7 @@ like this in your .xinitrc:
</a> 
     while true
     do
<a href="#h0-0-3" id="h0-0-3" class="d">-        echo `date` `uptime | sed &#39;s/.*,//&#39;`
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        xsetroot -name &quot;`date` `uptime | sed &#39;s/.*,//&#39;`&quot;
</a>         sleep 1
     done | dwm
 
<b>diff --git a/<a id="h1" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -12,7 +12,6 @@ static unsigned int borderpx        = 1;        /* border pixel of windows */
</a> static unsigned int snap            = 32;       /* snap pixel */
 static Bool showbar                 = True;     /* False means no bar */
 static Bool topbar                  = True;     /* False means bottom bar */
<a href="#h1-0-3" id="h1-0-3" class="d">-static Bool readin                  = True;     /* False means do not read stdin */
</a> static Bool usegrab                 = False;    /* True means grabbing the X server
                                                    during mouse-based resizals */
 
<b>diff --git a/<a id="h2" href="../file/dwm.1.html">dwm.1</a> b/<a href="../file/dwm.1.html">dwm.1</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -20,13 +20,13 @@ Windows are grouped by tags. Each window can be tagged with one or multiple
</a> tags. Selecting certain tags displays all windows with these tags.
 .P
 dwm contains a small status bar which displays all available tags, the layout,
<a href="#h2-0-3" id="h2-0-3" class="d">-the title of the focused window, and the text read from standard input. A
</a><a href="#h2-0-4" id="h2-0-4" class="d">-floating window is indicated with an empty square and a maximised
</a><a href="#h2-0-5" id="h2-0-5" class="d">-floating window is indicated with a filled square before the windows
</a><a href="#h2-0-6" id="h2-0-6" class="d">-title.  The selected tags are indicated with a different color. The tags of
</a><a href="#h2-0-7" id="h2-0-7" class="d">-the focused window are indicated with a filled square in the top left
</a><a href="#h2-0-8" id="h2-0-8" class="d">-corner.  The tags which are applied to one or more windows are indicated
</a><a href="#h2-0-9" id="h2-0-9" class="d">-with an empty square in the top left corner.
</a><a href="#h2-0-10" id="h2-0-10" class="i">+the title of the focused window, and the text read from the root window name
</a><a href="#h2-0-11" id="h2-0-11" class="i">+property. A floating window is indicated with an empty square and a maximised
</a><a href="#h2-0-12" id="h2-0-12" class="i">+floating window is indicated with a filled square before the windows title.
</a><a href="#h2-0-13" id="h2-0-13" class="i">+The selected tags are indicated with a different color. The tags of the focused
</a><a href="#h2-0-14" id="h2-0-14" class="i">+window are indicated with a filled square in the top left corner.  The tags
</a><a href="#h2-0-15" id="h2-0-15" class="i">+which are applied to one or more windows are indicated with an empty square in
</a><a href="#h2-0-16" id="h2-0-16" class="i">+the top left corner.
</a> .P
 dwm draws a small border around windows to indicate the focus state.
 .SH OPTIONS
<b>diff --git a/<a id="h3" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -6,12 +6,9 @@
</a>  * events about window (dis-)appearance.  Only one X connection at a time is
  * allowed to select for this event mask.
  *
<a href="#h3-0-3" id="h3-0-3" class="d">- * Calls to fetch an X event from the event queue are blocking.  Due reading
</a><a href="#h3-0-4" id="h3-0-4" class="d">- * status text from standard input, a select()-driven main loop has been
</a><a href="#h3-0-5" id="h3-0-5" class="d">- * implemented which selects for reads on the X connection and STDIN_FILENO to
</a><a href="#h3-0-6" id="h3-0-6" class="d">- * handle all data smoothly. The event handlers of dwm are organized in an
</a><a href="#h3-0-7" id="h3-0-7" class="d">- * array which is accessed whenever a new event has been fetched. This allows
</a><a href="#h3-0-8" id="h3-0-8" class="d">- * event dispatching in O(1) time.
</a><a href="#h3-0-9" id="h3-0-9" class="i">+ * The event handlers of dwm are organized in an array which is accessed
</a><a href="#h3-0-10" id="h3-0-10" class="i">+ * whenever a new event has been fetched. This allows event dispatching
</a><a href="#h3-0-11" id="h3-0-11" class="i">+ * in O(1) time.
</a>  *
  * Each child of the root window is called a client, except windows which have
  * set the override_redirect flag.  Clients are organized in a global
<a href="#h3-1" id="h3-1" class="h">@@ -30,7 +27,6 @@
</a> #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
<a href="#h3-1-3" id="h3-1-3" class="d">-#include &lt;sys/select.h&gt;
</a> #include &lt;sys/types.h&gt;
 #include &lt;sys/wait.h&gt;
 #include &lt;X11/cursorfont.h&gt;
<a href="#h3-2" id="h3-2" class="h">@@ -196,6 +192,7 @@ static void updatebar(void);
</a> static void updategeom(void);
 static void updatenumlockmask(void);
 static void updatesizehints(Client *c);
<a href="#h3-2-3" id="h3-2-3" class="i">+static void updatestatus(void);
</a> static void updatetitle(Client *c);
 static void updatewmhints(Client *c);
 static void view(const Arg *arg);
<a href="#h3-3" id="h3-3" class="h">@@ -998,9 +995,11 @@ propertynotify(XEvent *e) {
</a> 	Window trans;
 	XPropertyEvent *ev = &amp;e-&gt;xproperty;
 
<a href="#h3-3-3" id="h3-3-3" class="d">-	if(ev-&gt;state == PropertyDelete)
</a><a href="#h3-3-4" id="h3-3-4" class="i">+	if((ev-&gt;window == root) &amp;&amp; (ev-&gt;atom = XA_WM_NAME))
</a><a href="#h3-3-5" id="h3-3-5" class="i">+		updatestatus();
</a><a href="#h3-3-6" id="h3-3-6" class="i">+	else if(ev-&gt;state == PropertyDelete)
</a> 		return; /* ignore */
<a href="#h3-3-8" id="h3-3-8" class="d">-	if((c = getclient(ev-&gt;window))) {
</a><a href="#h3-3-9" id="h3-3-9" class="i">+	else if((c = getclient(ev-&gt;window))) {
</a> 		switch (ev-&gt;atom) {
 		default: break;
 		case XA_WM_TRANSIENT_FOR:
<a href="#h3-4" id="h3-4" class="h">@@ -1026,7 +1025,7 @@ propertynotify(XEvent *e) {
</a> 
 void
 quit(const Arg *arg) {
<a href="#h3-4-3" id="h3-4-3" class="d">-	readin = running = False;
</a><a href="#h3-4-4" id="h3-4-4" class="i">+	running = False;
</a> }
 
 void
<a href="#h3-5" id="h3-5" class="h">@@ -1180,60 +1179,13 @@ restack(void) {
</a> 
 void
 run(void) {
<a href="#h3-5-3" id="h3-5-3" class="d">-	char *p;
</a><a href="#h3-5-4" id="h3-5-4" class="d">-	char sbuf[sizeof stext];
</a><a href="#h3-5-5" id="h3-5-5" class="d">-	fd_set rd;
</a><a href="#h3-5-6" id="h3-5-6" class="d">-	int r, xfd;
</a><a href="#h3-5-7" id="h3-5-7" class="d">-	unsigned int len, offset;
</a> 	XEvent ev;
 
<a href="#h3-5-10" id="h3-5-10" class="d">-	/* main event loop, also reads status text from stdin */
</a><a href="#h3-5-11" id="h3-5-11" class="i">+	/* main event loop */
</a> 	XSync(dpy, False);
<a href="#h3-5-13" id="h3-5-13" class="d">-	xfd = ConnectionNumber(dpy);
</a><a href="#h3-5-14" id="h3-5-14" class="d">-	offset = 0;
</a><a href="#h3-5-15" id="h3-5-15" class="d">-	len = sizeof stext - 1;
</a><a href="#h3-5-16" id="h3-5-16" class="d">-	sbuf[len] = stext[len] = &#39;\0&#39;; /* 0-terminator is never touched */
</a><a href="#h3-5-17" id="h3-5-17" class="d">-	while(running) {
</a><a href="#h3-5-18" id="h3-5-18" class="d">-		FD_ZERO(&amp;rd);
</a><a href="#h3-5-19" id="h3-5-19" class="d">-		if(readin)
</a><a href="#h3-5-20" id="h3-5-20" class="d">-			FD_SET(STDIN_FILENO, &amp;rd);
</a><a href="#h3-5-21" id="h3-5-21" class="d">-		FD_SET(xfd, &amp;rd);
</a><a href="#h3-5-22" id="h3-5-22" class="d">-		if(select(xfd + 1, &amp;rd, NULL, NULL, NULL) == -1) {
</a><a href="#h3-5-23" id="h3-5-23" class="d">-			if(errno == EINTR)
</a><a href="#h3-5-24" id="h3-5-24" class="d">-				continue;
</a><a href="#h3-5-25" id="h3-5-25" class="d">-			die(&quot;select failed\n&quot;);
</a><a href="#h3-5-26" id="h3-5-26" class="d">-		}
</a><a href="#h3-5-27" id="h3-5-27" class="d">-		if(FD_ISSET(STDIN_FILENO, &amp;rd)) {
</a><a href="#h3-5-28" id="h3-5-28" class="d">-			switch((r = read(STDIN_FILENO, sbuf + offset, len - offset))) {
</a><a href="#h3-5-29" id="h3-5-29" class="d">-			case -1:
</a><a href="#h3-5-30" id="h3-5-30" class="d">-				strncpy(stext, strerror(errno), len);
</a><a href="#h3-5-31" id="h3-5-31" class="d">-				readin = False;
</a><a href="#h3-5-32" id="h3-5-32" class="d">-				break;
</a><a href="#h3-5-33" id="h3-5-33" class="d">-			case 0:
</a><a href="#h3-5-34" id="h3-5-34" class="d">-				strncpy(stext, &quot;EOF&quot;, 4);
</a><a href="#h3-5-35" id="h3-5-35" class="d">-				readin = False;
</a><a href="#h3-5-36" id="h3-5-36" class="d">-				break;
</a><a href="#h3-5-37" id="h3-5-37" class="d">-			default:
</a><a href="#h3-5-38" id="h3-5-38" class="d">-				for(p = sbuf + offset; r &gt; 0; p++, r--, offset++)
</a><a href="#h3-5-39" id="h3-5-39" class="d">-					if(*p == &#39;\n&#39; || *p == &#39;\0&#39;) {
</a><a href="#h3-5-40" id="h3-5-40" class="d">-						*p = &#39;\0&#39;;
</a><a href="#h3-5-41" id="h3-5-41" class="d">-						strncpy(stext, sbuf, len);
</a><a href="#h3-5-42" id="h3-5-42" class="d">-						p += r - 1; /* p is sbuf + offset + r - 1 */
</a><a href="#h3-5-43" id="h3-5-43" class="d">-						for(r = 0; *(p - r) &amp;&amp; *(p - r) != &#39;\n&#39;; r++);
</a><a href="#h3-5-44" id="h3-5-44" class="d">-						offset = r;
</a><a href="#h3-5-45" id="h3-5-45" class="d">-						if(r)
</a><a href="#h3-5-46" id="h3-5-46" class="d">-							memmove(sbuf, p - r + 1, r);
</a><a href="#h3-5-47" id="h3-5-47" class="d">-						break;
</a><a href="#h3-5-48" id="h3-5-48" class="d">-					}
</a><a href="#h3-5-49" id="h3-5-49" class="d">-				break;
</a><a href="#h3-5-50" id="h3-5-50" class="d">-			}
</a><a href="#h3-5-51" id="h3-5-51" class="d">-			drawbar();
</a><a href="#h3-5-52" id="h3-5-52" class="d">-		}
</a><a href="#h3-5-53" id="h3-5-53" class="d">-		while(XPending(dpy)) {
</a><a href="#h3-5-54" id="h3-5-54" class="d">-			XNextEvent(dpy, &amp;ev);
</a><a href="#h3-5-55" id="h3-5-55" class="d">-			if(handler[ev.type])
</a><a href="#h3-5-56" id="h3-5-56" class="d">-				(handler[ev.type])(&amp;ev); /* call handler */
</a><a href="#h3-5-57" id="h3-5-57" class="d">-		}
</a><a href="#h3-5-58" id="h3-5-58" class="i">+	while(running &amp;&amp; !XNextEvent(dpy, &amp;ev)) {
</a><a href="#h3-5-59" id="h3-5-59" class="i">+		if(handler[ev.type])
</a><a href="#h3-5-60" id="h3-5-60" class="i">+			(handler[ev.type])(&amp;ev); /* call handler */
</a> 	}
 }
 
<a href="#h3-6" id="h3-6" class="h">@@ -1356,8 +1308,7 @@ setup(void) {
</a> 			CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
 	XDefineCursor(dpy, barwin, cursor[CurNormal]);
 	XMapRaised(dpy, barwin);
<a href="#h3-6-3" id="h3-6-3" class="d">-	strcpy(stext, &quot;dwm-&quot;VERSION);
</a><a href="#h3-6-4" id="h3-6-4" class="d">-	drawbar();
</a><a href="#h3-6-5" id="h3-6-5" class="i">+	updatestatus();
</a> 
 	/* EWMH support per view */
 	XChangeProperty(dpy, root, netatom[NetSupported], XA_ATOM, 32,
<a href="#h3-7" id="h3-7" class="h">@@ -1365,7 +1316,8 @@ setup(void) {
</a> 
 	/* select for events */
 	wa.event_mask = SubstructureRedirectMask|SubstructureNotifyMask|ButtonPressMask
<a href="#h3-7-3" id="h3-7-3" class="d">-			|EnterWindowMask|LeaveWindowMask|StructureNotifyMask;
</a><a href="#h3-7-4" id="h3-7-4" class="i">+			|EnterWindowMask|LeaveWindowMask|StructureNotifyMask
</a><a href="#h3-7-5" id="h3-7-5" class="i">+			|PropertyChangeMask;
</a> 	XChangeWindowAttributes(dpy, root, CWEventMask|CWCursor, &amp;wa);
 	XSelectInput(dpy, root, wa.event_mask);
 
<a href="#h3-8" id="h3-8" class="h">@@ -1647,6 +1599,13 @@ updatetitle(Client *c) {
</a> }
 
 void
<a href="#h3-8-3" id="h3-8-3" class="i">+updatestatus() {
</a><a href="#h3-8-4" id="h3-8-4" class="i">+	if(!gettextprop(root, XA_WM_NAME, stext, sizeof(stext)))
</a><a href="#h3-8-5" id="h3-8-5" class="i">+		strcpy(stext, &quot;dwm-&quot;VERSION);
</a><a href="#h3-8-6" id="h3-8-6" class="i">+	drawbar();
</a><a href="#h3-8-7" id="h3-8-7" class="i">+}
</a><a href="#h3-8-8" id="h3-8-8" class="i">+
</a><a href="#h3-8-9" id="h3-8-9" class="i">+void
</a> updatewmhints(Client *c) {
 	XWMHints *wmh;
 
</pre>
</div>
</body>
</html>
