<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>applied Gottox&#39; patches, and also removed usegrab - dwm - dynamic window manager
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dwm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dwm</h1><span class="desc">dynamic window manager
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/565697087b92db6eb09e896f60f68503ce0a4ac1.html">565697087b92db6eb09e896f60f68503ce0a4ac1</a>
<b>parent</b> <a href="../commit/ea0008cba24b57f7955541568c8c527c06329ccd.html">ea0008cba24b57f7955541568c8c527c06329ccd</a>
<b>Author:</b> Anselm R Garbe &lt;<a href="mailto:garbeam@gmail.com">garbeam@gmail.com</a>&gt;
<b>Date:</b>   Tue, 17 Mar 2009 19:53:00 +0000

applied Gottox&#39; patches, and also removed usegrab
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">dwm.c</a></td><td> | </td><td class="num">120</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------------------------</span></td></tr>
</table></pre><pre>2 files changed, 55 insertions(+), 67 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -12,8 +12,6 @@ static unsigned int borderpx        = 1;        /* border pixel of windows */
</a> static unsigned int snap            = 32;       /* snap pixel */
 static Bool showbar                 = True;     /* False means no bar */
 static Bool topbar                  = True;     /* False means bottom bar */
<a href="#h0-0-3" id="h0-0-3" class="d">-static Bool usegrab                 = False;    /* True means grabbing the X server
</a><a href="#h0-0-4" id="h0-0-4" class="d">-                                                   during mouse-based resizals */
</a> 
 /* tagging */
 static const char tags[][MAXTAGLEN] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot; };
<b>diff --git a/<a id="h1" href="../file/dwm.c.html">dwm.c</a> b/<a href="../file/dwm.c.html">dwm.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -129,7 +129,7 @@ typedef struct {
</a> 
 /* function declarations */
 static void applyrules(Client *c);
<a href="#h1-0-3" id="h1-0-3" class="d">-static void applysizehints(Client *c, int *w, int *h);
</a><a href="#h1-0-4" id="h1-0-4" class="i">+static Bool applysizehints(Client *c, int *x, int *y, int *w, int *h);
</a> static void arrange(void);
 static void attach(Client *c);
 static void attachstack(Client *c);
<a href="#h1-1" id="h1-1" class="h">@@ -252,6 +252,7 @@ applyrules(Client *c) {
</a> 	XClassHint ch = { 0 };
 
 	/* rule matching */
<a href="#h1-1-3" id="h1-1-3" class="i">+	c-&gt;isfloating = c-&gt;tags = 0;
</a> 	if(XGetClassHint(dpy, c-&gt;win, &amp;ch)) {
 		for(i = 0; i &lt; LENGTH(rules); i++) {
 			r = &amp;rules[i];
<a href="#h1-2" id="h1-2" class="h">@@ -259,7 +260,7 @@ applyrules(Client *c) {
</a> 			&amp;&amp; (!r-&gt;class || (ch.res_class &amp;&amp; strstr(ch.res_class, r-&gt;class)))
 			&amp;&amp; (!r-&gt;instance || (ch.res_name &amp;&amp; strstr(ch.res_name, r-&gt;instance)))) {
 				c-&gt;isfloating = r-&gt;isfloating;
<a href="#h1-2-3" id="h1-2-3" class="d">-				c-&gt;tags |= r-&gt;tags &amp; TAGMASK ? r-&gt;tags &amp; TAGMASK : tagset[seltags]; 
</a><a href="#h1-2-4" id="h1-2-4" class="i">+				c-&gt;tags |= r-&gt;tags; 
</a> 			}
 		}
 		if(ch.res_class)
<a href="#h1-3" id="h1-3" class="h">@@ -267,60 +268,72 @@ applyrules(Client *c) {
</a> 		if(ch.res_name)
 			XFree(ch.res_name);
 	}
<a href="#h1-3-3" id="h1-3-3" class="d">-	if(!c-&gt;tags)
</a><a href="#h1-3-4" id="h1-3-4" class="d">-		c-&gt;tags = tagset[seltags];
</a><a href="#h1-3-5" id="h1-3-5" class="i">+	c-&gt;tags = c-&gt;tags &amp; TAGMASK ? c-&gt;tags &amp; TAGMASK : tagset[seltags];
</a> }
 
<a href="#h1-3-8" id="h1-3-8" class="d">-void
</a><a href="#h1-3-9" id="h1-3-9" class="d">-applysizehints(Client *c, int *w, int *h) {
</a><a href="#h1-3-10" id="h1-3-10" class="i">+Bool
</a><a href="#h1-3-11" id="h1-3-11" class="i">+applysizehints(Client *c, int *x, int *y, int *w, int *h) {
</a> 	Bool baseismin;
 
<a href="#h1-3-14" id="h1-3-14" class="d">-	if(!resizehints &amp;&amp; !c-&gt;isfloating)
</a><a href="#h1-3-15" id="h1-3-15" class="d">-		return;
</a><a href="#h1-3-16" id="h1-3-16" class="d">-
</a><a href="#h1-3-17" id="h1-3-17" class="d">-	/* see last two sentences in ICCCM 4.1.2.3 */
</a><a href="#h1-3-18" id="h1-3-18" class="d">-	baseismin = c-&gt;basew == c-&gt;minw &amp;&amp; c-&gt;baseh == c-&gt;minh;
</a><a href="#h1-3-19" id="h1-3-19" class="d">-
</a> 	/* set minimum possible */
 	*w = MAX(1, *w);
 	*h = MAX(1, *h);
 
<a href="#h1-3-24" id="h1-3-24" class="d">-	if(!baseismin) { /* temporarily remove base dimensions */
</a><a href="#h1-3-25" id="h1-3-25" class="d">-		*w -= c-&gt;basew;
</a><a href="#h1-3-26" id="h1-3-26" class="d">-		*h -= c-&gt;baseh;
</a><a href="#h1-3-27" id="h1-3-27" class="d">-	}
</a><a href="#h1-3-28" id="h1-3-28" class="i">+	if(*x &gt; sx + sw)
</a><a href="#h1-3-29" id="h1-3-29" class="i">+		*x = sw - WIDTH(c);
</a><a href="#h1-3-30" id="h1-3-30" class="i">+	if(*y &gt; sy + sh)
</a><a href="#h1-3-31" id="h1-3-31" class="i">+		*y = sh - HEIGHT(c);
</a><a href="#h1-3-32" id="h1-3-32" class="i">+	if(*x + *w + 2 * c-&gt;bw &lt; sx)
</a><a href="#h1-3-33" id="h1-3-33" class="i">+		*x = sx;
</a><a href="#h1-3-34" id="h1-3-34" class="i">+	if(*y + *h + 2 * c-&gt;bw &lt; sy)
</a><a href="#h1-3-35" id="h1-3-35" class="i">+		*y = sy;
</a><a href="#h1-3-36" id="h1-3-36" class="i">+	if(*h &lt; bh)
</a><a href="#h1-3-37" id="h1-3-37" class="i">+		*h = bh;
</a><a href="#h1-3-38" id="h1-3-38" class="i">+	if(*w &lt; bh)
</a><a href="#h1-3-39" id="h1-3-39" class="i">+		*w = bh;
</a><a href="#h1-3-40" id="h1-3-40" class="i">+
</a><a href="#h1-3-41" id="h1-3-41" class="i">+	if(resizehints || c-&gt;isfloating) {
</a><a href="#h1-3-42" id="h1-3-42" class="i">+		/* see last two sentences in ICCCM 4.1.2.3 */
</a><a href="#h1-3-43" id="h1-3-43" class="i">+		baseismin = c-&gt;basew == c-&gt;minw &amp;&amp; c-&gt;baseh == c-&gt;minh;
</a><a href="#h1-3-44" id="h1-3-44" class="i">+
</a><a href="#h1-3-45" id="h1-3-45" class="i">+		if(!baseismin) { /* temporarily remove base dimensions */
</a><a href="#h1-3-46" id="h1-3-46" class="i">+			*w -= c-&gt;basew;
</a><a href="#h1-3-47" id="h1-3-47" class="i">+			*h -= c-&gt;baseh;
</a><a href="#h1-3-48" id="h1-3-48" class="i">+		}
</a> 
<a href="#h1-3-50" id="h1-3-50" class="d">-	/* adjust for aspect limits */
</a><a href="#h1-3-51" id="h1-3-51" class="d">-	if(c-&gt;mina &gt; 0 &amp;&amp; c-&gt;maxa &gt; 0) {
</a><a href="#h1-3-52" id="h1-3-52" class="d">-		if(c-&gt;maxa &lt; (float)*w / *h)
</a><a href="#h1-3-53" id="h1-3-53" class="d">-			*w = *h * c-&gt;maxa;
</a><a href="#h1-3-54" id="h1-3-54" class="d">-		else if(c-&gt;mina &lt; (float)*h / *w)
</a><a href="#h1-3-55" id="h1-3-55" class="d">-			*h = *w * c-&gt;mina;
</a><a href="#h1-3-56" id="h1-3-56" class="d">-	}
</a><a href="#h1-3-57" id="h1-3-57" class="i">+		/* adjust for aspect limits */
</a><a href="#h1-3-58" id="h1-3-58" class="i">+		if(c-&gt;mina &gt; 0 &amp;&amp; c-&gt;maxa &gt; 0) {
</a><a href="#h1-3-59" id="h1-3-59" class="i">+			if(c-&gt;maxa &lt; (float)*w / *h)
</a><a href="#h1-3-60" id="h1-3-60" class="i">+				*w = *h * c-&gt;maxa;
</a><a href="#h1-3-61" id="h1-3-61" class="i">+			else if(c-&gt;mina &lt; (float)*h / *w)
</a><a href="#h1-3-62" id="h1-3-62" class="i">+				*h = *w * c-&gt;mina;
</a><a href="#h1-3-63" id="h1-3-63" class="i">+		}
</a> 
<a href="#h1-3-65" id="h1-3-65" class="d">-	if(baseismin) { /* increment calculation requires this */
</a><a href="#h1-3-66" id="h1-3-66" class="d">-		*w -= c-&gt;basew;
</a><a href="#h1-3-67" id="h1-3-67" class="d">-		*h -= c-&gt;baseh;
</a><a href="#h1-3-68" id="h1-3-68" class="d">-	}
</a><a href="#h1-3-69" id="h1-3-69" class="i">+		if(baseismin) { /* increment calculation requires this */
</a><a href="#h1-3-70" id="h1-3-70" class="i">+			*w -= c-&gt;basew;
</a><a href="#h1-3-71" id="h1-3-71" class="i">+			*h -= c-&gt;baseh;
</a><a href="#h1-3-72" id="h1-3-72" class="i">+		}
</a> 
<a href="#h1-3-74" id="h1-3-74" class="d">-	/* adjust for increment value */
</a><a href="#h1-3-75" id="h1-3-75" class="d">-	if(c-&gt;incw)
</a><a href="#h1-3-76" id="h1-3-76" class="d">-		*w -= *w % c-&gt;incw;
</a><a href="#h1-3-77" id="h1-3-77" class="d">-	if(c-&gt;inch)
</a><a href="#h1-3-78" id="h1-3-78" class="d">-		*h -= *h % c-&gt;inch;
</a><a href="#h1-3-79" id="h1-3-79" class="i">+		/* adjust for increment value */
</a><a href="#h1-3-80" id="h1-3-80" class="i">+		if(c-&gt;incw)
</a><a href="#h1-3-81" id="h1-3-81" class="i">+			*w -= *w % c-&gt;incw;
</a><a href="#h1-3-82" id="h1-3-82" class="i">+		if(c-&gt;inch)
</a><a href="#h1-3-83" id="h1-3-83" class="i">+			*h -= *h % c-&gt;inch;
</a> 
<a href="#h1-3-85" id="h1-3-85" class="d">-	/* restore base dimensions */
</a><a href="#h1-3-86" id="h1-3-86" class="d">-	*w += c-&gt;basew;
</a><a href="#h1-3-87" id="h1-3-87" class="d">-	*h += c-&gt;baseh;
</a><a href="#h1-3-88" id="h1-3-88" class="i">+		/* restore base dimensions */
</a><a href="#h1-3-89" id="h1-3-89" class="i">+		*w += c-&gt;basew;
</a><a href="#h1-3-90" id="h1-3-90" class="i">+		*h += c-&gt;baseh;
</a> 
<a href="#h1-3-92" id="h1-3-92" class="d">-	*w = MAX(*w, c-&gt;minw);
</a><a href="#h1-3-93" id="h1-3-93" class="d">-	*h = MAX(*h, c-&gt;minh);
</a><a href="#h1-3-94" id="h1-3-94" class="i">+		*w = MAX(*w, c-&gt;minw);
</a><a href="#h1-3-95" id="h1-3-95" class="i">+		*h = MAX(*h, c-&gt;minh);
</a> 
<a href="#h1-3-97" id="h1-3-97" class="d">-	if(c-&gt;maxw)
</a><a href="#h1-3-98" id="h1-3-98" class="d">-		*w = MIN(*w, c-&gt;maxw);
</a><a href="#h1-3-99" id="h1-3-99" class="i">+		if(c-&gt;maxw)
</a><a href="#h1-3-100" id="h1-3-100" class="i">+			*w = MIN(*w, c-&gt;maxw);
</a> 
<a href="#h1-3-102" id="h1-3-102" class="d">-	if(c-&gt;maxh)
</a><a href="#h1-3-103" id="h1-3-103" class="d">-		*h = MIN(*h, c-&gt;maxh);
</a><a href="#h1-3-104" id="h1-3-104" class="i">+		if(c-&gt;maxh)
</a><a href="#h1-3-105" id="h1-3-105" class="i">+			*h = MIN(*h, c-&gt;maxh);
</a><a href="#h1-3-106" id="h1-3-106" class="i">+	}
</a><a href="#h1-3-107" id="h1-3-107" class="i">+	return *x != c-&gt;x || *y != c-&gt;y || *w != c-&gt;w || *h != c-&gt;h;
</a> }
 
 void
<a href="#h1-4" id="h1-4" class="h">@@ -1005,8 +1018,6 @@ movemouse(const Arg *arg) {
</a> 	None, cursor[CurMove], CurrentTime) != GrabSuccess)
 		return;
 	XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, &amp;x, &amp;y, &amp;di, &amp;di, &amp;dui);
<a href="#h1-4-3" id="h1-4-3" class="d">-	if(usegrab)
</a><a href="#h1-4-4" id="h1-4-4" class="d">-		XGrabServer(dpy);
</a> 	do {
 		XMaskEvent(dpy, MOUSEMASK|ExposureMask|SubstructureRedirectMask, &amp;ev);
 		switch (ev.type) {
<a href="#h1-5" id="h1-5" class="h">@@ -1037,8 +1048,6 @@ movemouse(const Arg *arg) {
</a> 		}
 	}
 	while(ev.type != ButtonRelease);
<a href="#h1-5-3" id="h1-5-3" class="d">-	if(usegrab)
</a><a href="#h1-5-4" id="h1-5-4" class="d">-		XUngrabServer(dpy);
</a> 	XUngrabPointer(dpy, CurrentTime);
 }
 
<a href="#h1-6" id="h1-6" class="h">@@ -1091,22 +1100,7 @@ void
</a> resize(Client *c, int x, int y, int w, int h) {
 	XWindowChanges wc;
 
<a href="#h1-6-3" id="h1-6-3" class="d">-	applysizehints(c, &amp;w, &amp;h);
</a><a href="#h1-6-4" id="h1-6-4" class="d">-	if(w &lt;= 0 || h &lt;= 0)
</a><a href="#h1-6-5" id="h1-6-5" class="d">-		return;
</a><a href="#h1-6-6" id="h1-6-6" class="d">-	if(x &gt; sx + sw)
</a><a href="#h1-6-7" id="h1-6-7" class="d">-		x = sw - WIDTH(c);
</a><a href="#h1-6-8" id="h1-6-8" class="d">-	if(y &gt; sy + sh)
</a><a href="#h1-6-9" id="h1-6-9" class="d">-		y = sh - HEIGHT(c);
</a><a href="#h1-6-10" id="h1-6-10" class="d">-	if(x + w + 2 * c-&gt;bw &lt; sx)
</a><a href="#h1-6-11" id="h1-6-11" class="d">-		x = sx;
</a><a href="#h1-6-12" id="h1-6-12" class="d">-	if(y + h + 2 * c-&gt;bw &lt; sy)
</a><a href="#h1-6-13" id="h1-6-13" class="d">-		y = sy;
</a><a href="#h1-6-14" id="h1-6-14" class="d">-	if(h &lt; bh)
</a><a href="#h1-6-15" id="h1-6-15" class="d">-		h = bh;
</a><a href="#h1-6-16" id="h1-6-16" class="d">-	if(w &lt; bh)
</a><a href="#h1-6-17" id="h1-6-17" class="d">-		w = bh;
</a><a href="#h1-6-18" id="h1-6-18" class="d">-	if(c-&gt;x != x || c-&gt;y != y || c-&gt;w != w || c-&gt;h != h) {
</a><a href="#h1-6-19" id="h1-6-19" class="i">+	if(applysizehints(c, &amp;x, &amp;y, &amp;w, &amp;h)) {
</a> 		c-&gt;x = wc.x = x;
 		c-&gt;y = wc.y = y;
 		c-&gt;w = wc.width = w;
<a href="#h1-7" id="h1-7" class="h">@@ -1135,8 +1129,6 @@ resizemouse(const Arg *arg) {
</a> 	None, cursor[CurResize], CurrentTime) != GrabSuccess)
 		return;
 	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;bw - 1, c-&gt;h + c-&gt;bw - 1);
<a href="#h1-7-3" id="h1-7-3" class="d">-	if(usegrab)
</a><a href="#h1-7-4" id="h1-7-4" class="d">-		XGrabServer(dpy);
</a> 	do {
 		XMaskEvent(dpy, MOUSEMASK|ExposureMask|SubstructureRedirectMask, &amp;ev);
 		switch(ev.type) {
<a href="#h1-8" id="h1-8" class="h">@@ -1161,8 +1153,6 @@ resizemouse(const Arg *arg) {
</a> 		}
 	}
 	while(ev.type != ButtonRelease);
<a href="#h1-8-3" id="h1-8-3" class="d">-	if(usegrab)
</a><a href="#h1-8-4" id="h1-8-4" class="d">-		XUngrabServer(dpy);
</a> 	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;bw - 1, c-&gt;h + c-&gt;bw - 1);
 	XUngrabPointer(dpy, CurrentTime);
 	while(XCheckMaskEvent(dpy, EnterWindowMask, &amp;ev));
</pre>
</div>
</body>
</html>
