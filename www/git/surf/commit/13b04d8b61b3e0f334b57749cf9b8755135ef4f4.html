<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Style inquisition plus blocking of the */favicon.ico request. Thanks Peter A. Shevtsov! - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/13b04d8b61b3e0f334b57749cf9b8755135ef4f4.html">13b04d8b61b3e0f334b57749cf9b8755135ef4f4</a>
<b>parent</b> <a href="../commit/a013f0857e0f2ddf720b9d02954eeacd8d3f849b.html">a013f0857e0f2ddf720b9d02954eeacd8d3f849b</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Thu,  6 Dec 2012 13:32:52 +0100

Style inquisition plus blocking of the */favicon.ico request. Thanks Peter A.
Shevtsov!

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">surf.c</a></td><td> | </td><td class="num">270</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------</span></td></tr>
</table></pre><pre>1 file changed, 173 insertions(+), 97 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -83,18 +83,29 @@ static gboolean loadimages = 1, enableplugins = 1, enablescripts = 1,
</a> 		usingproxy = 0;
 static char togglestat[5];
 
<a href="#h0-0-3" id="h0-0-3" class="i">+static void beforerequest(WebKitWebView *w, WebKitWebFrame *f,
</a><a href="#h0-0-4" id="h0-0-4" class="i">+		WebKitWebResource *r, WebKitNetworkRequest *req,
</a><a href="#h0-0-5" id="h0-0-5" class="i">+		WebKitNetworkResponse *resp, gpointer d);
</a> static char *buildpath(const char *path);
<a href="#h0-0-7" id="h0-0-7" class="d">-static gboolean buttonrelease(WebKitWebView *web, GdkEventButton *e, GList *gl);
</a><a href="#h0-0-8" id="h0-0-8" class="i">+static gboolean buttonrelease(WebKitWebView *web, GdkEventButton *e,
</a><a href="#h0-0-9" id="h0-0-9" class="i">+		GList *gl);
</a> static void cleanup(void);
 static void clipboard(Client *c, const Arg *arg);
<a href="#h0-0-12" id="h0-0-12" class="d">-static void cookiejar_changed(SoupCookieJar *self, SoupCookie *old_cookie, SoupCookie *new_cookie);
</a><a href="#h0-0-13" id="h0-0-13" class="i">+static void cookiejar_changed(SoupCookieJar *self, SoupCookie *old_cookie,
</a><a href="#h0-0-14" id="h0-0-14" class="i">+		SoupCookie *new_cookie);
</a> static void cookiejar_finalize(GObject *self);
 static SoupCookieJar *cookiejar_new(const char *filename, gboolean read_only);
<a href="#h0-0-17" id="h0-0-17" class="d">-static void cookiejar_set_property(GObject *self, guint prop_id, const GValue *value, GParamSpec *pspec);
</a><a href="#h0-0-18" id="h0-0-18" class="i">+static void cookiejar_set_property(GObject *self, guint prop_id,
</a><a href="#h0-0-19" id="h0-0-19" class="i">+		const GValue *value, GParamSpec *pspec);
</a> static char *copystr(char **str, const char *src);
<a href="#h0-0-21" id="h0-0-21" class="d">-static WebKitWebView *createwindow(WebKitWebView *v, WebKitWebFrame *f, Client *c);
</a><a href="#h0-0-22" id="h0-0-22" class="d">-static gboolean decidedownload(WebKitWebView *v, WebKitWebFrame *f, WebKitNetworkRequest *r, gchar *m,  WebKitWebPolicyDecision *p, Client *c);
</a><a href="#h0-0-23" id="h0-0-23" class="d">-static gboolean decidewindow(WebKitWebView *v, WebKitWebFrame *f, WebKitNetworkRequest *r, WebKitWebNavigationAction *n, WebKitWebPolicyDecision *p, Client *c);
</a><a href="#h0-0-24" id="h0-0-24" class="i">+static WebKitWebView *createwindow(WebKitWebView *v, WebKitWebFrame *f,
</a><a href="#h0-0-25" id="h0-0-25" class="i">+		Client *c);
</a><a href="#h0-0-26" id="h0-0-26" class="i">+static gboolean decidedownload(WebKitWebView *v, WebKitWebFrame *f,
</a><a href="#h0-0-27" id="h0-0-27" class="i">+		WebKitNetworkRequest *r, gchar *m,  WebKitWebPolicyDecision *p,
</a><a href="#h0-0-28" id="h0-0-28" class="i">+		Client *c);
</a><a href="#h0-0-29" id="h0-0-29" class="i">+static gboolean decidewindow(WebKitWebView *v, WebKitWebFrame *f,
</a><a href="#h0-0-30" id="h0-0-30" class="i">+		WebKitNetworkRequest *r, WebKitWebNavigationAction *n,
</a><a href="#h0-0-31" id="h0-0-31" class="i">+		WebKitWebPolicyDecision *p, Client *c);
</a> static void destroyclient(Client *c);
 static void destroywin(GtkWidget* w, Client *c);
 static void die(char *str);
<a href="#h0-1" id="h0-1" class="h">@@ -106,8 +117,10 @@ static const char *getatom(Client *c, int a);
</a> static char *geturi(Client *c);
 static gboolean initdownload(WebKitWebView *v, WebKitDownload *o, Client *c);
 static gboolean keypress(GtkWidget *w, GdkEventKey *ev, Client *c);
<a href="#h0-1-3" id="h0-1-3" class="d">-static void linkhover(WebKitWebView *v, const char* t, const char* l, Client *c);
</a><a href="#h0-1-4" id="h0-1-4" class="d">-static void loadstatuschange(WebKitWebView *view, GParamSpec *pspec, Client *c);
</a><a href="#h0-1-5" id="h0-1-5" class="i">+static void linkhover(WebKitWebView *v, const char* t, const char* l,
</a><a href="#h0-1-6" id="h0-1-6" class="i">+		Client *c);
</a><a href="#h0-1-7" id="h0-1-7" class="i">+static void loadstatuschange(WebKitWebView *view, GParamSpec *pspec,
</a><a href="#h0-1-8" id="h0-1-8" class="i">+		Client *c);
</a> static void loaduri(Client *c, const Arg *arg);
 static void navigate(Client *c, const Arg *arg);
 static Client *newclient(void);
<a href="#h0-2" id="h0-2" class="h">@@ -116,7 +129,8 @@ static void pasteuri(GtkClipboard *clipboard, const char *text, gpointer d);
</a> static void populatepopup(WebKitWebView *web, GtkMenu *menu, Client *c);
 static void popupactivate(GtkMenuItem *menu, Client *);
 static void print(Client *c, const Arg *arg);
<a href="#h0-2-3" id="h0-2-3" class="d">-static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event, gpointer d);
</a><a href="#h0-2-4" id="h0-2-4" class="i">+static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event,
</a><a href="#h0-2-5" id="h0-2-5" class="i">+		gpointer d);
</a> static void progresschange(WebKitWebView *view, GParamSpec *pspec, Client *c);
 static void reload(Client *c, const Arg *arg);
 static void scroll_h(Client *c, const Arg *arg);
<a href="#h0-3" id="h0-3" class="h">@@ -129,19 +143,30 @@ static void source(Client *c, const Arg *arg);
</a> static void spawn(Client *c, const Arg *arg);
 static void eval(Client *c, const Arg *arg);
 static void stop(Client *c, const Arg *arg);
<a href="#h0-3-3" id="h0-3-3" class="d">-static void titlechange(WebKitWebView *v, WebKitWebFrame* frame, const char* title, Client *c);
</a><a href="#h0-3-4" id="h0-3-4" class="i">+static void titlechange(WebKitWebView *v, WebKitWebFrame *frame,
</a><a href="#h0-3-5" id="h0-3-5" class="i">+		const char *title, Client *c);
</a> static void toggle(Client *c, const Arg *arg);
 static void gettogglestat(Client *c);
 static void update(Client *c);
 static void updatewinid(Client *c);
 static void usage(void);
<a href="#h0-3-11" id="h0-3-11" class="d">-static void windowobjectcleared(GtkWidget *w, WebKitWebFrame *frame, JSContextRef js, JSObjectRef win, Client *c);
</a><a href="#h0-3-12" id="h0-3-12" class="i">+static void windowobjectcleared(GtkWidget *w, WebKitWebFrame *frame,
</a><a href="#h0-3-13" id="h0-3-13" class="i">+		JSContextRef js, JSObjectRef win, Client *c);
</a> static void zoom(Client *c, const Arg *arg);
 
 /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
 
<a href="#h0-3-19" id="h0-3-19" class="d">-char *
</a><a href="#h0-3-20" id="h0-3-20" class="i">+static void
</a><a href="#h0-3-21" id="h0-3-21" class="i">+beforerequest(WebKitWebView *w, WebKitWebFrame *f, WebKitWebResource *r,
</a><a href="#h0-3-22" id="h0-3-22" class="i">+		WebKitNetworkRequest *req, WebKitNetworkResponse *resp,
</a><a href="#h0-3-23" id="h0-3-23" class="i">+		gpointer d) {
</a><a href="#h0-3-24" id="h0-3-24" class="i">+	const gchar *uri = webkit_network_request_get_uri(req);
</a><a href="#h0-3-25" id="h0-3-25" class="i">+	if(g_str_has_suffix(uri, &quot;/favicon.ico&quot;))
</a><a href="#h0-3-26" id="h0-3-26" class="i">+		webkit_network_request_set_uri(req, &quot;about:blank&quot;);
</a><a href="#h0-3-27" id="h0-3-27" class="i">+}
</a><a href="#h0-3-28" id="h0-3-28" class="i">+
</a><a href="#h0-3-29" id="h0-3-29" class="i">+static char *
</a> buildpath(const char *path) {
 	char *apath, *p;
 	FILE *f;
<a href="#h0-4" id="h0-4" class="h">@@ -178,7 +203,8 @@ buildpath(const char *path) {
</a> static gboolean
 buttonrelease(WebKitWebView *web, GdkEventButton *e, GList *gl) {
 	WebKitHitTestResultContext context;
<a href="#h0-4-3" id="h0-4-3" class="d">-	WebKitHitTestResult *result = webkit_web_view_get_hit_test_result(web, e);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+	WebKitHitTestResult *result = webkit_web_view_get_hit_test_result(web,
</a><a href="#h0-4-5" id="h0-4-5" class="i">+			e);
</a> 	Arg arg;
 
 	g_object_get(result, &quot;context&quot;, &amp;context, NULL);
<a href="#h0-5" id="h0-5" class="h">@@ -192,7 +218,7 @@ buttonrelease(WebKitWebView *web, GdkEventButton *e, GList *gl) {
</a> 	return false;
 }
 
<a href="#h0-5-3" id="h0-5-3" class="d">-void
</a><a href="#h0-5-4" id="h0-5-4" class="i">+static void
</a> cleanup(void) {
 	while(clients)
 		destroyclient(clients);
<a href="#h0-6" id="h0-6" class="h">@@ -202,18 +228,23 @@ cleanup(void) {
</a> }
 
 static void
<a href="#h0-6-3" id="h0-6-3" class="d">-cookiejar_changed(SoupCookieJar *self, SoupCookie *old_cookie, SoupCookie *new_cookie) {
</a><a href="#h0-6-4" id="h0-6-4" class="i">+cookiejar_changed(SoupCookieJar *self, SoupCookie *old_cookie,
</a><a href="#h0-6-5" id="h0-6-5" class="i">+		SoupCookie *new_cookie) {
</a> 	flock(COOKIEJAR(self)-&gt;lock, LOCK_EX);
<a href="#h0-6-7" id="h0-6-7" class="d">-	if(new_cookie &amp;&amp; !new_cookie-&gt;expires &amp;&amp; sessiontime)
</a><a href="#h0-6-8" id="h0-6-8" class="d">-		soup_cookie_set_expires(new_cookie, soup_date_new_from_now(sessiontime));
</a><a href="#h0-6-9" id="h0-6-9" class="d">-	SOUP_COOKIE_JAR_CLASS(cookiejar_parent_class)-&gt;changed(self, old_cookie, new_cookie);
</a><a href="#h0-6-10" id="h0-6-10" class="i">+	if(new_cookie &amp;&amp; !new_cookie-&gt;expires &amp;&amp; sessiontime) {
</a><a href="#h0-6-11" id="h0-6-11" class="i">+		soup_cookie_set_expires(new_cookie,
</a><a href="#h0-6-12" id="h0-6-12" class="i">+				soup_date_new_from_now(sessiontime));
</a><a href="#h0-6-13" id="h0-6-13" class="i">+	}
</a><a href="#h0-6-14" id="h0-6-14" class="i">+	SOUP_COOKIE_JAR_CLASS(cookiejar_parent_class)-&gt;changed(self,
</a><a href="#h0-6-15" id="h0-6-15" class="i">+			old_cookie, new_cookie);
</a> 	flock(COOKIEJAR(self)-&gt;lock, LOCK_UN);
 }
 
 static void
 cookiejar_class_init(CookieJarClass *klass) {
 	SOUP_COOKIE_JAR_CLASS(klass)-&gt;changed = cookiejar_changed;
<a href="#h0-6-22" id="h0-6-22" class="d">-	G_OBJECT_CLASS(klass)-&gt;get_property = G_OBJECT_CLASS(cookiejar_parent_class)-&gt;get_property;
</a><a href="#h0-6-23" id="h0-6-23" class="i">+	G_OBJECT_CLASS(klass)-&gt;get_property =
</a><a href="#h0-6-24" id="h0-6-24" class="i">+		G_OBJECT_CLASS(cookiejar_parent_class)-&gt;get_property;
</a> 	G_OBJECT_CLASS(klass)-&gt;set_property = cookiejar_set_property;
 	G_OBJECT_CLASS(klass)-&gt;finalize = cookiejar_finalize;
 	g_object_class_override_property(G_OBJECT_CLASS(klass), 1, &quot;filename&quot;);
<a href="#h0-7" id="h0-7" class="h">@@ -238,13 +269,15 @@ cookiejar_new(const char *filename, gboolean read_only) {
</a> }
 
 static void
<a href="#h0-7-3" id="h0-7-3" class="d">-cookiejar_set_property(GObject *self, guint prop_id, const GValue *value, GParamSpec *pspec) {
</a><a href="#h0-7-4" id="h0-7-4" class="i">+cookiejar_set_property(GObject *self, guint prop_id, const GValue *value,
</a><a href="#h0-7-5" id="h0-7-5" class="i">+		GParamSpec *pspec) {
</a> 	flock(COOKIEJAR(self)-&gt;lock, LOCK_SH);
<a href="#h0-7-7" id="h0-7-7" class="d">-	G_OBJECT_CLASS(cookiejar_parent_class)-&gt;set_property(self, prop_id, value, pspec);
</a><a href="#h0-7-8" id="h0-7-8" class="i">+	G_OBJECT_CLASS(cookiejar_parent_class)-&gt;set_property(self, prop_id,
</a><a href="#h0-7-9" id="h0-7-9" class="i">+			value, pspec);
</a> 	flock(COOKIEJAR(self)-&gt;lock, LOCK_UN);
 }
 
<a href="#h0-7-13" id="h0-7-13" class="d">-void
</a><a href="#h0-7-14" id="h0-7-14" class="i">+static void
</a> evalscript(JSContextRef js, char *script, char* scriptname) {
 	JSStringRef jsscript, jsscriptname;
 	JSValueRef exception = NULL;
<a href="#h0-8" id="h0-8" class="h">@@ -256,7 +289,7 @@ evalscript(JSContextRef js, char *script, char* scriptname) {
</a> 	JSStringRelease(jsscriptname);
 }
 
<a href="#h0-8-3" id="h0-8-3" class="d">-void
</a><a href="#h0-8-4" id="h0-8-4" class="i">+static void
</a> runscript(WebKitWebFrame *frame) {
 	char *script;
 	GError *error;
<a href="#h0-9" id="h0-9" class="h">@@ -266,7 +299,7 @@ runscript(WebKitWebFrame *frame) {
</a> 	}
 }
 
<a href="#h0-9-3" id="h0-9-3" class="d">-void
</a><a href="#h0-9-4" id="h0-9-4" class="i">+static void
</a> clipboard(Client *c, const Arg *arg) {
 	gboolean paste = *(gboolean *)arg;
 
<a href="#h0-10" id="h0-10" class="h">@@ -276,7 +309,7 @@ clipboard(Client *c, const Arg *arg) {
</a> 		gtk_clipboard_set_text(gtk_clipboard_get(GDK_SELECTION_PRIMARY), c-&gt;linkhover ? c-&gt;linkhover : geturi(c), -1);
 }
 
<a href="#h0-10-3" id="h0-10-3" class="d">-char *
</a><a href="#h0-10-4" id="h0-10-4" class="i">+static char *
</a> copystr(char **str, const char *src) {
 	char *tmp;
 	tmp = g_strdup(src);
<a href="#h0-11" id="h0-11" class="h">@@ -288,14 +321,15 @@ copystr(char **str, const char *src) {
</a> 	return tmp;
 }
 
<a href="#h0-11-3" id="h0-11-3" class="d">-WebKitWebView *
</a><a href="#h0-11-4" id="h0-11-4" class="i">+static WebKitWebView *
</a> createwindow(WebKitWebView  *v, WebKitWebFrame *f, Client *c) {
 	Client *n = newclient();
 	return n-&gt;view;
 }
 
<a href="#h0-11-10" id="h0-11-10" class="d">-gboolean
</a><a href="#h0-11-11" id="h0-11-11" class="d">-decidedownload(WebKitWebView *v, WebKitWebFrame *f, WebKitNetworkRequest *r, gchar *m,  WebKitWebPolicyDecision *p, Client *c) {
</a><a href="#h0-11-12" id="h0-11-12" class="i">+static gboolean
</a><a href="#h0-11-13" id="h0-11-13" class="i">+decidedownload(WebKitWebView *v, WebKitWebFrame *f, WebKitNetworkRequest *r,
</a><a href="#h0-11-14" id="h0-11-14" class="i">+		gchar *m,  WebKitWebPolicyDecision *p, Client *c) {
</a> 	if(!webkit_web_view_can_show_mime_type(v, m)) {
 		webkit_web_policy_decision_download(p);
 		return TRUE;
<a href="#h0-12" id="h0-12" class="h">@@ -303,11 +337,14 @@ decidedownload(WebKitWebView *v, WebKitWebFrame *f, WebKitNetworkRequest *r, gch
</a> 	return FALSE;
 }
 
<a href="#h0-12-3" id="h0-12-3" class="d">-gboolean
</a><a href="#h0-12-4" id="h0-12-4" class="d">-decidewindow(WebKitWebView *view, WebKitWebFrame *f, WebKitNetworkRequest *r, WebKitWebNavigationAction *n, WebKitWebPolicyDecision *p, Client *c) {
</a><a href="#h0-12-5" id="h0-12-5" class="i">+static gboolean
</a><a href="#h0-12-6" id="h0-12-6" class="i">+decidewindow(WebKitWebView *view, WebKitWebFrame *f, WebKitNetworkRequest *r,
</a><a href="#h0-12-7" id="h0-12-7" class="i">+		WebKitWebNavigationAction *n, WebKitWebPolicyDecision *p,
</a><a href="#h0-12-8" id="h0-12-8" class="i">+		Client *c) {
</a> 	Arg arg;
 
<a href="#h0-12-11" id="h0-12-11" class="d">-	if(webkit_web_navigation_action_get_reason(n) == WEBKIT_WEB_NAVIGATION_REASON_LINK_CLICKED) {
</a><a href="#h0-12-12" id="h0-12-12" class="i">+	if(webkit_web_navigation_action_get_reason(n) ==
</a><a href="#h0-12-13" id="h0-12-13" class="i">+			WEBKIT_WEB_NAVIGATION_REASON_LINK_CLICKED) {
</a> 		webkit_web_policy_decision_ignore(p);
 		arg.v = (void *)webkit_network_request_get_uri(r);
 		newwindow(NULL, &amp;arg, 0);
<a href="#h0-13" id="h0-13" class="h">@@ -316,7 +353,7 @@ decidewindow(WebKitWebView *view, WebKitWebFrame *f, WebKitNetworkRequest *r, We
</a> 	return FALSE;
 }
 
<a href="#h0-13-3" id="h0-13-3" class="d">-void
</a><a href="#h0-13-4" id="h0-13-4" class="i">+static void
</a> destroyclient(Client *c) {
 	Client *p;
 
<a href="#h0-14" id="h0-14" class="h">@@ -328,27 +365,28 @@ destroyclient(Client *c) {
</a> 	gtk_widget_destroy(c-&gt;win);
 
 	for(p = clients; p &amp;&amp; p-&gt;next != c; p = p-&gt;next);
<a href="#h0-14-3" id="h0-14-3" class="d">-	if(p)
</a><a href="#h0-14-4" id="h0-14-4" class="i">+	if(p) {
</a> 		p-&gt;next = c-&gt;next;
<a href="#h0-14-6" id="h0-14-6" class="d">-	else
</a><a href="#h0-14-7" id="h0-14-7" class="i">+	} else {
</a> 		clients = c-&gt;next;
<a href="#h0-14-9" id="h0-14-9" class="i">+	}
</a> 	free(c);
 	if(clients == NULL)
 		gtk_main_quit();
 }
 
<a href="#h0-14-15" id="h0-14-15" class="d">-void
</a><a href="#h0-14-16" id="h0-14-16" class="i">+static void
</a> destroywin(GtkWidget* w, Client *c) {
 	destroyclient(c);
 }
 
<a href="#h0-14-21" id="h0-14-21" class="d">-void
</a><a href="#h0-14-22" id="h0-14-22" class="i">+static void
</a> die(char *str) {
 	fputs(str, stderr);
 	exit(EXIT_FAILURE);
 }
 
<a href="#h0-14-28" id="h0-14-28" class="d">-void
</a><a href="#h0-14-29" id="h0-14-29" class="i">+static void
</a> drawindicator(Client *c) {
 	gint width;
 	const char *uri;
<a href="#h0-15" id="h0-15" class="h">@@ -363,9 +401,11 @@ drawindicator(Client *c) {
</a> 	gc = gdk_gc_new(w-&gt;window);
 	if(strstr(uri, &quot;https://&quot;) == uri) {
 		if(usingproxy) {
<a href="#h0-15-3" id="h0-15-3" class="d">-			colorname = c-&gt;sslfailed? progress_proxy_untrust : progress_proxy_trust;
</a><a href="#h0-15-4" id="h0-15-4" class="i">+			colorname = c-&gt;sslfailed? progress_proxy_untrust :
</a><a href="#h0-15-5" id="h0-15-5" class="i">+				progress_proxy_trust;
</a> 		} else {
<a href="#h0-15-7" id="h0-15-7" class="d">-			colorname = c-&gt;sslfailed? progress_untrust : progress_trust;
</a><a href="#h0-15-8" id="h0-15-8" class="i">+			colorname = c-&gt;sslfailed? progress_untrust :
</a><a href="#h0-15-9" id="h0-15-9" class="i">+				progress_trust;
</a> 		}
 	} else {
 		if(usingproxy) {
<a href="#h0-16" id="h0-16" class="h">@@ -385,13 +425,13 @@ drawindicator(Client *c) {
</a> 	g_object_unref(gc);
 }
 
<a href="#h0-16-3" id="h0-16-3" class="d">-gboolean
</a><a href="#h0-16-4" id="h0-16-4" class="i">+static gboolean
</a> exposeindicator(GtkWidget *w, GdkEventExpose *e, Client *c) {
 	drawindicator(c);
 	return TRUE;
 }
 
<a href="#h0-16-10" id="h0-16-10" class="d">-void
</a><a href="#h0-16-11" id="h0-16-11" class="i">+static void
</a> find(Client *c, const Arg *arg) {
 	const char *s;
 
<a href="#h0-17" id="h0-17" class="h">@@ -400,7 +440,7 @@ find(Client *c, const Arg *arg) {
</a> 	webkit_web_view_search_text(c-&gt;view, s, FALSE, forward, TRUE);
 }
 
<a href="#h0-17-3" id="h0-17-3" class="d">-void
</a><a href="#h0-17-4" id="h0-17-4" class="i">+static void
</a> fullscreen(Client *c, const Arg *arg) {
 	if(c-&gt;fullscreen) {
 		gtk_window_unfullscreen(GTK_WINDOW(c-&gt;win));
<a href="#h0-18" id="h0-18" class="h">@@ -410,7 +450,7 @@ fullscreen(Client *c, const Arg *arg) {
</a> 	c-&gt;fullscreen = !c-&gt;fullscreen;
 }
 
<a href="#h0-18-3" id="h0-18-3" class="d">-const char *
</a><a href="#h0-18-4" id="h0-18-4" class="i">+static const char *
</a> getatom(Client *c, int a) {
 	static char buf[BUFSIZ];
 	Atom adummy;
<a href="#h0-19" id="h0-19" class="h">@@ -429,7 +469,7 @@ getatom(Client *c, int a) {
</a> 	return buf;
 }
 
<a href="#h0-19-3" id="h0-19-3" class="d">-char *
</a><a href="#h0-19-4" id="h0-19-4" class="i">+static char *
</a> geturi(Client *c) {
 	char *uri;
 
<a href="#h0-20" id="h0-20" class="h">@@ -438,7 +478,7 @@ geturi(Client *c) {
</a> 	return uri;
 }
 
<a href="#h0-20-3" id="h0-20-3" class="d">-gboolean
</a><a href="#h0-20-4" id="h0-20-4" class="i">+static gboolean
</a> initdownload(WebKitWebView *view, WebKitDownload *o, Client *c) {
 	Arg arg;
 
<a href="#h0-21" id="h0-21" class="h">@@ -448,7 +488,7 @@ initdownload(WebKitWebView *view, WebKitDownload *o, Client *c) {
</a> 	return FALSE;
 }
 
<a href="#h0-21-3" id="h0-21-3" class="d">-gboolean
</a><a href="#h0-21-4" id="h0-21-4" class="i">+static gboolean
</a> keypress(GtkWidget* w, GdkEventKey *ev, Client *c) {
 	guint i;
 	gboolean processed = FALSE;
<a href="#h0-22" id="h0-22" class="h">@@ -466,7 +506,7 @@ keypress(GtkWidget* w, GdkEventKey *ev, Client *c) {
</a> 	return processed;
 }
 
<a href="#h0-22-3" id="h0-22-3" class="d">-void
</a><a href="#h0-22-4" id="h0-22-4" class="i">+static void
</a> linkhover(WebKitWebView *v, const char* t, const char* l, Client *c) {
 	if(l) {
 		c-&gt;linkhover = copystr(&amp;c-&gt;linkhover, l);
<a href="#h0-23" id="h0-23" class="h">@@ -477,7 +517,7 @@ linkhover(WebKitWebView *v, const char* t, const char* l, Client *c) {
</a> 	update(c);
 }
 
<a href="#h0-23-3" id="h0-23-3" class="d">-void
</a><a href="#h0-23-4" id="h0-23-4" class="i">+static void
</a> loadstatuschange(WebKitWebView *view, GParamSpec *pspec, Client *c) {
 	WebKitWebFrame *frame;
 	WebKitWebDataSource *src;
<a href="#h0-24" id="h0-24" class="h">@@ -507,7 +547,7 @@ loadstatuschange(WebKitWebView *view, GParamSpec *pspec, Client *c) {
</a> 	}
 }
 
<a href="#h0-24-3" id="h0-24-3" class="d">-void
</a><a href="#h0-24-4" id="h0-24-4" class="i">+static void
</a> loaduri(Client *c, const Arg *arg) {
 	char *u, *rp;
 	const char *uri = (char *)arg-&gt;v;
<a href="#h0-25" id="h0-25" class="h">@@ -538,13 +578,13 @@ loaduri(Client *c, const Arg *arg) {
</a> 	}
 }
 
<a href="#h0-25-3" id="h0-25-3" class="d">-void
</a><a href="#h0-25-4" id="h0-25-4" class="i">+static void
</a> navigate(Client *c, const Arg *arg) {
 	int steps = *(int *)arg;
 	webkit_web_view_go_back_or_forward(c-&gt;view, steps);
 }
 
<a href="#h0-25-10" id="h0-25-10" class="d">-Client *
</a><a href="#h0-25-11" id="h0-25-11" class="i">+static Client *
</a> newclient(void) {
 	Client *c;
 	WebKitWebSettings *settings;
<a href="#h0-26" id="h0-26" class="h">@@ -576,8 +616,12 @@ newclient(void) {
</a> 		gtk_window_set_role(GTK_WINDOW(c-&gt;win), &quot;Surf&quot;);
 	}
 	gtk_window_set_default_size(GTK_WINDOW(c-&gt;win), 800, 600);
<a href="#h0-26-3" id="h0-26-3" class="d">-	g_signal_connect(G_OBJECT(c-&gt;win), &quot;destroy&quot;, G_CALLBACK(destroywin), c);
</a><a href="#h0-26-4" id="h0-26-4" class="d">-	g_signal_connect(G_OBJECT(c-&gt;win), &quot;key-press-event&quot;, G_CALLBACK(keypress), c);
</a><a href="#h0-26-5" id="h0-26-5" class="i">+	g_signal_connect(G_OBJECT(c-&gt;win),
</a><a href="#h0-26-6" id="h0-26-6" class="i">+			&quot;destroy&quot;,
</a><a href="#h0-26-7" id="h0-26-7" class="i">+			G_CALLBACK(destroywin), c);
</a><a href="#h0-26-8" id="h0-26-8" class="i">+	g_signal_connect(G_OBJECT(c-&gt;win),
</a><a href="#h0-26-9" id="h0-26-9" class="i">+			&quot;key-press-event&quot;,
</a><a href="#h0-26-10" id="h0-26-10" class="i">+			G_CALLBACK(keypress), c);
</a> 
 	/* VBox */
 	c-&gt;vbox = gtk_vbox_new(FALSE, 0);
<a href="#h0-27" id="h0-27" class="h">@@ -589,17 +633,42 @@ newclient(void) {
</a> 
 	/* Webview */
 	c-&gt;view = WEBKIT_WEB_VIEW(webkit_web_view_new());
<a href="#h0-27-3" id="h0-27-3" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;title-changed&quot;, G_CALLBACK(titlechange), c);
</a><a href="#h0-27-4" id="h0-27-4" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;hovering-over-link&quot;, G_CALLBACK(linkhover), c);
</a><a href="#h0-27-5" id="h0-27-5" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;create-web-view&quot;, G_CALLBACK(createwindow), c);
</a><a href="#h0-27-6" id="h0-27-6" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;new-window-policy-decision-requested&quot;, G_CALLBACK(decidewindow), c);
</a><a href="#h0-27-7" id="h0-27-7" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;mime-type-policy-decision-requested&quot;, G_CALLBACK(decidedownload), c);
</a><a href="#h0-27-8" id="h0-27-8" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;window-object-cleared&quot;, G_CALLBACK(windowobjectcleared), c);
</a><a href="#h0-27-9" id="h0-27-9" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;notify::load-status&quot;, G_CALLBACK(loadstatuschange), c);
</a><a href="#h0-27-10" id="h0-27-10" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;notify::progress&quot;, G_CALLBACK(progresschange), c);
</a><a href="#h0-27-11" id="h0-27-11" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;download-requested&quot;, G_CALLBACK(initdownload), c);
</a><a href="#h0-27-12" id="h0-27-12" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;button-release-event&quot;, G_CALLBACK(buttonrelease), c);
</a><a href="#h0-27-13" id="h0-27-13" class="d">-	g_signal_connect(G_OBJECT(c-&gt;view), &quot;populate-popup&quot;, G_CALLBACK(populatepopup), c);
</a><a href="#h0-27-14" id="h0-27-14" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-15" id="h0-27-15" class="i">+			&quot;title-changed&quot;,
</a><a href="#h0-27-16" id="h0-27-16" class="i">+			G_CALLBACK(titlechange), c);
</a><a href="#h0-27-17" id="h0-27-17" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-18" id="h0-27-18" class="i">+			&quot;hovering-over-link&quot;,
</a><a href="#h0-27-19" id="h0-27-19" class="i">+			G_CALLBACK(linkhover), c);
</a><a href="#h0-27-20" id="h0-27-20" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-21" id="h0-27-21" class="i">+			&quot;create-web-view&quot;,
</a><a href="#h0-27-22" id="h0-27-22" class="i">+			G_CALLBACK(createwindow), c);
</a><a href="#h0-27-23" id="h0-27-23" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-24" id="h0-27-24" class="i">+			&quot;new-window-policy-decision-requested&quot;,
</a><a href="#h0-27-25" id="h0-27-25" class="i">+			G_CALLBACK(decidewindow), c);
</a><a href="#h0-27-26" id="h0-27-26" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-27" id="h0-27-27" class="i">+			&quot;mime-type-policy-decision-requested&quot;,
</a><a href="#h0-27-28" id="h0-27-28" class="i">+			G_CALLBACK(decidedownload), c);
</a><a href="#h0-27-29" id="h0-27-29" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-30" id="h0-27-30" class="i">+			&quot;window-object-cleared&quot;,
</a><a href="#h0-27-31" id="h0-27-31" class="i">+			G_CALLBACK(windowobjectcleared), c);
</a><a href="#h0-27-32" id="h0-27-32" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-33" id="h0-27-33" class="i">+			&quot;notify::load-status&quot;,
</a><a href="#h0-27-34" id="h0-27-34" class="i">+			G_CALLBACK(loadstatuschange), c);
</a><a href="#h0-27-35" id="h0-27-35" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-36" id="h0-27-36" class="i">+			&quot;notify::progress&quot;,
</a><a href="#h0-27-37" id="h0-27-37" class="i">+			G_CALLBACK(progresschange), c);
</a><a href="#h0-27-38" id="h0-27-38" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-39" id="h0-27-39" class="i">+			&quot;download-requested&quot;,
</a><a href="#h0-27-40" id="h0-27-40" class="i">+			G_CALLBACK(initdownload), c);
</a><a href="#h0-27-41" id="h0-27-41" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-42" id="h0-27-42" class="i">+			&quot;button-release-event&quot;,
</a><a href="#h0-27-43" id="h0-27-43" class="i">+			G_CALLBACK(buttonrelease), c);
</a><a href="#h0-27-44" id="h0-27-44" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-45" id="h0-27-45" class="i">+			&quot;populate-popup&quot;,
</a><a href="#h0-27-46" id="h0-27-46" class="i">+			G_CALLBACK(populatepopup), c);
</a><a href="#h0-27-47" id="h0-27-47" class="i">+	g_signal_connect(G_OBJECT(c-&gt;view),
</a><a href="#h0-27-48" id="h0-27-48" class="i">+			&quot;resource-request-starting&quot;,
</a><a href="#h0-27-49" id="h0-27-49" class="i">+			G_CALLBACK(beforerequest), c);
</a> 
 	/* Indicator */
 	c-&gt;indicator = gtk_drawing_area_new();
<a href="#h0-28" id="h0-28" class="h">@@ -614,14 +683,17 @@ newclient(void) {
</a> 	gtk_container_add(GTK_CONTAINER(c-&gt;vbox), c-&gt;indicator);
 
 	/* Setup */
<a href="#h0-28-3" id="h0-28-3" class="d">-	gtk_box_set_child_packing(GTK_BOX(c-&gt;vbox), c-&gt;indicator, FALSE, FALSE, 0, GTK_PACK_START);
</a><a href="#h0-28-4" id="h0-28-4" class="d">-	gtk_box_set_child_packing(GTK_BOX(c-&gt;vbox), c-&gt;scroll, TRUE, TRUE, 0, GTK_PACK_START);
</a><a href="#h0-28-5" id="h0-28-5" class="i">+	gtk_box_set_child_packing(GTK_BOX(c-&gt;vbox), c-&gt;indicator, FALSE,
</a><a href="#h0-28-6" id="h0-28-6" class="i">+			FALSE, 0, GTK_PACK_START);
</a><a href="#h0-28-7" id="h0-28-7" class="i">+	gtk_box_set_child_packing(GTK_BOX(c-&gt;vbox), c-&gt;scroll, TRUE,
</a><a href="#h0-28-8" id="h0-28-8" class="i">+			TRUE, 0, GTK_PACK_START);
</a> 	gtk_widget_grab_focus(GTK_WIDGET(c-&gt;view));
 	gtk_widget_show(c-&gt;vbox);
 	gtk_widget_show(c-&gt;scroll);
 	gtk_widget_show(GTK_WIDGET(c-&gt;view));
 	gtk_widget_show(c-&gt;win);
<a href="#h0-28-14" id="h0-28-14" class="d">-	gtk_window_set_geometry_hints(GTK_WINDOW(c-&gt;win), NULL, &amp;hints, GDK_HINT_MIN_SIZE);
</a><a href="#h0-28-15" id="h0-28-15" class="i">+	gtk_window_set_geometry_hints(GTK_WINDOW(c-&gt;win), NULL, &amp;hints,
</a><a href="#h0-28-16" id="h0-28-16" class="i">+			GDK_HINT_MIN_SIZE);
</a> 	gdk_window_set_events(GTK_WIDGET(c-&gt;win)-&gt;window, GDK_ALL_EVENTS_MASK);
 	gdk_window_add_filter(GTK_WIDGET(c-&gt;win)-&gt;window, processx, c);
 	webkit_web_view_set_full_content_zoom(c-&gt;view, TRUE);
<a href="#h0-29" id="h0-29" class="h">@@ -652,7 +724,8 @@ newclient(void) {
</a> 	clients = c;
 	if(showxid) {
 		gdk_display_sync(gtk_widget_get_display(c-&gt;win));
<a href="#h0-29-3" id="h0-29-3" class="d">-		printf(&quot;%u\n&quot;, (guint)GDK_WINDOW_XID(GTK_WIDGET(c-&gt;win)-&gt;window));
</a><a href="#h0-29-4" id="h0-29-4" class="i">+		printf(&quot;%u\n&quot;,
</a><a href="#h0-29-5" id="h0-29-5" class="i">+			(guint)GDK_WINDOW_XID(GTK_WIDGET(c-&gt;win)-&gt;window));
</a> 		fflush(NULL);
                 if (fclose(stdout) != 0) {
 			die(&quot;Error closing stdout&quot;);
<a href="#h0-30" id="h0-30" class="h">@@ -661,7 +734,7 @@ newclient(void) {
</a> 	return c;
 }
 
<a href="#h0-30-3" id="h0-30-3" class="d">-void
</a><a href="#h0-30-4" id="h0-30-4" class="i">+static void
</a> newwindow(Client *c, const Arg *arg, gboolean noembed) {
 	guint i = 0;
 	const char *cmd[10], *uri;
<a href="#h0-31" id="h0-31" class="h">@@ -729,19 +802,19 @@ popupactivate(GtkMenuItem *menu, Client *c) {
</a> 	}
 }
 
<a href="#h0-31-3" id="h0-31-3" class="d">-void
</a><a href="#h0-31-4" id="h0-31-4" class="i">+static void
</a> pasteuri(GtkClipboard *clipboard, const char *text, gpointer d) {
 	Arg arg = {.v = text };
 	if(text != NULL)
 		loaduri((Client *) d, &amp;arg);
 }
 
<a href="#h0-31-11" id="h0-31-11" class="d">-void
</a><a href="#h0-31-12" id="h0-31-12" class="i">+static void
</a> print(Client *c, const Arg *arg) {
 	webkit_web_frame_print(webkit_web_view_get_main_frame(c-&gt;view));
 }
 
<a href="#h0-31-17" id="h0-31-17" class="d">-GdkFilterReturn
</a><a href="#h0-31-18" id="h0-31-18" class="i">+static GdkFilterReturn
</a> processx(GdkXEvent *e, GdkEvent *event, gpointer d) {
 	Client *c = (Client *)d;
 	XPropertyEvent *ev;
<a href="#h0-32" id="h0-32" class="h">@@ -765,13 +838,13 @@ processx(GdkXEvent *e, GdkEvent *event, gpointer d) {
</a> 	return GDK_FILTER_CONTINUE;
 }
 
<a href="#h0-32-3" id="h0-32-3" class="d">-void
</a><a href="#h0-32-4" id="h0-32-4" class="i">+static void
</a> progresschange(WebKitWebView *view, GParamSpec *pspec, Client *c) {
 	c-&gt;progress = webkit_web_view_get_progress(c-&gt;view) * 100;
 	update(c);
 }
 
<a href="#h0-32-10" id="h0-32-10" class="d">-void
</a><a href="#h0-32-11" id="h0-32-11" class="i">+static void
</a> reload(Client *c, const Arg *arg) {
 	gboolean nocache = *(gboolean *)arg;
 	if(nocache)
<a href="#h0-33" id="h0-33" class="h">@@ -780,19 +853,19 @@ reload(Client *c, const Arg *arg) {
</a> 		 webkit_web_view_reload(c-&gt;view);
 }
 
<a href="#h0-33-3" id="h0-33-3" class="d">-void
</a><a href="#h0-33-4" id="h0-33-4" class="i">+static void
</a> scroll_h(Client *c, const Arg *arg) {
 	scroll(gtk_scrolled_window_get_hadjustment(
 				GTK_SCROLLED_WINDOW(c-&gt;scroll)), arg);
 }
 
<a href="#h0-33-10" id="h0-33-10" class="d">-void
</a><a href="#h0-33-11" id="h0-33-11" class="i">+static void
</a> scroll_v(Client *c, const Arg *arg) {
 	scroll(gtk_scrolled_window_get_vadjustment(
 				GTK_SCROLLED_WINDOW(c-&gt;scroll)), arg);
 }
 
<a href="#h0-33-17" id="h0-33-17" class="d">-void
</a><a href="#h0-33-18" id="h0-33-18" class="i">+static void
</a> scroll(GtkAdjustment *a, const Arg *arg) {
 	gdouble v;
 
<a href="#h0-34" id="h0-34" class="h">@@ -815,15 +888,15 @@ scroll(GtkAdjustment *a, const Arg *arg) {
</a> 	gtk_adjustment_set_value(a, v);
 }
 
<a href="#h0-34-3" id="h0-34-3" class="d">-void
</a><a href="#h0-34-4" id="h0-34-4" class="i">+static void
</a> setatom(Client *c, int a, const char *v) {
 	XSync(dpy, False);
<a href="#h0-34-7" id="h0-34-7" class="d">-	XChangeProperty(dpy, GDK_WINDOW_XID(GTK_WIDGET(c-&gt;win)-&gt;window), atoms[a],
</a><a href="#h0-34-8" id="h0-34-8" class="d">-			XA_STRING, 8, PropModeReplace, (unsigned char *)v,
</a><a href="#h0-34-9" id="h0-34-9" class="d">-			strlen(v) + 1);
</a><a href="#h0-34-10" id="h0-34-10" class="i">+	XChangeProperty(dpy, GDK_WINDOW_XID(GTK_WIDGET(c-&gt;win)-&gt;window),
</a><a href="#h0-34-11" id="h0-34-11" class="i">+			atoms[a], XA_STRING, 8, PropModeReplace,
</a><a href="#h0-34-12" id="h0-34-12" class="i">+			(unsigned char *)v, strlen(v) + 1);
</a> }
 
<a href="#h0-34-15" id="h0-34-15" class="d">-void
</a><a href="#h0-34-16" id="h0-34-16" class="i">+static void
</a> setup(void) {
 	char *proxy;
 	char *new_proxy;
<a href="#h0-35" id="h0-35" class="h">@@ -852,7 +925,9 @@ setup(void) {
</a> 	s = webkit_get_default_session();
 
 	/* cookie jar */
<a href="#h0-35-3" id="h0-35-3" class="d">-	soup_session_add_feature(s, SOUP_SESSION_FEATURE(cookiejar_new(cookiefile, FALSE)));
</a><a href="#h0-35-4" id="h0-35-4" class="i">+	soup_session_add_feature(s,
</a><a href="#h0-35-5" id="h0-35-5" class="i">+			SOUP_SESSION_FEATURE(cookiejar_new(cookiefile,
</a><a href="#h0-35-6" id="h0-35-6" class="i">+					FALSE)));
</a> 
 	/* ssl */
 	g_object_set(G_OBJECT(s), &quot;ssl-ca-file&quot;, cafile, NULL);
<a href="#h0-36" id="h0-36" class="h">@@ -870,14 +945,14 @@ setup(void) {
</a> 	}
 }
 
<a href="#h0-36-3" id="h0-36-3" class="d">-void
</a><a href="#h0-36-4" id="h0-36-4" class="i">+static void
</a> sigchld(int unused) {
 	if(signal(SIGCHLD, sigchld) == SIG_ERR)
 		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
 	while(0 &lt; waitpid(-1, NULL, WNOHANG));
 }
 
<a href="#h0-36-11" id="h0-36-11" class="d">-void
</a><a href="#h0-36-12" id="h0-36-12" class="i">+static void
</a> source(Client *c, const Arg *arg) {
 	Arg a = { .b = FALSE };
 	gboolean s;
<a href="#h0-37" id="h0-37" class="h">@@ -887,7 +962,7 @@ source(Client *c, const Arg *arg) {
</a> 	reload(c, &amp;a);
 }
 
<a href="#h0-37-3" id="h0-37-3" class="d">-void
</a><a href="#h0-37-4" id="h0-37-4" class="i">+static void
</a> spawn(Client *c, const Arg *arg) {
 	if(fork() == 0) {
 		if(dpy)
<a href="#h0-38" id="h0-38" class="h">@@ -900,25 +975,25 @@ spawn(Client *c, const Arg *arg) {
</a> 	}
 }
 
<a href="#h0-38-3" id="h0-38-3" class="d">-void
</a><a href="#h0-38-4" id="h0-38-4" class="i">+static void
</a> eval(Client *c, const Arg *arg) {
 	WebKitWebFrame *frame = webkit_web_view_get_main_frame(c-&gt;view);
 	evalscript(webkit_web_frame_get_global_context(frame),
 			((char **)arg-&gt;v)[0], &quot;&quot;);
 }
 
<a href="#h0-38-11" id="h0-38-11" class="d">-void
</a><a href="#h0-38-12" id="h0-38-12" class="i">+static void
</a> stop(Client *c, const Arg *arg) {
 	webkit_web_view_stop_loading(c-&gt;view);
 }
 
<a href="#h0-38-17" id="h0-38-17" class="d">-void
</a><a href="#h0-38-18" id="h0-38-18" class="i">+static void
</a> titlechange(WebKitWebView *v, WebKitWebFrame *f, const char *t, Client *c) {
 	c-&gt;title = copystr(&amp;c-&gt;title, t);
 	update(c);
 }
 
<a href="#h0-38-24" id="h0-38-24" class="d">-void
</a><a href="#h0-38-25" id="h0-38-25" class="i">+static void
</a> toggle(Client *c, const Arg *arg) {
 	WebKitWebSettings *settings;
 	char *name = (char *)arg-&gt;v;
<a href="#h0-39" id="h0-39" class="h">@@ -932,7 +1007,7 @@ toggle(Client *c, const Arg *arg) {
</a> 	reload(c,&amp;a);
 }
 
<a href="#h0-39-3" id="h0-39-3" class="d">-void
</a><a href="#h0-39-4" id="h0-39-4" class="i">+static void
</a> gettogglestat(Client *c){
 	gboolean value;
 	WebKitWebSettings *settings = webkit_web_view_get_settings(c-&gt;view);
<a href="#h0-40" id="h0-40" class="h">@@ -954,7 +1029,7 @@ gettogglestat(Client *c){
</a> }
 
 
<a href="#h0-40-3" id="h0-40-3" class="d">-void
</a><a href="#h0-40-4" id="h0-40-4" class="i">+static void
</a> update(Client *c) {
 	char *t;
 
<a href="#h0-41" id="h0-41" class="h">@@ -976,25 +1051,26 @@ update(Client *c) {
</a> 	g_free(t);
 }
 
<a href="#h0-41-3" id="h0-41-3" class="d">-void
</a><a href="#h0-41-4" id="h0-41-4" class="i">+static void
</a> updatewinid(Client *c) {
 	snprintf(winid, LENGTH(winid), &quot;%u&quot;,
 			(int)GDK_WINDOW_XID(GTK_WIDGET(c-&gt;win)-&gt;window));
 }
 
<a href="#h0-41-10" id="h0-41-10" class="d">-void
</a><a href="#h0-41-11" id="h0-41-11" class="i">+static void
</a> usage(void) {
 	fputs(&quot;surf - simple browser\n&quot;, stderr);
 	die(&quot;usage: surf [-c cookiefile] [-e xid] [-i] [-p] [-r scriptfile]&quot;
 		&quot; [-s] [-t stylefile] [-u useragent] [-v] [-x] [uri]\n&quot;);
 }
 
<a href="#h0-41-18" id="h0-41-18" class="d">-void
</a><a href="#h0-41-19" id="h0-41-19" class="d">-windowobjectcleared(GtkWidget *w, WebKitWebFrame *frame, JSContextRef js, JSObjectRef win, Client *c) {
</a><a href="#h0-41-20" id="h0-41-20" class="i">+static void
</a><a href="#h0-41-21" id="h0-41-21" class="i">+windowobjectcleared(GtkWidget *w, WebKitWebFrame *frame, JSContextRef js,
</a><a href="#h0-41-22" id="h0-41-22" class="i">+		JSObjectRef win, Client *c) {
</a> 	runscript(frame);
 }
 
<a href="#h0-41-26" id="h0-41-26" class="d">-void
</a><a href="#h0-41-27" id="h0-41-27" class="i">+static void
</a> zoom(Client *c, const Arg *arg) {
 	c-&gt;zoomed = TRUE;
 	if(arg-&gt;i &lt; 0) {
</pre>
</div>
</body>
</html>
