<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Simplify DOWNLOAD macro - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/dca42648635b70f7d01adb8d9a53720a0c7909c1.html">dca42648635b70f7d01adb8d9a53720a0c7909c1</a>
<b>parent</b> <a href="../commit/654d527f87e59c6c9f507402878bed62398c4e61.html">654d527f87e59c6c9f507402878bed62398c4e61</a>
<b>Author:</b> Quentin Rameau &lt;<a href="mailto:quinq@fifth.space">quinq@fifth.space</a>&gt;
<b>Date:</b>   Thu,  4 May 2017 18:24:33 +0200

Simplify DOWNLOAD macro

No need to spawn an extra sh.
Use short flags for curl and quote operands.
Replace sleep with read, let the user close the download window instead
of waiting for an arbitrary time.
Rename d to reflect what it&#39;s used for.
Reorder sh positional arguments.
Set $0 to a command name and shift other positional parameters to
clarify the &quot;sh -c&quot; command.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++</span><span class="d">------</span></td></tr>
</table></pre><pre>1 file changed, 5 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -61,12 +61,11 @@ static WebKitFindOptions findopts = WEBKIT_FIND_OPTIONS_CASE_INSENSITIVE |
</a> }
 
 /* DOWNLOAD(URI, referer) */
<a href="#h0-0-3" id="h0-0-3" class="d">-#define DOWNLOAD(d, r) { \
</a><a href="#h0-0-4" id="h0-0-4" class="d">-        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h0-0-5" id="h0-0-5" class="d">-             &quot;st -e /bin/sh -c \&quot;curl -g -L -J -O --user-agent &#39;$1&#39;&quot; \
</a><a href="#h0-0-6" id="h0-0-6" class="d">-             &quot; --referer &#39;$2&#39; -b $3 -c $3 &#39;$0&#39;;&quot; \
</a><a href="#h0-0-7" id="h0-0-7" class="d">-             &quot; sleep 5;\&quot;&quot;, \
</a><a href="#h0-0-8" id="h0-0-8" class="d">-             d, useragent, r, cookiefile, NULL \
</a><a href="#h0-0-9" id="h0-0-9" class="i">+#define DOWNLOAD(u, r) { \
</a><a href="#h0-0-10" id="h0-0-10" class="i">+        .v = (const char *[]){ &quot;st&quot;, &quot;-e&quot;, &quot;/bin/sh&quot;, &quot;-c&quot;,\
</a><a href="#h0-0-11" id="h0-0-11" class="i">+             &quot;curl -g -L -J -O -A \&quot;$1\&quot; -b \&quot;$2\&quot; -c \&quot;$2\&quot;&quot; \
</a><a href="#h0-0-12" id="h0-0-12" class="i">+             &quot; -e \&quot;$3\&quot; \&quot;$4\&quot;; read&quot;, \
</a><a href="#h0-0-13" id="h0-0-13" class="i">+             &quot;surf-download&quot;, useragent, cookiefile, r, u, NULL \
</a>         } \
 }
 
</pre>
</div>
</body>
</html>
