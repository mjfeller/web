<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Adding web inspector support to surf. - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/e784d925dfab0405cb4bf2ac7466045d8089a189.html">e784d925dfab0405cb4bf2ac7466045d8089a189</a>
<b>parent</b> <a href="../commit/13b04d8b61b3e0f334b57749cf9b8755135ef4f4.html">13b04d8b61b3e0f334b57749cf9b8755135ef4f4</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Sat, 26 Jan 2013 15:53:33 +0100

Adding web inspector support to surf.

Thanks Gregor Best &lt;gbe@ring0.de&gt;!

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">surf.1</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">surf.c</a></td><td> | </td><td class="num">105</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------</span></td></tr>
</table></pre><pre>3 files changed, 101 insertions(+), 25 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -16,8 +16,12 @@ static char *cafile         = &quot;/etc/ssl/certs/ca-certificates.crt&quot;;
</a> static char *strictssl      = FALSE; /* Refuse untrusted SSL connections */
 static int   indicator_thickness = 2;
 
<a href="#h0-0-3" id="h0-0-3" class="d">-/* Webkit features */
</a><a href="#h0-0-4" id="h0-0-4" class="d">-static Bool spatialbrowsing = TRUE;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+/* Webkit default features */
</a><a href="#h0-0-6" id="h0-0-6" class="i">+static Bool enablespatialbrowsing = TRUE;
</a><a href="#h0-0-7" id="h0-0-7" class="i">+static Bool enableplugins = TRUE;
</a><a href="#h0-0-8" id="h0-0-8" class="i">+static Bool enablescripts = TRUE;
</a><a href="#h0-0-9" id="h0-0-9" class="i">+static Bool enableinspector = TRUE;
</a><a href="#h0-0-10" id="h0-0-10" class="i">+static Bool loadimages = TRUE;
</a> static Bool hidebackground  = FALSE;
 
 #define SETPROP(p, q) { \
<a href="#h0-1" id="h0-1" class="h">@@ -69,6 +73,7 @@ static Key keys[] = {
</a>     { 0,                    GDK_F11,    fullscreen, { 0 } },
     { 0,                    GDK_Escape, stop,       { 0 } },
     { MODKEY,               GDK_o,      source,     { 0 } },
<a href="#h0-1-3" id="h0-1-3" class="i">+    { MODKEY|GDK_SHIFT_MASK,GDK_o,      inspector,  { 0 } },
</a> 
     { MODKEY,               GDK_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;) },
     { MODKEY,               GDK_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;) },
<b>diff --git a/<a id="h1" href="../file/surf.1.html">surf.1</a> b/<a href="../file/surf.1.html">surf.1</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -3,16 +3,12 @@
</a> surf \- simple webkit-based browser
 .SH SYNOPSIS
 .B surf
<a href="#h1-0-3" id="h1-0-3" class="i">+.RB [-ipnsvx]
</a> .RB [-c\ cookiefile]
 .RB [-e\ xid]
<a href="#h1-0-6" id="h1-0-6" class="d">-.RB [-i]
</a><a href="#h1-0-7" id="h1-0-7" class="d">-.RB [-p]
</a> .RB [-r\ scriptfile]
<a href="#h1-0-9" id="h1-0-9" class="d">-.RB [-s]
</a> .RB [-t\ stylefile]
 .RB [-u\ useragent]
<a href="#h1-0-12" id="h1-0-12" class="d">-.RB [-v]
</a><a href="#h1-0-13" id="h1-0-13" class="d">-.RB [-x]
</a> .RB &quot;URI&quot;
 .SH DESCRIPTION
 surf is a simple Web browser based on WebKit/GTK+. It is able
<a href="#h1-1" id="h1-1" class="h">@@ -30,6 +26,9 @@ Reparents to window specified by xid.
</a> .B \-i
 Disable Images
 .TP
<a href="#h1-1-3" id="h1-1-3" class="i">+.B \-n
</a><a href="#h1-1-4" id="h1-1-4" class="i">+Disable the Web Inspector (Developer Tools).
</a><a href="#h1-1-5" id="h1-1-5" class="i">+.TP
</a> .B \-p
 Disable Plugins
 .TP
<a href="#h1-2" id="h1-2" class="h">@@ -127,6 +126,9 @@ Copies current URI to primary selection.
</a> .B Ctrl\-o
 Show the sourcecode of the current page.
 .TP
<a href="#h1-2-3" id="h1-2-3" class="i">+.B Ctrl\-Shift\-o
</a><a href="#h1-2-4" id="h1-2-4" class="i">+Open the Web Inspector (Developer Tools) window for the current page.
</a><a href="#h1-2-5" id="h1-2-5" class="i">+.TP
</a> .B Ctrl\-Shift\-c
 Toggle caret browsing.
 .TP
<b>diff --git a/<a id="h2" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -20,6 +20,8 @@
</a> #include &lt;glib/gstdio.h&gt;
 #include &lt;JavaScriptCore/JavaScript.h&gt;
 #include &lt;sys/file.h&gt;
<a href="#h2-0-3" id="h2-0-3" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h2-0-4" id="h2-0-4" class="i">+#include &lt;stdarg.h&gt;
</a> 
 #include &quot;arg.h&quot;
 
<a href="#h2-1" id="h2-1" class="h">@@ -41,12 +43,12 @@ union Arg {
</a> typedef struct Client {
 	GtkWidget *win, *scroll, *vbox, *indicator;
 	WebKitWebView *view;
<a href="#h2-1-3" id="h2-1-3" class="i">+	WebKitWebInspector *inspector;
</a> 	char *title, *linkhover;
 	const char *uri, *needle;
 	gint progress;
<a href="#h2-1-7" id="h2-1-7" class="d">-	gboolean sslfailed;
</a> 	struct Client *next;
<a href="#h2-1-9" id="h2-1-9" class="d">-	gboolean zoomed, fullscreen;
</a><a href="#h2-1-10" id="h2-1-10" class="i">+	gboolean zoomed, fullscreen, isinspector, sslfailed;
</a> } Client;
 
 typedef struct {
<a href="#h2-2" id="h2-2" class="h">@@ -79,8 +81,7 @@ static Client *clients = NULL;
</a> static GdkNativeWindow embed = 0;
 static gboolean showxid = FALSE;
 static char winid[64];
<a href="#h2-2-3" id="h2-2-3" class="d">-static gboolean loadimages = 1, enableplugins = 1, enablescripts = 1,
</a><a href="#h2-2-4" id="h2-2-4" class="d">-		usingproxy = 0;
</a><a href="#h2-2-5" id="h2-2-5" class="i">+static gboolean usingproxy = 0;
</a> static char togglestat[5];
 
 static void beforerequest(WebKitWebView *w, WebKitWebFrame *f,
<a href="#h2-3" id="h2-3" class="h">@@ -91,12 +92,14 @@ static gboolean buttonrelease(WebKitWebView *web, GdkEventButton *e,
</a> 		GList *gl);
 static void cleanup(void);
 static void clipboard(Client *c, const Arg *arg);
<a href="#h2-3-3" id="h2-3-3" class="i">+
</a> static void cookiejar_changed(SoupCookieJar *self, SoupCookie *old_cookie,
 		SoupCookie *new_cookie);
 static void cookiejar_finalize(GObject *self);
 static SoupCookieJar *cookiejar_new(const char *filename, gboolean read_only);
 static void cookiejar_set_property(GObject *self, guint prop_id,
 		const GValue *value, GParamSpec *pspec);
<a href="#h2-3-10" id="h2-3-10" class="i">+
</a> static char *copystr(char **str, const char *src);
 static WebKitWebView *createwindow(WebKitWebView *v, WebKitWebFrame *f,
 		Client *c);
<a href="#h2-4" id="h2-4" class="h">@@ -108,14 +111,24 @@ static gboolean decidewindow(WebKitWebView *v, WebKitWebFrame *f,
</a> 		WebKitWebPolicyDecision *p, Client *c);
 static void destroyclient(Client *c);
 static void destroywin(GtkWidget* w, Client *c);
<a href="#h2-4-3" id="h2-4-3" class="d">-static void die(char *str);
</a><a href="#h2-4-4" id="h2-4-4" class="i">+static void die(const char *errstr, ...);
</a> static void drawindicator(Client *c);
<a href="#h2-4-6" id="h2-4-6" class="i">+static void eval(Client *c, const Arg *arg);
</a> static gboolean exposeindicator(GtkWidget *w, GdkEventExpose *e, Client *c);
 static void find(Client *c, const Arg *arg);
 static void fullscreen(Client *c, const Arg *arg);
 static const char *getatom(Client *c, int a);
<a href="#h2-4-11" id="h2-4-11" class="i">+static void gettogglestat(Client *c);
</a> static char *geturi(Client *c);
 static gboolean initdownload(WebKitWebView *v, WebKitDownload *o, Client *c);
<a href="#h2-4-14" id="h2-4-14" class="i">+
</a><a href="#h2-4-15" id="h2-4-15" class="i">+static void inspector(Client *c, const Arg *arg);
</a><a href="#h2-4-16" id="h2-4-16" class="i">+static WebKitWebView *inspector_new(WebKitWebInspector *i, WebKitWebView *v,
</a><a href="#h2-4-17" id="h2-4-17" class="i">+		Client *c);
</a><a href="#h2-4-18" id="h2-4-18" class="i">+static gboolean inspector_show(WebKitWebInspector *i, Client *c);
</a><a href="#h2-4-19" id="h2-4-19" class="i">+static gboolean inspector_close(WebKitWebInspector *i, Client *c);
</a><a href="#h2-4-20" id="h2-4-20" class="i">+static void inspector_finished(WebKitWebInspector *i, Client *c);
</a><a href="#h2-4-21" id="h2-4-21" class="i">+
</a> static gboolean keypress(GtkWidget *w, GdkEventKey *ev, Client *c);
 static void linkhover(WebKitWebView *v, const char* t, const char* l,
 		Client *c);
<a href="#h2-5" id="h2-5" class="h">@@ -141,12 +154,10 @@ static void setup(void);
</a> static void sigchld(int unused);
 static void source(Client *c, const Arg *arg);
 static void spawn(Client *c, const Arg *arg);
<a href="#h2-5-3" id="h2-5-3" class="d">-static void eval(Client *c, const Arg *arg);
</a> static void stop(Client *c, const Arg *arg);
 static void titlechange(WebKitWebView *v, WebKitWebFrame *frame,
 		const char *title, Client *c);
 static void toggle(Client *c, const Arg *arg);
<a href="#h2-5-8" id="h2-5-8" class="d">-static void gettogglestat(Client *c);
</a> static void update(Client *c);
 static void updatewinid(Client *c);
 static void usage(void);
<a href="#h2-6" id="h2-6" class="h">@@ -381,8 +392,12 @@ destroywin(GtkWidget* w, Client *c) {
</a> }
 
 static void
<a href="#h2-6-3" id="h2-6-3" class="d">-die(char *str) {
</a><a href="#h2-6-4" id="h2-6-4" class="d">-	fputs(str, stderr);
</a><a href="#h2-6-5" id="h2-6-5" class="i">+die(const char *errstr, ...) {
</a><a href="#h2-6-6" id="h2-6-6" class="i">+	va_list ap;
</a><a href="#h2-6-7" id="h2-6-7" class="i">+
</a><a href="#h2-6-8" id="h2-6-8" class="i">+	va_start(ap, errstr);
</a><a href="#h2-6-9" id="h2-6-9" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h2-6-10" id="h2-6-10" class="i">+	va_end(ap);
</a> 	exit(EXIT_FAILURE);
 }
 
<a href="#h2-7" id="h2-7" class="h">@@ -488,6 +503,38 @@ initdownload(WebKitWebView *view, WebKitDownload *o, Client *c) {
</a> 	return FALSE;
 }
 
<a href="#h2-7-3" id="h2-7-3" class="i">+static void
</a><a href="#h2-7-4" id="h2-7-4" class="i">+inspector(Client *c, const Arg *arg) {
</a><a href="#h2-7-5" id="h2-7-5" class="i">+	if(c-&gt;isinspector)
</a><a href="#h2-7-6" id="h2-7-6" class="i">+		return;
</a><a href="#h2-7-7" id="h2-7-7" class="i">+	webkit_web_inspector_show(c-&gt;inspector);
</a><a href="#h2-7-8" id="h2-7-8" class="i">+}
</a><a href="#h2-7-9" id="h2-7-9" class="i">+
</a><a href="#h2-7-10" id="h2-7-10" class="i">+static WebKitWebView *
</a><a href="#h2-7-11" id="h2-7-11" class="i">+inspector_new(WebKitWebInspector *i, WebKitWebView *v, Client *c) {
</a><a href="#h2-7-12" id="h2-7-12" class="i">+	Client *n = newclient();
</a><a href="#h2-7-13" id="h2-7-13" class="i">+	n-&gt;isinspector = true;
</a><a href="#h2-7-14" id="h2-7-14" class="i">+
</a><a href="#h2-7-15" id="h2-7-15" class="i">+	return n-&gt;view;
</a><a href="#h2-7-16" id="h2-7-16" class="i">+}
</a><a href="#h2-7-17" id="h2-7-17" class="i">+
</a><a href="#h2-7-18" id="h2-7-18" class="i">+static gboolean
</a><a href="#h2-7-19" id="h2-7-19" class="i">+inspector_show(WebKitWebInspector *i, Client *c) {
</a><a href="#h2-7-20" id="h2-7-20" class="i">+	gtk_widget_show(GTK_WIDGET(webkit_web_inspector_get_web_view(i)));
</a><a href="#h2-7-21" id="h2-7-21" class="i">+	return true;
</a><a href="#h2-7-22" id="h2-7-22" class="i">+}
</a><a href="#h2-7-23" id="h2-7-23" class="i">+
</a><a href="#h2-7-24" id="h2-7-24" class="i">+static gboolean
</a><a href="#h2-7-25" id="h2-7-25" class="i">+inspector_close(WebKitWebInspector *i, Client *c) {
</a><a href="#h2-7-26" id="h2-7-26" class="i">+	gtk_widget_hide(GTK_WIDGET(webkit_web_inspector_get_web_view(i)));
</a><a href="#h2-7-27" id="h2-7-27" class="i">+	return true;
</a><a href="#h2-7-28" id="h2-7-28" class="i">+}
</a><a href="#h2-7-29" id="h2-7-29" class="i">+
</a><a href="#h2-7-30" id="h2-7-30" class="i">+static void
</a><a href="#h2-7-31" id="h2-7-31" class="i">+inspector_finished(WebKitWebInspector *i, Client *c) {
</a><a href="#h2-7-32" id="h2-7-32" class="i">+	g_free(c-&gt;inspector);
</a><a href="#h2-7-33" id="h2-7-33" class="i">+}
</a><a href="#h2-7-34" id="h2-7-34" class="i">+
</a> static gboolean
 keypress(GtkWidget* w, GdkEventKey *ev, Client *c) {
 	guint i;
<a href="#h2-8" id="h2-8" class="h">@@ -706,11 +753,30 @@ newclient(void) {
</a> 	g_object_set(G_OBJECT(settings), &quot;user-agent&quot;, ua, NULL);
 	uri = g_strconcat(&quot;file://&quot;, stylefile, NULL);
 	g_object_set(G_OBJECT(settings), &quot;user-stylesheet-uri&quot;, uri, NULL);
<a href="#h2-8-3" id="h2-8-3" class="d">-	g_object_set(G_OBJECT(settings), &quot;auto-load-images&quot;, loadimages, NULL);
</a><a href="#h2-8-4" id="h2-8-4" class="d">-	g_object_set(G_OBJECT(settings), &quot;enable-plugins&quot;, enableplugins, NULL);
</a><a href="#h2-8-5" id="h2-8-5" class="d">-	g_object_set(G_OBJECT(settings), &quot;enable-scripts&quot;, enablescripts, NULL);
</a><a href="#h2-8-6" id="h2-8-6" class="i">+	g_object_set(G_OBJECT(settings), &quot;auto-load-images&quot;, loadimages,
</a><a href="#h2-8-7" id="h2-8-7" class="i">+			NULL);
</a><a href="#h2-8-8" id="h2-8-8" class="i">+	g_object_set(G_OBJECT(settings), &quot;enable-plugins&quot;, enableplugins,
</a><a href="#h2-8-9" id="h2-8-9" class="i">+			NULL);
</a><a href="#h2-8-10" id="h2-8-10" class="i">+	g_object_set(G_OBJECT(settings), &quot;enable-scripts&quot;, enablescripts,
</a><a href="#h2-8-11" id="h2-8-11" class="i">+			NULL);
</a> 	g_object_set(G_OBJECT(settings), &quot;enable-spatial-navigation&quot;,
<a href="#h2-8-13" id="h2-8-13" class="d">-			spatialbrowsing, NULL);
</a><a href="#h2-8-14" id="h2-8-14" class="i">+			enablespatialbrowsing, NULL);
</a><a href="#h2-8-15" id="h2-8-15" class="i">+	g_object_set(G_OBJECT(settings), &quot;enable-developer-extras&quot;,
</a><a href="#h2-8-16" id="h2-8-16" class="i">+			enableinspector, NULL);
</a><a href="#h2-8-17" id="h2-8-17" class="i">+
</a><a href="#h2-8-18" id="h2-8-18" class="i">+	if(enableinspector) {
</a><a href="#h2-8-19" id="h2-8-19" class="i">+		c-&gt;inspector = WEBKIT_WEB_INSPECTOR(
</a><a href="#h2-8-20" id="h2-8-20" class="i">+				webkit_web_view_get_inspector(c-&gt;view));
</a><a href="#h2-8-21" id="h2-8-21" class="i">+		g_signal_connect(G_OBJECT(c-&gt;inspector), &quot;inspect-web-view&quot;,
</a><a href="#h2-8-22" id="h2-8-22" class="i">+				G_CALLBACK(inspector_new), c);
</a><a href="#h2-8-23" id="h2-8-23" class="i">+		g_signal_connect(G_OBJECT(c-&gt;inspector), &quot;show-window&quot;,
</a><a href="#h2-8-24" id="h2-8-24" class="i">+				G_CALLBACK(inspector_show), c);
</a><a href="#h2-8-25" id="h2-8-25" class="i">+		g_signal_connect(G_OBJECT(c-&gt;inspector), &quot;close-window&quot;,
</a><a href="#h2-8-26" id="h2-8-26" class="i">+				G_CALLBACK(inspector_close), c);
</a><a href="#h2-8-27" id="h2-8-27" class="i">+		g_signal_connect(G_OBJECT(c-&gt;inspector), &quot;finished&quot;,
</a><a href="#h2-8-28" id="h2-8-28" class="i">+				G_CALLBACK(inspector_finished), c);
</a><a href="#h2-8-29" id="h2-8-29" class="i">+		c-&gt;isinspector = false;
</a><a href="#h2-8-30" id="h2-8-30" class="i">+	}
</a> 
 	g_free(uri);
 
<a href="#h2-9" id="h2-9" class="h">@@ -1059,9 +1125,8 @@ updatewinid(Client *c) {
</a> 
 static void
 usage(void) {
<a href="#h2-9-3" id="h2-9-3" class="d">-	fputs(&quot;surf - simple browser\n&quot;, stderr);
</a><a href="#h2-9-4" id="h2-9-4" class="d">-	die(&quot;usage: surf [-c cookiefile] [-e xid] [-i] [-p] [-r scriptfile]&quot;
</a><a href="#h2-9-5" id="h2-9-5" class="d">-		&quot; [-s] [-t stylefile] [-u useragent] [-v] [-x] [uri]\n&quot;);
</a><a href="#h2-9-6" id="h2-9-6" class="i">+	die(&quot;usage: %s [-inpsvx] [-c cookiefile] [-e xid] [-r scriptfile]&quot;
</a><a href="#h2-9-7" id="h2-9-7" class="i">+		&quot; [-t stylefile] [-u useragent] [uri]\n&quot;, basename(argv0));
</a> }
 
 static void
<a href="#h2-10" id="h2-10" class="h">@@ -1103,6 +1168,9 @@ main(int argc, char *argv[]) {
</a> 	case &#39;i&#39;:
 		loadimages = 0;
 		break;
<a href="#h2-10-3" id="h2-10-3" class="i">+	case &#39;n&#39;:
</a><a href="#h2-10-4" id="h2-10-4" class="i">+		enableinspector = 0;
</a><a href="#h2-10-5" id="h2-10-5" class="i">+		break;
</a> 	case &#39;p&#39;:
 		enableplugins = 0;
 		break;
<a href="#h2-11" id="h2-11" class="h">@@ -1118,11 +1186,12 @@ main(int argc, char *argv[]) {
</a> 	case &#39;u&#39;:
 		useragent = EARGF(usage());
 		break;
<a href="#h2-11-3" id="h2-11-3" class="i">+	case &#39;v&#39;:
</a><a href="#h2-11-4" id="h2-11-4" class="i">+		die(&quot;surf-&quot;VERSION&quot;, ©2009-2012 surf engineers, &quot;
</a><a href="#h2-11-5" id="h2-11-5" class="i">+				&quot;see LICENSE for details\n&quot;);
</a> 	case &#39;x&#39;:
 		showxid = TRUE;
 		break;
<a href="#h2-11-9" id="h2-11-9" class="d">-	case &#39;v&#39;:
</a><a href="#h2-11-10" id="h2-11-10" class="d">-		die(&quot;surf-&quot;VERSION&quot;, ©2009-2012 surf engineers, see LICENSE for details\n&quot;);
</a> 	default:
 		usage();
 	} ARGEND;
</pre>
</div>
</body>
</html>
