<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Add options for scriptfile, cookiefile and stylefile. And changing the default behaviour of buildpath to be more like in open(). - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/4ce3808684c5ea5d14eab0c3e24119784d2ae255.html">4ce3808684c5ea5d14eab0c3e24119784d2ae255</a>
<b>parent</b> <a href="../commit/0b885f18e3aebee047e952620f8541491fe77b8a.html">0b885f18e3aebee047e952620f8541491fe77b8a</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Wed, 31 Oct 2012 21:13:50 +0100

Add options for scriptfile, cookiefile and stylefile. And changing the default
behaviour of buildpath to be more like in open().
<b>Diffstat:</b>
<table><tr><td class="A">A</td><td><a href="#h0">arg.h</a></td><td> | </td><td class="num">41</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">surf.1</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">surf.c</a></td><td> | </td><td class="num">98</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------</span></td></tr>
</table></pre><pre>3 files changed, 109 insertions(+), 42 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/arg.h.html">arg.h</a> b/<a href="../file/arg.h.html">arg.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,41 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+/*
</a><a href="#h0-0-1" id="h0-0-1" class="i">+ * Copy me if you can.
</a><a href="#h0-0-2" id="h0-0-2" class="i">+ * by 20h
</a><a href="#h0-0-3" id="h0-0-3" class="i">+ */
</a><a href="#h0-0-4" id="h0-0-4" class="i">+
</a><a href="#h0-0-5" id="h0-0-5" class="i">+#ifndef __ARG_H__
</a><a href="#h0-0-6" id="h0-0-6" class="i">+#define __ARG_H__
</a><a href="#h0-0-7" id="h0-0-7" class="i">+
</a><a href="#h0-0-8" id="h0-0-8" class="i">+extern char *argv0;
</a><a href="#h0-0-9" id="h0-0-9" class="i">+
</a><a href="#h0-0-10" id="h0-0-10" class="i">+#define USED(x) ((void)(x))
</a><a href="#h0-0-11" id="h0-0-11" class="i">+
</a><a href="#h0-0-12" id="h0-0-12" class="i">+#define ARGBEGIN	for (argv0 = *argv, argv++, argc--;\
</a><a href="#h0-0-13" id="h0-0-13" class="i">+					argv[0] &amp;&amp; argv[0][1]\
</a><a href="#h0-0-14" id="h0-0-14" class="i">+					&amp;&amp; argv[0][0] == &#39;-&#39;;\
</a><a href="#h0-0-15" id="h0-0-15" class="i">+					argc--, argv++) {\
</a><a href="#h0-0-16" id="h0-0-16" class="i">+				char _argc;\
</a><a href="#h0-0-17" id="h0-0-17" class="i">+				char **_argv;\
</a><a href="#h0-0-18" id="h0-0-18" class="i">+				if (argv[0][1] == &#39;-&#39; &amp;&amp; argv[0][2] == &#39;\0&#39;) {\
</a><a href="#h0-0-19" id="h0-0-19" class="i">+					argv++;\
</a><a href="#h0-0-20" id="h0-0-20" class="i">+					argc--;\
</a><a href="#h0-0-21" id="h0-0-21" class="i">+					break;\
</a><a href="#h0-0-22" id="h0-0-22" class="i">+				}\
</a><a href="#h0-0-23" id="h0-0-23" class="i">+				for (argv[0]++, _argv = argv; argv[0][0];\
</a><a href="#h0-0-24" id="h0-0-24" class="i">+						argv[0]++) {\
</a><a href="#h0-0-25" id="h0-0-25" class="i">+					if (_argv != argv)\
</a><a href="#h0-0-26" id="h0-0-26" class="i">+						break;\
</a><a href="#h0-0-27" id="h0-0-27" class="i">+					_argc = argv[0][0];\
</a><a href="#h0-0-28" id="h0-0-28" class="i">+					switch (_argc)
</a><a href="#h0-0-29" id="h0-0-29" class="i">+
</a><a href="#h0-0-30" id="h0-0-30" class="i">+#define ARGEND			}\
</a><a href="#h0-0-31" id="h0-0-31" class="i">+				USED(_argc);\
</a><a href="#h0-0-32" id="h0-0-32" class="i">+			}\
</a><a href="#h0-0-33" id="h0-0-33" class="i">+			USED(argv);\
</a><a href="#h0-0-34" id="h0-0-34" class="i">+			USED(argc);
</a><a href="#h0-0-35" id="h0-0-35" class="i">+
</a><a href="#h0-0-36" id="h0-0-36" class="i">+#define EARGF(x)	((argv[1] == NULL)? ((x), abort(), (char *)0) :\
</a><a href="#h0-0-37" id="h0-0-37" class="i">+			(argc--, argv++, argv[0]))
</a><a href="#h0-0-38" id="h0-0-38" class="i">+
</a><a href="#h0-0-39" id="h0-0-39" class="i">+#endif
</a><a href="#h0-0-40" id="h0-0-40" class="i">+
</a><b>diff --git a/<a id="h1" href="../file/surf.1.html">surf.1</a> b/<a href="../file/surf.1.html">surf.1</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -3,10 +3,13 @@
</a> surf \- simple webkit-based browser
 .SH SYNOPSIS
 .B surf
<a href="#h1-0-3" id="h1-0-3" class="i">+.RB [-c\ cookiefile]
</a> .RB [-e\ xid]
 .RB [-i]
 .RB [-p]
<a href="#h1-0-7" id="h1-0-7" class="i">+.RB [-r\ scriptfile]
</a> .RB [-s]
<a href="#h1-0-9" id="h1-0-9" class="i">+.RB [-t\ stylefile]
</a> .RB [-v]
 .RB [-x]
 .RB &quot;URI&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -17,6 +20,9 @@ which makes it possible to embed it in another application. Furthermore,
</a> one can point surf to another URI by setting its XProperties.
 .SH OPTIONS
 .TP
<a href="#h1-1-3" id="h1-1-3" class="i">+.B \-c cookiefile 
</a><a href="#h1-1-4" id="h1-1-4" class="i">+Specify the cookiefile to use.
</a><a href="#h1-1-5" id="h1-1-5" class="i">+.TP
</a> .B \-e xid
 Reparents to window specified by xid.
 .TP
<a href="#h1-2" id="h1-2" class="h">@@ -26,9 +32,15 @@ Disable Images
</a> .B \-p
 Disable Plugins
 .TP
<a href="#h1-2-3" id="h1-2-3" class="i">+.B \-r scriptfile 
</a><a href="#h1-2-4" id="h1-2-4" class="i">+Specify the user scriptfile.
</a><a href="#h1-2-5" id="h1-2-5" class="i">+.TP
</a> .B \-s
 Disable Javascript
 .TP
<a href="#h1-2-9" id="h1-2-9" class="i">+.B \-t stylefile
</a><a href="#h1-2-10" id="h1-2-10" class="i">+Specify the user stylefile.
</a><a href="#h1-2-11" id="h1-2-11" class="i">+.TP
</a> .B \-v
 Prints version information to standard output, then exits.
 .TP
<b>diff --git a/<a id="h2" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -20,6 +20,10 @@
</a> #include &lt;JavaScriptCore/JavaScript.h&gt;
 #include &lt;sys/file.h&gt;
 
<a href="#h2-0-3" id="h2-0-3" class="i">+#include &quot;arg.h&quot;
</a><a href="#h2-0-4" id="h2-0-4" class="i">+
</a><a href="#h2-0-5" id="h2-0-5" class="i">+char *argv0;
</a><a href="#h2-0-6" id="h2-0-6" class="i">+
</a> #define LENGTH(x)               (sizeof x / sizeof x[0])
 #define COOKIEJAR_TYPE          (cookiejar_get_type ())
 #define COOKIEJAR(obj)          (G_TYPE_CHECK_INSTANCE_CAST ((obj), COOKIEJAR_TYPE, CookieJar))
<a href="#h2-1" id="h2-1" class="h">@@ -74,7 +78,6 @@ static Client *clients = NULL;
</a> static GdkNativeWindow embed = 0;
 static gboolean showxid = FALSE;
 static char winid[64];
<a href="#h2-1-3" id="h2-1-3" class="d">-static char *progname;
</a> static gboolean loadimage = 1, plugin = 1, script = 1, using_proxy = 0;
 
 static char *buildpath(const char *path);
<a href="#h2-2" id="h2-2" class="h">@@ -138,10 +141,19 @@ buildpath(const char *path) {
</a> 	FILE *f;
 
 	/* creating directory */
<a href="#h2-2-3" id="h2-2-3" class="d">-	if(path[0] == &#39;/&#39;)
</a><a href="#h2-2-4" id="h2-2-4" class="i">+	if(path[0] == &#39;/&#39;) {
</a> 		apath = g_strdup(path);
<a href="#h2-2-6" id="h2-2-6" class="d">-	else
</a><a href="#h2-2-7" id="h2-2-7" class="d">-		apath = g_strconcat(g_get_home_dir(), &quot;/&quot;, path, NULL);
</a><a href="#h2-2-8" id="h2-2-8" class="i">+	} else if(path[0] == &#39;~&#39;) {
</a><a href="#h2-2-9" id="h2-2-9" class="i">+		if(path[1] == &#39;/&#39;) {
</a><a href="#h2-2-10" id="h2-2-10" class="i">+			apath = g_strconcat(g_get_home_dir(), &amp;path[1], NULL);
</a><a href="#h2-2-11" id="h2-2-11" class="i">+		} else {
</a><a href="#h2-2-12" id="h2-2-12" class="i">+			apath = g_strconcat(g_get_home_dir(), &quot;/&quot;,
</a><a href="#h2-2-13" id="h2-2-13" class="i">+					&amp;path[1], NULL);
</a><a href="#h2-2-14" id="h2-2-14" class="i">+		}
</a><a href="#h2-2-15" id="h2-2-15" class="i">+	} else {
</a><a href="#h2-2-16" id="h2-2-16" class="i">+		apath = g_strconcat(g_get_current_dir(), &quot;/&quot;, path, NULL);
</a><a href="#h2-2-17" id="h2-2-17" class="i">+	}
</a><a href="#h2-2-18" id="h2-2-18" class="i">+
</a> 	if((p = strrchr(apath, &#39;/&#39;))) {
 		*p = &#39;\0&#39;;
 		g_mkdir_with_parents(apath, 0700);
<a href="#h2-3" id="h2-3" class="h">@@ -153,6 +165,7 @@ buildpath(const char *path) {
</a> 		g_chmod(apath, 0600); /* always */
 		fclose(f);
 	}
<a href="#h2-3-3" id="h2-3-3" class="i">+
</a> 	return apath;
 }
 
<a href="#h2-4" id="h2-4" class="h">@@ -216,7 +229,7 @@ cookiejar_new(const char *filename, gboolean read_only) {
</a> 	return g_object_new(COOKIEJAR_TYPE,
 	                    SOUP_COOKIE_JAR_TEXT_FILENAME, filename,
 	                    SOUP_COOKIE_JAR_READ_ONLY, read_only, NULL);
<a href="#h2-4-3" id="h2-4-3" class="d">-} 
</a><a href="#h2-4-4" id="h2-4-4" class="i">+}
</a> 
 static void
 cookiejar_set_property(GObject *self, guint prop_id, const GValue *value, GParamSpec *pspec) {
<a href="#h2-5" id="h2-5" class="h">@@ -628,7 +641,7 @@ newwindow(Client *c, const Arg *arg, gboolean noembed) {
</a> 	const Arg a = { .v = (void *)cmd };
 	char tmp[64];
 
<a href="#h2-5-3" id="h2-5-3" class="d">-	cmd[i++] = progname;
</a><a href="#h2-5-4" id="h2-5-4" class="i">+	cmd[i++] = argv0;
</a> 	if(embed &amp;&amp; !noembed) {
 		cmd[i++] = &quot;-e&quot;;
 		snprintf(tmp, LENGTH(tmp), &quot;%u\n&quot;, (int)embed);
<a href="#h2-6" id="h2-6" class="h">@@ -905,7 +918,8 @@ updatewinid(Client *c) {
</a> void
 usage(void) {
 	fputs(&quot;surf - simple browser\n&quot;, stderr);
<a href="#h2-6-3" id="h2-6-3" class="d">-	die(&quot;usage: surf [-e xid] [-i] [-p] [-s] [-v] [-x] [uri]\n&quot;);
</a><a href="#h2-6-4" id="h2-6-4" class="i">+	die(&quot;usage: surf [-c cookiefile] [-e xid] [-i] [-p] [-r scriptfile]&quot;
</a><a href="#h2-6-5" id="h2-6-5" class="i">+		&quot; [-s] [-t stylefile] [-v] [-x] [uri]\n&quot;);
</a> }
 
 void
<a href="#h2-7" id="h2-7" class="h">@@ -928,49 +942,49 @@ zoom(Client *c, const Arg *arg) {
</a> 
 int
 main(int argc, char *argv[]) {
<a href="#h2-7-3" id="h2-7-3" class="d">-	int i;
</a> 	Arg arg;
 
<a href="#h2-7-6" id="h2-7-6" class="d">-	progname = argv[0];
</a> 	/* command line args */
<a href="#h2-7-8" id="h2-7-8" class="d">-	for(i = 1, arg.v = NULL; i &lt; argc &amp;&amp; argv[i][0] == &#39;-&#39; &amp;&amp;
</a><a href="#h2-7-9" id="h2-7-9" class="d">-			argv[i][1] != &#39;\0&#39; &amp;&amp; argv[i][2] == &#39;\0&#39;; i++) {
</a><a href="#h2-7-10" id="h2-7-10" class="d">-		if(!strcmp(argv[i], &quot;--&quot;)) {
</a><a href="#h2-7-11" id="h2-7-11" class="d">-			i++;
</a><a href="#h2-7-12" id="h2-7-12" class="d">-			break;
</a><a href="#h2-7-13" id="h2-7-13" class="d">-		}
</a><a href="#h2-7-14" id="h2-7-14" class="d">-		switch(argv[i][1]) {
</a><a href="#h2-7-15" id="h2-7-15" class="d">-		case &#39;e&#39;:
</a><a href="#h2-7-16" id="h2-7-16" class="d">-			if(++i &lt; argc)
</a><a href="#h2-7-17" id="h2-7-17" class="d">-				embed = strtol(argv[i], NULL, 0);
</a><a href="#h2-7-18" id="h2-7-18" class="d">-			else
</a><a href="#h2-7-19" id="h2-7-19" class="d">-				usage();
</a><a href="#h2-7-20" id="h2-7-20" class="d">-			break;
</a><a href="#h2-7-21" id="h2-7-21" class="d">-		case &#39;i&#39;:
</a><a href="#h2-7-22" id="h2-7-22" class="d">-			loadimage = 0;
</a><a href="#h2-7-23" id="h2-7-23" class="d">-			break;
</a><a href="#h2-7-24" id="h2-7-24" class="d">-		case &#39;p&#39;:
</a><a href="#h2-7-25" id="h2-7-25" class="d">-			plugin = 0;
</a><a href="#h2-7-26" id="h2-7-26" class="d">-			break;
</a><a href="#h2-7-27" id="h2-7-27" class="d">-		case &#39;s&#39;:
</a><a href="#h2-7-28" id="h2-7-28" class="d">-			script = 0;
</a><a href="#h2-7-29" id="h2-7-29" class="d">-			break;
</a><a href="#h2-7-30" id="h2-7-30" class="d">-		case &#39;x&#39;:
</a><a href="#h2-7-31" id="h2-7-31" class="d">-			showxid = TRUE;
</a><a href="#h2-7-32" id="h2-7-32" class="d">-			break;
</a><a href="#h2-7-33" id="h2-7-33" class="d">-		case &#39;v&#39;:
</a><a href="#h2-7-34" id="h2-7-34" class="d">-			die(&quot;surf-&quot;VERSION&quot;, ©2009-2012 surf engineers, see LICENSE for details\n&quot;);
</a><a href="#h2-7-35" id="h2-7-35" class="d">-		default:
</a><a href="#h2-7-36" id="h2-7-36" class="d">-			usage();
</a><a href="#h2-7-37" id="h2-7-37" class="d">-		}
</a><a href="#h2-7-38" id="h2-7-38" class="d">-	}
</a><a href="#h2-7-39" id="h2-7-39" class="d">-	if(i &lt; argc)
</a><a href="#h2-7-40" id="h2-7-40" class="d">-		arg.v = argv[i];
</a><a href="#h2-7-41" id="h2-7-41" class="i">+	ARGBEGIN {
</a><a href="#h2-7-42" id="h2-7-42" class="i">+	case &#39;c&#39;:
</a><a href="#h2-7-43" id="h2-7-43" class="i">+		cookiefile = EARGF(usage());
</a><a href="#h2-7-44" id="h2-7-44" class="i">+		break;
</a><a href="#h2-7-45" id="h2-7-45" class="i">+	case &#39;e&#39;:
</a><a href="#h2-7-46" id="h2-7-46" class="i">+		embed = strtol(EARGF(usage()), NULL, 0);
</a><a href="#h2-7-47" id="h2-7-47" class="i">+		break;
</a><a href="#h2-7-48" id="h2-7-48" class="i">+	case &#39;i&#39;:
</a><a href="#h2-7-49" id="h2-7-49" class="i">+		loadimage = 0;
</a><a href="#h2-7-50" id="h2-7-50" class="i">+		break;
</a><a href="#h2-7-51" id="h2-7-51" class="i">+	case &#39;p&#39;:
</a><a href="#h2-7-52" id="h2-7-52" class="i">+		plugin = 0;
</a><a href="#h2-7-53" id="h2-7-53" class="i">+		break;
</a><a href="#h2-7-54" id="h2-7-54" class="i">+	case &#39;r&#39;:
</a><a href="#h2-7-55" id="h2-7-55" class="i">+		scriptfile = EARGF(usage());
</a><a href="#h2-7-56" id="h2-7-56" class="i">+		break;
</a><a href="#h2-7-57" id="h2-7-57" class="i">+	case &#39;s&#39;:
</a><a href="#h2-7-58" id="h2-7-58" class="i">+		script = 0;
</a><a href="#h2-7-59" id="h2-7-59" class="i">+		break;
</a><a href="#h2-7-60" id="h2-7-60" class="i">+	case &#39;t&#39;:
</a><a href="#h2-7-61" id="h2-7-61" class="i">+		stylefile = EARGF(usage());
</a><a href="#h2-7-62" id="h2-7-62" class="i">+		break;
</a><a href="#h2-7-63" id="h2-7-63" class="i">+	case &#39;x&#39;:
</a><a href="#h2-7-64" id="h2-7-64" class="i">+		showxid = TRUE;
</a><a href="#h2-7-65" id="h2-7-65" class="i">+		break;
</a><a href="#h2-7-66" id="h2-7-66" class="i">+	case &#39;v&#39;:
</a><a href="#h2-7-67" id="h2-7-67" class="i">+		die(&quot;surf-&quot;VERSION&quot;, ©2009-2012 surf engineers, see LICENSE for details\n&quot;);
</a><a href="#h2-7-68" id="h2-7-68" class="i">+	default:
</a><a href="#h2-7-69" id="h2-7-69" class="i">+		usage();
</a><a href="#h2-7-70" id="h2-7-70" class="i">+	} ARGEND;
</a><a href="#h2-7-71" id="h2-7-71" class="i">+	if(argc &gt; 0)
</a><a href="#h2-7-72" id="h2-7-72" class="i">+		arg.v = argv[0];
</a><a href="#h2-7-73" id="h2-7-73" class="i">+
</a> 	setup();
 	newclient();
 	if(arg.v)
 		loaduri(clients, &amp;arg);
 	gtk_main();
 	cleanup();
<a href="#h2-7-80" id="h2-7-80" class="i">+
</a> 	return EXIT_SUCCESS;
 }
<a href="#h2-7-83" id="h2-7-83" class="i">+
</a></pre>
</div>
</body>
</html>
