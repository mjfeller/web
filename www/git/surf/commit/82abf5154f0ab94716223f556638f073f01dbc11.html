<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Adapt toggle(), clean some config parameters - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/82abf5154f0ab94716223f556638f073f01dbc11.html">82abf5154f0ab94716223f556638f073f01dbc11</a>
<b>parent</b> <a href="../commit/526b974c33a17b7ef77f4268bd8602e2d51ad1b9.html">526b974c33a17b7ef77f4268bd8602e2d51ad1b9</a>
<b>Author:</b> Quentin Rameau &lt;<a href="mailto:quinq@fifth.space">quinq@fifth.space</a>&gt;
<b>Date:</b>   Fri, 20 Nov 2015 15:48:04 +0100

Adapt toggle(), clean some config parameters

Regroup all toggles in an enum and handle them with a unique function
via a switch. That lets us take different actions for each toggle.
Add a frame flatenning and a dns preteching options.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">23</td><td><span class="i">++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">surf.c</a></td><td> | </td><td class="num">83</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
</table></pre><pre>2 files changed, 71 insertions(+), 35 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -8,7 +8,6 @@ static char *cachedir       = &quot;~/.surf/cache/&quot;;
</a> 
 static Bool kioskmode       = FALSE; /* Ignore shortcuts */
 static Bool showindicators  = TRUE;  /* Show indicators in window title */
<a href="#h0-0-3" id="h0-0-3" class="d">-static Bool zoomto96dpi     = TRUE;  /* Zoom pages to always emulate 96dpi */
</a> static Bool runinfullscreen = FALSE; /* Run in fullscreen mode by default */
 
 static guint defaultfontsize = 12;   /* Default font size */
<a href="#h0-1" id="h0-1" class="h">@@ -18,15 +17,12 @@ static gfloat zoomlevel = 1.0;       /* Default zoom level */
</a> static char *cookiefile     = &quot;~/.surf/cookies.txt&quot;;
 static char *cookiepolicies = &quot;Aa@&quot;; /* A: accept all; a: accept nothing,
                                       * @: accept no third party */
<a href="#h0-1-3" id="h0-1-3" class="d">-static char *cafile         = &quot;/etc/ssl/certs/ca-certificates.crt&quot;;
</a> static Bool strictssl       = FALSE; /* Refuse untrusted SSL connections */
<a href="#h0-1-5" id="h0-1-5" class="d">-static time_t sessiontime   = 3600;
</a> 
 /* Webkit default features */
 static Bool enablescrollbars      = TRUE;
<a href="#h0-1-9" id="h0-1-9" class="d">-static Bool enablespatialbrowsing = TRUE;
</a><a href="#h0-1-10" id="h0-1-10" class="d">-static Bool enablediskcache       = TRUE;
</a><a href="#h0-1-11" id="h0-1-11" class="d">-static int diskcachebytes         = 5 * 1024 * 1024;
</a><a href="#h0-1-12" id="h0-1-12" class="i">+static Bool enablecaretbrowsing   = TRUE;
</a><a href="#h0-1-13" id="h0-1-13" class="i">+static Bool enablecache           = TRUE;
</a> static Bool enableplugins         = TRUE;
 static Bool enablescripts         = TRUE;
 static Bool enableinspector       = TRUE;
<a href="#h0-2" id="h0-2" class="h">@@ -34,6 +30,8 @@ static Bool enablestyle           = TRUE;
</a> static Bool loadimages            = TRUE;
 static Bool hidebackground        = FALSE;
 static Bool allowgeolocation      = TRUE;
<a href="#h0-2-3" id="h0-2-3" class="i">+static Bool enablednsprefetching  = FALSE;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+static Bool enableframeflattening = FALSE;
</a> 
 static WebKitFindOptions findopts = WEBKIT_FIND_OPTIONS_CASE_INSENSITIVE |
                                     WEBKIT_FIND_OPTIONS_WRAP_AROUND;
<a href="#h0-3" id="h0-3" class="h">@@ -122,13 +120,16 @@ static Key keys[] = {
</a> 	{ MODKEY,                GDK_KEY_n,      find,       { .i = +1 } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_n,      find,       { .i = -1 } },
 
<a href="#h0-3-3" id="h0-3-3" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .v = &quot;enable-caret-browsing&quot; } },
</a><a href="#h0-3-4" id="h0-3-4" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .v = &quot;auto-load-images&quot; } },
</a><a href="#h0-3-5" id="h0-3-5" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_s,      toggle,     { .v = &quot;enable-scripts&quot; } },
</a><a href="#h0-3-6" id="h0-3-6" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .v = &quot;enable-plugins&quot; } },
</a><a href="#h0-3-7" id="h0-3-7" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .i = CaretBrowsing } },
</a><a href="#h0-3-8" id="h0-3-8" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_f,      toggle,     { .i = FrameFlattening } },
</a><a href="#h0-3-9" id="h0-3-9" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      toggle,     { .i = Geolocation } },
</a><a href="#h0-3-10" id="h0-3-10" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_s,      toggle,     { .i = JavaScript } },
</a><a href="#h0-3-11" id="h0-3-11" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .i = LoadImages } },
</a><a href="#h0-3-12" id="h0-3-12" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .i = Plugins } },
</a><a href="#h0-3-13" id="h0-3-13" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_b,      toggle,     { .i = ScrollBars } },
</a><a href="#h0-3-14" id="h0-3-14" class="i">+
</a> 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      togglestyle, { 0 } },
<a href="#h0-3-17" id="h0-3-17" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      togglegeolocation, { 0 } },
</a> };
 
 /* button definitions */
<b>diff --git a/<a id="h1" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -47,6 +47,16 @@ enum {
</a> 	OnAny   = OnDoc | OnLink | OnImg | OnMedia | OnEdit | OnBar | OnSel,
 };
 
<a href="#h1-0-3" id="h1-0-3" class="i">+enum {
</a><a href="#h1-0-4" id="h1-0-4" class="i">+	CaretBrowsing,
</a><a href="#h1-0-5" id="h1-0-5" class="i">+	FrameFlattening,
</a><a href="#h1-0-6" id="h1-0-6" class="i">+	Geolocation,
</a><a href="#h1-0-7" id="h1-0-7" class="i">+	JavaScript,
</a><a href="#h1-0-8" id="h1-0-8" class="i">+	LoadImages,
</a><a href="#h1-0-9" id="h1-0-9" class="i">+	Plugins,
</a><a href="#h1-0-10" id="h1-0-10" class="i">+	ScrollBars,
</a><a href="#h1-0-11" id="h1-0-11" class="i">+};
</a><a href="#h1-0-12" id="h1-0-12" class="i">+
</a> typedef union Arg Arg;
 union Arg {
 	gboolean b;
<a href="#h1-1" id="h1-1" class="h">@@ -176,9 +186,8 @@ static void sigchld(int unused);
</a> static void spawn(Client *c, const Arg *arg);
 static void stop(Client *c, const Arg *arg);
 static void titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c);
<a href="#h1-1-3" id="h1-1-3" class="d">-static void toggle(Client *c, const Arg *arg);
</a><a href="#h1-1-4" id="h1-1-4" class="i">+static void toggle(Client *c, const Arg *a);
</a> static void togglecookiepolicy(Client *c, const Arg *arg);
<a href="#h1-1-6" id="h1-1-6" class="d">-static void togglegeolocation(Client *c, const Arg *arg);
</a> static void togglestyle(Client *c, const Arg *arg);
 static void updatetitle(Client *c);
 static void updatewinid(Client *c);
<a href="#h1-2" id="h1-2" class="h">@@ -1064,7 +1073,7 @@ newwindow(Client *c, const Arg *arg, gboolean noembed)
</a> 		cmd[i++] = &quot;-s&quot;;
 	if (showxid)
 		cmd[i++] = &quot;-x&quot;;
<a href="#h1-2-3" id="h1-2-3" class="d">-	if (enablediskcache)
</a><a href="#h1-2-4" id="h1-2-4" class="i">+	if (enablecache)
</a> 		cmd[i++] = &quot;-D&quot;;
 	cmd[i++] = &quot;-c&quot;;
 	cmd[i++] = cookiefile;
<a href="#h1-3" id="h1-3" class="h">@@ -1306,18 +1315,53 @@ winevent(GtkWidget *w, GdkEvent *e, Client *c)
</a> }
 
 void
<a href="#h1-3-3" id="h1-3-3" class="d">-toggle(Client *c, const Arg *arg)
</a><a href="#h1-3-4" id="h1-3-4" class="i">+toggle(Client *c, const Arg *a)
</a> {
<a href="#h1-3-6" id="h1-3-6" class="d">-	WebKitWebSettings *settings;
</a><a href="#h1-3-7" id="h1-3-7" class="d">-	char *name = (char *)arg-&gt;v;
</a><a href="#h1-3-8" id="h1-3-8" class="d">-	gboolean value;
</a><a href="#h1-3-9" id="h1-3-9" class="d">-	Arg a = { .b = FALSE };
</a><a href="#h1-3-10" id="h1-3-10" class="i">+	WebKitSettings *s;
</a> 
<a href="#h1-3-12" id="h1-3-12" class="d">-	settings = webkit_web_view_get_settings(c-&gt;view);
</a><a href="#h1-3-13" id="h1-3-13" class="d">-	g_object_get(G_OBJECT(settings), name, &amp;value, NULL);
</a><a href="#h1-3-14" id="h1-3-14" class="d">-	g_object_set(G_OBJECT(settings), name, !value, NULL);
</a><a href="#h1-3-15" id="h1-3-15" class="i">+	s = webkit_web_view_get_settings(c-&gt;view);
</a> 
<a href="#h1-3-17" id="h1-3-17" class="d">-	reload(c, &amp;a);
</a><a href="#h1-3-18" id="h1-3-18" class="i">+	switch ((unsigned int)a-&gt;i) {
</a><a href="#h1-3-19" id="h1-3-19" class="i">+	case CaretBrowsing:
</a><a href="#h1-3-20" id="h1-3-20" class="i">+		enablecaretbrowsing = !enablecaretbrowsing;
</a><a href="#h1-3-21" id="h1-3-21" class="i">+		webkit_settings_set_enable_caret_browsing(s,
</a><a href="#h1-3-22" id="h1-3-22" class="i">+		    enablecaretbrowsing);
</a><a href="#h1-3-23" id="h1-3-23" class="i">+		updatetitle(c);
</a><a href="#h1-3-24" id="h1-3-24" class="i">+		return; /* do not reload */
</a><a href="#h1-3-25" id="h1-3-25" class="i">+		break;
</a><a href="#h1-3-26" id="h1-3-26" class="i">+	case FrameFlattening:
</a><a href="#h1-3-27" id="h1-3-27" class="i">+		enableframeflattening = !enableframeflattening;
</a><a href="#h1-3-28" id="h1-3-28" class="i">+		webkit_settings_set_enable_frame_flattening(s,
</a><a href="#h1-3-29" id="h1-3-29" class="i">+		    enableframeflattening);
</a><a href="#h1-3-30" id="h1-3-30" class="i">+		break;
</a><a href="#h1-3-31" id="h1-3-31" class="i">+	case Geolocation:
</a><a href="#h1-3-32" id="h1-3-32" class="i">+		allowgeolocation = !allowgeolocation;
</a><a href="#h1-3-33" id="h1-3-33" class="i">+		break;
</a><a href="#h1-3-34" id="h1-3-34" class="i">+	case JavaScript:
</a><a href="#h1-3-35" id="h1-3-35" class="i">+		enablescripts = !enablescripts;
</a><a href="#h1-3-36" id="h1-3-36" class="i">+		webkit_settings_set_enable_javascript(s, enablescripts);
</a><a href="#h1-3-37" id="h1-3-37" class="i">+		break;
</a><a href="#h1-3-38" id="h1-3-38" class="i">+	case LoadImages:
</a><a href="#h1-3-39" id="h1-3-39" class="i">+		loadimages = !loadimages;
</a><a href="#h1-3-40" id="h1-3-40" class="i">+		webkit_settings_set_auto_load_images(s, loadimages);
</a><a href="#h1-3-41" id="h1-3-41" class="i">+		break;
</a><a href="#h1-3-42" id="h1-3-42" class="i">+	case Plugins:
</a><a href="#h1-3-43" id="h1-3-43" class="i">+		enableplugins = !enableplugins;
</a><a href="#h1-3-44" id="h1-3-44" class="i">+		webkit_settings_set_enable_plugins(s, enableplugins);
</a><a href="#h1-3-45" id="h1-3-45" class="i">+		break;
</a><a href="#h1-3-46" id="h1-3-46" class="i">+	case ScrollBars:
</a><a href="#h1-3-47" id="h1-3-47" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h1-3-48" id="h1-3-48" class="i">+		 * manipulating the DOM directly.
</a><a href="#h1-3-49" id="h1-3-49" class="i">+		enablescrollbars = !enablescrollbars;
</a><a href="#h1-3-50" id="h1-3-50" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h1-3-51" id="h1-3-51" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h1-3-52" id="h1-3-52" class="i">+		*/
</a><a href="#h1-3-53" id="h1-3-53" class="i">+		return; /* do not reload */
</a><a href="#h1-3-54" id="h1-3-54" class="i">+		break;
</a><a href="#h1-3-55" id="h1-3-55" class="i">+	default:
</a><a href="#h1-3-56" id="h1-3-56" class="i">+		break;
</a><a href="#h1-3-57" id="h1-3-57" class="i">+	}
</a><a href="#h1-3-58" id="h1-3-58" class="i">+	reload(c, a);
</a> }
 
 void
<a href="#h1-4" id="h1-4" class="h">@@ -1336,15 +1380,6 @@ togglecookiepolicy(Client *c, const Arg *arg)
</a> }
 
 void
<a href="#h1-4-3" id="h1-4-3" class="d">-togglegeolocation(Client *c, const Arg *arg)
</a><a href="#h1-4-4" id="h1-4-4" class="d">-{
</a><a href="#h1-4-5" id="h1-4-5" class="d">-	Arg a = { .b = FALSE };
</a><a href="#h1-4-6" id="h1-4-6" class="d">-
</a><a href="#h1-4-7" id="h1-4-7" class="d">-	allowgeolocation ^= 1;
</a><a href="#h1-4-8" id="h1-4-8" class="d">-	reload(c, &amp;a);
</a><a href="#h1-4-9" id="h1-4-9" class="d">-}
</a><a href="#h1-4-10" id="h1-4-10" class="d">-
</a><a href="#h1-4-11" id="h1-4-11" class="d">-void
</a> togglestyle(Client *c, const Arg *arg)
 {
 	enablestyle = !enablestyle;
<a href="#h1-5" id="h1-5" class="h">@@ -1368,7 +1403,7 @@ gettogglestat(Client *c)
</a> 
 	togglestat[p++] = allowgeolocation? &#39;G&#39;: &#39;g&#39;;
 
<a href="#h1-5-3" id="h1-5-3" class="d">-	togglestat[p++] = enablediskcache? &#39;D&#39;: &#39;d&#39;;
</a><a href="#h1-5-4" id="h1-5-4" class="i">+	togglestat[p++] = enablecache? &#39;D&#39;: &#39;d&#39;;
</a> 
 	g_object_get(G_OBJECT(settings), &quot;auto-load-images&quot;, &amp;value, NULL);
 	togglestat[p++] = value? &#39;I&#39;: &#39;i&#39;;
<a href="#h1-6" id="h1-6" class="h">@@ -1473,10 +1508,10 @@ main(int argc, char *argv[])
</a> 		cookiefile = EARGF(usage());
 		break;
 	case &#39;d&#39;:
<a href="#h1-6-3" id="h1-6-3" class="d">-		enablediskcache = 0;
</a><a href="#h1-6-4" id="h1-6-4" class="i">+		enablecache = 0;
</a> 		break;
 	case &#39;D&#39;:
<a href="#h1-6-7" id="h1-6-7" class="d">-		enablediskcache = 1;
</a><a href="#h1-6-8" id="h1-6-8" class="i">+		enablecache = 1;
</a> 		break;
 	case &#39;e&#39;:
 		embed = strtol(EARGF(usage()), NULL, 0);
</pre>
</div>
</body>
</html>
