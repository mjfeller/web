<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>disable/toggle scrollbars - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/fe3bd631d4e163e15ab685c22ad70c67f8b94f83.html">fe3bd631d4e163e15ab685c22ad70c67f8b94f83</a>
<b>parent</b> <a href="../commit/69004b2ff67c5747e3f03fcffad1192741ea9419.html">69004b2ff67c5747e3f03fcffad1192741ea9419</a>
<b>Author:</b> Carlos J. Torres &lt;<a href="mailto:vlaadbrain@gmail.com">vlaadbrain@gmail.com</a>&gt;
<b>Date:</b>   Thu, 21 Feb 2013 09:59:07 -0500

disable/toggle scrollbars

	* add flag to main
	* add flag to manual
	* add signal handler to block default scrollbar policy
	* add toggle of scrollbars (hacky - but no reload) with a twitch
	* add key map to manual
	* add commandline flag to children surfers
	* update TODO
	* sort stuff alphabetically for the style inquisition

Signed-off-by: Christoph Lohmann &lt;20h@r-36.net&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">TODO.md</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.def.h</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">surf.1</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">surf.c</a></td><td> | </td><td class="num">79</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
</table></pre><pre>4 files changed, 79 insertions(+), 16 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/TODO.md.html">TODO.md</a> b/<a href="../file/TODO.md.html">TODO.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -2,7 +2,7 @@
</a> 
 * suckless adblocking
 * integrate the WebKitWebInspector API
<a href="#h0-0-3" id="h0-0-3" class="d">-* make scrollbars a switch and allow them to be disabled
</a><a href="#h0-0-4" id="h0-0-4" class="i">+* replace twitch() with proper gtk calls to make scrollbars reappear
</a> * replace webkit with something sane
 * add video player options
 	* play in plugin
<b>diff --git a/<a id="h1" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -10,6 +10,7 @@ static char *cafile         = &quot;/etc/ssl/certs/ca-certificates.crt&quot;;
</a> static char *strictssl      = FALSE; /* Refuse untrusted SSL connections */
 
 /* Webkit default features */
<a href="#h1-0-3" id="h1-0-3" class="i">+static Bool enablescrollbars = TRUE;
</a> static Bool enablespatialbrowsing = TRUE;
 static Bool enableplugins = TRUE;
 static Bool enablescripts = TRUE;
<a href="#h1-1" id="h1-1" class="h">@@ -84,5 +85,6 @@ static Key keys[] = {
</a>     { MODKEY|GDK_SHIFT_MASK,GDK_s,      toggle,     { .v = &quot;enable-scripts&quot; } },
     { MODKEY|GDK_SHIFT_MASK,GDK_v,      toggle,     { .v = &quot;enable-plugins&quot; } },
     { MODKEY|GDK_SHIFT_MASK,GDK_m,      togglestyle,{ 0 } },
<a href="#h1-1-3" id="h1-1-3" class="i">+    { MODKEY|GDK_SHIFT_MASK,GDK_b,      togglescrollbars,{ 0 } },
</a> };
 
<b>diff --git a/<a id="h2" href="../file/surf.1.html">surf.1</a> b/<a href="../file/surf.1.html">surf.1</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -3,7 +3,7 @@
</a> surf \- simple webkit-based browser
 .SH SYNOPSIS
 .B surf
<a href="#h2-0-3" id="h2-0-3" class="d">-.RB [-ipnsvx]
</a><a href="#h2-0-4" id="h2-0-4" class="i">+.RB [-bipnsvx]
</a> .RB [-c\ cookiefile]
 .RB [-e\ xid]
 .RB [-r\ scriptfile]
<a href="#h2-1" id="h2-1" class="h">@@ -17,6 +17,9 @@ which makes it possible to embed it in another application. Furthermore,
</a> one can point surf to another URI by setting its XProperties.
 .SH OPTIONS
 .TP
<a href="#h2-1-3" id="h2-1-3" class="i">+.B \-b
</a><a href="#h2-1-4" id="h2-1-4" class="i">+Disable Scrollbars
</a><a href="#h2-1-5" id="h2-1-5" class="i">+.TP
</a> .B \-c cookiefile 
 Specify the
 .I cookiefile
<a href="#h2-2" id="h2-2" class="h">@@ -127,8 +130,8 @@ Copies current URI to primary selection.
</a> .B Ctrl\-o
 Show the sourcecode of the current page.
 .TP
<a href="#h2-2-3" id="h2-2-3" class="d">-.B Ctrl\-Shift\-o
</a><a href="#h2-2-4" id="h2-2-4" class="d">-Open the Web Inspector (Developer Tools) window for the current page.
</a><a href="#h2-2-5" id="h2-2-5" class="i">+.B Ctrl\-Shift\-b
</a><a href="#h2-2-6" id="h2-2-6" class="i">+Toggle scrollbars
</a> .TP
 .B Ctrl\-Shift\-c
 Toggle caret browsing.
<a href="#h2-3" id="h2-3" class="h">@@ -141,6 +144,9 @@ Toggle if the
</a> .I stylefile 
 file should be loaded.
 .TP
<a href="#h2-3-3" id="h2-3-3" class="i">+.B Ctrl\-Shift\-o
</a><a href="#h2-3-4" id="h2-3-4" class="i">+Open the Web Inspector (Developer Tools) window for the current page.
</a><a href="#h2-3-5" id="h2-3-5" class="i">+.TP
</a> .B Ctrl\-Shift\-s
 Toggle script execution.
 .TP
<b>diff --git a/<a id="h3" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -153,6 +153,7 @@ static void stop(Client *c, const Arg *arg);
</a> static void titlechange(WebKitWebView *v, WebKitWebFrame *frame,
 		const char *title, Client *c);
 static void toggle(Client *c, const Arg *arg);
<a href="#h3-0-3" id="h3-0-3" class="i">+static void togglescrollbars(Client *c, const Arg *arg);
</a> static void togglestyle(Client *c, const Arg *arg);
 static void update(Client *c);
 static void updatewinid(Client *c);
<a href="#h3-1" id="h3-1" class="h">@@ -654,13 +655,9 @@ newclient(void) {
</a> 	c-&gt;vbox = gtk_vbox_new(FALSE, 0);
 	gtk_paned_pack1(GTK_PANED(c-&gt;pane), c-&gt;vbox, TRUE, TRUE);
 
<a href="#h3-1-3" id="h3-1-3" class="d">-	/* Scrolled Window */
</a><a href="#h3-1-4" id="h3-1-4" class="d">-	c-&gt;scroll = gtk_scrolled_window_new(NULL, NULL);
</a><a href="#h3-1-5" id="h3-1-5" class="d">-	gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll),
</a><a href="#h3-1-6" id="h3-1-6" class="d">-			GTK_POLICY_NEVER, GTK_POLICY_NEVER);
</a><a href="#h3-1-7" id="h3-1-7" class="d">-
</a> 	/* Webview */
 	c-&gt;view = WEBKIT_WEB_VIEW(webkit_web_view_new());
<a href="#h3-1-10" id="h3-1-10" class="i">+
</a> 	g_signal_connect(G_OBJECT(c-&gt;view),
 			&quot;title-changed&quot;,
 			G_CALLBACK(titlechange), c);
<a href="#h3-2" id="h3-2" class="h">@@ -698,6 +695,21 @@ newclient(void) {
</a> 			&quot;resource-request-starting&quot;,
 			G_CALLBACK(beforerequest), c);
 
<a href="#h3-2-3" id="h3-2-3" class="i">+	/* Scrolled Window */
</a><a href="#h3-2-4" id="h3-2-4" class="i">+	c-&gt;scroll = gtk_scrolled_window_new(NULL, NULL);
</a><a href="#h3-2-5" id="h3-2-5" class="i">+
</a><a href="#h3-2-6" id="h3-2-6" class="i">+	frame = webkit_web_view_get_main_frame(WEBKIT_WEB_VIEW(c-&gt;view));
</a><a href="#h3-2-7" id="h3-2-7" class="i">+	g_signal_connect(G_OBJECT(frame), &quot;scrollbars-policy-changed&quot;,
</a><a href="#h3-2-8" id="h3-2-8" class="i">+			G_CALLBACK(gtk_true), NULL);
</a><a href="#h3-2-9" id="h3-2-9" class="i">+
</a><a href="#h3-2-10" id="h3-2-10" class="i">+	if(!enablescrollbars) {
</a><a href="#h3-2-11" id="h3-2-11" class="i">+		gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll),
</a><a href="#h3-2-12" id="h3-2-12" class="i">+				GTK_POLICY_NEVER, GTK_POLICY_NEVER);
</a><a href="#h3-2-13" id="h3-2-13" class="i">+	} else {
</a><a href="#h3-2-14" id="h3-2-14" class="i">+		gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll),
</a><a href="#h3-2-15" id="h3-2-15" class="i">+				GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
</a><a href="#h3-2-16" id="h3-2-16" class="i">+	}
</a><a href="#h3-2-17" id="h3-2-17" class="i">+
</a> 	/* Arranging */
 	gtk_container_add(GTK_CONTAINER(c-&gt;scroll), GTK_WIDGET(c-&gt;view));
 	gtk_container_add(GTK_CONTAINER(c-&gt;win), c-&gt;pane);
<a href="#h3-3" id="h3-3" class="h">@@ -718,8 +730,8 @@ newclient(void) {
</a> 	gdk_window_add_filter(GTK_WIDGET(c-&gt;win)-&gt;window, processx, c);
 	webkit_web_view_set_full_content_zoom(c-&gt;view, TRUE);
 
<a href="#h3-3-3" id="h3-3-3" class="d">-	frame = webkit_web_view_get_main_frame(c-&gt;view);
</a> 	runscript(frame);
<a href="#h3-3-5" id="h3-3-5" class="i">+
</a> 	settings = webkit_web_view_get_settings(c-&gt;view);
 	if(!(ua = getenv(&quot;SURF_USERAGENT&quot;)))
 		ua = useragent;
<a href="#h3-4" id="h3-4" class="h">@@ -778,22 +790,24 @@ newclient(void) {
</a> static void
 newwindow(Client *c, const Arg *arg, gboolean noembed) {
 	guint i = 0;
<a href="#h3-4-3" id="h3-4-3" class="d">-	const char *cmd[10], *uri;
</a><a href="#h3-4-4" id="h3-4-4" class="i">+	const char *cmd[11], *uri;
</a> 	const Arg a = { .v = (void *)cmd };
 	char tmp[64];
 
 	cmd[i++] = argv0;
<a href="#h3-4-9" id="h3-4-9" class="i">+	if(!enablescrollbars)
</a><a href="#h3-4-10" id="h3-4-10" class="i">+		cmd[i++] = &quot;-b&quot;;
</a> 	if(embed &amp;&amp; !noembed) {
 		cmd[i++] = &quot;-e&quot;;
 		snprintf(tmp, LENGTH(tmp), &quot;%u\n&quot;, (int)embed);
 		cmd[i++] = tmp;
 	}
<a href="#h3-4-16" id="h3-4-16" class="d">-	if(!enablescripts)
</a><a href="#h3-4-17" id="h3-4-17" class="d">-		cmd[i++] = &quot;-s&quot;;
</a><a href="#h3-4-18" id="h3-4-18" class="d">-	if(!enableplugins)
</a><a href="#h3-4-19" id="h3-4-19" class="d">-		cmd[i++] = &quot;-p&quot;;
</a> 	if(!loadimages)
 		cmd[i++] = &quot;-i&quot;;
<a href="#h3-4-22" id="h3-4-22" class="i">+	if(!enableplugins)
</a><a href="#h3-4-23" id="h3-4-23" class="i">+		cmd[i++] = &quot;-p&quot;;
</a><a href="#h3-4-24" id="h3-4-24" class="i">+	if(!enablescripts)
</a><a href="#h3-4-25" id="h3-4-25" class="i">+		cmd[i++] = &quot;-s&quot;;
</a> 	if(showxid)
 		cmd[i++] = &quot;-x&quot;;
 	cmd[i++] = &quot;--&quot;;
<a href="#h3-5" id="h3-5" class="h">@@ -1048,6 +1062,44 @@ toggle(Client *c, const Arg *arg) {
</a> }
 
 static void
<a href="#h3-5-3" id="h3-5-3" class="i">+twitch(Client *c, const Arg *arg) {
</a><a href="#h3-5-4" id="h3-5-4" class="i">+	GtkAdjustment *a;
</a><a href="#h3-5-5" id="h3-5-5" class="i">+	gdouble v;
</a><a href="#h3-5-6" id="h3-5-6" class="i">+
</a><a href="#h3-5-7" id="h3-5-7" class="i">+	a = gtk_scrolled_window_get_vadjustment(
</a><a href="#h3-5-8" id="h3-5-8" class="i">+			GTK_SCROLLED_WINDOW(c-&gt;scroll));
</a><a href="#h3-5-9" id="h3-5-9" class="i">+
</a><a href="#h3-5-10" id="h3-5-10" class="i">+	v = gtk_adjustment_get_value(a);
</a><a href="#h3-5-11" id="h3-5-11" class="i">+
</a><a href="#h3-5-12" id="h3-5-12" class="i">+	v += arg-&gt;i;
</a><a href="#h3-5-13" id="h3-5-13" class="i">+
</a><a href="#h3-5-14" id="h3-5-14" class="i">+	v = MAX(v, 0.0);
</a><a href="#h3-5-15" id="h3-5-15" class="i">+	v = MIN(v, gtk_adjustment_get_upper(a) -
</a><a href="#h3-5-16" id="h3-5-16" class="i">+			gtk_adjustment_get_page_size(a));
</a><a href="#h3-5-17" id="h3-5-17" class="i">+	gtk_adjustment_set_value(a, v);
</a><a href="#h3-5-18" id="h3-5-18" class="i">+}
</a><a href="#h3-5-19" id="h3-5-19" class="i">+
</a><a href="#h3-5-20" id="h3-5-20" class="i">+static void
</a><a href="#h3-5-21" id="h3-5-21" class="i">+togglescrollbars(Client *c, const Arg *arg) {
</a><a href="#h3-5-22" id="h3-5-22" class="i">+	GtkPolicyType vspolicy;
</a><a href="#h3-5-23" id="h3-5-23" class="i">+	Arg a;
</a><a href="#h3-5-24" id="h3-5-24" class="i">+
</a><a href="#h3-5-25" id="h3-5-25" class="i">+	gtk_scrolled_window_get_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll), NULL, &amp;vspolicy);
</a><a href="#h3-5-26" id="h3-5-26" class="i">+
</a><a href="#h3-5-27" id="h3-5-27" class="i">+	if(vspolicy == GTK_POLICY_AUTOMATIC) {
</a><a href="#h3-5-28" id="h3-5-28" class="i">+		gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll),
</a><a href="#h3-5-29" id="h3-5-29" class="i">+				GTK_POLICY_NEVER, GTK_POLICY_NEVER);
</a><a href="#h3-5-30" id="h3-5-30" class="i">+	} else {
</a><a href="#h3-5-31" id="h3-5-31" class="i">+		gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(c-&gt;scroll),
</a><a href="#h3-5-32" id="h3-5-32" class="i">+				GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
</a><a href="#h3-5-33" id="h3-5-33" class="i">+		a.i = +1;
</a><a href="#h3-5-34" id="h3-5-34" class="i">+		twitch(c, &amp;a);
</a><a href="#h3-5-35" id="h3-5-35" class="i">+		a.i = -1;
</a><a href="#h3-5-36" id="h3-5-36" class="i">+		twitch(c, &amp;a);
</a><a href="#h3-5-37" id="h3-5-37" class="i">+	}
</a><a href="#h3-5-38" id="h3-5-38" class="i">+}
</a><a href="#h3-5-39" id="h3-5-39" class="i">+
</a><a href="#h3-5-40" id="h3-5-40" class="i">+static void
</a> togglestyle(Client *c, const Arg *arg) {
 	WebKitWebSettings *settings;
 	char *uri;
<a href="#h3-6" id="h3-6" class="h">@@ -1128,7 +1180,7 @@ updatewinid(Client *c) {
</a> 
 static void
 usage(void) {
<a href="#h3-6-3" id="h3-6-3" class="d">-	die(&quot;usage: %s [-inpsvx] [-c cookiefile] [-e xid] [-r scriptfile]&quot;
</a><a href="#h3-6-4" id="h3-6-4" class="i">+	die(&quot;usage: %s [-binpsvx] [-c cookiefile] [-e xid] [-r scriptfile]&quot;
</a> 		&quot; [-t stylefile] [-u useragent] [uri]\n&quot;, basename(argv0));
 }
 
<a href="#h3-7" id="h3-7" class="h">@@ -1162,6 +1214,9 @@ main(int argc, char *argv[]) {
</a> 
 	/* command line args */
 	ARGBEGIN {
<a href="#h3-7-3" id="h3-7-3" class="i">+	case &#39;b&#39;:
</a><a href="#h3-7-4" id="h3-7-4" class="i">+		enablescrollbars = 0;
</a><a href="#h3-7-5" id="h3-7-5" class="i">+		break;
</a> 	case &#39;c&#39;:
 		cookiefile = EARGF(usage());
 		break;
</pre>
</div>
</body>
</html>
