<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Style change in functions ordering - surf - surf browser, a WebKit based browser
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="surf Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>surf</h1><span class="desc">surf browser, a WebKit based browser
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/432f3c6b53cf47db3141a3e9b8b5aec2152f9aae.html">432f3c6b53cf47db3141a3e9b8b5aec2152f9aae</a>
<b>parent</b> <a href="../commit/7e9a85a5cb31a2ddefd06498eff33df724bdc6cf.html">7e9a85a5cb31a2ddefd06498eff33df724bdc6cf</a>
<b>Author:</b> Quentin Rameau &lt;<a href="mailto:quinq@fifth.space">quinq@fifth.space</a>&gt;
<b>Date:</b>   Sat, 21 Nov 2015 19:14:08 +0100

Style change in functions ordering

Try to group and order functions in a logical manner.
Same thing for config keybindings.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">40</td><td><span class="i">+++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">surf.c</a></td><td> | </td><td class="num">1738</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
</table></pre><pre>2 files changed, 889 insertions(+), 889 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -84,18 +84,15 @@ static SiteStyle styles[] = {
</a>  */
 static Key keys[] = {
 	/* modifier	         keyval          function    arg */
<a href="#h0-0-3" id="h0-0-3" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_r,      reload,     { .b = TRUE } },
</a><a href="#h0-0-4" id="h0-0-4" class="d">-	{ MODKEY,                GDK_KEY_r,      reload,     { .b = FALSE } },
</a><a href="#h0-0-5" id="h0-0-5" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_p,      print,      { 0 } },
</a><a href="#h0-0-6" id="h0-0-6" class="i">+	{ MODKEY,                GDK_KEY_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;) },
</a><a href="#h0-0-7" id="h0-0-7" class="i">+	{ MODKEY,                GDK_KEY_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;) },
</a><a href="#h0-0-8" id="h0-0-8" class="i">+	{ MODKEY,                GDK_KEY_slash,  spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;) },
</a> 
<a href="#h0-0-10" id="h0-0-10" class="d">-	{ MODKEY,                GDK_KEY_p,      clipboard,  { .b = TRUE } },
</a><a href="#h0-0-11" id="h0-0-11" class="d">-	{ MODKEY,                GDK_KEY_y,      clipboard,  { .b = FALSE } },
</a><a href="#h0-0-12" id="h0-0-12" class="i">+	{ 0,                     GDK_KEY_Escape, stop,       { 0 } },
</a><a href="#h0-0-13" id="h0-0-13" class="i">+	{ MODKEY,                GDK_KEY_c,      stop,       { 0 } },
</a> 
<a href="#h0-0-15" id="h0-0-15" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_j,      zoom,       { .i = -1 } },
</a><a href="#h0-0-16" id="h0-0-16" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_k,      zoom,       { .i = +1 } },
</a><a href="#h0-0-17" id="h0-0-17" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_q,      zoom,       { .i = 0  } },
</a><a href="#h0-0-18" id="h0-0-18" class="d">-	{ MODKEY,                GDK_KEY_minus,  zoom,       { .i = -1 } },
</a><a href="#h0-0-19" id="h0-0-19" class="d">-	{ MODKEY,                GDK_KEY_plus,   zoom,       { .i = +1 } },
</a><a href="#h0-0-20" id="h0-0-20" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_r,      reload,     { .b = TRUE } },
</a><a href="#h0-0-21" id="h0-0-21" class="i">+	{ MODKEY,                GDK_KEY_r,      reload,     { .b = FALSE } },
</a> 
 	{ MODKEY,                GDK_KEY_l,      navigate,   { .i = +1 } },
 	{ MODKEY,                GDK_KEY_h,      navigate,   { .i = -1 } },
<a href="#h0-1" id="h0-1" class="h">@@ -108,17 +105,25 @@ static Key keys[] = {
</a> 	{ MODKEY,                GDK_KEY_i,      scroll_h,   { .i = +10 } },
 	{ MODKEY,                GDK_KEY_u,      scroll_h,   { .i = -10 } },
 
<a href="#h0-1-3" id="h0-1-3" class="d">-	{ 0,                     GDK_KEY_F11,    togglefullscreen, { 0 } },
</a><a href="#h0-1-4" id="h0-1-4" class="d">-	{ 0,                     GDK_KEY_Escape, stop,       { 0 } },
</a><a href="#h0-1-5" id="h0-1-5" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_o,      toggleinspector, { 0 } },
</a><a href="#h0-1-6" id="h0-1-6" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_j,      zoom,       { .i = -1 } },
</a><a href="#h0-1-7" id="h0-1-7" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_k,      zoom,       { .i = +1 } },
</a><a href="#h0-1-8" id="h0-1-8" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_q,      zoom,       { .i = 0  } },
</a><a href="#h0-1-9" id="h0-1-9" class="i">+	{ MODKEY,                GDK_KEY_minus,  zoom,       { .i = -1 } },
</a><a href="#h0-1-10" id="h0-1-10" class="i">+	{ MODKEY,                GDK_KEY_plus,   zoom,       { .i = +1 } },
</a> 
<a href="#h0-1-12" id="h0-1-12" class="d">-	{ MODKEY,                GDK_KEY_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;) },
</a><a href="#h0-1-13" id="h0-1-13" class="d">-	{ MODKEY,                GDK_KEY_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;) },
</a><a href="#h0-1-14" id="h0-1-14" class="d">-	{ MODKEY,                GDK_KEY_slash,  spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;) },
</a><a href="#h0-1-15" id="h0-1-15" class="i">+	{ MODKEY,                GDK_KEY_p,      clipboard,  { .b = TRUE } },
</a><a href="#h0-1-16" id="h0-1-16" class="i">+	{ MODKEY,                GDK_KEY_y,      clipboard,  { .b = FALSE } },
</a> 
 	{ MODKEY,                GDK_KEY_n,      find,       { .i = +1 } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_n,      find,       { .i = -1 } },
 
<a href="#h0-1-21" id="h0-1-21" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_p,      print,      { 0 } },
</a><a href="#h0-1-22" id="h0-1-22" class="i">+
</a><a href="#h0-1-23" id="h0-1-23" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
</a><a href="#h0-1-24" id="h0-1-24" class="i">+	{ 0,                     GDK_KEY_F11,    togglefullscreen, { 0 } },
</a><a href="#h0-1-25" id="h0-1-25" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_o,      toggleinspector, { 0 } },
</a><a href="#h0-1-26" id="h0-1-26" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      togglestyle, { 0 } },
</a><a href="#h0-1-27" id="h0-1-27" class="i">+
</a> 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .i = CaretBrowsing } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_f,      toggle,     { .i = FrameFlattening } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      toggle,     { .i = Geolocation } },
<a href="#h0-2" id="h0-2" class="h">@@ -126,9 +131,6 @@ static Key keys[] = {
</a> 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .i = LoadImages } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .i = Plugins } },
 	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_b,      toggle,     { .i = ScrollBars } },
<a href="#h0-2-3" id="h0-2-3" class="d">-
</a><a href="#h0-2-4" id="h0-2-4" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
</a><a href="#h0-2-5" id="h0-2-5" class="d">-	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      togglestyle, { 0 } },
</a> };
 
 /* button definitions */
<b>diff --git a/<a id="h1" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -29,14 +29,22 @@
</a> 
 #include &quot;arg.h&quot;
 
<a href="#h1-0-3" id="h1-0-3" class="d">-char *argv0;
</a><a href="#h1-0-4" id="h1-0-4" class="d">-
</a> #define LENGTH(x)               (sizeof(x) / sizeof(x[0]))
 #define CLEANMASK(mask)         (mask &amp; (MODKEY|GDK_SHIFT_MASK))
 
 enum { AtomFind, AtomGo, AtomUri, AtomLast };
 
 enum {
<a href="#h1-0-11" id="h1-0-11" class="i">+	CaretBrowsing,
</a><a href="#h1-0-12" id="h1-0-12" class="i">+	FrameFlattening,
</a><a href="#h1-0-13" id="h1-0-13" class="i">+	Geolocation,
</a><a href="#h1-0-14" id="h1-0-14" class="i">+	JavaScript,
</a><a href="#h1-0-15" id="h1-0-15" class="i">+	LoadImages,
</a><a href="#h1-0-16" id="h1-0-16" class="i">+	Plugins,
</a><a href="#h1-0-17" id="h1-0-17" class="i">+	ScrollBars,
</a><a href="#h1-0-18" id="h1-0-18" class="i">+};
</a><a href="#h1-0-19" id="h1-0-19" class="i">+
</a><a href="#h1-0-20" id="h1-0-20" class="i">+enum {
</a> 	OnDoc   = WEBKIT_HIT_TEST_RESULT_CONTEXT_DOCUMENT,
 	OnLink  = WEBKIT_HIT_TEST_RESULT_CONTEXT_LINK,
 	OnImg   = WEBKIT_HIT_TEST_RESULT_CONTEXT_IMAGE,
<a href="#h1-1" id="h1-1" class="h">@@ -47,42 +55,31 @@ enum {
</a> 	OnAny   = OnDoc | OnLink | OnImg | OnMedia | OnEdit | OnBar | OnSel,
 };
 
<a href="#h1-1-3" id="h1-1-3" class="d">-enum {
</a><a href="#h1-1-4" id="h1-1-4" class="d">-	CaretBrowsing,
</a><a href="#h1-1-5" id="h1-1-5" class="d">-	FrameFlattening,
</a><a href="#h1-1-6" id="h1-1-6" class="d">-	Geolocation,
</a><a href="#h1-1-7" id="h1-1-7" class="d">-	JavaScript,
</a><a href="#h1-1-8" id="h1-1-8" class="d">-	LoadImages,
</a><a href="#h1-1-9" id="h1-1-9" class="d">-	Plugins,
</a><a href="#h1-1-10" id="h1-1-10" class="d">-	ScrollBars,
</a><a href="#h1-1-11" id="h1-1-11" class="d">-};
</a><a href="#h1-1-12" id="h1-1-12" class="d">-
</a><a href="#h1-1-13" id="h1-1-13" class="d">-typedef union Arg Arg;
</a><a href="#h1-1-14" id="h1-1-14" class="d">-union Arg {
</a><a href="#h1-1-15" id="h1-1-15" class="i">+typedef union {
</a> 	gboolean b;
 	gint i;
 	const void *v;
<a href="#h1-1-19" id="h1-1-19" class="d">-};
</a><a href="#h1-1-20" id="h1-1-20" class="i">+} Arg;
</a> 
 typedef struct Client {
 	GtkWidget *win;
<a href="#h1-1-24" id="h1-1-24" class="d">-	Window xid;
</a> 	WebKitWebView *view;
 	WebKitWebInspector *inspector;
 	WebKitFindController *finder;
 	WebKitHitTestResult *mousepos;
 	GTlsCertificateFlags tlsflags;
<a href="#h1-1-30" id="h1-1-30" class="i">+	Window xid;
</a><a href="#h1-1-31" id="h1-1-31" class="i">+	gint progress;
</a><a href="#h1-1-32" id="h1-1-32" class="i">+	gboolean fullscreen;
</a> 	const char *title, *targeturi;
 	const char *needle;
<a href="#h1-1-35" id="h1-1-35" class="d">-	gint progress;
</a> 	struct Client *next;
<a href="#h1-1-37" id="h1-1-37" class="d">-	gboolean fullscreen;
</a> } Client;
 
 typedef struct {
 	guint mod;
 	guint keyval;
<a href="#h1-1-43" id="h1-1-43" class="d">-	void (*func)(Client *c, const Arg *arg);
</a><a href="#h1-1-44" id="h1-1-44" class="i">+	void (*func)(Client *c, const Arg *a);
</a> 	const Arg arg;
 } Key;
 
<a href="#h1-2" id="h1-2" class="h">@@ -101,114 +98,168 @@ typedef struct {
</a> 	regex_t re;
 } SiteStyle;
 
<a href="#h1-2-3" id="h1-2-3" class="d">-static Display *dpy;
</a><a href="#h1-2-4" id="h1-2-4" class="d">-static Atom atoms[AtomLast];
</a><a href="#h1-2-5" id="h1-2-5" class="d">-static Client *clients = NULL;
</a><a href="#h1-2-6" id="h1-2-6" class="d">-static Window embed = 0;
</a><a href="#h1-2-7" id="h1-2-7" class="d">-static gboolean showxid = FALSE;
</a><a href="#h1-2-8" id="h1-2-8" class="d">-static char winid[64];
</a><a href="#h1-2-9" id="h1-2-9" class="d">-static char togglestats[10];
</a><a href="#h1-2-10" id="h1-2-10" class="d">-static char pagestats[2];
</a><a href="#h1-2-11" id="h1-2-11" class="d">-static int cookiepolicy;
</a><a href="#h1-2-12" id="h1-2-12" class="d">-static char *stylefile = NULL;
</a><a href="#h1-2-13" id="h1-2-13" class="d">-static const char *useragent;
</a><a href="#h1-2-14" id="h1-2-14" class="d">-
</a><a href="#h1-2-15" id="h1-2-15" class="d">-static void addaccelgroup(Client *c);
</a><a href="#h1-2-16" id="h1-2-16" class="i">+/* Surf */
</a><a href="#h1-2-17" id="h1-2-17" class="i">+static void usage(void);
</a><a href="#h1-2-18" id="h1-2-18" class="i">+static void die(const char *errstr, ...);
</a><a href="#h1-2-19" id="h1-2-19" class="i">+static void setup(void);
</a><a href="#h1-2-20" id="h1-2-20" class="i">+static void sigchld(int unused);
</a> static char *buildfile(const char *path);
 static char *buildpath(const char *path);
<a href="#h1-2-23" id="h1-2-23" class="d">-static gboolean buttonreleased(GtkWidget *w, GdkEventKey *e, Client *c);
</a><a href="#h1-2-24" id="h1-2-24" class="d">-static void cleanup(void);
</a><a href="#h1-2-25" id="h1-2-25" class="d">-static void clipboard(Client *c, const Arg *a);
</a><a href="#h1-2-26" id="h1-2-26" class="d">-
</a><a href="#h1-2-27" id="h1-2-27" class="i">+static Client *newclient(Client *c);
</a><a href="#h1-2-28" id="h1-2-28" class="i">+static void addaccelgroup(Client *c);
</a><a href="#h1-2-29" id="h1-2-29" class="i">+static void loaduri(Client *c, const Arg *a);
</a><a href="#h1-2-30" id="h1-2-30" class="i">+static char *geturi(Client *c);
</a><a href="#h1-2-31" id="h1-2-31" class="i">+static void setatom(Client *c, int a, const char *v);
</a><a href="#h1-2-32" id="h1-2-32" class="i">+static const char *getatom(Client *c, int a);
</a><a href="#h1-2-33" id="h1-2-33" class="i">+static void updatetitle(Client *c);
</a><a href="#h1-2-34" id="h1-2-34" class="i">+static void gettogglestats(Client *c);
</a><a href="#h1-2-35" id="h1-2-35" class="i">+static void getpagestats(Client *c);
</a> static WebKitCookieAcceptPolicy cookiepolicy_get(void);
 static char cookiepolicy_set(const WebKitCookieAcceptPolicy p);
<a href="#h1-2-38" id="h1-2-38" class="i">+static const gchar *getstyle(const char *uri);
</a><a href="#h1-2-39" id="h1-2-39" class="i">+static void setstyle(Client *c, const char *stylefile);
</a><a href="#h1-2-40" id="h1-2-40" class="i">+static void runscript(Client *c);
</a><a href="#h1-2-41" id="h1-2-41" class="i">+static void evalscript(Client *c, const char *jsstr, ...);
</a><a href="#h1-2-42" id="h1-2-42" class="i">+static void updatewinid(Client *c);
</a><a href="#h1-2-43" id="h1-2-43" class="i">+static void handleplumb(Client *c, const gchar *uri);
</a><a href="#h1-2-44" id="h1-2-44" class="i">+static void newwindow(Client *c, const Arg *arg, gboolean noembed);
</a><a href="#h1-2-45" id="h1-2-45" class="i">+static void spawn(Client *c, const Arg *a);
</a><a href="#h1-2-46" id="h1-2-46" class="i">+static void destroyclient(Client *c);
</a><a href="#h1-2-47" id="h1-2-47" class="i">+static void cleanup(void);
</a> 
<a href="#h1-2-49" id="h1-2-49" class="i">+/* GTK/WebKit */
</a><a href="#h1-2-50" id="h1-2-50" class="i">+static WebKitWebView *newview(Client *c, WebKitWebView *rv);
</a> static GtkWidget *createview(WebKitWebView *v, WebKitNavigationAction *a,
 		Client *c);
<a href="#h1-2-53" id="h1-2-53" class="i">+static gboolean buttonreleased(GtkWidget *w, GdkEventKey *e, Client *c);
</a><a href="#h1-2-54" id="h1-2-54" class="i">+static gboolean keypress(GtkAccelGroup *group, GObject *obj, guint key,
</a><a href="#h1-2-55" id="h1-2-55" class="i">+                         GdkModifierType mods, Client *c);
</a><a href="#h1-2-56" id="h1-2-56" class="i">+static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event,
</a><a href="#h1-2-57" id="h1-2-57" class="i">+                                gpointer d);
</a><a href="#h1-2-58" id="h1-2-58" class="i">+static gboolean winevent(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h1-2-59" id="h1-2-59" class="i">+static void showview(WebKitWebView *v, Client *c);
</a><a href="#h1-2-60" id="h1-2-60" class="i">+static GtkWidget *createwindow(Client *c);
</a><a href="#h1-2-61" id="h1-2-61" class="i">+static void loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c);
</a><a href="#h1-2-62" id="h1-2-62" class="i">+static void progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c);
</a><a href="#h1-2-63" id="h1-2-63" class="i">+static void titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c);
</a><a href="#h1-2-64" id="h1-2-64" class="i">+static void mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h,
</a><a href="#h1-2-65" id="h1-2-65" class="i">+		guint modifiers, Client *c);
</a><a href="#h1-2-66" id="h1-2-66" class="i">+static gboolean permissionrequested(WebKitWebView *v,
</a><a href="#h1-2-67" id="h1-2-67" class="i">+		WebKitPermissionRequest *r, Client *c);
</a> static gboolean decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
     WebKitPolicyDecisionType dt, Client *c);
 static void decidenavigation(WebKitPolicyDecision *d, Client *c);
 static void decidenewwindow(WebKitPolicyDecision *d, Client *c);
 static void decideresource(WebKitPolicyDecision *d, Client *c);
<a href="#h1-2-73" id="h1-2-73" class="d">-static void closeview(WebKitWebView *v, Client *c);
</a><a href="#h1-2-74" id="h1-2-74" class="d">-static void destroyclient(Client *c);
</a><a href="#h1-2-75" id="h1-2-75" class="d">-static void destroywin(GtkWidget* w, Client *c);
</a><a href="#h1-2-76" id="h1-2-76" class="d">-static void die(const char *errstr, ...);
</a><a href="#h1-2-77" id="h1-2-77" class="d">-static void evalscript(Client *c, const char *jsstr, ...);
</a><a href="#h1-2-78" id="h1-2-78" class="d">-static void runscript(Client *c);
</a><a href="#h1-2-79" id="h1-2-79" class="d">-static void find(Client *c, const Arg *a);
</a><a href="#h1-2-80" id="h1-2-80" class="d">-static void togglefullscreen(Client *c, const Arg *a);
</a><a href="#h1-2-81" id="h1-2-81" class="d">-static gboolean permissionrequested(WebKitWebView *v,
</a><a href="#h1-2-82" id="h1-2-82" class="d">-		WebKitPermissionRequest *r, Client *c);
</a><a href="#h1-2-83" id="h1-2-83" class="d">-static const char *getatom(Client *c, int a);
</a><a href="#h1-2-84" id="h1-2-84" class="d">-static void gettogglestats(Client *c);
</a><a href="#h1-2-85" id="h1-2-85" class="d">-static void getpagestats(Client *c);
</a><a href="#h1-2-86" id="h1-2-86" class="d">-static char *geturi(Client *c);
</a><a href="#h1-2-87" id="h1-2-87" class="d">-static const gchar *getstyle(const char *uri);
</a><a href="#h1-2-88" id="h1-2-88" class="d">-static void setstyle(Client *c, const char *stylefile);
</a><a href="#h1-2-89" id="h1-2-89" class="d">-
</a><a href="#h1-2-90" id="h1-2-90" class="d">-static void handleplumb(Client *c, const gchar *uri);
</a><a href="#h1-2-91" id="h1-2-91" class="d">-
</a> static void downloadstarted(WebKitWebContext *wc, WebKitDownload *d,
 		Client *c);
 static void responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c);
 static void download(Client *c, WebKitURIResponse *r);
<a href="#h1-2-96" id="h1-2-96" class="i">+static void closeview(WebKitWebView *v, Client *c);
</a><a href="#h1-2-97" id="h1-2-97" class="i">+static void destroywin(GtkWidget* w, Client *c);
</a> 
<a href="#h1-2-99" id="h1-2-99" class="d">-static void toggleinspector(Client *c, const Arg *a);
</a><a href="#h1-2-100" id="h1-2-100" class="d">-
</a><a href="#h1-2-101" id="h1-2-101" class="d">-static gboolean keypress(GtkAccelGroup *group, GObject *obj, guint key,
</a><a href="#h1-2-102" id="h1-2-102" class="d">-                         GdkModifierType mods, Client *c);
</a><a href="#h1-2-103" id="h1-2-103" class="d">-static void mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h,
</a><a href="#h1-2-104" id="h1-2-104" class="d">-		guint modifiers, Client *c);
</a><a href="#h1-2-105" id="h1-2-105" class="d">-static void loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c);
</a><a href="#h1-2-106" id="h1-2-106" class="d">-static void loaduri(Client *c, const Arg *a);
</a><a href="#h1-2-107" id="h1-2-107" class="d">-static void navigate(Client *c, const Arg *a);
</a><a href="#h1-2-108" id="h1-2-108" class="d">-static void clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h1-2-109" id="h1-2-109" class="d">-static Client *newclient(Client *c);
</a><a href="#h1-2-110" id="h1-2-110" class="d">-static WebKitWebView *newview(Client *c, WebKitWebView *rv);
</a><a href="#h1-2-111" id="h1-2-111" class="d">-static void showview(WebKitWebView *v, Client *c);
</a><a href="#h1-2-112" id="h1-2-112" class="d">-static void newwindow(Client *c, const Arg *arg, gboolean noembed);
</a><a href="#h1-2-113" id="h1-2-113" class="d">-static GtkWidget *createwindow(Client *c);
</a><a href="#h1-2-114" id="h1-2-114" class="i">+/* Hotkeys */
</a> static void pasteuri(GtkClipboard *clipboard, const char *text, gpointer d);
<a href="#h1-2-116" id="h1-2-116" class="d">-static void print(Client *c, const Arg *a);
</a><a href="#h1-2-117" id="h1-2-117" class="d">-static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event,
</a><a href="#h1-2-118" id="h1-2-118" class="d">-                                gpointer d);
</a><a href="#h1-2-119" id="h1-2-119" class="d">-static gboolean winevent(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h1-2-120" id="h1-2-120" class="d">-static void progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c);
</a><a href="#h1-2-121" id="h1-2-121" class="d">-static void clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h);
</a> static void reload(Client *c, const Arg *arg);
<a href="#h1-2-123" id="h1-2-123" class="d">-static void scroll_h(Client *c, const Arg *a);
</a><a href="#h1-2-124" id="h1-2-124" class="i">+static void print(Client *c, const Arg *a);
</a><a href="#h1-2-125" id="h1-2-125" class="i">+static void clipboard(Client *c, const Arg *a);
</a><a href="#h1-2-126" id="h1-2-126" class="i">+static void zoom(Client *c, const Arg *a);
</a> static void scroll_v(Client *c, const Arg *a);
<a href="#h1-2-128" id="h1-2-128" class="d">-static void setatom(Client *c, int a, const char *v);
</a><a href="#h1-2-129" id="h1-2-129" class="d">-static void setup(void);
</a><a href="#h1-2-130" id="h1-2-130" class="d">-static void sigchld(int unused);
</a><a href="#h1-2-131" id="h1-2-131" class="d">-static void spawn(Client *c, const Arg *arg);
</a><a href="#h1-2-132" id="h1-2-132" class="i">+static void scroll_h(Client *c, const Arg *a);
</a><a href="#h1-2-133" id="h1-2-133" class="i">+static void navigate(Client *c, const Arg *a);
</a> static void stop(Client *c, const Arg *arg);
<a href="#h1-2-135" id="h1-2-135" class="d">-static void titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c);
</a> static void toggle(Client *c, const Arg *a);
<a href="#h1-2-137" id="h1-2-137" class="i">+static void togglefullscreen(Client *c, const Arg *a);
</a> static void togglecookiepolicy(Client *c, const Arg *arg);
 static void togglestyle(Client *c, const Arg *arg);
<a href="#h1-2-140" id="h1-2-140" class="d">-static void updatetitle(Client *c);
</a><a href="#h1-2-141" id="h1-2-141" class="d">-static void updatewinid(Client *c);
</a><a href="#h1-2-142" id="h1-2-142" class="d">-static void usage(void);
</a><a href="#h1-2-143" id="h1-2-143" class="d">-static void zoom(Client *c, const Arg *a);
</a><a href="#h1-2-144" id="h1-2-144" class="i">+static void toggleinspector(Client *c, const Arg *a);
</a><a href="#h1-2-145" id="h1-2-145" class="i">+static void find(Client *c, const Arg *a);
</a><a href="#h1-2-146" id="h1-2-146" class="i">+
</a><a href="#h1-2-147" id="h1-2-147" class="i">+/* Buttons */
</a><a href="#h1-2-148" id="h1-2-148" class="i">+static void clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h1-2-149" id="h1-2-149" class="i">+static void clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h1-2-150" id="h1-2-150" class="i">+
</a><a href="#h1-2-151" id="h1-2-151" class="i">+static char winid[64];
</a><a href="#h1-2-152" id="h1-2-152" class="i">+static char togglestats[10];
</a><a href="#h1-2-153" id="h1-2-153" class="i">+static char pagestats[2];
</a><a href="#h1-2-154" id="h1-2-154" class="i">+static Atom atoms[AtomLast];
</a><a href="#h1-2-155" id="h1-2-155" class="i">+static Window embed;
</a><a href="#h1-2-156" id="h1-2-156" class="i">+static gboolean showxid = FALSE;
</a><a href="#h1-2-157" id="h1-2-157" class="i">+static int cookiepolicy;
</a><a href="#h1-2-158" id="h1-2-158" class="i">+static Display *dpy;
</a><a href="#h1-2-159" id="h1-2-159" class="i">+static Client *clients;
</a><a href="#h1-2-160" id="h1-2-160" class="i">+static char *stylefile;
</a><a href="#h1-2-161" id="h1-2-161" class="i">+static const char *useragent;
</a><a href="#h1-2-162" id="h1-2-162" class="i">+char *argv0;
</a> 
 /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
 
 void
<a href="#h1-2-168" id="h1-2-168" class="d">-addaccelgroup(Client *c)
</a><a href="#h1-2-169" id="h1-2-169" class="i">+usage(void)
</a><a href="#h1-2-170" id="h1-2-170" class="i">+{
</a><a href="#h1-2-171" id="h1-2-171" class="i">+	die(&quot;usage: %s [-bBdDfFgGiIkKmMnNpPsSvx] [-a cookiepolicies ] &quot;
</a><a href="#h1-2-172" id="h1-2-172" class="i">+	    &quot;[-c cookiefile] [-e xid] [-r scriptfile] [-t stylefile] &quot;
</a><a href="#h1-2-173" id="h1-2-173" class="i">+	    &quot;[-u useragent] [-z zoomlevel] [uri]\n&quot;, basename(argv0));
</a><a href="#h1-2-174" id="h1-2-174" class="i">+}
</a><a href="#h1-2-175" id="h1-2-175" class="i">+
</a><a href="#h1-2-176" id="h1-2-176" class="i">+void
</a><a href="#h1-2-177" id="h1-2-177" class="i">+die(const char *errstr, ...)
</a><a href="#h1-2-178" id="h1-2-178" class="i">+{
</a><a href="#h1-2-179" id="h1-2-179" class="i">+	va_list ap;
</a><a href="#h1-2-180" id="h1-2-180" class="i">+
</a><a href="#h1-2-181" id="h1-2-181" class="i">+	va_start(ap, errstr);
</a><a href="#h1-2-182" id="h1-2-182" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h1-2-183" id="h1-2-183" class="i">+	va_end(ap);
</a><a href="#h1-2-184" id="h1-2-184" class="i">+	exit(EXIT_FAILURE);
</a><a href="#h1-2-185" id="h1-2-185" class="i">+}
</a><a href="#h1-2-186" id="h1-2-186" class="i">+
</a><a href="#h1-2-187" id="h1-2-187" class="i">+void
</a><a href="#h1-2-188" id="h1-2-188" class="i">+setup(void)
</a> {
 	int i;
<a href="#h1-2-191" id="h1-2-191" class="d">-	GtkAccelGroup *group = gtk_accel_group_new();
</a><a href="#h1-2-192" id="h1-2-192" class="d">-	GClosure *closure;
</a> 
<a href="#h1-2-194" id="h1-2-194" class="d">-	for (i = 0; i &lt; LENGTH(keys); i++) {
</a><a href="#h1-2-195" id="h1-2-195" class="d">-		closure = g_cclosure_new(G_CALLBACK(keypress), c, NULL);
</a><a href="#h1-2-196" id="h1-2-196" class="d">-		gtk_accel_group_connect(group, keys[i].keyval, keys[i].mod, 0,
</a><a href="#h1-2-197" id="h1-2-197" class="d">-		                        closure);
</a><a href="#h1-2-198" id="h1-2-198" class="i">+	/* clean up any zombies immediately */
</a><a href="#h1-2-199" id="h1-2-199" class="i">+	sigchld(0);
</a><a href="#h1-2-200" id="h1-2-200" class="i">+	gtk_init(NULL, NULL);
</a><a href="#h1-2-201" id="h1-2-201" class="i">+
</a><a href="#h1-2-202" id="h1-2-202" class="i">+	dpy = GDK_DISPLAY_XDISPLAY(gdk_display_get_default());
</a><a href="#h1-2-203" id="h1-2-203" class="i">+
</a><a href="#h1-2-204" id="h1-2-204" class="i">+	/* atoms */
</a><a href="#h1-2-205" id="h1-2-205" class="i">+	atoms[AtomFind] = XInternAtom(dpy, &quot;_SURF_FIND&quot;, False);
</a><a href="#h1-2-206" id="h1-2-206" class="i">+	atoms[AtomGo] = XInternAtom(dpy, &quot;_SURF_GO&quot;, False);
</a><a href="#h1-2-207" id="h1-2-207" class="i">+	atoms[AtomUri] = XInternAtom(dpy, &quot;_SURF_URI&quot;, False);
</a><a href="#h1-2-208" id="h1-2-208" class="i">+
</a><a href="#h1-2-209" id="h1-2-209" class="i">+	/* dirs and files */
</a><a href="#h1-2-210" id="h1-2-210" class="i">+	cookiefile = buildfile(cookiefile);
</a><a href="#h1-2-211" id="h1-2-211" class="i">+	scriptfile = buildfile(scriptfile);
</a><a href="#h1-2-212" id="h1-2-212" class="i">+	cachedir   = buildpath(cachedir);
</a><a href="#h1-2-213" id="h1-2-213" class="i">+
</a><a href="#h1-2-214" id="h1-2-214" class="i">+	if (stylefile == NULL) {
</a><a href="#h1-2-215" id="h1-2-215" class="i">+		styledir = buildpath(styledir);
</a><a href="#h1-2-216" id="h1-2-216" class="i">+		for (i = 0; i &lt; LENGTH(styles); i++) {
</a><a href="#h1-2-217" id="h1-2-217" class="i">+			if (regcomp(&amp;(styles[i].re), styles[i].regex,
</a><a href="#h1-2-218" id="h1-2-218" class="i">+			    REG_EXTENDED)) {
</a><a href="#h1-2-219" id="h1-2-219" class="i">+				fprintf(stderr,
</a><a href="#h1-2-220" id="h1-2-220" class="i">+				        &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h1-2-221" id="h1-2-221" class="i">+				        styles[i].regex);
</a><a href="#h1-2-222" id="h1-2-222" class="i">+				styles[i].regex = NULL;
</a><a href="#h1-2-223" id="h1-2-223" class="i">+			}
</a><a href="#h1-2-224" id="h1-2-224" class="i">+			styles[i].style = g_strconcat(styledir, &quot;/&quot;,
</a><a href="#h1-2-225" id="h1-2-225" class="i">+			    styles[i].style, NULL);
</a><a href="#h1-2-226" id="h1-2-226" class="i">+		}
</a><a href="#h1-2-227" id="h1-2-227" class="i">+		g_free(styledir);
</a><a href="#h1-2-228" id="h1-2-228" class="i">+	} else {
</a><a href="#h1-2-229" id="h1-2-229" class="i">+		stylefile = buildfile(stylefile);
</a> 	}
<a href="#h1-2-231" id="h1-2-231" class="d">-	gtk_window_add_accel_group(GTK_WINDOW(c-&gt;win), group);
</a><a href="#h1-2-232" id="h1-2-232" class="i">+}
</a><a href="#h1-2-233" id="h1-2-233" class="i">+
</a><a href="#h1-2-234" id="h1-2-234" class="i">+void
</a><a href="#h1-2-235" id="h1-2-235" class="i">+sigchld(int unused)
</a><a href="#h1-2-236" id="h1-2-236" class="i">+{
</a><a href="#h1-2-237" id="h1-2-237" class="i">+	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h1-2-238" id="h1-2-238" class="i">+		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h1-2-239" id="h1-2-239" class="i">+	while (0 &lt; waitpid(-1, NULL, WNOHANG));
</a> }
 
 char *
<a href="#h1-3" id="h1-3" class="h">@@ -273,37 +324,161 @@ buildpath(const char *path)
</a> 	return fpath;
 }
 
<a href="#h1-3-3" id="h1-3-3" class="d">-gboolean
</a><a href="#h1-3-4" id="h1-3-4" class="d">-buttonreleased(GtkWidget *w, GdkEventKey *e, Client *c)
</a><a href="#h1-3-5" id="h1-3-5" class="i">+Client *
</a><a href="#h1-3-6" id="h1-3-6" class="i">+newclient(Client *rc)
</a> {
<a href="#h1-3-8" id="h1-3-8" class="d">-	WebKitHitTestResultContext element;
</a><a href="#h1-3-9" id="h1-3-9" class="d">-	GdkEventButton *eb = (GdkEventButton*)e;
</a><a href="#h1-3-10" id="h1-3-10" class="d">-	int i;
</a><a href="#h1-3-11" id="h1-3-11" class="i">+	Client *c;
</a> 
<a href="#h1-3-13" id="h1-3-13" class="d">-	element = webkit_hit_test_result_get_context(c-&gt;mousepos);
</a><a href="#h1-3-14" id="h1-3-14" class="i">+	if (!(c = calloc(1, sizeof(Client))))
</a><a href="#h1-3-15" id="h1-3-15" class="i">+		die(&quot;Cannot malloc!\n&quot;);
</a> 
<a href="#h1-3-17" id="h1-3-17" class="d">-	for (i = 0; i &lt; LENGTH(buttons); ++i) {
</a><a href="#h1-3-18" id="h1-3-18" class="d">-		if (element &amp; buttons[i].target &amp;&amp;
</a><a href="#h1-3-19" id="h1-3-19" class="d">-		    eb-&gt;button == buttons[i].button &amp;&amp;
</a><a href="#h1-3-20" id="h1-3-20" class="d">-		    CLEANMASK(eb-&gt;state) == CLEANMASK(buttons[i].mask) &amp;&amp;
</a><a href="#h1-3-21" id="h1-3-21" class="d">-		    buttons[i].func) {
</a><a href="#h1-3-22" id="h1-3-22" class="d">-			buttons[i].func(c, &amp;buttons[i].arg, c-&gt;mousepos);
</a><a href="#h1-3-23" id="h1-3-23" class="d">-			return buttons[i].stopevent;
</a><a href="#h1-3-24" id="h1-3-24" class="d">-		}
</a><a href="#h1-3-25" id="h1-3-25" class="d">-	}
</a><a href="#h1-3-26" id="h1-3-26" class="i">+	c-&gt;title = NULL;
</a><a href="#h1-3-27" id="h1-3-27" class="i">+	c-&gt;progress = 100;
</a> 
<a href="#h1-3-29" id="h1-3-29" class="d">-	return FALSE;
</a><a href="#h1-3-30" id="h1-3-30" class="i">+	c-&gt;next = clients;
</a><a href="#h1-3-31" id="h1-3-31" class="i">+	clients = c;
</a><a href="#h1-3-32" id="h1-3-32" class="i">+
</a><a href="#h1-3-33" id="h1-3-33" class="i">+	c-&gt;view = newview(c, rc ? rc-&gt;view : NULL);
</a><a href="#h1-3-34" id="h1-3-34" class="i">+	c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-3-35" id="h1-3-35" class="i">+
</a><a href="#h1-3-36" id="h1-3-36" class="i">+	return c;
</a> }
 
 void
<a href="#h1-3-40" id="h1-3-40" class="d">-cleanup(void)
</a><a href="#h1-3-41" id="h1-3-41" class="i">+addaccelgroup(Client *c)
</a> {
<a href="#h1-3-43" id="h1-3-43" class="d">-	while (clients)
</a><a href="#h1-3-44" id="h1-3-44" class="d">-		destroyclient(clients);
</a><a href="#h1-3-45" id="h1-3-45" class="d">-	g_free(cookiefile);
</a><a href="#h1-3-46" id="h1-3-46" class="d">-	g_free(scriptfile);
</a><a href="#h1-3-47" id="h1-3-47" class="d">-	g_free(stylefile);
</a><a href="#h1-3-48" id="h1-3-48" class="d">-	g_free(cachedir);
</a><a href="#h1-3-49" id="h1-3-49" class="i">+	int i;
</a><a href="#h1-3-50" id="h1-3-50" class="i">+	GtkAccelGroup *group = gtk_accel_group_new();
</a><a href="#h1-3-51" id="h1-3-51" class="i">+	GClosure *closure;
</a><a href="#h1-3-52" id="h1-3-52" class="i">+
</a><a href="#h1-3-53" id="h1-3-53" class="i">+	for (i = 0; i &lt; LENGTH(keys); i++) {
</a><a href="#h1-3-54" id="h1-3-54" class="i">+		closure = g_cclosure_new(G_CALLBACK(keypress), c, NULL);
</a><a href="#h1-3-55" id="h1-3-55" class="i">+		gtk_accel_group_connect(group, keys[i].keyval, keys[i].mod, 0,
</a><a href="#h1-3-56" id="h1-3-56" class="i">+		                        closure);
</a><a href="#h1-3-57" id="h1-3-57" class="i">+	}
</a><a href="#h1-3-58" id="h1-3-58" class="i">+	gtk_window_add_accel_group(GTK_WINDOW(c-&gt;win), group);
</a><a href="#h1-3-59" id="h1-3-59" class="i">+}
</a><a href="#h1-3-60" id="h1-3-60" class="i">+
</a><a href="#h1-3-61" id="h1-3-61" class="i">+void
</a><a href="#h1-3-62" id="h1-3-62" class="i">+loaduri(Client *c, const Arg *a)
</a><a href="#h1-3-63" id="h1-3-63" class="i">+{
</a><a href="#h1-3-64" id="h1-3-64" class="i">+	struct stat st;
</a><a href="#h1-3-65" id="h1-3-65" class="i">+	char *url, *path;
</a><a href="#h1-3-66" id="h1-3-66" class="i">+	const char *uri = (char *)a-&gt;v;
</a><a href="#h1-3-67" id="h1-3-67" class="i">+
</a><a href="#h1-3-68" id="h1-3-68" class="i">+	if (g_strcmp0(uri, &quot;&quot;) == 0)
</a><a href="#h1-3-69" id="h1-3-69" class="i">+		return;
</a><a href="#h1-3-70" id="h1-3-70" class="i">+
</a><a href="#h1-3-71" id="h1-3-71" class="i">+	if (g_strrstr(uri, &quot;://&quot;) || g_str_has_prefix(uri, &quot;about:&quot;)) {
</a><a href="#h1-3-72" id="h1-3-72" class="i">+		url = g_strdup(uri);
</a><a href="#h1-3-73" id="h1-3-73" class="i">+	} else if (!stat(uri, &amp;st) &amp;&amp; (path = realpath(uri, NULL))) {
</a><a href="#h1-3-74" id="h1-3-74" class="i">+		url = g_strdup_printf(&quot;file://%s&quot;, path);
</a><a href="#h1-3-75" id="h1-3-75" class="i">+		free(path);
</a><a href="#h1-3-76" id="h1-3-76" class="i">+	} else {
</a><a href="#h1-3-77" id="h1-3-77" class="i">+		url = g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h1-3-78" id="h1-3-78" class="i">+	}
</a><a href="#h1-3-79" id="h1-3-79" class="i">+
</a><a href="#h1-3-80" id="h1-3-80" class="i">+	setatom(c, AtomUri, url);
</a><a href="#h1-3-81" id="h1-3-81" class="i">+
</a><a href="#h1-3-82" id="h1-3-82" class="i">+	if (strcmp(url, geturi(c)) == 0) {
</a><a href="#h1-3-83" id="h1-3-83" class="i">+		reload(c, a);
</a><a href="#h1-3-84" id="h1-3-84" class="i">+	} else {
</a><a href="#h1-3-85" id="h1-3-85" class="i">+		webkit_web_view_load_uri(c-&gt;view, url);
</a><a href="#h1-3-86" id="h1-3-86" class="i">+		c-&gt;title = geturi(c);
</a><a href="#h1-3-87" id="h1-3-87" class="i">+		updatetitle(c);
</a><a href="#h1-3-88" id="h1-3-88" class="i">+	}
</a><a href="#h1-3-89" id="h1-3-89" class="i">+
</a><a href="#h1-3-90" id="h1-3-90" class="i">+	g_free(url);
</a><a href="#h1-3-91" id="h1-3-91" class="i">+}
</a><a href="#h1-3-92" id="h1-3-92" class="i">+
</a><a href="#h1-3-93" id="h1-3-93" class="i">+char *
</a><a href="#h1-3-94" id="h1-3-94" class="i">+geturi(Client *c)
</a><a href="#h1-3-95" id="h1-3-95" class="i">+{
</a><a href="#h1-3-96" id="h1-3-96" class="i">+	char *uri;
</a><a href="#h1-3-97" id="h1-3-97" class="i">+
</a><a href="#h1-3-98" id="h1-3-98" class="i">+	if (!(uri = (char *)webkit_web_view_get_uri(c-&gt;view)))
</a><a href="#h1-3-99" id="h1-3-99" class="i">+		uri = &quot;about:blank&quot;;
</a><a href="#h1-3-100" id="h1-3-100" class="i">+	return uri;
</a><a href="#h1-3-101" id="h1-3-101" class="i">+}
</a><a href="#h1-3-102" id="h1-3-102" class="i">+
</a><a href="#h1-3-103" id="h1-3-103" class="i">+void
</a><a href="#h1-3-104" id="h1-3-104" class="i">+setatom(Client *c, int a, const char *v)
</a><a href="#h1-3-105" id="h1-3-105" class="i">+{
</a><a href="#h1-3-106" id="h1-3-106" class="i">+	XSync(dpy, False);
</a><a href="#h1-3-107" id="h1-3-107" class="i">+	XChangeProperty(dpy, c-&gt;xid,
</a><a href="#h1-3-108" id="h1-3-108" class="i">+			atoms[a], XA_STRING, 8, PropModeReplace,
</a><a href="#h1-3-109" id="h1-3-109" class="i">+			(unsigned char *)v, strlen(v) + 1);
</a><a href="#h1-3-110" id="h1-3-110" class="i">+}
</a><a href="#h1-3-111" id="h1-3-111" class="i">+
</a><a href="#h1-3-112" id="h1-3-112" class="i">+const char *
</a><a href="#h1-3-113" id="h1-3-113" class="i">+getatom(Client *c, int a)
</a><a href="#h1-3-114" id="h1-3-114" class="i">+{
</a><a href="#h1-3-115" id="h1-3-115" class="i">+	static char buf[BUFSIZ];
</a><a href="#h1-3-116" id="h1-3-116" class="i">+	Atom adummy;
</a><a href="#h1-3-117" id="h1-3-117" class="i">+	int idummy;
</a><a href="#h1-3-118" id="h1-3-118" class="i">+	unsigned long ldummy;
</a><a href="#h1-3-119" id="h1-3-119" class="i">+	unsigned char *p = NULL;
</a><a href="#h1-3-120" id="h1-3-120" class="i">+
</a><a href="#h1-3-121" id="h1-3-121" class="i">+	XGetWindowProperty(dpy, c-&gt;xid,
</a><a href="#h1-3-122" id="h1-3-122" class="i">+			   atoms[a], 0L, BUFSIZ, False, XA_STRING,
</a><a href="#h1-3-123" id="h1-3-123" class="i">+			   &amp;adummy, &amp;idummy, &amp;ldummy, &amp;ldummy, &amp;p);
</a><a href="#h1-3-124" id="h1-3-124" class="i">+	if (p)
</a><a href="#h1-3-125" id="h1-3-125" class="i">+		strncpy(buf, (char *)p, LENGTH(buf)-1);
</a><a href="#h1-3-126" id="h1-3-126" class="i">+	else
</a><a href="#h1-3-127" id="h1-3-127" class="i">+		buf[0] = &#39;\0&#39;;
</a><a href="#h1-3-128" id="h1-3-128" class="i">+	XFree(p);
</a><a href="#h1-3-129" id="h1-3-129" class="i">+
</a><a href="#h1-3-130" id="h1-3-130" class="i">+	return buf;
</a><a href="#h1-3-131" id="h1-3-131" class="i">+}
</a><a href="#h1-3-132" id="h1-3-132" class="i">+
</a><a href="#h1-3-133" id="h1-3-133" class="i">+void
</a><a href="#h1-3-134" id="h1-3-134" class="i">+updatetitle(Client *c)
</a><a href="#h1-3-135" id="h1-3-135" class="i">+{
</a><a href="#h1-3-136" id="h1-3-136" class="i">+	char *title;
</a><a href="#h1-3-137" id="h1-3-137" class="i">+
</a><a href="#h1-3-138" id="h1-3-138" class="i">+	if (showindicators) {
</a><a href="#h1-3-139" id="h1-3-139" class="i">+		gettogglestats(c);
</a><a href="#h1-3-140" id="h1-3-140" class="i">+		getpagestats(c);
</a><a href="#h1-3-141" id="h1-3-141" class="i">+
</a><a href="#h1-3-142" id="h1-3-142" class="i">+		if (c-&gt;progress != 100) {
</a><a href="#h1-3-143" id="h1-3-143" class="i">+			title = g_strdup_printf(&quot;[%i%%] %s:%s | %s&quot;,
</a><a href="#h1-3-144" id="h1-3-144" class="i">+			    c-&gt;progress, togglestats, pagestats,
</a><a href="#h1-3-145" id="h1-3-145" class="i">+			    c-&gt;targeturi ? c-&gt;targeturi : c-&gt;title);
</a><a href="#h1-3-146" id="h1-3-146" class="i">+		} else {
</a><a href="#h1-3-147" id="h1-3-147" class="i">+			title = g_strdup_printf(&quot;%s:%s | %s&quot;,
</a><a href="#h1-3-148" id="h1-3-148" class="i">+			    togglestats, pagestats,
</a><a href="#h1-3-149" id="h1-3-149" class="i">+			    c-&gt;targeturi ? c-&gt;targeturi : c-&gt;title);
</a><a href="#h1-3-150" id="h1-3-150" class="i">+		}
</a><a href="#h1-3-151" id="h1-3-151" class="i">+
</a><a href="#h1-3-152" id="h1-3-152" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), title);
</a><a href="#h1-3-153" id="h1-3-153" class="i">+		g_free(title);
</a><a href="#h1-3-154" id="h1-3-154" class="i">+	} else {
</a><a href="#h1-3-155" id="h1-3-155" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), c-&gt;title ?
</a><a href="#h1-3-156" id="h1-3-156" class="i">+		    c-&gt;title : &quot;&quot;);
</a><a href="#h1-3-157" id="h1-3-157" class="i">+	}
</a><a href="#h1-3-158" id="h1-3-158" class="i">+}
</a><a href="#h1-3-159" id="h1-3-159" class="i">+
</a><a href="#h1-3-160" id="h1-3-160" class="i">+void
</a><a href="#h1-3-161" id="h1-3-161" class="i">+gettogglestats(Client *c)
</a><a href="#h1-3-162" id="h1-3-162" class="i">+{
</a><a href="#h1-3-163" id="h1-3-163" class="i">+	togglestats[0] = cookiepolicy_set(cookiepolicy_get());
</a><a href="#h1-3-164" id="h1-3-164" class="i">+	togglestats[1] = enablecaretbrowsing ? &#39;C&#39; : &#39;c&#39;;
</a><a href="#h1-3-165" id="h1-3-165" class="i">+	togglestats[2] = allowgeolocation ? &#39;G&#39; : &#39;g&#39;;
</a><a href="#h1-3-166" id="h1-3-166" class="i">+	togglestats[3] = enablecache ? &#39;D&#39; : &#39;d&#39;;
</a><a href="#h1-3-167" id="h1-3-167" class="i">+	togglestats[4] = loadimages ? &#39;I&#39; : &#39;i&#39;;
</a><a href="#h1-3-168" id="h1-3-168" class="i">+	togglestats[5] = enablescripts ? &#39;S&#39;: &#39;s&#39;;
</a><a href="#h1-3-169" id="h1-3-169" class="i">+	togglestats[6] = enableplugins ? &#39;V&#39; : &#39;v&#39;;
</a><a href="#h1-3-170" id="h1-3-170" class="i">+	togglestats[7] = enablestyle ? &#39;M&#39; : &#39;m&#39;;
</a><a href="#h1-3-171" id="h1-3-171" class="i">+	togglestats[8] = enableframeflattening ? &#39;F&#39; : &#39;f&#39;;
</a><a href="#h1-3-172" id="h1-3-172" class="i">+	togglestats[9] = &#39;\0&#39;;
</a><a href="#h1-3-173" id="h1-3-173" class="i">+}
</a><a href="#h1-3-174" id="h1-3-174" class="i">+
</a><a href="#h1-3-175" id="h1-3-175" class="i">+void
</a><a href="#h1-3-176" id="h1-3-176" class="i">+getpagestats(Client *c)
</a><a href="#h1-3-177" id="h1-3-177" class="i">+{
</a><a href="#h1-3-178" id="h1-3-178" class="i">+	pagestats[0] = c-&gt;tlsflags &gt; G_TLS_CERTIFICATE_VALIDATE_ALL ? &#39;-&#39; :
</a><a href="#h1-3-179" id="h1-3-179" class="i">+	    c-&gt;tlsflags &gt; 0 ? &#39;U&#39; : &#39;T&#39;;
</a><a href="#h1-3-180" id="h1-3-180" class="i">+	pagestats[1] = &#39;\0&#39;;
</a> }
 
 WebKitCookieAcceptPolicy
<a href="#h1-4" id="h1-4" class="h">@@ -338,18 +513,41 @@ cookiepolicy_set(const WebKitCookieAcceptPolicy ep)
</a> 	return &#39;A&#39;;
 }
 
<a href="#h1-4-3" id="h1-4-3" class="i">+const gchar *
</a><a href="#h1-4-4" id="h1-4-4" class="i">+getstyle(const char *uri)
</a><a href="#h1-4-5" id="h1-4-5" class="i">+{
</a><a href="#h1-4-6" id="h1-4-6" class="i">+	int i;
</a><a href="#h1-4-7" id="h1-4-7" class="i">+
</a><a href="#h1-4-8" id="h1-4-8" class="i">+	if (stylefile != NULL)
</a><a href="#h1-4-9" id="h1-4-9" class="i">+		return stylefile;
</a><a href="#h1-4-10" id="h1-4-10" class="i">+
</a><a href="#h1-4-11" id="h1-4-11" class="i">+	for (i = 0; i &lt; LENGTH(styles); i++) {
</a><a href="#h1-4-12" id="h1-4-12" class="i">+		if (styles[i].regex &amp;&amp; !regexec(&amp;(styles[i].re), uri, 0,
</a><a href="#h1-4-13" id="h1-4-13" class="i">+		    NULL, 0))
</a><a href="#h1-4-14" id="h1-4-14" class="i">+			return styles[i].style;
</a><a href="#h1-4-15" id="h1-4-15" class="i">+	}
</a><a href="#h1-4-16" id="h1-4-16" class="i">+
</a><a href="#h1-4-17" id="h1-4-17" class="i">+	return &quot;&quot;;
</a><a href="#h1-4-18" id="h1-4-18" class="i">+}
</a><a href="#h1-4-19" id="h1-4-19" class="i">+
</a> void
<a href="#h1-4-21" id="h1-4-21" class="d">-evalscript(Client *c, const char *jsstr, ...)
</a><a href="#h1-4-22" id="h1-4-22" class="i">+setstyle(Client *c, const char *stylefile)
</a> {
<a href="#h1-4-24" id="h1-4-24" class="d">-	va_list ap;
</a><a href="#h1-4-25" id="h1-4-25" class="d">-	gchar *script;
</a><a href="#h1-4-26" id="h1-4-26" class="i">+	gchar *style;
</a> 
<a href="#h1-4-28" id="h1-4-28" class="d">-	va_start(ap, jsstr);
</a><a href="#h1-4-29" id="h1-4-29" class="d">-	script = g_strdup_vprintf(jsstr, ap);
</a><a href="#h1-4-30" id="h1-4-30" class="d">-	va_end(ap);
</a><a href="#h1-4-31" id="h1-4-31" class="i">+	if (!g_file_get_contents(stylefile, &amp;style, NULL, NULL)) {
</a><a href="#h1-4-32" id="h1-4-32" class="i">+		fprintf(stderr, &quot;Could not read style file: %s\n&quot;, stylefile);
</a><a href="#h1-4-33" id="h1-4-33" class="i">+		return;
</a><a href="#h1-4-34" id="h1-4-34" class="i">+	}
</a> 
<a href="#h1-4-36" id="h1-4-36" class="d">-	webkit_web_view_run_javascript(c-&gt;view, script, NULL, NULL, NULL);
</a><a href="#h1-4-37" id="h1-4-37" class="d">-	g_free(script);
</a><a href="#h1-4-38" id="h1-4-38" class="i">+	webkit_user_content_manager_add_style_sheet(
</a><a href="#h1-4-39" id="h1-4-39" class="i">+	    webkit_web_view_get_user_content_manager(c-&gt;view),
</a><a href="#h1-4-40" id="h1-4-40" class="i">+	    webkit_user_style_sheet_new(style,
</a><a href="#h1-4-41" id="h1-4-41" class="i">+	    WEBKIT_USER_CONTENT_INJECT_ALL_FRAMES,
</a><a href="#h1-4-42" id="h1-4-42" class="i">+	    WEBKIT_USER_STYLE_LEVEL_USER,
</a><a href="#h1-4-43" id="h1-4-43" class="i">+	    NULL, NULL));
</a><a href="#h1-4-44" id="h1-4-44" class="i">+
</a><a href="#h1-4-45" id="h1-4-45" class="i">+	g_free(style);
</a> }
 
 void
<a href="#h1-5" id="h1-5" class="h">@@ -364,517 +562,129 @@ runscript(Client *c)
</a> }
 
 void
<a href="#h1-5-3" id="h1-5-3" class="d">-clipboard(Client *c, const Arg *a)
</a><a href="#h1-5-4" id="h1-5-4" class="d">-{
</a><a href="#h1-5-5" id="h1-5-5" class="d">-	if (a-&gt;b) { /* load clipboard uri */
</a><a href="#h1-5-6" id="h1-5-6" class="d">-		gtk_clipboard_request_text(gtk_clipboard_get(
</a><a href="#h1-5-7" id="h1-5-7" class="d">-		                           GDK_SELECTION_PRIMARY),
</a><a href="#h1-5-8" id="h1-5-8" class="d">-		                           pasteuri, c);
</a><a href="#h1-5-9" id="h1-5-9" class="d">-	} else { /* copy uri */
</a><a href="#h1-5-10" id="h1-5-10" class="d">-		gtk_clipboard_set_text(gtk_clipboard_get(
</a><a href="#h1-5-11" id="h1-5-11" class="d">-		                       GDK_SELECTION_PRIMARY), c-&gt;targeturi
</a><a href="#h1-5-12" id="h1-5-12" class="d">-		                       ? c-&gt;targeturi : geturi(c), -1);
</a><a href="#h1-5-13" id="h1-5-13" class="d">-	}
</a><a href="#h1-5-14" id="h1-5-14" class="d">-}
</a><a href="#h1-5-15" id="h1-5-15" class="d">-
</a><a href="#h1-5-16" id="h1-5-16" class="d">-GtkWidget *
</a><a href="#h1-5-17" id="h1-5-17" class="d">-createview(WebKitWebView *v, WebKitNavigationAction *a, Client *c)
</a><a href="#h1-5-18" id="h1-5-18" class="i">+evalscript(Client *c, const char *jsstr, ...)
</a> {
<a href="#h1-5-20" id="h1-5-20" class="d">-	Client *n;
</a><a href="#h1-5-21" id="h1-5-21" class="i">+	va_list ap;
</a><a href="#h1-5-22" id="h1-5-22" class="i">+	gchar *script;
</a> 
<a href="#h1-5-24" id="h1-5-24" class="d">-	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-5-25" id="h1-5-25" class="d">-	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-5-26" id="h1-5-26" class="d">-		/*
</a><a href="#h1-5-27" id="h1-5-27" class="d">-		 * popup windows of type “other” are almost always triggered
</a><a href="#h1-5-28" id="h1-5-28" class="d">-		 * by user gesture, so inverse the logic here
</a><a href="#h1-5-29" id="h1-5-29" class="d">-		 */
</a><a href="#h1-5-30" id="h1-5-30" class="d">-/* instead of this, compare destination uri to mouse-over uri for validating window */
</a><a href="#h1-5-31" id="h1-5-31" class="d">-		if (webkit_navigation_action_is_user_gesture(a)) {
</a><a href="#h1-5-32" id="h1-5-32" class="d">-			return NULL;
</a><a href="#h1-5-33" id="h1-5-33" class="d">-			break;
</a><a href="#h1-5-34" id="h1-5-34" class="d">-		}
</a><a href="#h1-5-35" id="h1-5-35" class="d">-	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-5-36" id="h1-5-36" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-5-37" id="h1-5-37" class="d">-	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-5-38" id="h1-5-38" class="d">-	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-5-39" id="h1-5-39" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-5-40" id="h1-5-40" class="d">-		n = newclient(c);
</a><a href="#h1-5-41" id="h1-5-41" class="d">-		break;
</a><a href="#h1-5-42" id="h1-5-42" class="d">-	default:
</a><a href="#h1-5-43" id="h1-5-43" class="d">-		return NULL;
</a><a href="#h1-5-44" id="h1-5-44" class="d">-		break;
</a><a href="#h1-5-45" id="h1-5-45" class="d">-	}
</a><a href="#h1-5-46" id="h1-5-46" class="i">+	va_start(ap, jsstr);
</a><a href="#h1-5-47" id="h1-5-47" class="i">+	script = g_strdup_vprintf(jsstr, ap);
</a><a href="#h1-5-48" id="h1-5-48" class="i">+	va_end(ap);
</a> 
<a href="#h1-5-50" id="h1-5-50" class="d">-	return GTK_WIDGET(n-&gt;view);
</a><a href="#h1-5-51" id="h1-5-51" class="i">+	webkit_web_view_run_javascript(c-&gt;view, script, NULL, NULL, NULL);
</a><a href="#h1-5-52" id="h1-5-52" class="i">+	g_free(script);
</a> }
 
<a href="#h1-5-55" id="h1-5-55" class="d">-gboolean
</a><a href="#h1-5-56" id="h1-5-56" class="d">-decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h1-5-57" id="h1-5-57" class="d">-    WebKitPolicyDecisionType dt, Client *c)
</a><a href="#h1-5-58" id="h1-5-58" class="i">+void
</a><a href="#h1-5-59" id="h1-5-59" class="i">+updatewinid(Client *c)
</a> {
<a href="#h1-5-61" id="h1-5-61" class="d">-	switch (dt) {
</a><a href="#h1-5-62" id="h1-5-62" class="d">-	case WEBKIT_POLICY_DECISION_TYPE_NAVIGATION_ACTION:
</a><a href="#h1-5-63" id="h1-5-63" class="d">-		decidenavigation(d, c);
</a><a href="#h1-5-64" id="h1-5-64" class="d">-		break;
</a><a href="#h1-5-65" id="h1-5-65" class="d">-	case WEBKIT_POLICY_DECISION_TYPE_NEW_WINDOW_ACTION:
</a><a href="#h1-5-66" id="h1-5-66" class="d">-		decidenewwindow(d, c);
</a><a href="#h1-5-67" id="h1-5-67" class="d">-		break;
</a><a href="#h1-5-68" id="h1-5-68" class="d">-	case WEBKIT_POLICY_DECISION_TYPE_RESPONSE:
</a><a href="#h1-5-69" id="h1-5-69" class="d">-		decideresource(d, c);
</a><a href="#h1-5-70" id="h1-5-70" class="d">-		break;
</a><a href="#h1-5-71" id="h1-5-71" class="d">-	default:
</a><a href="#h1-5-72" id="h1-5-72" class="d">-		webkit_policy_decision_ignore(d);
</a><a href="#h1-5-73" id="h1-5-73" class="d">-		break;
</a><a href="#h1-5-74" id="h1-5-74" class="d">-	}
</a><a href="#h1-5-75" id="h1-5-75" class="d">-	return TRUE;
</a><a href="#h1-5-76" id="h1-5-76" class="i">+	snprintf(winid, LENGTH(winid), &quot;%lu&quot;, c-&gt;xid);
</a> }
 
 void
<a href="#h1-5-80" id="h1-5-80" class="d">-decidenavigation(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-5-81" id="h1-5-81" class="i">+handleplumb(Client *c, const gchar *uri)
</a> {
<a href="#h1-5-83" id="h1-5-83" class="d">-	WebKitNavigationAction *a;
</a><a href="#h1-5-84" id="h1-5-84" class="i">+	Arg arg;
</a> 
<a href="#h1-5-86" id="h1-5-86" class="d">-	a = webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h1-5-87" id="h1-5-87" class="d">-	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h1-5-88" id="h1-5-88" class="d">-
</a><a href="#h1-5-89" id="h1-5-89" class="d">-	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-5-90" id="h1-5-90" class="d">-	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-5-91" id="h1-5-91" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-5-92" id="h1-5-92" class="d">-	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-5-93" id="h1-5-93" class="d">-	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-5-94" id="h1-5-94" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-5-95" id="h1-5-95" class="d">-	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-5-96" id="h1-5-96" class="d">-	default:
</a><a href="#h1-5-97" id="h1-5-97" class="d">-		/* Do not navigate to links with a &quot;_blank&quot; target (popup) */
</a><a href="#h1-5-98" id="h1-5-98" class="d">-		if (webkit_navigation_policy_decision_get_frame_name(
</a><a href="#h1-5-99" id="h1-5-99" class="d">-		    WEBKIT_NAVIGATION_POLICY_DECISION(d))) {
</a><a href="#h1-5-100" id="h1-5-100" class="d">-			webkit_policy_decision_ignore(d);
</a><a href="#h1-5-101" id="h1-5-101" class="d">-		} else {
</a><a href="#h1-5-102" id="h1-5-102" class="d">-			/* Filter out navigation to different domain ? */
</a><a href="#h1-5-103" id="h1-5-103" class="d">-			/* get action→urirequest, copy and load in new window+view
</a><a href="#h1-5-104" id="h1-5-104" class="d">-			 * on Ctrl+Click ? */
</a><a href="#h1-5-105" id="h1-5-105" class="d">-			webkit_policy_decision_use(d);
</a><a href="#h1-5-106" id="h1-5-106" class="d">-		}
</a><a href="#h1-5-107" id="h1-5-107" class="d">-		break;
</a><a href="#h1-5-108" id="h1-5-108" class="d">-	}
</a><a href="#h1-5-109" id="h1-5-109" class="d">-}
</a><a href="#h1-5-110" id="h1-5-110" class="d">-
</a><a href="#h1-5-111" id="h1-5-111" class="d">-void
</a><a href="#h1-5-112" id="h1-5-112" class="d">-decidenewwindow(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-5-113" id="h1-5-113" class="d">-{
</a><a href="#h1-5-114" id="h1-5-114" class="d">-	WebKitNavigationAction *a;
</a><a href="#h1-5-115" id="h1-5-115" class="d">-	Arg arg;
</a><a href="#h1-5-116" id="h1-5-116" class="d">-
</a><a href="#h1-5-117" id="h1-5-117" class="d">-	a = webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h1-5-118" id="h1-5-118" class="d">-	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h1-5-119" id="h1-5-119" class="d">-
</a><a href="#h1-5-120" id="h1-5-120" class="d">-	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-5-121" id="h1-5-121" class="d">-	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-5-122" id="h1-5-122" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-5-123" id="h1-5-123" class="d">-	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-5-124" id="h1-5-124" class="d">-	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-5-125" id="h1-5-125" class="d">-	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-5-126" id="h1-5-126" class="d">-		/* Filter domains here */
</a><a href="#h1-5-127" id="h1-5-127" class="d">-/* If the value of “mouse-button” is not 0, then the navigation was triggered by a mouse event.
</a><a href="#h1-5-128" id="h1-5-128" class="d">- * test for link clicked but no button ? */
</a><a href="#h1-5-129" id="h1-5-129" class="d">-		arg.v = webkit_uri_request_get_uri(
</a><a href="#h1-5-130" id="h1-5-130" class="d">-		    webkit_navigation_action_get_request(a));
</a><a href="#h1-5-131" id="h1-5-131" class="d">-		newwindow(c, &amp;arg, 0);
</a><a href="#h1-5-132" id="h1-5-132" class="d">-		break;
</a><a href="#h1-5-133" id="h1-5-133" class="d">-	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-5-134" id="h1-5-134" class="d">-	default:
</a><a href="#h1-5-135" id="h1-5-135" class="d">-		break;
</a><a href="#h1-5-136" id="h1-5-136" class="d">-	}
</a><a href="#h1-5-137" id="h1-5-137" class="d">-
</a><a href="#h1-5-138" id="h1-5-138" class="d">-	webkit_policy_decision_ignore(d);
</a><a href="#h1-5-139" id="h1-5-139" class="d">-}
</a><a href="#h1-5-140" id="h1-5-140" class="d">-
</a><a href="#h1-5-141" id="h1-5-141" class="d">-void
</a><a href="#h1-5-142" id="h1-5-142" class="d">-decideresource(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-5-143" id="h1-5-143" class="d">-{
</a><a href="#h1-5-144" id="h1-5-144" class="d">-	const gchar *uri;
</a><a href="#h1-5-145" id="h1-5-145" class="d">-	int i, isascii = 1;
</a><a href="#h1-5-146" id="h1-5-146" class="d">-	WebKitResponsePolicyDecision *r = WEBKIT_RESPONSE_POLICY_DECISION(d);
</a><a href="#h1-5-147" id="h1-5-147" class="d">-	WebKitURIResponse *res;
</a><a href="#h1-5-148" id="h1-5-148" class="d">-
</a><a href="#h1-5-149" id="h1-5-149" class="d">-	res = webkit_response_policy_decision_get_response(r);
</a><a href="#h1-5-150" id="h1-5-150" class="d">-	uri = webkit_uri_response_get_uri(res);
</a><a href="#h1-5-151" id="h1-5-151" class="d">-
</a><a href="#h1-5-152" id="h1-5-152" class="d">-	if (g_str_has_suffix(uri, &quot;/favicon.ico&quot;))
</a><a href="#h1-5-153" id="h1-5-153" class="d">-		webkit_uri_request_set_uri(
</a><a href="#h1-5-154" id="h1-5-154" class="d">-		    webkit_response_policy_decision_get_request(r),
</a><a href="#h1-5-155" id="h1-5-155" class="d">-		    &quot;about:blank&quot;);
</a><a href="#h1-5-156" id="h1-5-156" class="d">-
</a><a href="#h1-5-157" id="h1-5-157" class="d">-	if (!g_str_has_prefix(uri, &quot;http://&quot;)
</a><a href="#h1-5-158" id="h1-5-158" class="d">-	    &amp;&amp; !g_str_has_prefix(uri, &quot;https://&quot;)
</a><a href="#h1-5-159" id="h1-5-159" class="d">-	    &amp;&amp; !g_str_has_prefix(uri, &quot;about:&quot;)
</a><a href="#h1-5-160" id="h1-5-160" class="d">-	    &amp;&amp; !g_str_has_prefix(uri, &quot;file://&quot;)
</a><a href="#h1-5-161" id="h1-5-161" class="d">-	    &amp;&amp; !g_str_has_prefix(uri, &quot;data:&quot;)
</a><a href="#h1-5-162" id="h1-5-162" class="d">-	    &amp;&amp; !g_str_has_prefix(uri, &quot;blob:&quot;)
</a><a href="#h1-5-163" id="h1-5-163" class="d">-	    &amp;&amp; strlen(uri) &gt; 0) {
</a><a href="#h1-5-164" id="h1-5-164" class="d">-		for (i = 0; i &lt; strlen(uri); i++) {
</a><a href="#h1-5-165" id="h1-5-165" class="d">-			if (!g_ascii_isprint(uri[i])) {
</a><a href="#h1-5-166" id="h1-5-166" class="d">-				isascii = 0;
</a><a href="#h1-5-167" id="h1-5-167" class="d">-				break;
</a><a href="#h1-5-168" id="h1-5-168" class="d">-			}
</a><a href="#h1-5-169" id="h1-5-169" class="d">-		}
</a><a href="#h1-5-170" id="h1-5-170" class="d">-		if (isascii) {
</a><a href="#h1-5-171" id="h1-5-171" class="d">-			handleplumb(c, uri);
</a><a href="#h1-5-172" id="h1-5-172" class="d">-			webkit_policy_decision_ignore(d);
</a><a href="#h1-5-173" id="h1-5-173" class="d">-		}
</a><a href="#h1-5-174" id="h1-5-174" class="d">-	}
</a><a href="#h1-5-175" id="h1-5-175" class="d">-
</a><a href="#h1-5-176" id="h1-5-176" class="d">-	if (webkit_response_policy_decision_is_mime_type_supported(r)) {
</a><a href="#h1-5-177" id="h1-5-177" class="d">-		webkit_policy_decision_use(d);
</a><a href="#h1-5-178" id="h1-5-178" class="d">-	} else {
</a><a href="#h1-5-179" id="h1-5-179" class="d">-		webkit_policy_decision_ignore(d);
</a><a href="#h1-5-180" id="h1-5-180" class="d">-		download(c, res);
</a><a href="#h1-5-181" id="h1-5-181" class="d">-	}
</a><a href="#h1-5-182" id="h1-5-182" class="d">-}
</a><a href="#h1-5-183" id="h1-5-183" class="d">-
</a><a href="#h1-5-184" id="h1-5-184" class="d">-void
</a><a href="#h1-5-185" id="h1-5-185" class="d">-destroyclient(Client *c)
</a><a href="#h1-5-186" id="h1-5-186" class="d">-{
</a><a href="#h1-5-187" id="h1-5-187" class="d">-	Client *p;
</a><a href="#h1-5-188" id="h1-5-188" class="d">-
</a><a href="#h1-5-189" id="h1-5-189" class="d">-	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h1-5-190" id="h1-5-190" class="d">-	/* Not needed, has already been called
</a><a href="#h1-5-191" id="h1-5-191" class="d">-	gtk_widget_destroy(c-&gt;win);
</a><a href="#h1-5-192" id="h1-5-192" class="d">-	 */
</a><a href="#h1-5-193" id="h1-5-193" class="d">-
</a><a href="#h1-5-194" id="h1-5-194" class="d">-	for (p = clients; p &amp;&amp; p-&gt;next != c; p = p-&gt;next)
</a><a href="#h1-5-195" id="h1-5-195" class="d">-		;
</a><a href="#h1-5-196" id="h1-5-196" class="d">-	if (p)
</a><a href="#h1-5-197" id="h1-5-197" class="d">-		p-&gt;next = c-&gt;next;
</a><a href="#h1-5-198" id="h1-5-198" class="d">-	else
</a><a href="#h1-5-199" id="h1-5-199" class="d">-		clients = c-&gt;next;
</a><a href="#h1-5-200" id="h1-5-200" class="d">-	free(c);
</a><a href="#h1-5-201" id="h1-5-201" class="d">-}
</a><a href="#h1-5-202" id="h1-5-202" class="d">-
</a><a href="#h1-5-203" id="h1-5-203" class="d">-void
</a><a href="#h1-5-204" id="h1-5-204" class="d">-closeview(WebKitWebView *v, Client *c)
</a><a href="#h1-5-205" id="h1-5-205" class="d">-{
</a><a href="#h1-5-206" id="h1-5-206" class="d">-	gtk_widget_destroy(c-&gt;win);
</a><a href="#h1-5-207" id="h1-5-207" class="d">-}
</a><a href="#h1-5-208" id="h1-5-208" class="d">-
</a><a href="#h1-5-209" id="h1-5-209" class="d">-void
</a><a href="#h1-5-210" id="h1-5-210" class="d">-destroywin(GtkWidget* w, Client *c)
</a><a href="#h1-5-211" id="h1-5-211" class="d">-{
</a><a href="#h1-5-212" id="h1-5-212" class="d">-	destroyclient(c);
</a><a href="#h1-5-213" id="h1-5-213" class="d">-	if (clients == NULL)
</a><a href="#h1-5-214" id="h1-5-214" class="d">-		gtk_main_quit();
</a><a href="#h1-5-215" id="h1-5-215" class="d">-}
</a><a href="#h1-5-216" id="h1-5-216" class="d">-
</a><a href="#h1-5-217" id="h1-5-217" class="d">-void
</a><a href="#h1-5-218" id="h1-5-218" class="d">-die(const char *errstr, ...)
</a><a href="#h1-5-219" id="h1-5-219" class="d">-{
</a><a href="#h1-5-220" id="h1-5-220" class="d">-	va_list ap;
</a><a href="#h1-5-221" id="h1-5-221" class="d">-
</a><a href="#h1-5-222" id="h1-5-222" class="d">-	va_start(ap, errstr);
</a><a href="#h1-5-223" id="h1-5-223" class="d">-	vfprintf(stderr, errstr, ap);
</a><a href="#h1-5-224" id="h1-5-224" class="d">-	va_end(ap);
</a><a href="#h1-5-225" id="h1-5-225" class="d">-	exit(EXIT_FAILURE);
</a><a href="#h1-5-226" id="h1-5-226" class="d">-}
</a><a href="#h1-5-227" id="h1-5-227" class="d">-
</a><a href="#h1-5-228" id="h1-5-228" class="d">-void
</a><a href="#h1-5-229" id="h1-5-229" class="d">-find(Client *c, const Arg *a)
</a><a href="#h1-5-230" id="h1-5-230" class="d">-{
</a><a href="#h1-5-231" id="h1-5-231" class="d">-	const char *s, *f;
</a><a href="#h1-5-232" id="h1-5-232" class="d">-
</a><a href="#h1-5-233" id="h1-5-233" class="d">-	if (a &amp;&amp; a-&gt;i) {
</a><a href="#h1-5-234" id="h1-5-234" class="d">-		if (a-&gt;i &gt; 0)
</a><a href="#h1-5-235" id="h1-5-235" class="d">-			webkit_find_controller_search_next(c-&gt;finder);
</a><a href="#h1-5-236" id="h1-5-236" class="d">-		else
</a><a href="#h1-5-237" id="h1-5-237" class="d">-			webkit_find_controller_search_previous(c-&gt;finder);
</a><a href="#h1-5-238" id="h1-5-238" class="d">-	} else {
</a><a href="#h1-5-239" id="h1-5-239" class="d">-		s = getatom(c, AtomFind);
</a><a href="#h1-5-240" id="h1-5-240" class="d">-		f = webkit_find_controller_get_search_text(c-&gt;finder);
</a><a href="#h1-5-241" id="h1-5-241" class="d">-
</a><a href="#h1-5-242" id="h1-5-242" class="d">-		if (g_strcmp0(f, s) == 0) /* reset search */
</a><a href="#h1-5-243" id="h1-5-243" class="d">-			webkit_find_controller_search(c-&gt;finder, &quot;&quot;, findopts, G_MAXUINT);
</a><a href="#h1-5-244" id="h1-5-244" class="d">-
</a><a href="#h1-5-245" id="h1-5-245" class="d">-		webkit_find_controller_search(c-&gt;finder, s, findopts, G_MAXUINT);
</a><a href="#h1-5-246" id="h1-5-246" class="d">-
</a><a href="#h1-5-247" id="h1-5-247" class="d">-		if (strcmp(s, &quot;&quot;) == 0)
</a><a href="#h1-5-248" id="h1-5-248" class="d">-			webkit_find_controller_search_finish(c-&gt;finder);
</a><a href="#h1-5-249" id="h1-5-249" class="d">-	}
</a><a href="#h1-5-250" id="h1-5-250" class="d">-}
</a><a href="#h1-5-251" id="h1-5-251" class="d">-
</a><a href="#h1-5-252" id="h1-5-252" class="d">-void
</a><a href="#h1-5-253" id="h1-5-253" class="d">-togglefullscreen(Client *c, const Arg *a)
</a><a href="#h1-5-254" id="h1-5-254" class="d">-{
</a><a href="#h1-5-255" id="h1-5-255" class="d">-	/* toggling value is handled in winevent() */
</a><a href="#h1-5-256" id="h1-5-256" class="d">-	if (c-&gt;fullscreen)
</a><a href="#h1-5-257" id="h1-5-257" class="d">-		gtk_window_unfullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h1-5-258" id="h1-5-258" class="d">-	else
</a><a href="#h1-5-259" id="h1-5-259" class="d">-		gtk_window_fullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h1-5-260" id="h1-5-260" class="d">-}
</a><a href="#h1-5-261" id="h1-5-261" class="d">-
</a><a href="#h1-5-262" id="h1-5-262" class="d">-gboolean
</a><a href="#h1-5-263" id="h1-5-263" class="d">-permissionrequested(WebKitWebView *v, WebKitPermissionRequest *r, Client *c)
</a><a href="#h1-5-264" id="h1-5-264" class="d">-{
</a><a href="#h1-5-265" id="h1-5-265" class="d">-	if (WEBKIT_IS_GEOLOCATION_PERMISSION_REQUEST(r)) {
</a><a href="#h1-5-266" id="h1-5-266" class="d">-		if (allowgeolocation)
</a><a href="#h1-5-267" id="h1-5-267" class="d">-			webkit_permission_request_allow(r);
</a><a href="#h1-5-268" id="h1-5-268" class="d">-		else
</a><a href="#h1-5-269" id="h1-5-269" class="d">-			webkit_permission_request_deny(r);
</a><a href="#h1-5-270" id="h1-5-270" class="d">-		return TRUE;
</a><a href="#h1-5-271" id="h1-5-271" class="d">-	}
</a><a href="#h1-5-272" id="h1-5-272" class="d">-
</a><a href="#h1-5-273" id="h1-5-273" class="d">-	return FALSE;
</a><a href="#h1-5-274" id="h1-5-274" class="d">-}
</a><a href="#h1-5-275" id="h1-5-275" class="d">-
</a><a href="#h1-5-276" id="h1-5-276" class="d">-const char *
</a><a href="#h1-5-277" id="h1-5-277" class="d">-getatom(Client *c, int a)
</a><a href="#h1-5-278" id="h1-5-278" class="d">-{
</a><a href="#h1-5-279" id="h1-5-279" class="d">-	static char buf[BUFSIZ];
</a><a href="#h1-5-280" id="h1-5-280" class="d">-	Atom adummy;
</a><a href="#h1-5-281" id="h1-5-281" class="d">-	int idummy;
</a><a href="#h1-5-282" id="h1-5-282" class="d">-	unsigned long ldummy;
</a><a href="#h1-5-283" id="h1-5-283" class="d">-	unsigned char *p = NULL;
</a><a href="#h1-5-284" id="h1-5-284" class="d">-
</a><a href="#h1-5-285" id="h1-5-285" class="d">-	XGetWindowProperty(dpy, c-&gt;xid,
</a><a href="#h1-5-286" id="h1-5-286" class="d">-			   atoms[a], 0L, BUFSIZ, False, XA_STRING,
</a><a href="#h1-5-287" id="h1-5-287" class="d">-			   &amp;adummy, &amp;idummy, &amp;ldummy, &amp;ldummy, &amp;p);
</a><a href="#h1-5-288" id="h1-5-288" class="d">-	if (p)
</a><a href="#h1-5-289" id="h1-5-289" class="d">-		strncpy(buf, (char *)p, LENGTH(buf)-1);
</a><a href="#h1-5-290" id="h1-5-290" class="d">-	else
</a><a href="#h1-5-291" id="h1-5-291" class="d">-		buf[0] = &#39;\0&#39;;
</a><a href="#h1-5-292" id="h1-5-292" class="d">-	XFree(p);
</a><a href="#h1-5-293" id="h1-5-293" class="d">-
</a><a href="#h1-5-294" id="h1-5-294" class="d">-	return buf;
</a><a href="#h1-5-295" id="h1-5-295" class="d">-}
</a><a href="#h1-5-296" id="h1-5-296" class="d">-
</a><a href="#h1-5-297" id="h1-5-297" class="d">-char *
</a><a href="#h1-5-298" id="h1-5-298" class="d">-geturi(Client *c)
</a><a href="#h1-5-299" id="h1-5-299" class="d">-{
</a><a href="#h1-5-300" id="h1-5-300" class="d">-	char *uri;
</a><a href="#h1-5-301" id="h1-5-301" class="d">-
</a><a href="#h1-5-302" id="h1-5-302" class="d">-	if (!(uri = (char *)webkit_web_view_get_uri(c-&gt;view)))
</a><a href="#h1-5-303" id="h1-5-303" class="d">-		uri = &quot;about:blank&quot;;
</a><a href="#h1-5-304" id="h1-5-304" class="d">-	return uri;
</a><a href="#h1-5-305" id="h1-5-305" class="d">-}
</a><a href="#h1-5-306" id="h1-5-306" class="d">-
</a><a href="#h1-5-307" id="h1-5-307" class="d">-const gchar *
</a><a href="#h1-5-308" id="h1-5-308" class="d">-getstyle(const char *uri)
</a><a href="#h1-5-309" id="h1-5-309" class="d">-{
</a><a href="#h1-5-310" id="h1-5-310" class="d">-	int i;
</a><a href="#h1-5-311" id="h1-5-311" class="d">-
</a><a href="#h1-5-312" id="h1-5-312" class="d">-	if (stylefile != NULL)
</a><a href="#h1-5-313" id="h1-5-313" class="d">-		return stylefile;
</a><a href="#h1-5-314" id="h1-5-314" class="d">-
</a><a href="#h1-5-315" id="h1-5-315" class="d">-	for (i = 0; i &lt; LENGTH(styles); i++) {
</a><a href="#h1-5-316" id="h1-5-316" class="d">-		if (styles[i].regex &amp;&amp; !regexec(&amp;(styles[i].re), uri, 0,
</a><a href="#h1-5-317" id="h1-5-317" class="d">-		    NULL, 0))
</a><a href="#h1-5-318" id="h1-5-318" class="d">-			return styles[i].style;
</a><a href="#h1-5-319" id="h1-5-319" class="d">-	}
</a><a href="#h1-5-320" id="h1-5-320" class="d">-
</a><a href="#h1-5-321" id="h1-5-321" class="d">-	return &quot;&quot;;
</a><a href="#h1-5-322" id="h1-5-322" class="d">-}
</a><a href="#h1-5-323" id="h1-5-323" class="i">+	arg = (Arg)PLUMB(uri);
</a><a href="#h1-5-324" id="h1-5-324" class="i">+	spawn(c, &amp;arg);
</a><a href="#h1-5-325" id="h1-5-325" class="i">+}
</a> 
 void
<a href="#h1-5-328" id="h1-5-328" class="d">-setstyle(Client *c, const char *stylefile)
</a><a href="#h1-5-329" id="h1-5-329" class="d">-{
</a><a href="#h1-5-330" id="h1-5-330" class="d">-	gchar *style;
</a><a href="#h1-5-331" id="h1-5-331" class="d">-
</a><a href="#h1-5-332" id="h1-5-332" class="d">-	if (!g_file_get_contents(stylefile, &amp;style, NULL, NULL)) {
</a><a href="#h1-5-333" id="h1-5-333" class="d">-		fprintf(stderr, &quot;Could not read style file: %s\n&quot;, stylefile);
</a><a href="#h1-5-334" id="h1-5-334" class="d">-		return;
</a><a href="#h1-5-335" id="h1-5-335" class="d">-	}
</a><a href="#h1-5-336" id="h1-5-336" class="d">-
</a><a href="#h1-5-337" id="h1-5-337" class="d">-	webkit_user_content_manager_add_style_sheet(
</a><a href="#h1-5-338" id="h1-5-338" class="d">-	    webkit_web_view_get_user_content_manager(c-&gt;view),
</a><a href="#h1-5-339" id="h1-5-339" class="d">-	    webkit_user_style_sheet_new(style,
</a><a href="#h1-5-340" id="h1-5-340" class="d">-	    WEBKIT_USER_CONTENT_INJECT_ALL_FRAMES,
</a><a href="#h1-5-341" id="h1-5-341" class="d">-	    WEBKIT_USER_STYLE_LEVEL_USER,
</a><a href="#h1-5-342" id="h1-5-342" class="d">-	    NULL, NULL));
</a><a href="#h1-5-343" id="h1-5-343" class="d">-
</a><a href="#h1-5-344" id="h1-5-344" class="d">-	g_free(style);
</a><a href="#h1-5-345" id="h1-5-345" class="d">-}
</a><a href="#h1-5-346" id="h1-5-346" class="d">-
</a><a href="#h1-5-347" id="h1-5-347" class="d">-void
</a><a href="#h1-5-348" id="h1-5-348" class="d">-handleplumb(Client *c, const gchar *uri)
</a><a href="#h1-5-349" id="h1-5-349" class="d">-{
</a><a href="#h1-5-350" id="h1-5-350" class="d">-	Arg arg;
</a><a href="#h1-5-351" id="h1-5-351" class="d">-
</a><a href="#h1-5-352" id="h1-5-352" class="d">-	arg = (Arg)PLUMB(uri);
</a><a href="#h1-5-353" id="h1-5-353" class="d">-	spawn(c, &amp;arg);
</a><a href="#h1-5-354" id="h1-5-354" class="d">-}
</a><a href="#h1-5-355" id="h1-5-355" class="d">-
</a><a href="#h1-5-356" id="h1-5-356" class="d">-void
</a><a href="#h1-5-357" id="h1-5-357" class="d">-downloadstarted(WebKitWebContext *wc, WebKitDownload *d, Client *c)
</a><a href="#h1-5-358" id="h1-5-358" class="d">-{
</a><a href="#h1-5-359" id="h1-5-359" class="d">-	g_signal_connect(G_OBJECT(d), &quot;notify::response&quot;,
</a><a href="#h1-5-360" id="h1-5-360" class="d">-	    G_CALLBACK(responsereceived), c);
</a><a href="#h1-5-361" id="h1-5-361" class="d">-}
</a><a href="#h1-5-362" id="h1-5-362" class="d">-
</a><a href="#h1-5-363" id="h1-5-363" class="d">-void
</a><a href="#h1-5-364" id="h1-5-364" class="d">-responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c)
</a><a href="#h1-5-365" id="h1-5-365" class="d">-{
</a><a href="#h1-5-366" id="h1-5-366" class="d">-	download(c, webkit_download_get_response(d));
</a><a href="#h1-5-367" id="h1-5-367" class="d">-	webkit_download_cancel(d);
</a><a href="#h1-5-368" id="h1-5-368" class="d">-}
</a><a href="#h1-5-369" id="h1-5-369" class="d">-
</a><a href="#h1-5-370" id="h1-5-370" class="d">-void
</a><a href="#h1-5-371" id="h1-5-371" class="d">-download(Client *c, WebKitURIResponse *r)
</a><a href="#h1-5-372" id="h1-5-372" class="i">+newwindow(Client *c, const Arg *a, int noembed)
</a> {
<a href="#h1-5-374" id="h1-5-374" class="d">-	Arg a;
</a><a href="#h1-5-375" id="h1-5-375" class="d">-
</a><a href="#h1-5-376" id="h1-5-376" class="d">-	a = (Arg)DOWNLOAD(webkit_uri_response_get_uri(r), geturi(c));
</a><a href="#h1-5-377" id="h1-5-377" class="d">-	spawn(c, &amp;a);
</a><a href="#h1-5-378" id="h1-5-378" class="d">-}
</a><a href="#h1-5-379" id="h1-5-379" class="i">+	int i = 0;
</a><a href="#h1-5-380" id="h1-5-380" class="i">+	char tmp[64];
</a><a href="#h1-5-381" id="h1-5-381" class="i">+	const char *cmd[26], *uri;
</a><a href="#h1-5-382" id="h1-5-382" class="i">+	const Arg arg = { .v = cmd };
</a> 
<a href="#h1-5-384" id="h1-5-384" class="d">-void
</a><a href="#h1-5-385" id="h1-5-385" class="d">-toggleinspector(Client *c, const Arg *a)
</a><a href="#h1-5-386" id="h1-5-386" class="d">-{
</a><a href="#h1-5-387" id="h1-5-387" class="d">-	if (enableinspector) {
</a><a href="#h1-5-388" id="h1-5-388" class="d">-		if (webkit_web_inspector_is_attached(c-&gt;inspector))
</a><a href="#h1-5-389" id="h1-5-389" class="d">-			webkit_web_inspector_close(c-&gt;inspector);
</a><a href="#h1-5-390" id="h1-5-390" class="d">-		else
</a><a href="#h1-5-391" id="h1-5-391" class="d">-			webkit_web_inspector_show(c-&gt;inspector);
</a><a href="#h1-5-392" id="h1-5-392" class="i">+	cmd[i++] = argv0;
</a><a href="#h1-5-393" id="h1-5-393" class="i">+	cmd[i++] = &quot;-a&quot;;
</a><a href="#h1-5-394" id="h1-5-394" class="i">+	cmd[i++] = cookiepolicies;
</a><a href="#h1-5-395" id="h1-5-395" class="i">+	cmd[i++] = enablescrollbars ? &quot;-B&quot; : &quot;-b&quot;;
</a><a href="#h1-5-396" id="h1-5-396" class="i">+	if (cookiefile &amp;&amp; g_strcmp0(cookiefile, &quot;&quot;)) {
</a><a href="#h1-5-397" id="h1-5-397" class="i">+		cmd[i++] = &quot;-c&quot;;
</a><a href="#h1-5-398" id="h1-5-398" class="i">+		cmd[i++] = cookiefile;
</a> 	}
<a href="#h1-5-400" id="h1-5-400" class="d">-}
</a><a href="#h1-5-401" id="h1-5-401" class="d">-
</a><a href="#h1-5-402" id="h1-5-402" class="d">-gboolean
</a><a href="#h1-5-403" id="h1-5-403" class="d">-keypress(GtkAccelGroup *group, GObject *obj, guint key, GdkModifierType mods,
</a><a href="#h1-5-404" id="h1-5-404" class="d">-         Client *c)
</a><a href="#h1-5-405" id="h1-5-405" class="d">-{
</a><a href="#h1-5-406" id="h1-5-406" class="d">-	guint i;
</a><a href="#h1-5-407" id="h1-5-407" class="d">-	gboolean processed = FALSE;
</a><a href="#h1-5-408" id="h1-5-408" class="d">-
</a><a href="#h1-5-409" id="h1-5-409" class="d">-	mods = CLEANMASK(mods);
</a><a href="#h1-5-410" id="h1-5-410" class="d">-	key = gdk_keyval_to_lower(key);
</a><a href="#h1-5-411" id="h1-5-411" class="d">-	updatewinid(c);
</a><a href="#h1-5-412" id="h1-5-412" class="d">-	for (i = 0; i &lt; LENGTH(keys); i++) {
</a><a href="#h1-5-413" id="h1-5-413" class="d">-		if (key == keys[i].keyval
</a><a href="#h1-5-414" id="h1-5-414" class="d">-		    &amp;&amp; mods == keys[i].mod
</a><a href="#h1-5-415" id="h1-5-415" class="d">-		    &amp;&amp; keys[i].func) {
</a><a href="#h1-5-416" id="h1-5-416" class="d">-			keys[i].func(c, &amp;(keys[i].arg));
</a><a href="#h1-5-417" id="h1-5-417" class="d">-			processed = TRUE;
</a><a href="#h1-5-418" id="h1-5-418" class="d">-		}
</a><a href="#h1-5-419" id="h1-5-419" class="i">+	cmd[i++] = enablecache ? &quot;-D&quot; : &quot;-d&quot;;
</a><a href="#h1-5-420" id="h1-5-420" class="i">+	if (embed &amp;&amp; !noembed) {
</a><a href="#h1-5-421" id="h1-5-421" class="i">+		cmd[i++] = &quot;-e&quot;;
</a><a href="#h1-5-422" id="h1-5-422" class="i">+		snprintf(tmp, LENGTH(tmp), &quot;%lu&quot;, embed);
</a><a href="#h1-5-423" id="h1-5-423" class="i">+		cmd[i++] = tmp;
</a> 	}
<a href="#h1-5-425" id="h1-5-425" class="d">-
</a><a href="#h1-5-426" id="h1-5-426" class="d">-	return processed;
</a><a href="#h1-5-427" id="h1-5-427" class="d">-}
</a><a href="#h1-5-428" id="h1-5-428" class="d">-
</a><a href="#h1-5-429" id="h1-5-429" class="d">-void
</a><a href="#h1-5-430" id="h1-5-430" class="d">-mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h, guint modifiers,
</a><a href="#h1-5-431" id="h1-5-431" class="d">-    Client *c)
</a><a href="#h1-5-432" id="h1-5-432" class="d">-{
</a><a href="#h1-5-433" id="h1-5-433" class="d">-	WebKitHitTestResultContext hc;
</a><a href="#h1-5-434" id="h1-5-434" class="d">-
</a><a href="#h1-5-435" id="h1-5-435" class="d">-	/* Keep the hit test to know where is the pointer on the next click */
</a><a href="#h1-5-436" id="h1-5-436" class="d">-	c-&gt;mousepos = h;
</a><a href="#h1-5-437" id="h1-5-437" class="d">-
</a><a href="#h1-5-438" id="h1-5-438" class="d">-	hc = webkit_hit_test_result_get_context(h);
</a><a href="#h1-5-439" id="h1-5-439" class="d">-
</a><a href="#h1-5-440" id="h1-5-440" class="d">-	if (hc &amp; OnLink)
</a><a href="#h1-5-441" id="h1-5-441" class="d">-		c-&gt;targeturi = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h1-5-442" id="h1-5-442" class="d">-	else if (hc &amp; OnImg)
</a><a href="#h1-5-443" id="h1-5-443" class="d">-		c-&gt;targeturi = webkit_hit_test_result_get_image_uri(h);
</a><a href="#h1-5-444" id="h1-5-444" class="d">-	else if (hc &amp; OnMedia)
</a><a href="#h1-5-445" id="h1-5-445" class="d">-		c-&gt;targeturi = webkit_hit_test_result_get_media_uri(h);
</a><a href="#h1-5-446" id="h1-5-446" class="d">-	else
</a><a href="#h1-5-447" id="h1-5-447" class="d">-		c-&gt;targeturi = NULL;
</a><a href="#h1-5-448" id="h1-5-448" class="d">-	updatetitle(c);
</a><a href="#h1-5-449" id="h1-5-449" class="d">-}
</a><a href="#h1-5-450" id="h1-5-450" class="d">-
</a><a href="#h1-5-451" id="h1-5-451" class="d">-void
</a><a href="#h1-5-452" id="h1-5-452" class="d">-loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c)
</a><a href="#h1-5-453" id="h1-5-453" class="d">-{
</a><a href="#h1-5-454" id="h1-5-454" class="d">-	switch (e) {
</a><a href="#h1-5-455" id="h1-5-455" class="d">-	case WEBKIT_LOAD_STARTED:
</a><a href="#h1-5-456" id="h1-5-456" class="d">-		c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-5-457" id="h1-5-457" class="d">-		break;
</a><a href="#h1-5-458" id="h1-5-458" class="d">-	case WEBKIT_LOAD_REDIRECTED:
</a><a href="#h1-5-459" id="h1-5-459" class="d">-		setatom(c, AtomUri, geturi(c));
</a><a href="#h1-5-460" id="h1-5-460" class="d">-		break;
</a><a href="#h1-5-461" id="h1-5-461" class="d">-	case WEBKIT_LOAD_COMMITTED:
</a><a href="#h1-5-462" id="h1-5-462" class="d">-		if (!webkit_web_view_get_tls_info(c-&gt;view, NULL, &amp;(c-&gt;tlsflags)))
</a><a href="#h1-5-463" id="h1-5-463" class="d">-			c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-5-464" id="h1-5-464" class="d">-
</a><a href="#h1-5-465" id="h1-5-465" class="d">-		setatom(c, AtomUri, geturi(c));
</a><a href="#h1-5-466" id="h1-5-466" class="d">-
</a><a href="#h1-5-467" id="h1-5-467" class="d">-		if (enablestyle)
</a><a href="#h1-5-468" id="h1-5-468" class="d">-			setstyle(c, getstyle(geturi(c)));
</a><a href="#h1-5-469" id="h1-5-469" class="d">-		break;
</a><a href="#h1-5-470" id="h1-5-470" class="d">-	case WEBKIT_LOAD_FINISHED:
</a><a href="#h1-5-471" id="h1-5-471" class="d">-		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h1-5-472" id="h1-5-472" class="d">-		 * manipulating the DOM directly.
</a><a href="#h1-5-473" id="h1-5-473" class="d">-		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h1-5-474" id="h1-5-474" class="d">-		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h1-5-475" id="h1-5-475" class="d">-		*/
</a><a href="#h1-5-476" id="h1-5-476" class="d">-		runscript(c);
</a><a href="#h1-5-477" id="h1-5-477" class="d">-		break;
</a><a href="#h1-5-478" id="h1-5-478" class="i">+	cmd[i++] = runinfullscreen ? &quot;-F&quot; : &quot;-f&quot;;
</a><a href="#h1-5-479" id="h1-5-479" class="i">+	cmd[i++] = allowgeolocation ? &quot;-G&quot; : &quot;-g&quot;;
</a><a href="#h1-5-480" id="h1-5-480" class="i">+	cmd[i++] = loadimages ? &quot;-I&quot; : &quot;-i&quot;;
</a><a href="#h1-5-481" id="h1-5-481" class="i">+	cmd[i++] = kioskmode ? &quot;-K&quot; : &quot;-k&quot;;
</a><a href="#h1-5-482" id="h1-5-482" class="i">+	cmd[i++] = enablestyle ? &quot;-M&quot; : &quot;-m&quot;;
</a><a href="#h1-5-483" id="h1-5-483" class="i">+	cmd[i++] = enableinspector ? &quot;-N&quot; : &quot;-n&quot;;
</a><a href="#h1-5-484" id="h1-5-484" class="i">+	cmd[i++] = enableplugins ? &quot;-P&quot; : &quot;-p&quot;;
</a><a href="#h1-5-485" id="h1-5-485" class="i">+	if (scriptfile &amp;&amp; g_strcmp0(scriptfile, &quot;&quot;)) {
</a><a href="#h1-5-486" id="h1-5-486" class="i">+		cmd[i++] = &quot;-r&quot;;
</a><a href="#h1-5-487" id="h1-5-487" class="i">+		cmd[i++] = scriptfile;
</a> 	}
<a href="#h1-5-489" id="h1-5-489" class="d">-	updatetitle(c);
</a><a href="#h1-5-490" id="h1-5-490" class="d">-}
</a><a href="#h1-5-491" id="h1-5-491" class="d">-
</a><a href="#h1-5-492" id="h1-5-492" class="d">-void
</a><a href="#h1-5-493" id="h1-5-493" class="d">-loaduri(Client *c, const Arg *a)
</a><a href="#h1-5-494" id="h1-5-494" class="d">-{
</a><a href="#h1-5-495" id="h1-5-495" class="d">-	struct stat st;
</a><a href="#h1-5-496" id="h1-5-496" class="d">-	char *url, *path;
</a><a href="#h1-5-497" id="h1-5-497" class="d">-	const char *uri = (char *)a-&gt;v;
</a><a href="#h1-5-498" id="h1-5-498" class="d">-
</a><a href="#h1-5-499" id="h1-5-499" class="d">-	if (g_strcmp0(uri, &quot;&quot;) == 0)
</a><a href="#h1-5-500" id="h1-5-500" class="d">-		return;
</a><a href="#h1-5-501" id="h1-5-501" class="d">-
</a><a href="#h1-5-502" id="h1-5-502" class="d">-	if (g_strrstr(uri, &quot;://&quot;) || g_str_has_prefix(uri, &quot;about:&quot;)) {
</a><a href="#h1-5-503" id="h1-5-503" class="d">-		url = g_strdup(uri);
</a><a href="#h1-5-504" id="h1-5-504" class="d">-	} else if (!stat(uri, &amp;st) &amp;&amp; (path = realpath(uri, NULL))) {
</a><a href="#h1-5-505" id="h1-5-505" class="d">-		url = g_strdup_printf(&quot;file://%s&quot;, path);
</a><a href="#h1-5-506" id="h1-5-506" class="d">-		free(path);
</a><a href="#h1-5-507" id="h1-5-507" class="d">-	} else {
</a><a href="#h1-5-508" id="h1-5-508" class="d">-		url = g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h1-5-509" id="h1-5-509" class="i">+	cmd[i++] = enablescripts ? &quot;-S&quot; : &quot;-s&quot;;
</a><a href="#h1-5-510" id="h1-5-510" class="i">+	if (stylefile &amp;&amp; g_strcmp0(stylefile, &quot;&quot;)) {
</a><a href="#h1-5-511" id="h1-5-511" class="i">+		cmd[i++] = &quot;-t&quot;;
</a><a href="#h1-5-512" id="h1-5-512" class="i">+		cmd[i++] = stylefile;
</a> 	}
<a href="#h1-5-514" id="h1-5-514" class="d">-
</a><a href="#h1-5-515" id="h1-5-515" class="d">-	setatom(c, AtomUri, url);
</a><a href="#h1-5-516" id="h1-5-516" class="d">-
</a><a href="#h1-5-517" id="h1-5-517" class="d">-	if (strcmp(url, geturi(c)) == 0) {
</a><a href="#h1-5-518" id="h1-5-518" class="d">-		reload(c, a);
</a><a href="#h1-5-519" id="h1-5-519" class="d">-	} else {
</a><a href="#h1-5-520" id="h1-5-520" class="d">-		webkit_web_view_load_uri(c-&gt;view, url);
</a><a href="#h1-5-521" id="h1-5-521" class="d">-		c-&gt;title = geturi(c);
</a><a href="#h1-5-522" id="h1-5-522" class="d">-		updatetitle(c);
</a><a href="#h1-5-523" id="h1-5-523" class="i">+	if (fulluseragent &amp;&amp; g_strcmp0(fulluseragent, &quot;&quot;)) {
</a><a href="#h1-5-524" id="h1-5-524" class="i">+		cmd[i++] = &quot;-u&quot;;
</a><a href="#h1-5-525" id="h1-5-525" class="i">+		cmd[i++] = fulluseragent;
</a> 	}
<a href="#h1-5-527" id="h1-5-527" class="d">-
</a><a href="#h1-5-528" id="h1-5-528" class="d">-	g_free(url);
</a><a href="#h1-5-529" id="h1-5-529" class="d">-}
</a><a href="#h1-5-530" id="h1-5-530" class="d">-
</a><a href="#h1-5-531" id="h1-5-531" class="d">-void
</a><a href="#h1-5-532" id="h1-5-532" class="d">-navigate(Client *c, const Arg *a)
</a><a href="#h1-5-533" id="h1-5-533" class="d">-{
</a><a href="#h1-5-534" id="h1-5-534" class="d">-	if (a-&gt;i &lt; 0)
</a><a href="#h1-5-535" id="h1-5-535" class="d">-		webkit_web_view_go_back(c-&gt;view);
</a><a href="#h1-5-536" id="h1-5-536" class="d">-	else if (a-&gt;i &gt; 0)
</a><a href="#h1-5-537" id="h1-5-537" class="d">-		webkit_web_view_go_forward(c-&gt;view);
</a><a href="#h1-5-538" id="h1-5-538" class="i">+	if (showxid)
</a><a href="#h1-5-539" id="h1-5-539" class="i">+		cmd[i++] = &quot;-x&quot;;
</a><a href="#h1-5-540" id="h1-5-540" class="i">+	/* do not keep zoom level */
</a><a href="#h1-5-541" id="h1-5-541" class="i">+	cmd[i++] = &quot;--&quot;;
</a><a href="#h1-5-542" id="h1-5-542" class="i">+	if ((uri = a-&gt;v))
</a><a href="#h1-5-543" id="h1-5-543" class="i">+		cmd[i++] = uri;
</a><a href="#h1-5-544" id="h1-5-544" class="i">+	cmd[i] = NULL;
</a><a href="#h1-5-545" id="h1-5-545" class="i">+
</a><a href="#h1-5-546" id="h1-5-546" class="i">+	spawn(c, &amp;arg);
</a> }
 
 void
<a href="#h1-5-550" id="h1-5-550" class="d">-clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h1-5-551" id="h1-5-551" class="i">+spawn(Client *c, const Arg *arg)
</a> {
<a href="#h1-5-553" id="h1-5-553" class="d">-	navigate(c, a);
</a><a href="#h1-5-554" id="h1-5-554" class="i">+	if (fork() == 0) {
</a><a href="#h1-5-555" id="h1-5-555" class="i">+		if (dpy)
</a><a href="#h1-5-556" id="h1-5-556" class="i">+			close(ConnectionNumber(dpy));
</a><a href="#h1-5-557" id="h1-5-557" class="i">+		setsid();
</a><a href="#h1-5-558" id="h1-5-558" class="i">+		execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
</a><a href="#h1-5-559" id="h1-5-559" class="i">+		fprintf(stderr, &quot;surf: execvp %s&quot;, ((char **)arg-&gt;v)[0]);
</a><a href="#h1-5-560" id="h1-5-560" class="i">+		perror(&quot; failed&quot;);
</a><a href="#h1-5-561" id="h1-5-561" class="i">+		exit(0);
</a><a href="#h1-5-562" id="h1-5-562" class="i">+	}
</a> }
 
<a href="#h1-5-565" id="h1-5-565" class="d">-Client *
</a><a href="#h1-5-566" id="h1-5-566" class="d">-newclient(Client *rc)
</a><a href="#h1-5-567" id="h1-5-567" class="i">+void
</a><a href="#h1-5-568" id="h1-5-568" class="i">+destroyclient(Client *c)
</a> {
<a href="#h1-5-570" id="h1-5-570" class="d">-	Client *c;
</a><a href="#h1-5-571" id="h1-5-571" class="d">-
</a><a href="#h1-5-572" id="h1-5-572" class="d">-	if (!(c = calloc(1, sizeof(Client))))
</a><a href="#h1-5-573" id="h1-5-573" class="d">-		die(&quot;Cannot malloc!\n&quot;);
</a><a href="#h1-5-574" id="h1-5-574" class="d">-
</a><a href="#h1-5-575" id="h1-5-575" class="d">-	c-&gt;title = NULL;
</a><a href="#h1-5-576" id="h1-5-576" class="d">-	c-&gt;progress = 100;
</a><a href="#h1-5-577" id="h1-5-577" class="i">+	Client *p;
</a> 
<a href="#h1-5-579" id="h1-5-579" class="d">-	c-&gt;next = clients;
</a><a href="#h1-5-580" id="h1-5-580" class="d">-	clients = c;
</a><a href="#h1-5-581" id="h1-5-581" class="i">+	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h1-5-582" id="h1-5-582" class="i">+	/* Not needed, has already been called
</a><a href="#h1-5-583" id="h1-5-583" class="i">+	gtk_widget_destroy(c-&gt;win);
</a><a href="#h1-5-584" id="h1-5-584" class="i">+	 */
</a> 
<a href="#h1-5-586" id="h1-5-586" class="d">-	c-&gt;view = newview(c, rc ? rc-&gt;view : NULL);
</a><a href="#h1-5-587" id="h1-5-587" class="d">-	c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-5-588" id="h1-5-588" class="i">+	for (p = clients; p &amp;&amp; p-&gt;next != c; p = p-&gt;next)
</a><a href="#h1-5-589" id="h1-5-589" class="i">+		;
</a><a href="#h1-5-590" id="h1-5-590" class="i">+	if (p)
</a><a href="#h1-5-591" id="h1-5-591" class="i">+		p-&gt;next = c-&gt;next;
</a><a href="#h1-5-592" id="h1-5-592" class="i">+	else
</a><a href="#h1-5-593" id="h1-5-593" class="i">+		clients = c-&gt;next;
</a><a href="#h1-5-594" id="h1-5-594" class="i">+	free(c);
</a><a href="#h1-5-595" id="h1-5-595" class="i">+}
</a> 
<a href="#h1-5-597" id="h1-5-597" class="d">-	return c;
</a><a href="#h1-5-598" id="h1-5-598" class="i">+void
</a><a href="#h1-5-599" id="h1-5-599" class="i">+cleanup(void)
</a><a href="#h1-5-600" id="h1-5-600" class="i">+{
</a><a href="#h1-5-601" id="h1-5-601" class="i">+	while (clients)
</a><a href="#h1-5-602" id="h1-5-602" class="i">+		destroyclient(clients);
</a><a href="#h1-5-603" id="h1-5-603" class="i">+	g_free(cookiefile);
</a><a href="#h1-5-604" id="h1-5-604" class="i">+	g_free(scriptfile);
</a><a href="#h1-5-605" id="h1-5-605" class="i">+	g_free(stylefile);
</a><a href="#h1-5-606" id="h1-5-606" class="i">+	g_free(cachedir);
</a> }
 
 WebKitWebView *
<a href="#h1-6" id="h1-6" class="h">@@ -983,109 +793,178 @@ newview(Client *c, WebKitWebView *rv)
</a> 	return v;
 }
 
<a href="#h1-6-3" id="h1-6-3" class="d">-void
</a><a href="#h1-6-4" id="h1-6-4" class="d">-showview(WebKitWebView *v, Client *c)
</a><a href="#h1-6-5" id="h1-6-5" class="i">+GtkWidget *
</a><a href="#h1-6-6" id="h1-6-6" class="i">+createview(WebKitWebView *v, WebKitNavigationAction *a, Client *c)
</a> {
<a href="#h1-6-8" id="h1-6-8" class="d">-	GdkGeometry hints = { 1, 1 };
</a><a href="#h1-6-9" id="h1-6-9" class="d">-	GdkRGBA bgcolor = { 0 };
</a><a href="#h1-6-10" id="h1-6-10" class="d">-	GdkWindow *gwin;
</a><a href="#h1-6-11" id="h1-6-11" class="i">+	Client *n;
</a> 
<a href="#h1-6-13" id="h1-6-13" class="d">-	c-&gt;win = createwindow(c);
</a><a href="#h1-6-14" id="h1-6-14" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-6-15" id="h1-6-15" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-6-16" id="h1-6-16" class="i">+		/*
</a><a href="#h1-6-17" id="h1-6-17" class="i">+		 * popup windows of type “other” are almost always triggered
</a><a href="#h1-6-18" id="h1-6-18" class="i">+		 * by user gesture, so inverse the logic here
</a><a href="#h1-6-19" id="h1-6-19" class="i">+		 */
</a><a href="#h1-6-20" id="h1-6-20" class="i">+/* instead of this, compare destination uri to mouse-over uri for validating window */
</a><a href="#h1-6-21" id="h1-6-21" class="i">+		if (webkit_navigation_action_is_user_gesture(a)) {
</a><a href="#h1-6-22" id="h1-6-22" class="i">+			return NULL;
</a><a href="#h1-6-23" id="h1-6-23" class="i">+			break;
</a><a href="#h1-6-24" id="h1-6-24" class="i">+		}
</a><a href="#h1-6-25" id="h1-6-25" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-6-26" id="h1-6-26" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-6-27" id="h1-6-27" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-6-28" id="h1-6-28" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-6-29" id="h1-6-29" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-6-30" id="h1-6-30" class="i">+		n = newclient(c);
</a><a href="#h1-6-31" id="h1-6-31" class="i">+		break;
</a><a href="#h1-6-32" id="h1-6-32" class="i">+	default:
</a><a href="#h1-6-33" id="h1-6-33" class="i">+		return NULL;
</a><a href="#h1-6-34" id="h1-6-34" class="i">+		break;
</a><a href="#h1-6-35" id="h1-6-35" class="i">+	}
</a> 
<a href="#h1-6-37" id="h1-6-37" class="d">-	if (enableinspector)
</a><a href="#h1-6-38" id="h1-6-38" class="d">-		c-&gt;inspector = webkit_web_view_get_inspector(c-&gt;view);
</a><a href="#h1-6-39" id="h1-6-39" class="i">+	return GTK_WIDGET(n-&gt;view);
</a><a href="#h1-6-40" id="h1-6-40" class="i">+}
</a> 
<a href="#h1-6-42" id="h1-6-42" class="d">-	c-&gt;finder = webkit_web_view_get_find_controller(c-&gt;view);
</a><a href="#h1-6-43" id="h1-6-43" class="i">+gboolean
</a><a href="#h1-6-44" id="h1-6-44" class="i">+buttonreleased(GtkWidget *w, GdkEventKey *e, Client *c)
</a><a href="#h1-6-45" id="h1-6-45" class="i">+{
</a><a href="#h1-6-46" id="h1-6-46" class="i">+	WebKitHitTestResultContext element;
</a><a href="#h1-6-47" id="h1-6-47" class="i">+	GdkEventButton *eb = (GdkEventButton*)e;
</a><a href="#h1-6-48" id="h1-6-48" class="i">+	int i;
</a> 
<a href="#h1-6-50" id="h1-6-50" class="d">-	if (!kioskmode)
</a><a href="#h1-6-51" id="h1-6-51" class="d">-		addaccelgroup(c);
</a><a href="#h1-6-52" id="h1-6-52" class="i">+	element = webkit_hit_test_result_get_context(c-&gt;mousepos);
</a> 
<a href="#h1-6-54" id="h1-6-54" class="d">-	/* Arranging */
</a><a href="#h1-6-55" id="h1-6-55" class="d">-	gtk_container_add(GTK_CONTAINER(c-&gt;win), GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-56" id="h1-6-56" class="i">+	for (i = 0; i &lt; LENGTH(buttons); ++i) {
</a><a href="#h1-6-57" id="h1-6-57" class="i">+		if (element &amp; buttons[i].target &amp;&amp;
</a><a href="#h1-6-58" id="h1-6-58" class="i">+		    eb-&gt;button == buttons[i].button &amp;&amp;
</a><a href="#h1-6-59" id="h1-6-59" class="i">+		    CLEANMASK(eb-&gt;state) == CLEANMASK(buttons[i].mask) &amp;&amp;
</a><a href="#h1-6-60" id="h1-6-60" class="i">+		    buttons[i].func) {
</a><a href="#h1-6-61" id="h1-6-61" class="i">+			buttons[i].func(c, &amp;buttons[i].arg, c-&gt;mousepos);
</a><a href="#h1-6-62" id="h1-6-62" class="i">+			return buttons[i].stopevent;
</a><a href="#h1-6-63" id="h1-6-63" class="i">+		}
</a><a href="#h1-6-64" id="h1-6-64" class="i">+	}
</a> 
<a href="#h1-6-66" id="h1-6-66" class="d">-	/* Setup */
</a><a href="#h1-6-67" id="h1-6-67" class="d">-	gtk_widget_grab_focus(GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-68" id="h1-6-68" class="d">-	gtk_widget_show(GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-69" id="h1-6-69" class="d">-	gtk_widget_show(c-&gt;win);
</a><a href="#h1-6-70" id="h1-6-70" class="d">-	gwin = gtk_widget_get_window(GTK_WIDGET(c-&gt;win));
</a><a href="#h1-6-71" id="h1-6-71" class="d">-	c-&gt;xid = gdk_x11_window_get_xid(gwin);
</a><a href="#h1-6-72" id="h1-6-72" class="d">-	gtk_window_set_geometry_hints(GTK_WINDOW(c-&gt;win), NULL, &amp;hints,
</a><a href="#h1-6-73" id="h1-6-73" class="d">-				      GDK_HINT_MIN_SIZE);
</a><a href="#h1-6-74" id="h1-6-74" class="d">-	gdk_window_set_events(gwin, GDK_ALL_EVENTS_MASK);
</a><a href="#h1-6-75" id="h1-6-75" class="d">-	gdk_window_add_filter(gwin, processx, c);
</a><a href="#h1-6-76" id="h1-6-76" class="i">+	return FALSE;
</a><a href="#h1-6-77" id="h1-6-77" class="i">+}
</a> 
<a href="#h1-6-79" id="h1-6-79" class="d">-	if (zoomlevel != 1.0)
</a><a href="#h1-6-80" id="h1-6-80" class="d">-		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel);
</a><a href="#h1-6-81" id="h1-6-81" class="i">+gboolean
</a><a href="#h1-6-82" id="h1-6-82" class="i">+keypress(GtkAccelGroup *group, GObject *obj, guint key, GdkModifierType mods,
</a><a href="#h1-6-83" id="h1-6-83" class="i">+         Client *c)
</a><a href="#h1-6-84" id="h1-6-84" class="i">+{
</a><a href="#h1-6-85" id="h1-6-85" class="i">+	guint i;
</a><a href="#h1-6-86" id="h1-6-86" class="i">+	gboolean processed = FALSE;
</a> 
<a href="#h1-6-88" id="h1-6-88" class="d">-	if (runinfullscreen)
</a><a href="#h1-6-89" id="h1-6-89" class="d">-		togglefullscreen(c, NULL);
</a><a href="#h1-6-90" id="h1-6-90" class="i">+	mods = CLEANMASK(mods);
</a><a href="#h1-6-91" id="h1-6-91" class="i">+	key = gdk_keyval_to_lower(key);
</a><a href="#h1-6-92" id="h1-6-92" class="i">+	updatewinid(c);
</a><a href="#h1-6-93" id="h1-6-93" class="i">+	for (i = 0; i &lt; LENGTH(keys); i++) {
</a><a href="#h1-6-94" id="h1-6-94" class="i">+		if (key == keys[i].keyval
</a><a href="#h1-6-95" id="h1-6-95" class="i">+		    &amp;&amp; mods == keys[i].mod
</a><a href="#h1-6-96" id="h1-6-96" class="i">+		    &amp;&amp; keys[i].func) {
</a><a href="#h1-6-97" id="h1-6-97" class="i">+			keys[i].func(c, &amp;(keys[i].arg));
</a><a href="#h1-6-98" id="h1-6-98" class="i">+			processed = TRUE;
</a><a href="#h1-6-99" id="h1-6-99" class="i">+		}
</a><a href="#h1-6-100" id="h1-6-100" class="i">+	}
</a> 
<a href="#h1-6-102" id="h1-6-102" class="d">-	setatom(c, AtomFind, &quot;&quot;);
</a><a href="#h1-6-103" id="h1-6-103" class="d">-	setatom(c, AtomUri, &quot;about:blank&quot;);
</a><a href="#h1-6-104" id="h1-6-104" class="d">-	if (hidebackground)
</a><a href="#h1-6-105" id="h1-6-105" class="d">-		webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h1-6-106" id="h1-6-106" class="i">+	return processed;
</a><a href="#h1-6-107" id="h1-6-107" class="i">+}
</a> 
<a href="#h1-6-109" id="h1-6-109" class="d">-	if (showxid) {
</a><a href="#h1-6-110" id="h1-6-110" class="d">-		gdk_display_sync(gtk_widget_get_display(c-&gt;win));
</a><a href="#h1-6-111" id="h1-6-111" class="d">-		printf(&quot;%lu\n&quot;, c-&gt;xid);
</a><a href="#h1-6-112" id="h1-6-112" class="d">-		fflush(NULL);
</a><a href="#h1-6-113" id="h1-6-113" class="d">-                if (fclose(stdout) != 0) {
</a><a href="#h1-6-114" id="h1-6-114" class="d">-			die(&quot;Error closing stdout&quot;);
</a><a href="#h1-6-115" id="h1-6-115" class="d">-                }
</a><a href="#h1-6-116" id="h1-6-116" class="i">+GdkFilterReturn
</a><a href="#h1-6-117" id="h1-6-117" class="i">+processx(GdkXEvent *e, GdkEvent *event, gpointer d)
</a><a href="#h1-6-118" id="h1-6-118" class="i">+{
</a><a href="#h1-6-119" id="h1-6-119" class="i">+	Client *c = (Client *)d;
</a><a href="#h1-6-120" id="h1-6-120" class="i">+	XPropertyEvent *ev;
</a><a href="#h1-6-121" id="h1-6-121" class="i">+	Arg arg;
</a><a href="#h1-6-122" id="h1-6-122" class="i">+
</a><a href="#h1-6-123" id="h1-6-123" class="i">+	if (((XEvent *)e)-&gt;type == PropertyNotify) {
</a><a href="#h1-6-124" id="h1-6-124" class="i">+		ev = &amp;((XEvent *)e)-&gt;xproperty;
</a><a href="#h1-6-125" id="h1-6-125" class="i">+		if (ev-&gt;state == PropertyNewValue) {
</a><a href="#h1-6-126" id="h1-6-126" class="i">+			if (ev-&gt;atom == atoms[AtomFind]) {
</a><a href="#h1-6-127" id="h1-6-127" class="i">+				find(c, NULL);
</a><a href="#h1-6-128" id="h1-6-128" class="i">+
</a><a href="#h1-6-129" id="h1-6-129" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h1-6-130" id="h1-6-130" class="i">+			} else if (ev-&gt;atom == atoms[AtomGo]) {
</a><a href="#h1-6-131" id="h1-6-131" class="i">+				arg.v = getatom(c, AtomGo);
</a><a href="#h1-6-132" id="h1-6-132" class="i">+				loaduri(c, &amp;arg);
</a><a href="#h1-6-133" id="h1-6-133" class="i">+
</a><a href="#h1-6-134" id="h1-6-134" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h1-6-135" id="h1-6-135" class="i">+			}
</a><a href="#h1-6-136" id="h1-6-136" class="i">+		}
</a><a href="#h1-6-137" id="h1-6-137" class="i">+	}
</a><a href="#h1-6-138" id="h1-6-138" class="i">+	return GDK_FILTER_CONTINUE;
</a><a href="#h1-6-139" id="h1-6-139" class="i">+}
</a><a href="#h1-6-140" id="h1-6-140" class="i">+
</a><a href="#h1-6-141" id="h1-6-141" class="i">+gboolean
</a><a href="#h1-6-142" id="h1-6-142" class="i">+winevent(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h1-6-143" id="h1-6-143" class="i">+{
</a><a href="#h1-6-144" id="h1-6-144" class="i">+	switch (e-&gt;type) {
</a><a href="#h1-6-145" id="h1-6-145" class="i">+	case GDK_LEAVE_NOTIFY:
</a><a href="#h1-6-146" id="h1-6-146" class="i">+		c-&gt;targeturi = NULL;
</a><a href="#h1-6-147" id="h1-6-147" class="i">+		updatetitle(c);
</a><a href="#h1-6-148" id="h1-6-148" class="i">+		break;
</a><a href="#h1-6-149" id="h1-6-149" class="i">+	case GDK_WINDOW_STATE: /* fallthrough */
</a><a href="#h1-6-150" id="h1-6-150" class="i">+		if (e-&gt;window_state.changed_mask ==
</a><a href="#h1-6-151" id="h1-6-151" class="i">+		    GDK_WINDOW_STATE_FULLSCREEN) {
</a><a href="#h1-6-152" id="h1-6-152" class="i">+			c-&gt;fullscreen = e-&gt;window_state.new_window_state &amp;
</a><a href="#h1-6-153" id="h1-6-153" class="i">+			    GDK_WINDOW_STATE_FULLSCREEN;
</a><a href="#h1-6-154" id="h1-6-154" class="i">+			break;
</a><a href="#h1-6-155" id="h1-6-155" class="i">+		}
</a><a href="#h1-6-156" id="h1-6-156" class="i">+	default:
</a><a href="#h1-6-157" id="h1-6-157" class="i">+		return FALSE;
</a> 	}
<a href="#h1-6-159" id="h1-6-159" class="i">+
</a><a href="#h1-6-160" id="h1-6-160" class="i">+	return TRUE;
</a> }
 
 void
<a href="#h1-6-164" id="h1-6-164" class="d">-newwindow(Client *c, const Arg *a, int noembed)
</a><a href="#h1-6-165" id="h1-6-165" class="i">+showview(WebKitWebView *v, Client *c)
</a> {
<a href="#h1-6-167" id="h1-6-167" class="d">-	int i = 0;
</a><a href="#h1-6-168" id="h1-6-168" class="d">-	char tmp[64];
</a><a href="#h1-6-169" id="h1-6-169" class="d">-	const char *cmd[26], *uri;
</a><a href="#h1-6-170" id="h1-6-170" class="d">-	const Arg arg = { .v = cmd };
</a><a href="#h1-6-171" id="h1-6-171" class="i">+	GdkGeometry hints = { 1, 1 };
</a><a href="#h1-6-172" id="h1-6-172" class="i">+	GdkRGBA bgcolor = { 0 };
</a><a href="#h1-6-173" id="h1-6-173" class="i">+	GdkWindow *gwin;
</a> 
<a href="#h1-6-175" id="h1-6-175" class="d">-	cmd[i++] = argv0;
</a><a href="#h1-6-176" id="h1-6-176" class="d">-	cmd[i++] = &quot;-a&quot;;
</a><a href="#h1-6-177" id="h1-6-177" class="d">-	cmd[i++] = cookiepolicies;
</a><a href="#h1-6-178" id="h1-6-178" class="d">-	cmd[i++] = enablescrollbars ? &quot;-B&quot; : &quot;-b&quot;;
</a><a href="#h1-6-179" id="h1-6-179" class="d">-	if (cookiefile &amp;&amp; g_strcmp0(cookiefile, &quot;&quot;)) {
</a><a href="#h1-6-180" id="h1-6-180" class="d">-		cmd[i++] = &quot;-c&quot;;
</a><a href="#h1-6-181" id="h1-6-181" class="d">-		cmd[i++] = cookiefile;
</a><a href="#h1-6-182" id="h1-6-182" class="d">-	}
</a><a href="#h1-6-183" id="h1-6-183" class="d">-	cmd[i++] = enablecache ? &quot;-D&quot; : &quot;-d&quot;;
</a><a href="#h1-6-184" id="h1-6-184" class="d">-	if (embed &amp;&amp; !noembed) {
</a><a href="#h1-6-185" id="h1-6-185" class="d">-		cmd[i++] = &quot;-e&quot;;
</a><a href="#h1-6-186" id="h1-6-186" class="d">-		snprintf(tmp, LENGTH(tmp), &quot;%lu&quot;, embed);
</a><a href="#h1-6-187" id="h1-6-187" class="d">-		cmd[i++] = tmp;
</a><a href="#h1-6-188" id="h1-6-188" class="d">-	}
</a><a href="#h1-6-189" id="h1-6-189" class="d">-	cmd[i++] = runinfullscreen ? &quot;-F&quot; : &quot;-f&quot;;
</a><a href="#h1-6-190" id="h1-6-190" class="d">-	cmd[i++] = allowgeolocation ? &quot;-G&quot; : &quot;-g&quot;;
</a><a href="#h1-6-191" id="h1-6-191" class="d">-	cmd[i++] = loadimages ? &quot;-I&quot; : &quot;-i&quot;;
</a><a href="#h1-6-192" id="h1-6-192" class="d">-	cmd[i++] = kioskmode ? &quot;-K&quot; : &quot;-k&quot;;
</a><a href="#h1-6-193" id="h1-6-193" class="d">-	cmd[i++] = enablestyle ? &quot;-M&quot; : &quot;-m&quot;;
</a><a href="#h1-6-194" id="h1-6-194" class="d">-	cmd[i++] = enableinspector ? &quot;-N&quot; : &quot;-n&quot;;
</a><a href="#h1-6-195" id="h1-6-195" class="d">-	cmd[i++] = enableplugins ? &quot;-P&quot; : &quot;-p&quot;;
</a><a href="#h1-6-196" id="h1-6-196" class="d">-	if (scriptfile &amp;&amp; g_strcmp0(scriptfile, &quot;&quot;)) {
</a><a href="#h1-6-197" id="h1-6-197" class="d">-		cmd[i++] = &quot;-r&quot;;
</a><a href="#h1-6-198" id="h1-6-198" class="d">-		cmd[i++] = scriptfile;
</a><a href="#h1-6-199" id="h1-6-199" class="d">-	}
</a><a href="#h1-6-200" id="h1-6-200" class="d">-	cmd[i++] = enablescripts ? &quot;-S&quot; : &quot;-s&quot;;
</a><a href="#h1-6-201" id="h1-6-201" class="d">-	if (stylefile &amp;&amp; g_strcmp0(stylefile, &quot;&quot;)) {
</a><a href="#h1-6-202" id="h1-6-202" class="d">-		cmd[i++] = &quot;-t&quot;;
</a><a href="#h1-6-203" id="h1-6-203" class="d">-		cmd[i++] = stylefile;
</a><a href="#h1-6-204" id="h1-6-204" class="d">-	}
</a><a href="#h1-6-205" id="h1-6-205" class="d">-	if (fulluseragent &amp;&amp; g_strcmp0(fulluseragent, &quot;&quot;)) {
</a><a href="#h1-6-206" id="h1-6-206" class="d">-		cmd[i++] = &quot;-u&quot;;
</a><a href="#h1-6-207" id="h1-6-207" class="d">-		cmd[i++] = fulluseragent;
</a><a href="#h1-6-208" id="h1-6-208" class="d">-	}
</a><a href="#h1-6-209" id="h1-6-209" class="d">-	if (showxid)
</a><a href="#h1-6-210" id="h1-6-210" class="d">-		cmd[i++] = &quot;-x&quot;;
</a><a href="#h1-6-211" id="h1-6-211" class="d">-	/* do not keep zoom level */
</a><a href="#h1-6-212" id="h1-6-212" class="d">-	cmd[i++] = &quot;--&quot;;
</a><a href="#h1-6-213" id="h1-6-213" class="d">-	if ((uri = a-&gt;v))
</a><a href="#h1-6-214" id="h1-6-214" class="d">-		cmd[i++] = uri;
</a><a href="#h1-6-215" id="h1-6-215" class="d">-	cmd[i] = NULL;
</a><a href="#h1-6-216" id="h1-6-216" class="i">+	c-&gt;win = createwindow(c);
</a><a href="#h1-6-217" id="h1-6-217" class="i">+
</a><a href="#h1-6-218" id="h1-6-218" class="i">+	if (enableinspector)
</a><a href="#h1-6-219" id="h1-6-219" class="i">+		c-&gt;inspector = webkit_web_view_get_inspector(c-&gt;view);
</a><a href="#h1-6-220" id="h1-6-220" class="i">+
</a><a href="#h1-6-221" id="h1-6-221" class="i">+	c-&gt;finder = webkit_web_view_get_find_controller(c-&gt;view);
</a><a href="#h1-6-222" id="h1-6-222" class="i">+
</a><a href="#h1-6-223" id="h1-6-223" class="i">+	if (!kioskmode)
</a><a href="#h1-6-224" id="h1-6-224" class="i">+		addaccelgroup(c);
</a> 
<a href="#h1-6-226" id="h1-6-226" class="d">-	spawn(c, &amp;arg);
</a><a href="#h1-6-227" id="h1-6-227" class="i">+	/* Arranging */
</a><a href="#h1-6-228" id="h1-6-228" class="i">+	gtk_container_add(GTK_CONTAINER(c-&gt;win), GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-229" id="h1-6-229" class="i">+
</a><a href="#h1-6-230" id="h1-6-230" class="i">+	/* Setup */
</a><a href="#h1-6-231" id="h1-6-231" class="i">+	gtk_widget_grab_focus(GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-232" id="h1-6-232" class="i">+	gtk_widget_show(GTK_WIDGET(c-&gt;view));
</a><a href="#h1-6-233" id="h1-6-233" class="i">+	gtk_widget_show(c-&gt;win);
</a><a href="#h1-6-234" id="h1-6-234" class="i">+	gwin = gtk_widget_get_window(GTK_WIDGET(c-&gt;win));
</a><a href="#h1-6-235" id="h1-6-235" class="i">+	c-&gt;xid = gdk_x11_window_get_xid(gwin);
</a><a href="#h1-6-236" id="h1-6-236" class="i">+	gtk_window_set_geometry_hints(GTK_WINDOW(c-&gt;win), NULL, &amp;hints,
</a><a href="#h1-6-237" id="h1-6-237" class="i">+				      GDK_HINT_MIN_SIZE);
</a><a href="#h1-6-238" id="h1-6-238" class="i">+	gdk_window_set_events(gwin, GDK_ALL_EVENTS_MASK);
</a><a href="#h1-6-239" id="h1-6-239" class="i">+	gdk_window_add_filter(gwin, processx, c);
</a><a href="#h1-6-240" id="h1-6-240" class="i">+
</a><a href="#h1-6-241" id="h1-6-241" class="i">+	if (zoomlevel != 1.0)
</a><a href="#h1-6-242" id="h1-6-242" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel);
</a><a href="#h1-6-243" id="h1-6-243" class="i">+
</a><a href="#h1-6-244" id="h1-6-244" class="i">+	if (runinfullscreen)
</a><a href="#h1-6-245" id="h1-6-245" class="i">+		togglefullscreen(c, NULL);
</a><a href="#h1-6-246" id="h1-6-246" class="i">+
</a><a href="#h1-6-247" id="h1-6-247" class="i">+	setatom(c, AtomFind, &quot;&quot;);
</a><a href="#h1-6-248" id="h1-6-248" class="i">+	setatom(c, AtomUri, &quot;about:blank&quot;);
</a><a href="#h1-6-249" id="h1-6-249" class="i">+	if (hidebackground)
</a><a href="#h1-6-250" id="h1-6-250" class="i">+		webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h1-6-251" id="h1-6-251" class="i">+
</a><a href="#h1-6-252" id="h1-6-252" class="i">+	if (showxid) {
</a><a href="#h1-6-253" id="h1-6-253" class="i">+		gdk_display_sync(gtk_widget_get_display(c-&gt;win));
</a><a href="#h1-6-254" id="h1-6-254" class="i">+		printf(&quot;%lu\n&quot;, c-&gt;xid);
</a><a href="#h1-6-255" id="h1-6-255" class="i">+		fflush(NULL);
</a><a href="#h1-6-256" id="h1-6-256" class="i">+                if (fclose(stdout) != 0) {
</a><a href="#h1-6-257" id="h1-6-257" class="i">+			die(&quot;Error closing stdout&quot;);
</a><a href="#h1-6-258" id="h1-6-258" class="i">+                }
</a><a href="#h1-6-259" id="h1-6-259" class="i">+	}
</a> }
 
 GtkWidget *
<a href="#h1-7" id="h1-7" class="h">@@ -1126,60 +1005,254 @@ createwindow(Client *c)
</a> }
 
 void
<a href="#h1-7-3" id="h1-7-3" class="d">-pasteuri(GtkClipboard *clipboard, const char *text, gpointer d)
</a><a href="#h1-7-4" id="h1-7-4" class="i">+loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c)
</a> {
<a href="#h1-7-6" id="h1-7-6" class="d">-	Arg arg = {.v = text };
</a><a href="#h1-7-7" id="h1-7-7" class="d">-	if (text != NULL)
</a><a href="#h1-7-8" id="h1-7-8" class="d">-		loaduri((Client *) d, &amp;arg);
</a><a href="#h1-7-9" id="h1-7-9" class="i">+	switch (e) {
</a><a href="#h1-7-10" id="h1-7-10" class="i">+	case WEBKIT_LOAD_STARTED:
</a><a href="#h1-7-11" id="h1-7-11" class="i">+		c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-7-12" id="h1-7-12" class="i">+		break;
</a><a href="#h1-7-13" id="h1-7-13" class="i">+	case WEBKIT_LOAD_REDIRECTED:
</a><a href="#h1-7-14" id="h1-7-14" class="i">+		setatom(c, AtomUri, geturi(c));
</a><a href="#h1-7-15" id="h1-7-15" class="i">+		break;
</a><a href="#h1-7-16" id="h1-7-16" class="i">+	case WEBKIT_LOAD_COMMITTED:
</a><a href="#h1-7-17" id="h1-7-17" class="i">+		if (!webkit_web_view_get_tls_info(c-&gt;view, NULL, &amp;(c-&gt;tlsflags)))
</a><a href="#h1-7-18" id="h1-7-18" class="i">+			c-&gt;tlsflags = G_TLS_CERTIFICATE_VALIDATE_ALL + 1;
</a><a href="#h1-7-19" id="h1-7-19" class="i">+
</a><a href="#h1-7-20" id="h1-7-20" class="i">+		setatom(c, AtomUri, geturi(c));
</a><a href="#h1-7-21" id="h1-7-21" class="i">+
</a><a href="#h1-7-22" id="h1-7-22" class="i">+		if (enablestyle)
</a><a href="#h1-7-23" id="h1-7-23" class="i">+			setstyle(c, getstyle(geturi(c)));
</a><a href="#h1-7-24" id="h1-7-24" class="i">+		break;
</a><a href="#h1-7-25" id="h1-7-25" class="i">+	case WEBKIT_LOAD_FINISHED:
</a><a href="#h1-7-26" id="h1-7-26" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h1-7-27" id="h1-7-27" class="i">+		 * manipulating the DOM directly.
</a><a href="#h1-7-28" id="h1-7-28" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h1-7-29" id="h1-7-29" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h1-7-30" id="h1-7-30" class="i">+		*/
</a><a href="#h1-7-31" id="h1-7-31" class="i">+		runscript(c);
</a><a href="#h1-7-32" id="h1-7-32" class="i">+		break;
</a><a href="#h1-7-33" id="h1-7-33" class="i">+	}
</a><a href="#h1-7-34" id="h1-7-34" class="i">+	updatetitle(c);
</a> }
 
 void
<a href="#h1-7-38" id="h1-7-38" class="d">-print(Client *c, const Arg *a)
</a><a href="#h1-7-39" id="h1-7-39" class="i">+progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c)
</a> {
<a href="#h1-7-41" id="h1-7-41" class="d">-	webkit_print_operation_run_dialog(webkit_print_operation_new(c-&gt;view),
</a><a href="#h1-7-42" id="h1-7-42" class="d">-	    GTK_WINDOW(c-&gt;win));
</a><a href="#h1-7-43" id="h1-7-43" class="i">+	c-&gt;progress = webkit_web_view_get_estimated_load_progress(c-&gt;view) *
</a><a href="#h1-7-44" id="h1-7-44" class="i">+	    100;
</a><a href="#h1-7-45" id="h1-7-45" class="i">+	updatetitle(c);
</a> }
 
<a href="#h1-7-48" id="h1-7-48" class="d">-GdkFilterReturn
</a><a href="#h1-7-49" id="h1-7-49" class="d">-processx(GdkXEvent *e, GdkEvent *event, gpointer d)
</a><a href="#h1-7-50" id="h1-7-50" class="i">+void
</a><a href="#h1-7-51" id="h1-7-51" class="i">+titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c)
</a> {
<a href="#h1-7-53" id="h1-7-53" class="d">-	Client *c = (Client *)d;
</a><a href="#h1-7-54" id="h1-7-54" class="d">-	XPropertyEvent *ev;
</a><a href="#h1-7-55" id="h1-7-55" class="i">+	c-&gt;title = webkit_web_view_get_title(c-&gt;view);
</a><a href="#h1-7-56" id="h1-7-56" class="i">+	updatetitle(c);
</a><a href="#h1-7-57" id="h1-7-57" class="i">+}
</a><a href="#h1-7-58" id="h1-7-58" class="i">+
</a><a href="#h1-7-59" id="h1-7-59" class="i">+void
</a><a href="#h1-7-60" id="h1-7-60" class="i">+mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h, guint modifiers,
</a><a href="#h1-7-61" id="h1-7-61" class="i">+    Client *c)
</a><a href="#h1-7-62" id="h1-7-62" class="i">+{
</a><a href="#h1-7-63" id="h1-7-63" class="i">+	WebKitHitTestResultContext hc;
</a><a href="#h1-7-64" id="h1-7-64" class="i">+
</a><a href="#h1-7-65" id="h1-7-65" class="i">+	/* Keep the hit test to know where is the pointer on the next click */
</a><a href="#h1-7-66" id="h1-7-66" class="i">+	c-&gt;mousepos = h;
</a><a href="#h1-7-67" id="h1-7-67" class="i">+
</a><a href="#h1-7-68" id="h1-7-68" class="i">+	hc = webkit_hit_test_result_get_context(h);
</a><a href="#h1-7-69" id="h1-7-69" class="i">+
</a><a href="#h1-7-70" id="h1-7-70" class="i">+	if (hc &amp; OnLink)
</a><a href="#h1-7-71" id="h1-7-71" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h1-7-72" id="h1-7-72" class="i">+	else if (hc &amp; OnImg)
</a><a href="#h1-7-73" id="h1-7-73" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_image_uri(h);
</a><a href="#h1-7-74" id="h1-7-74" class="i">+	else if (hc &amp; OnMedia)
</a><a href="#h1-7-75" id="h1-7-75" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_media_uri(h);
</a><a href="#h1-7-76" id="h1-7-76" class="i">+	else
</a><a href="#h1-7-77" id="h1-7-77" class="i">+		c-&gt;targeturi = NULL;
</a><a href="#h1-7-78" id="h1-7-78" class="i">+	updatetitle(c);
</a><a href="#h1-7-79" id="h1-7-79" class="i">+}
</a><a href="#h1-7-80" id="h1-7-80" class="i">+
</a><a href="#h1-7-81" id="h1-7-81" class="i">+gboolean
</a><a href="#h1-7-82" id="h1-7-82" class="i">+permissionrequested(WebKitWebView *v, WebKitPermissionRequest *r, Client *c)
</a><a href="#h1-7-83" id="h1-7-83" class="i">+{
</a><a href="#h1-7-84" id="h1-7-84" class="i">+	if (WEBKIT_IS_GEOLOCATION_PERMISSION_REQUEST(r)) {
</a><a href="#h1-7-85" id="h1-7-85" class="i">+		if (allowgeolocation)
</a><a href="#h1-7-86" id="h1-7-86" class="i">+			webkit_permission_request_allow(r);
</a><a href="#h1-7-87" id="h1-7-87" class="i">+		else
</a><a href="#h1-7-88" id="h1-7-88" class="i">+			webkit_permission_request_deny(r);
</a><a href="#h1-7-89" id="h1-7-89" class="i">+		return TRUE;
</a><a href="#h1-7-90" id="h1-7-90" class="i">+	}
</a><a href="#h1-7-91" id="h1-7-91" class="i">+
</a><a href="#h1-7-92" id="h1-7-92" class="i">+	return FALSE;
</a><a href="#h1-7-93" id="h1-7-93" class="i">+}
</a><a href="#h1-7-94" id="h1-7-94" class="i">+
</a><a href="#h1-7-95" id="h1-7-95" class="i">+gboolean
</a><a href="#h1-7-96" id="h1-7-96" class="i">+decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h1-7-97" id="h1-7-97" class="i">+    WebKitPolicyDecisionType dt, Client *c)
</a><a href="#h1-7-98" id="h1-7-98" class="i">+{
</a><a href="#h1-7-99" id="h1-7-99" class="i">+	switch (dt) {
</a><a href="#h1-7-100" id="h1-7-100" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NAVIGATION_ACTION:
</a><a href="#h1-7-101" id="h1-7-101" class="i">+		decidenavigation(d, c);
</a><a href="#h1-7-102" id="h1-7-102" class="i">+		break;
</a><a href="#h1-7-103" id="h1-7-103" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NEW_WINDOW_ACTION:
</a><a href="#h1-7-104" id="h1-7-104" class="i">+		decidenewwindow(d, c);
</a><a href="#h1-7-105" id="h1-7-105" class="i">+		break;
</a><a href="#h1-7-106" id="h1-7-106" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_RESPONSE:
</a><a href="#h1-7-107" id="h1-7-107" class="i">+		decideresource(d, c);
</a><a href="#h1-7-108" id="h1-7-108" class="i">+		break;
</a><a href="#h1-7-109" id="h1-7-109" class="i">+	default:
</a><a href="#h1-7-110" id="h1-7-110" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h1-7-111" id="h1-7-111" class="i">+		break;
</a><a href="#h1-7-112" id="h1-7-112" class="i">+	}
</a><a href="#h1-7-113" id="h1-7-113" class="i">+	return TRUE;
</a><a href="#h1-7-114" id="h1-7-114" class="i">+}
</a><a href="#h1-7-115" id="h1-7-115" class="i">+
</a><a href="#h1-7-116" id="h1-7-116" class="i">+void
</a><a href="#h1-7-117" id="h1-7-117" class="i">+decidenavigation(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-7-118" id="h1-7-118" class="i">+{
</a><a href="#h1-7-119" id="h1-7-119" class="i">+	WebKitNavigationAction *a;
</a><a href="#h1-7-120" id="h1-7-120" class="i">+
</a><a href="#h1-7-121" id="h1-7-121" class="i">+	a = webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h1-7-122" id="h1-7-122" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h1-7-123" id="h1-7-123" class="i">+
</a><a href="#h1-7-124" id="h1-7-124" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-7-125" id="h1-7-125" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-7-126" id="h1-7-126" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-7-127" id="h1-7-127" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-7-128" id="h1-7-128" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-7-129" id="h1-7-129" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-7-130" id="h1-7-130" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-7-131" id="h1-7-131" class="i">+	default:
</a><a href="#h1-7-132" id="h1-7-132" class="i">+		/* Do not navigate to links with a &quot;_blank&quot; target (popup) */
</a><a href="#h1-7-133" id="h1-7-133" class="i">+		if (webkit_navigation_policy_decision_get_frame_name(
</a><a href="#h1-7-134" id="h1-7-134" class="i">+		    WEBKIT_NAVIGATION_POLICY_DECISION(d))) {
</a><a href="#h1-7-135" id="h1-7-135" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h1-7-136" id="h1-7-136" class="i">+		} else {
</a><a href="#h1-7-137" id="h1-7-137" class="i">+			/* Filter out navigation to different domain ? */
</a><a href="#h1-7-138" id="h1-7-138" class="i">+			/* get action→urirequest, copy and load in new window+view
</a><a href="#h1-7-139" id="h1-7-139" class="i">+			 * on Ctrl+Click ? */
</a><a href="#h1-7-140" id="h1-7-140" class="i">+			webkit_policy_decision_use(d);
</a><a href="#h1-7-141" id="h1-7-141" class="i">+		}
</a><a href="#h1-7-142" id="h1-7-142" class="i">+		break;
</a><a href="#h1-7-143" id="h1-7-143" class="i">+	}
</a><a href="#h1-7-144" id="h1-7-144" class="i">+}
</a><a href="#h1-7-145" id="h1-7-145" class="i">+
</a><a href="#h1-7-146" id="h1-7-146" class="i">+void
</a><a href="#h1-7-147" id="h1-7-147" class="i">+decidenewwindow(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-7-148" id="h1-7-148" class="i">+{
</a><a href="#h1-7-149" id="h1-7-149" class="i">+	WebKitNavigationAction *a;
</a> 	Arg arg;
 
<a href="#h1-7-152" id="h1-7-152" class="d">-	if (((XEvent *)e)-&gt;type == PropertyNotify) {
</a><a href="#h1-7-153" id="h1-7-153" class="d">-		ev = &amp;((XEvent *)e)-&gt;xproperty;
</a><a href="#h1-7-154" id="h1-7-154" class="d">-		if (ev-&gt;state == PropertyNewValue) {
</a><a href="#h1-7-155" id="h1-7-155" class="d">-			if (ev-&gt;atom == atoms[AtomFind]) {
</a><a href="#h1-7-156" id="h1-7-156" class="d">-				find(c, NULL);
</a><a href="#h1-7-157" id="h1-7-157" class="i">+	a = webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h1-7-158" id="h1-7-158" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h1-7-159" id="h1-7-159" class="i">+
</a><a href="#h1-7-160" id="h1-7-160" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h1-7-161" id="h1-7-161" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h1-7-162" id="h1-7-162" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h1-7-163" id="h1-7-163" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h1-7-164" id="h1-7-164" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h1-7-165" id="h1-7-165" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h1-7-166" id="h1-7-166" class="i">+		/* Filter domains here */
</a><a href="#h1-7-167" id="h1-7-167" class="i">+/* If the value of “mouse-button” is not 0, then the navigation was triggered by a mouse event.
</a><a href="#h1-7-168" id="h1-7-168" class="i">+ * test for link clicked but no button ? */
</a><a href="#h1-7-169" id="h1-7-169" class="i">+		arg.v = webkit_uri_request_get_uri(
</a><a href="#h1-7-170" id="h1-7-170" class="i">+		    webkit_navigation_action_get_request(a));
</a><a href="#h1-7-171" id="h1-7-171" class="i">+		newwindow(c, &amp;arg, 0);
</a><a href="#h1-7-172" id="h1-7-172" class="i">+		break;
</a><a href="#h1-7-173" id="h1-7-173" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h1-7-174" id="h1-7-174" class="i">+	default:
</a><a href="#h1-7-175" id="h1-7-175" class="i">+		break;
</a><a href="#h1-7-176" id="h1-7-176" class="i">+	}
</a><a href="#h1-7-177" id="h1-7-177" class="i">+
</a><a href="#h1-7-178" id="h1-7-178" class="i">+	webkit_policy_decision_ignore(d);
</a><a href="#h1-7-179" id="h1-7-179" class="i">+}
</a><a href="#h1-7-180" id="h1-7-180" class="i">+
</a><a href="#h1-7-181" id="h1-7-181" class="i">+void
</a><a href="#h1-7-182" id="h1-7-182" class="i">+decideresource(WebKitPolicyDecision *d, Client *c)
</a><a href="#h1-7-183" id="h1-7-183" class="i">+{
</a><a href="#h1-7-184" id="h1-7-184" class="i">+	const gchar *uri;
</a><a href="#h1-7-185" id="h1-7-185" class="i">+	int i, isascii = 1;
</a><a href="#h1-7-186" id="h1-7-186" class="i">+	WebKitResponsePolicyDecision *r = WEBKIT_RESPONSE_POLICY_DECISION(d);
</a><a href="#h1-7-187" id="h1-7-187" class="i">+	WebKitURIResponse *res;
</a><a href="#h1-7-188" id="h1-7-188" class="i">+
</a><a href="#h1-7-189" id="h1-7-189" class="i">+	res = webkit_response_policy_decision_get_response(r);
</a><a href="#h1-7-190" id="h1-7-190" class="i">+	uri = webkit_uri_response_get_uri(res);
</a><a href="#h1-7-191" id="h1-7-191" class="i">+
</a><a href="#h1-7-192" id="h1-7-192" class="i">+	if (g_str_has_suffix(uri, &quot;/favicon.ico&quot;))
</a><a href="#h1-7-193" id="h1-7-193" class="i">+		webkit_uri_request_set_uri(
</a><a href="#h1-7-194" id="h1-7-194" class="i">+		    webkit_response_policy_decision_get_request(r),
</a><a href="#h1-7-195" id="h1-7-195" class="i">+		    &quot;about:blank&quot;);
</a><a href="#h1-7-196" id="h1-7-196" class="i">+
</a><a href="#h1-7-197" id="h1-7-197" class="i">+	if (!g_str_has_prefix(uri, &quot;http://&quot;)
</a><a href="#h1-7-198" id="h1-7-198" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;https://&quot;)
</a><a href="#h1-7-199" id="h1-7-199" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;about:&quot;)
</a><a href="#h1-7-200" id="h1-7-200" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;file://&quot;)
</a><a href="#h1-7-201" id="h1-7-201" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;data:&quot;)
</a><a href="#h1-7-202" id="h1-7-202" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;blob:&quot;)
</a><a href="#h1-7-203" id="h1-7-203" class="i">+	    &amp;&amp; strlen(uri) &gt; 0) {
</a><a href="#h1-7-204" id="h1-7-204" class="i">+		for (i = 0; i &lt; strlen(uri); i++) {
</a><a href="#h1-7-205" id="h1-7-205" class="i">+			if (!g_ascii_isprint(uri[i])) {
</a><a href="#h1-7-206" id="h1-7-206" class="i">+				isascii = 0;
</a><a href="#h1-7-207" id="h1-7-207" class="i">+				break;
</a><a href="#h1-7-208" id="h1-7-208" class="i">+			}
</a><a href="#h1-7-209" id="h1-7-209" class="i">+		}
</a><a href="#h1-7-210" id="h1-7-210" class="i">+		if (isascii) {
</a><a href="#h1-7-211" id="h1-7-211" class="i">+			handleplumb(c, uri);
</a><a href="#h1-7-212" id="h1-7-212" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h1-7-213" id="h1-7-213" class="i">+		}
</a><a href="#h1-7-214" id="h1-7-214" class="i">+	}
</a><a href="#h1-7-215" id="h1-7-215" class="i">+
</a><a href="#h1-7-216" id="h1-7-216" class="i">+	if (webkit_response_policy_decision_is_mime_type_supported(r)) {
</a><a href="#h1-7-217" id="h1-7-217" class="i">+		webkit_policy_decision_use(d);
</a><a href="#h1-7-218" id="h1-7-218" class="i">+	} else {
</a><a href="#h1-7-219" id="h1-7-219" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h1-7-220" id="h1-7-220" class="i">+		download(c, res);
</a><a href="#h1-7-221" id="h1-7-221" class="i">+	}
</a><a href="#h1-7-222" id="h1-7-222" class="i">+}
</a><a href="#h1-7-223" id="h1-7-223" class="i">+
</a><a href="#h1-7-224" id="h1-7-224" class="i">+void
</a><a href="#h1-7-225" id="h1-7-225" class="i">+downloadstarted(WebKitWebContext *wc, WebKitDownload *d, Client *c)
</a><a href="#h1-7-226" id="h1-7-226" class="i">+{
</a><a href="#h1-7-227" id="h1-7-227" class="i">+	g_signal_connect(G_OBJECT(d), &quot;notify::response&quot;,
</a><a href="#h1-7-228" id="h1-7-228" class="i">+	    G_CALLBACK(responsereceived), c);
</a><a href="#h1-7-229" id="h1-7-229" class="i">+}
</a><a href="#h1-7-230" id="h1-7-230" class="i">+
</a><a href="#h1-7-231" id="h1-7-231" class="i">+void
</a><a href="#h1-7-232" id="h1-7-232" class="i">+responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c)
</a><a href="#h1-7-233" id="h1-7-233" class="i">+{
</a><a href="#h1-7-234" id="h1-7-234" class="i">+	download(c, webkit_download_get_response(d));
</a><a href="#h1-7-235" id="h1-7-235" class="i">+	webkit_download_cancel(d);
</a><a href="#h1-7-236" id="h1-7-236" class="i">+}
</a> 
<a href="#h1-7-238" id="h1-7-238" class="d">-				return GDK_FILTER_REMOVE;
</a><a href="#h1-7-239" id="h1-7-239" class="d">-			} else if (ev-&gt;atom == atoms[AtomGo]) {
</a><a href="#h1-7-240" id="h1-7-240" class="d">-				arg.v = getatom(c, AtomGo);
</a><a href="#h1-7-241" id="h1-7-241" class="d">-				loaduri(c, &amp;arg);
</a><a href="#h1-7-242" id="h1-7-242" class="i">+void
</a><a href="#h1-7-243" id="h1-7-243" class="i">+download(Client *c, WebKitURIResponse *r)
</a><a href="#h1-7-244" id="h1-7-244" class="i">+{
</a><a href="#h1-7-245" id="h1-7-245" class="i">+	Arg a;
</a> 
<a href="#h1-7-247" id="h1-7-247" class="d">-				return GDK_FILTER_REMOVE;
</a><a href="#h1-7-248" id="h1-7-248" class="d">-			}
</a><a href="#h1-7-249" id="h1-7-249" class="d">-		}
</a><a href="#h1-7-250" id="h1-7-250" class="d">-	}
</a><a href="#h1-7-251" id="h1-7-251" class="d">-	return GDK_FILTER_CONTINUE;
</a><a href="#h1-7-252" id="h1-7-252" class="i">+	a = (Arg)DOWNLOAD(webkit_uri_response_get_uri(r), geturi(c));
</a><a href="#h1-7-253" id="h1-7-253" class="i">+	spawn(c, &amp;a);
</a> }
 
 void
<a href="#h1-7-257" id="h1-7-257" class="d">-progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c)
</a><a href="#h1-7-258" id="h1-7-258" class="i">+closeview(WebKitWebView *v, Client *c)
</a> {
<a href="#h1-7-260" id="h1-7-260" class="d">-	c-&gt;progress = webkit_web_view_get_estimated_load_progress(c-&gt;view) *
</a><a href="#h1-7-261" id="h1-7-261" class="d">-	    100;
</a><a href="#h1-7-262" id="h1-7-262" class="d">-	updatetitle(c);
</a><a href="#h1-7-263" id="h1-7-263" class="i">+	gtk_widget_destroy(c-&gt;win);
</a> }
 
 void
<a href="#h1-7-267" id="h1-7-267" class="d">-clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h1-7-268" id="h1-7-268" class="i">+destroywin(GtkWidget* w, Client *c)
</a> {
<a href="#h1-7-270" id="h1-7-270" class="d">-	Arg arg;
</a><a href="#h1-7-271" id="h1-7-271" class="i">+	destroyclient(c);
</a><a href="#h1-7-272" id="h1-7-272" class="i">+	if (clients == NULL)
</a><a href="#h1-7-273" id="h1-7-273" class="i">+		gtk_main_quit();
</a><a href="#h1-7-274" id="h1-7-274" class="i">+}
</a> 
<a href="#h1-7-276" id="h1-7-276" class="d">-	arg.v = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h1-7-277" id="h1-7-277" class="d">-	newwindow(c, &amp;arg, a-&gt;b);
</a><a href="#h1-7-278" id="h1-7-278" class="i">+void
</a><a href="#h1-7-279" id="h1-7-279" class="i">+pasteuri(GtkClipboard *clipboard, const char *text, gpointer d)
</a><a href="#h1-7-280" id="h1-7-280" class="i">+{
</a><a href="#h1-7-281" id="h1-7-281" class="i">+	Arg arg = {.v = text };
</a><a href="#h1-7-282" id="h1-7-282" class="i">+	if (text != NULL)
</a><a href="#h1-7-283" id="h1-7-283" class="i">+		loaduri((Client *) d, &amp;arg);
</a> }
 
 void
<a href="#h1-8" id="h1-8" class="h">@@ -1193,88 +1266,60 @@ reload(Client *c, const Arg *arg)
</a> }
 
 void
<a href="#h1-8-3" id="h1-8-3" class="d">-scroll_h(Client *c, const Arg *a)
</a><a href="#h1-8-4" id="h1-8-4" class="i">+print(Client *c, const Arg *a)
</a> {
<a href="#h1-8-6" id="h1-8-6" class="d">-	evalscript(c, &quot;window.scrollBy(%d * (window.innerWidth / 100), 0)&quot;,
</a><a href="#h1-8-7" id="h1-8-7" class="d">-	    a-&gt;i);
</a><a href="#h1-8-8" id="h1-8-8" class="i">+	webkit_print_operation_run_dialog(webkit_print_operation_new(c-&gt;view),
</a><a href="#h1-8-9" id="h1-8-9" class="i">+	    GTK_WINDOW(c-&gt;win));
</a> }
 
 void
<a href="#h1-8-13" id="h1-8-13" class="d">-scroll_v(Client *c, const Arg *a)
</a><a href="#h1-8-14" id="h1-8-14" class="i">+clipboard(Client *c, const Arg *a)
</a> {
<a href="#h1-8-16" id="h1-8-16" class="d">-	evalscript(c, &quot;window.scrollBy(0, %d * (window.innerHeight / 100))&quot;,
</a><a href="#h1-8-17" id="h1-8-17" class="d">-	    a-&gt;i);
</a><a href="#h1-8-18" id="h1-8-18" class="i">+	if (a-&gt;b) { /* load clipboard uri */
</a><a href="#h1-8-19" id="h1-8-19" class="i">+		gtk_clipboard_request_text(gtk_clipboard_get(
</a><a href="#h1-8-20" id="h1-8-20" class="i">+		                           GDK_SELECTION_PRIMARY),
</a><a href="#h1-8-21" id="h1-8-21" class="i">+		                           pasteuri, c);
</a><a href="#h1-8-22" id="h1-8-22" class="i">+	} else { /* copy uri */
</a><a href="#h1-8-23" id="h1-8-23" class="i">+		gtk_clipboard_set_text(gtk_clipboard_get(
</a><a href="#h1-8-24" id="h1-8-24" class="i">+		                       GDK_SELECTION_PRIMARY), c-&gt;targeturi
</a><a href="#h1-8-25" id="h1-8-25" class="i">+		                       ? c-&gt;targeturi : geturi(c), -1);
</a><a href="#h1-8-26" id="h1-8-26" class="i">+	}
</a> }
 
 void
<a href="#h1-8-30" id="h1-8-30" class="d">-setatom(Client *c, int a, const char *v)
</a><a href="#h1-8-31" id="h1-8-31" class="i">+zoom(Client *c, const Arg *a)
</a> {
<a href="#h1-8-33" id="h1-8-33" class="d">-	XSync(dpy, False);
</a><a href="#h1-8-34" id="h1-8-34" class="d">-	XChangeProperty(dpy, c-&gt;xid,
</a><a href="#h1-8-35" id="h1-8-35" class="d">-			atoms[a], XA_STRING, 8, PropModeReplace,
</a><a href="#h1-8-36" id="h1-8-36" class="d">-			(unsigned char *)v, strlen(v) + 1);
</a><a href="#h1-8-37" id="h1-8-37" class="i">+	if (a-&gt;i &gt; 0)
</a><a href="#h1-8-38" id="h1-8-38" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel + 0.1);
</a><a href="#h1-8-39" id="h1-8-39" class="i">+	else if (a-&gt;i &lt; 0)
</a><a href="#h1-8-40" id="h1-8-40" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel - 0.1);
</a><a href="#h1-8-41" id="h1-8-41" class="i">+	else
</a><a href="#h1-8-42" id="h1-8-42" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, 1.0);
</a><a href="#h1-8-43" id="h1-8-43" class="i">+
</a><a href="#h1-8-44" id="h1-8-44" class="i">+	zoomlevel = webkit_web_view_get_zoom_level(c-&gt;view);
</a> }
 
 void
<a href="#h1-8-48" id="h1-8-48" class="d">-setup(void)
</a><a href="#h1-8-49" id="h1-8-49" class="i">+scroll_v(Client *c, const Arg *a)
</a> {
<a href="#h1-8-51" id="h1-8-51" class="d">-	int i;
</a><a href="#h1-8-52" id="h1-8-52" class="d">-
</a><a href="#h1-8-53" id="h1-8-53" class="d">-	/* clean up any zombies immediately */
</a><a href="#h1-8-54" id="h1-8-54" class="d">-	sigchld(0);
</a><a href="#h1-8-55" id="h1-8-55" class="d">-	gtk_init(NULL, NULL);
</a><a href="#h1-8-56" id="h1-8-56" class="d">-
</a><a href="#h1-8-57" id="h1-8-57" class="d">-	dpy = GDK_DISPLAY_XDISPLAY(gdk_display_get_default());
</a><a href="#h1-8-58" id="h1-8-58" class="d">-
</a><a href="#h1-8-59" id="h1-8-59" class="d">-	/* atoms */
</a><a href="#h1-8-60" id="h1-8-60" class="d">-	atoms[AtomFind] = XInternAtom(dpy, &quot;_SURF_FIND&quot;, False);
</a><a href="#h1-8-61" id="h1-8-61" class="d">-	atoms[AtomGo] = XInternAtom(dpy, &quot;_SURF_GO&quot;, False);
</a><a href="#h1-8-62" id="h1-8-62" class="d">-	atoms[AtomUri] = XInternAtom(dpy, &quot;_SURF_URI&quot;, False);
</a><a href="#h1-8-63" id="h1-8-63" class="d">-
</a><a href="#h1-8-64" id="h1-8-64" class="d">-	/* dirs and files */
</a><a href="#h1-8-65" id="h1-8-65" class="d">-	cookiefile = buildfile(cookiefile);
</a><a href="#h1-8-66" id="h1-8-66" class="d">-	scriptfile = buildfile(scriptfile);
</a><a href="#h1-8-67" id="h1-8-67" class="d">-	cachedir   = buildpath(cachedir);
</a><a href="#h1-8-68" id="h1-8-68" class="d">-
</a><a href="#h1-8-69" id="h1-8-69" class="d">-	if (stylefile == NULL) {
</a><a href="#h1-8-70" id="h1-8-70" class="d">-		styledir = buildpath(styledir);
</a><a href="#h1-8-71" id="h1-8-71" class="d">-		for (i = 0; i &lt; LENGTH(styles); i++) {
</a><a href="#h1-8-72" id="h1-8-72" class="d">-			if (regcomp(&amp;(styles[i].re), styles[i].regex,
</a><a href="#h1-8-73" id="h1-8-73" class="d">-			    REG_EXTENDED)) {
</a><a href="#h1-8-74" id="h1-8-74" class="d">-				fprintf(stderr,
</a><a href="#h1-8-75" id="h1-8-75" class="d">-				        &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h1-8-76" id="h1-8-76" class="d">-				        styles[i].regex);
</a><a href="#h1-8-77" id="h1-8-77" class="d">-				styles[i].regex = NULL;
</a><a href="#h1-8-78" id="h1-8-78" class="d">-			}
</a><a href="#h1-8-79" id="h1-8-79" class="d">-			styles[i].style = g_strconcat(styledir, &quot;/&quot;,
</a><a href="#h1-8-80" id="h1-8-80" class="d">-			    styles[i].style, NULL);
</a><a href="#h1-8-81" id="h1-8-81" class="d">-		}
</a><a href="#h1-8-82" id="h1-8-82" class="d">-		g_free(styledir);
</a><a href="#h1-8-83" id="h1-8-83" class="d">-	} else {
</a><a href="#h1-8-84" id="h1-8-84" class="d">-		stylefile = buildfile(stylefile);
</a><a href="#h1-8-85" id="h1-8-85" class="d">-	}
</a><a href="#h1-8-86" id="h1-8-86" class="i">+	evalscript(c, &quot;window.scrollBy(0, %d * (window.innerHeight / 100))&quot;,
</a><a href="#h1-8-87" id="h1-8-87" class="i">+	    a-&gt;i);
</a> }
 
 void
<a href="#h1-8-91" id="h1-8-91" class="d">-sigchld(int unused)
</a><a href="#h1-8-92" id="h1-8-92" class="i">+scroll_h(Client *c, const Arg *a)
</a> {
<a href="#h1-8-94" id="h1-8-94" class="d">-	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h1-8-95" id="h1-8-95" class="d">-		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h1-8-96" id="h1-8-96" class="d">-	while (0 &lt; waitpid(-1, NULL, WNOHANG));
</a><a href="#h1-8-97" id="h1-8-97" class="i">+	evalscript(c, &quot;window.scrollBy(%d * (window.innerWidth / 100), 0)&quot;,
</a><a href="#h1-8-98" id="h1-8-98" class="i">+	    a-&gt;i);
</a> }
 
 void
<a href="#h1-8-102" id="h1-8-102" class="d">-spawn(Client *c, const Arg *arg)
</a><a href="#h1-8-103" id="h1-8-103" class="i">+navigate(Client *c, const Arg *a)
</a> {
<a href="#h1-8-105" id="h1-8-105" class="d">-	if (fork() == 0) {
</a><a href="#h1-8-106" id="h1-8-106" class="d">-		if (dpy)
</a><a href="#h1-8-107" id="h1-8-107" class="d">-			close(ConnectionNumber(dpy));
</a><a href="#h1-8-108" id="h1-8-108" class="d">-		setsid();
</a><a href="#h1-8-109" id="h1-8-109" class="d">-		execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
</a><a href="#h1-8-110" id="h1-8-110" class="d">-		fprintf(stderr, &quot;surf: execvp %s&quot;, ((char **)arg-&gt;v)[0]);
</a><a href="#h1-8-111" id="h1-8-111" class="d">-		perror(&quot; failed&quot;);
</a><a href="#h1-8-112" id="h1-8-112" class="d">-		exit(0);
</a><a href="#h1-8-113" id="h1-8-113" class="d">-	}
</a><a href="#h1-8-114" id="h1-8-114" class="i">+	if (a-&gt;i &lt; 0)
</a><a href="#h1-8-115" id="h1-8-115" class="i">+		webkit_web_view_go_back(c-&gt;view);
</a><a href="#h1-8-116" id="h1-8-116" class="i">+	else if (a-&gt;i &gt; 0)
</a><a href="#h1-8-117" id="h1-8-117" class="i">+		webkit_web_view_go_forward(c-&gt;view);
</a> }
 
 void
<a href="#h1-9" id="h1-9" class="h">@@ -1284,35 +1329,6 @@ stop(Client *c, const Arg *arg)
</a> }
 
 void
<a href="#h1-9-3" id="h1-9-3" class="d">-titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c)
</a><a href="#h1-9-4" id="h1-9-4" class="d">-{
</a><a href="#h1-9-5" id="h1-9-5" class="d">-	c-&gt;title = webkit_web_view_get_title(c-&gt;view);
</a><a href="#h1-9-6" id="h1-9-6" class="d">-	updatetitle(c);
</a><a href="#h1-9-7" id="h1-9-7" class="d">-}
</a><a href="#h1-9-8" id="h1-9-8" class="d">-
</a><a href="#h1-9-9" id="h1-9-9" class="d">-gboolean
</a><a href="#h1-9-10" id="h1-9-10" class="d">-winevent(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h1-9-11" id="h1-9-11" class="d">-{
</a><a href="#h1-9-12" id="h1-9-12" class="d">-	switch (e-&gt;type) {
</a><a href="#h1-9-13" id="h1-9-13" class="d">-	case GDK_LEAVE_NOTIFY:
</a><a href="#h1-9-14" id="h1-9-14" class="d">-		c-&gt;targeturi = NULL;
</a><a href="#h1-9-15" id="h1-9-15" class="d">-		updatetitle(c);
</a><a href="#h1-9-16" id="h1-9-16" class="d">-		break;
</a><a href="#h1-9-17" id="h1-9-17" class="d">-	case GDK_WINDOW_STATE: /* fallthrough */
</a><a href="#h1-9-18" id="h1-9-18" class="d">-		if (e-&gt;window_state.changed_mask ==
</a><a href="#h1-9-19" id="h1-9-19" class="d">-		    GDK_WINDOW_STATE_FULLSCREEN) {
</a><a href="#h1-9-20" id="h1-9-20" class="d">-			c-&gt;fullscreen = e-&gt;window_state.new_window_state &amp;
</a><a href="#h1-9-21" id="h1-9-21" class="d">-			    GDK_WINDOW_STATE_FULLSCREEN;
</a><a href="#h1-9-22" id="h1-9-22" class="d">-			break;
</a><a href="#h1-9-23" id="h1-9-23" class="d">-		}
</a><a href="#h1-9-24" id="h1-9-24" class="d">-	default:
</a><a href="#h1-9-25" id="h1-9-25" class="d">-		return FALSE;
</a><a href="#h1-9-26" id="h1-9-26" class="d">-	}
</a><a href="#h1-9-27" id="h1-9-27" class="d">-
</a><a href="#h1-9-28" id="h1-9-28" class="d">-	return TRUE;
</a><a href="#h1-9-29" id="h1-9-29" class="d">-}
</a><a href="#h1-9-30" id="h1-9-30" class="d">-
</a><a href="#h1-9-31" id="h1-9-31" class="d">-void
</a> toggle(Client *c, const Arg *a)
 {
 	WebKitSettings *s;
<a href="#h1-10" id="h1-10" class="h">@@ -1363,6 +1379,16 @@ toggle(Client *c, const Arg *a)
</a> }
 
 void
<a href="#h1-10-3" id="h1-10-3" class="i">+togglefullscreen(Client *c, const Arg *a)
</a><a href="#h1-10-4" id="h1-10-4" class="i">+{
</a><a href="#h1-10-5" id="h1-10-5" class="i">+	/* toggling value is handled in winevent() */
</a><a href="#h1-10-6" id="h1-10-6" class="i">+	if (c-&gt;fullscreen)
</a><a href="#h1-10-7" id="h1-10-7" class="i">+		gtk_window_unfullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h1-10-8" id="h1-10-8" class="i">+	else
</a><a href="#h1-10-9" id="h1-10-9" class="i">+		gtk_window_fullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h1-10-10" id="h1-10-10" class="i">+}
</a><a href="#h1-10-11" id="h1-10-11" class="i">+
</a><a href="#h1-10-12" id="h1-10-12" class="i">+void
</a> togglecookiepolicy(Client *c, const Arg *arg)
 {
 	++cookiepolicy;
<a href="#h1-11" id="h1-11" class="h">@@ -1387,80 +1413,53 @@ togglestyle(Client *c, const Arg *arg)
</a> }
 
 void
<a href="#h1-11-3" id="h1-11-3" class="d">-gettogglestats(Client *c)
</a><a href="#h1-11-4" id="h1-11-4" class="i">+toggleinspector(Client *c, const Arg *a)
</a> {
<a href="#h1-11-6" id="h1-11-6" class="d">-	togglestats[0] = cookiepolicy_set(cookiepolicy_get());
</a><a href="#h1-11-7" id="h1-11-7" class="d">-	togglestats[1] = enablecaretbrowsing ? &#39;C&#39; : &#39;c&#39;;
</a><a href="#h1-11-8" id="h1-11-8" class="d">-	togglestats[2] = allowgeolocation ? &#39;G&#39; : &#39;g&#39;;
</a><a href="#h1-11-9" id="h1-11-9" class="d">-	togglestats[3] = enablecache ? &#39;D&#39; : &#39;d&#39;;
</a><a href="#h1-11-10" id="h1-11-10" class="d">-	togglestats[4] = loadimages ? &#39;I&#39; : &#39;i&#39;;
</a><a href="#h1-11-11" id="h1-11-11" class="d">-	togglestats[5] = enablescripts ? &#39;S&#39;: &#39;s&#39;;
</a><a href="#h1-11-12" id="h1-11-12" class="d">-	togglestats[6] = enableplugins ? &#39;V&#39; : &#39;v&#39;;
</a><a href="#h1-11-13" id="h1-11-13" class="d">-	togglestats[7] = enablestyle ? &#39;M&#39; : &#39;m&#39;;
</a><a href="#h1-11-14" id="h1-11-14" class="d">-	togglestats[8] = enableframeflattening ? &#39;F&#39; : &#39;f&#39;;
</a><a href="#h1-11-15" id="h1-11-15" class="d">-	togglestats[9] = &#39;\0&#39;;
</a><a href="#h1-11-16" id="h1-11-16" class="i">+	if (enableinspector) {
</a><a href="#h1-11-17" id="h1-11-17" class="i">+		if (webkit_web_inspector_is_attached(c-&gt;inspector))
</a><a href="#h1-11-18" id="h1-11-18" class="i">+			webkit_web_inspector_close(c-&gt;inspector);
</a><a href="#h1-11-19" id="h1-11-19" class="i">+		else
</a><a href="#h1-11-20" id="h1-11-20" class="i">+			webkit_web_inspector_show(c-&gt;inspector);
</a><a href="#h1-11-21" id="h1-11-21" class="i">+	}
</a> }
 
 void
<a href="#h1-11-25" id="h1-11-25" class="d">-getpagestats(Client *c)
</a><a href="#h1-11-26" id="h1-11-26" class="i">+find(Client *c, const Arg *a)
</a> {
<a href="#h1-11-28" id="h1-11-28" class="d">-	pagestats[0] = c-&gt;tlsflags &gt; G_TLS_CERTIFICATE_VALIDATE_ALL ? &#39;-&#39; :
</a><a href="#h1-11-29" id="h1-11-29" class="d">-	    c-&gt;tlsflags &gt; 0 ? &#39;U&#39; : &#39;T&#39;;
</a><a href="#h1-11-30" id="h1-11-30" class="d">-	pagestats[1] = &#39;\0&#39;;
</a><a href="#h1-11-31" id="h1-11-31" class="d">-}
</a><a href="#h1-11-32" id="h1-11-32" class="i">+	const char *s, *f;
</a> 
<a href="#h1-11-34" id="h1-11-34" class="d">-void
</a><a href="#h1-11-35" id="h1-11-35" class="d">-updatetitle(Client *c)
</a><a href="#h1-11-36" id="h1-11-36" class="d">-{
</a><a href="#h1-11-37" id="h1-11-37" class="d">-	char *title;
</a><a href="#h1-11-38" id="h1-11-38" class="i">+	if (a &amp;&amp; a-&gt;i) {
</a><a href="#h1-11-39" id="h1-11-39" class="i">+		if (a-&gt;i &gt; 0)
</a><a href="#h1-11-40" id="h1-11-40" class="i">+			webkit_find_controller_search_next(c-&gt;finder);
</a><a href="#h1-11-41" id="h1-11-41" class="i">+		else
</a><a href="#h1-11-42" id="h1-11-42" class="i">+			webkit_find_controller_search_previous(c-&gt;finder);
</a><a href="#h1-11-43" id="h1-11-43" class="i">+	} else {
</a><a href="#h1-11-44" id="h1-11-44" class="i">+		s = getatom(c, AtomFind);
</a><a href="#h1-11-45" id="h1-11-45" class="i">+		f = webkit_find_controller_get_search_text(c-&gt;finder);
</a> 
<a href="#h1-11-47" id="h1-11-47" class="d">-	if (showindicators) {
</a><a href="#h1-11-48" id="h1-11-48" class="d">-		gettogglestats(c);
</a><a href="#h1-11-49" id="h1-11-49" class="d">-		getpagestats(c);
</a><a href="#h1-11-50" id="h1-11-50" class="i">+		if (g_strcmp0(f, s) == 0) /* reset search */
</a><a href="#h1-11-51" id="h1-11-51" class="i">+			webkit_find_controller_search(c-&gt;finder, &quot;&quot;, findopts, G_MAXUINT);
</a> 
<a href="#h1-11-53" id="h1-11-53" class="d">-		if (c-&gt;progress != 100) {
</a><a href="#h1-11-54" id="h1-11-54" class="d">-			title = g_strdup_printf(&quot;[%i%%] %s:%s | %s&quot;,
</a><a href="#h1-11-55" id="h1-11-55" class="d">-			    c-&gt;progress, togglestats, pagestats,
</a><a href="#h1-11-56" id="h1-11-56" class="d">-			    c-&gt;targeturi ? c-&gt;targeturi : c-&gt;title);
</a><a href="#h1-11-57" id="h1-11-57" class="d">-		} else {
</a><a href="#h1-11-58" id="h1-11-58" class="d">-			title = g_strdup_printf(&quot;%s:%s | %s&quot;,
</a><a href="#h1-11-59" id="h1-11-59" class="d">-			    togglestats, pagestats,
</a><a href="#h1-11-60" id="h1-11-60" class="d">-			    c-&gt;targeturi ? c-&gt;targeturi : c-&gt;title);
</a><a href="#h1-11-61" id="h1-11-61" class="d">-		}
</a><a href="#h1-11-62" id="h1-11-62" class="i">+		webkit_find_controller_search(c-&gt;finder, s, findopts, G_MAXUINT);
</a> 
<a href="#h1-11-64" id="h1-11-64" class="d">-		gtk_window_set_title(GTK_WINDOW(c-&gt;win), title);
</a><a href="#h1-11-65" id="h1-11-65" class="d">-		g_free(title);
</a><a href="#h1-11-66" id="h1-11-66" class="d">-	} else {
</a><a href="#h1-11-67" id="h1-11-67" class="d">-		gtk_window_set_title(GTK_WINDOW(c-&gt;win), c-&gt;title ?
</a><a href="#h1-11-68" id="h1-11-68" class="d">-		    c-&gt;title : &quot;&quot;);
</a><a href="#h1-11-69" id="h1-11-69" class="i">+		if (strcmp(s, &quot;&quot;) == 0)
</a><a href="#h1-11-70" id="h1-11-70" class="i">+			webkit_find_controller_search_finish(c-&gt;finder);
</a> 	}
 }
 
 void
<a href="#h1-11-75" id="h1-11-75" class="d">-updatewinid(Client *c)
</a><a href="#h1-11-76" id="h1-11-76" class="d">-{
</a><a href="#h1-11-77" id="h1-11-77" class="d">-	snprintf(winid, LENGTH(winid), &quot;%lu&quot;, c-&gt;xid);
</a><a href="#h1-11-78" id="h1-11-78" class="d">-}
</a><a href="#h1-11-79" id="h1-11-79" class="d">-
</a><a href="#h1-11-80" id="h1-11-80" class="d">-void
</a><a href="#h1-11-81" id="h1-11-81" class="d">-usage(void)
</a><a href="#h1-11-82" id="h1-11-82" class="i">+clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h)
</a> {
<a href="#h1-11-84" id="h1-11-84" class="d">-	die(&quot;usage: %s [-bBdDfFgGiIkKmMnNpPsSvx] [-a cookiepolicies ] &quot;
</a><a href="#h1-11-85" id="h1-11-85" class="d">-	    &quot;[-c cookiefile] [-e xid] [-r scriptfile] [-t stylefile] &quot;
</a><a href="#h1-11-86" id="h1-11-86" class="d">-	    &quot;[-u useragent] [-z zoomlevel] [uri]\n&quot;, basename(argv0));
</a><a href="#h1-11-87" id="h1-11-87" class="i">+	navigate(c, a);
</a> }
 
 void
<a href="#h1-11-91" id="h1-11-91" class="d">-zoom(Client *c, const Arg *a)
</a><a href="#h1-11-92" id="h1-11-92" class="i">+clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h)
</a> {
<a href="#h1-11-94" id="h1-11-94" class="d">-	if (a-&gt;i &gt; 0)
</a><a href="#h1-11-95" id="h1-11-95" class="d">-		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel + 0.1);
</a><a href="#h1-11-96" id="h1-11-96" class="d">-	else if (a-&gt;i &lt; 0)
</a><a href="#h1-11-97" id="h1-11-97" class="d">-		webkit_web_view_set_zoom_level(c-&gt;view, zoomlevel - 0.1);
</a><a href="#h1-11-98" id="h1-11-98" class="d">-	else
</a><a href="#h1-11-99" id="h1-11-99" class="d">-		webkit_web_view_set_zoom_level(c-&gt;view, 1.0);
</a><a href="#h1-11-100" id="h1-11-100" class="i">+	Arg arg;
</a> 
<a href="#h1-11-102" id="h1-11-102" class="d">-	zoomlevel = webkit_web_view_get_zoom_level(c-&gt;view);
</a><a href="#h1-11-103" id="h1-11-103" class="i">+	arg.v = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h1-11-104" id="h1-11-104" class="i">+	newwindow(c, &amp;arg, a-&gt;b);
</a> }
 
 int
<a href="#h1-12" id="h1-12" class="h">@@ -1579,4 +1578,3 @@ main(int argc, char *argv[])
</a> 
 	return EXIT_SUCCESS;
 }
<a href="#h1-12-3" id="h1-12-3" class="d">-
</a></pre>
</div>
</body>
</html>
