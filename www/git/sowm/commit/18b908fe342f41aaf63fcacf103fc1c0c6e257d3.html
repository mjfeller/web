<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>catwm: spring cleaning - sowm - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="sowm Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>sowm</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/18b908fe342f41aaf63fcacf103fc1c0c6e257d3.html">18b908fe342f41aaf63fcacf103fc1c0c6e257d3</a>
<b>parent</b> <a href="../commit/445d61a269e8ac774cfd99d4f4e136539419ad02.html">445d61a269e8ac774cfd99d4f4e136539419ad02</a>
<b>Author:</b> Dylan Araps &lt;<a href="mailto:dylan.araps@gmail.com">dylan.araps@gmail.com</a>&gt;
<b>Date:</b>   Fri, 11 Oct 2019 18:52:07 +0300

catwm: spring cleaning

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">catwm.c</a></td><td> | </td><td class="num">252</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 109 insertions(+), 143 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/catwm.c.html">catwm.c</a> b/<a href="../file/catwm.c.html">catwm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -4,29 +4,8 @@
</a>  *  (  =^=  )
  *  (        )            ... for cat!
  *  (         )
<a href="#h0-0-3" id="h0-0-3" class="d">- *  (          ))))))________________ Cute And Tiny Window Manager
</a><a href="#h0-0-4" id="h0-0-4" class="d">- *  ______________________________________________________________________________
</a><a href="#h0-0-5" id="h0-0-5" class="d">- *
</a><a href="#h0-0-6" id="h0-0-6" class="d">- *  Copyright (c) 2010, Rinaldini Julien, julien.rinaldini@heig-vd.ch
</a><a href="#h0-0-7" id="h0-0-7" class="d">- *
</a><a href="#h0-0-8" id="h0-0-8" class="d">- *  Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h0-0-9" id="h0-0-9" class="d">- *  copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h0-0-10" id="h0-0-10" class="d">- *  to deal in the Software without restriction, including without limitation
</a><a href="#h0-0-11" id="h0-0-11" class="d">- *  the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h0-0-12" id="h0-0-12" class="d">- *  and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h0-0-13" id="h0-0-13" class="d">- *  Software is furnished to do so, subject to the following conditions:
</a><a href="#h0-0-14" id="h0-0-14" class="d">- *
</a><a href="#h0-0-15" id="h0-0-15" class="d">- *  The above copyright notice and this permission notice shall be included in
</a><a href="#h0-0-16" id="h0-0-16" class="d">- *  all copies or substantial portions of the Software.
</a><a href="#h0-0-17" id="h0-0-17" class="d">- *
</a><a href="#h0-0-18" id="h0-0-18" class="d">- *  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h0-0-19" id="h0-0-19" class="d">- *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h0-0-20" id="h0-0-20" class="d">- *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h0-0-21" id="h0-0-21" class="d">- *  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h0-0-22" id="h0-0-22" class="d">- *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h0-0-23" id="h0-0-23" class="d">- *  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h0-0-24" id="h0-0-24" class="d">- *  DEALINGS IN THE SOFTWARE.
</a><a href="#h0-0-25" id="h0-0-25" class="d">- *
</a><a href="#h0-0-26" id="h0-0-26" class="i">+ *  (          ))))))________________
</a><a href="#h0-0-27" id="h0-0-27" class="i">+ *  __________________
</a>  */
 
 #include &lt;X11/Xlib.h&gt;
<a href="#h0-1" id="h0-1" class="h">@@ -47,7 +26,6 @@ typedef union {
</a>     const int i;
 } Arg;
 
<a href="#h0-1-3" id="h0-1-3" class="d">-// Structs
</a> struct key {
     unsigned int mod;
     KeySym keysym;
<a href="#h0-2" id="h0-2" class="h">@@ -70,7 +48,6 @@ struct desktop{
</a>     client *current;
 };
 
<a href="#h0-2-3" id="h0-2-3" class="d">-// Functions
</a> static void add_window(Window w);
 static void buttonpress(XEvent *e);
 static void buttonrelease(XEvent *e);
<a href="#h0-3" id="h0-3" class="h">@@ -78,8 +55,8 @@ static void change_desktop(const Arg arg);
</a> static void client_to_desktop(const Arg arg);
 static void configurerequest(XEvent *e);
 static void destroynotify(XEvent *e);
<a href="#h0-3-3" id="h0-3-3" class="d">-static void die(const char* e);
</a> static void grabkeys();
<a href="#h0-3-5" id="h0-3-5" class="i">+static void init();
</a> static void keypress(XEvent *e);
 static void kill_client();
 static void maprequest(XEvent *e);
<a href="#h0-4" id="h0-4" class="h">@@ -92,27 +69,24 @@ static void send_kill_signal(Window w);
</a> static void setup();
 static void sigchld(int unused);
 static void spawn(const Arg arg);
<a href="#h0-4-3" id="h0-4-3" class="d">-static void init();
</a> static void update_current();
 
<a href="#h0-4-6" id="h0-4-6" class="d">-// Include configuration file (need struct key)
</a> #include &quot;config.h&quot;
 
<a href="#h0-4-9" id="h0-4-9" class="d">-// Variable
</a><a href="#h0-4-10" id="h0-4-10" class="d">-static Display *dis;
</a> static int bool_quit;
<a href="#h0-4-12" id="h0-4-12" class="d">-static int current_desktop;
</a><a href="#h0-4-13" id="h0-4-13" class="i">+static int curr_desk;
</a> static int mode;
<a href="#h0-4-15" id="h0-4-15" class="i">+static int screen;
</a> static int sh;
 static int sw;
<a href="#h0-4-18" id="h0-4-18" class="d">-static int screen;
</a><a href="#h0-4-19" id="h0-4-19" class="i">+static Display *dis;
</a> static Window root;
<a href="#h0-4-21" id="h0-4-21" class="d">-static client *head;
</a><a href="#h0-4-22" id="h0-4-22" class="d">-static client *current;
</a><a href="#h0-4-23" id="h0-4-23" class="d">-static XWindowAttributes attr;
</a> static XButtonEvent start;
<a href="#h0-4-25" id="h0-4-25" class="i">+static XWindowAttributes attr;
</a><a href="#h0-4-26" id="h0-4-26" class="i">+static client *current;
</a><a href="#h0-4-27" id="h0-4-27" class="i">+static client *head;
</a><a href="#h0-4-28" id="h0-4-28" class="i">+static desktop desktops[6];
</a> 
<a href="#h0-4-30" id="h0-4-30" class="d">-// Events array
</a> static void (*events[LASTEvent])(XEvent *e) = {
     [KeyPress]         = keypress,
     [MapRequest]       = maprequest,
<a href="#h0-5" id="h0-5" class="h">@@ -123,28 +97,25 @@ static void (*events[LASTEvent])(XEvent *e) = {
</a>     [MotionNotify]     = motionnotify
 };
 
<a href="#h0-5-3" id="h0-5-3" class="d">-// Desktop array
</a><a href="#h0-5-4" id="h0-5-4" class="d">-static desktop desktops[10];
</a><a href="#h0-5-5" id="h0-5-5" class="d">-
</a> void add_window(Window w) {
<a href="#h0-5-7" id="h0-5-7" class="d">-    client *c,*t;
</a><a href="#h0-5-8" id="h0-5-8" class="i">+    client *c, *t;
</a> 
<a href="#h0-5-10" id="h0-5-10" class="d">-    if(!(c = (client *)calloc(1,sizeof(client))))
</a><a href="#h0-5-11" id="h0-5-11" class="d">-        die(&quot;Error calloc!&quot;);
</a><a href="#h0-5-12" id="h0-5-12" class="i">+    if (!(c = (client *)calloc(1,sizeof(client))))
</a><a href="#h0-5-13" id="h0-5-13" class="i">+        exit(1);
</a> 
<a href="#h0-5-15" id="h0-5-15" class="d">-    if(head == NULL) {
</a><a href="#h0-5-16" id="h0-5-16" class="i">+    if (head == NULL) {
</a>         c-&gt;next = NULL;
         c-&gt;prev = NULL;
<a href="#h0-5-19" id="h0-5-19" class="d">-        c-&gt;win = w;
</a><a href="#h0-5-20" id="h0-5-20" class="d">-        head = c;
</a><a href="#h0-5-21" id="h0-5-21" class="i">+        c-&gt;win  = w;
</a><a href="#h0-5-22" id="h0-5-22" class="i">+        head    = c;
</a>     }
<a href="#h0-5-24" id="h0-5-24" class="i">+
</a>     else {
         for(t=head;t-&gt;next;t=t-&gt;next);
 
         c-&gt;next = NULL;
         c-&gt;prev = t;
<a href="#h0-5-30" id="h0-5-30" class="d">-        c-&gt;win = w;
</a><a href="#h0-5-31" id="h0-5-31" class="d">-
</a><a href="#h0-5-32" id="h0-5-32" class="i">+        c-&gt;win  = w;
</a>         t-&gt;next = c;
     }
 
<a href="#h0-6" id="h0-6" class="h">@@ -154,33 +125,26 @@ void add_window(Window w) {
</a> void change_desktop(const Arg arg) {
     client *c;
 
<a href="#h0-6-3" id="h0-6-3" class="d">-    if(arg.i == current_desktop)
</a><a href="#h0-6-4" id="h0-6-4" class="i">+    if (arg.i == curr_desk)
</a>         return;
 
<a href="#h0-6-7" id="h0-6-7" class="d">-    // Unmap all window
</a><a href="#h0-6-8" id="h0-6-8" class="d">-    if(head != NULL)
</a><a href="#h0-6-9" id="h0-6-9" class="d">-        for(c=head;c;c=c-&gt;next)
</a><a href="#h0-6-10" id="h0-6-10" class="d">-            XUnmapWindow(dis,c-&gt;win);
</a><a href="#h0-6-11" id="h0-6-11" class="d">-
</a><a href="#h0-6-12" id="h0-6-12" class="d">-    // Save current &quot;properties&quot;
</a><a href="#h0-6-13" id="h0-6-13" class="d">-    save_desktop(current_desktop);
</a><a href="#h0-6-14" id="h0-6-14" class="i">+    if (head != NULL)
</a><a href="#h0-6-15" id="h0-6-15" class="i">+        for(c=head;c;c=c-&gt;next) XUnmapWindow(dis,c-&gt;win);
</a> 
<a href="#h0-6-17" id="h0-6-17" class="d">-    // Take &quot;properties&quot; from the new desktop
</a><a href="#h0-6-18" id="h0-6-18" class="i">+    save_desktop(curr_desk);
</a>     select_desktop(arg.i);
 
<a href="#h0-6-21" id="h0-6-21" class="d">-    // Map all windows
</a><a href="#h0-6-22" id="h0-6-22" class="d">-    if(head != NULL)
</a><a href="#h0-6-23" id="h0-6-23" class="d">-        for(c=head;c;c=c-&gt;next)
</a><a href="#h0-6-24" id="h0-6-24" class="d">-            XMapWindow(dis,c-&gt;win);
</a><a href="#h0-6-25" id="h0-6-25" class="i">+    if (head != NULL)
</a><a href="#h0-6-26" id="h0-6-26" class="i">+        for(c=head;c;c=c-&gt;next) XMapWindow(dis,c-&gt;win);
</a> 
     update_current();
 }
 
 void client_to_desktop(const Arg arg) {
     client *tmp = current;
<a href="#h0-6-33" id="h0-6-33" class="d">-    int tmp2 = current_desktop;
</a><a href="#h0-6-34" id="h0-6-34" class="i">+    int    tmp2 = curr_desk;
</a> 
<a href="#h0-6-36" id="h0-6-36" class="d">-    if (arg.i == current_desktop || current == NULL)
</a><a href="#h0-6-37" id="h0-6-37" class="i">+    if (arg.i == tmp2 || current == NULL)
</a>         return;
 
     // Add client to desktop
<a href="#h0-7" id="h0-7" class="h">@@ -196,30 +160,29 @@ void client_to_desktop(const Arg arg) {
</a> }
 
 void configurerequest(XEvent *e) {
<a href="#h0-7-3" id="h0-7-3" class="d">-    // Paste from DWM, thx again \o/
</a>     XConfigureRequestEvent *ev = &amp;e-&gt;xconfigurerequest;
     XWindowChanges wc;
<a href="#h0-7-6" id="h0-7-6" class="d">-    wc.x = ev-&gt;x;
</a><a href="#h0-7-7" id="h0-7-7" class="d">-    wc.y = ev-&gt;y;
</a><a href="#h0-7-8" id="h0-7-8" class="d">-    wc.width = ev-&gt;width;
</a><a href="#h0-7-9" id="h0-7-9" class="d">-    wc.height = ev-&gt;height;
</a><a href="#h0-7-10" id="h0-7-10" class="i">+
</a><a href="#h0-7-11" id="h0-7-11" class="i">+    wc.x            = ev-&gt;x;
</a><a href="#h0-7-12" id="h0-7-12" class="i">+    wc.y            = ev-&gt;y;
</a><a href="#h0-7-13" id="h0-7-13" class="i">+    wc.width        = ev-&gt;width;
</a><a href="#h0-7-14" id="h0-7-14" class="i">+    wc.height       = ev-&gt;height;
</a>     wc.border_width = ev-&gt;border_width;
<a href="#h0-7-16" id="h0-7-16" class="d">-    wc.sibling = ev-&gt;above;
</a><a href="#h0-7-17" id="h0-7-17" class="d">-    wc.stack_mode = ev-&gt;detail;
</a><a href="#h0-7-18" id="h0-7-18" class="i">+    wc.sibling      = ev-&gt;above;
</a><a href="#h0-7-19" id="h0-7-19" class="i">+    wc.stack_mode   = ev-&gt;detail;
</a><a href="#h0-7-20" id="h0-7-20" class="i">+
</a>     XConfigureWindow(dis, ev-&gt;window, ev-&gt;value_mask, &amp;wc);
 }
 
 void destroynotify(XEvent *e) {
<a href="#h0-7-25" id="h0-7-25" class="d">-    int i=0;
</a><a href="#h0-7-26" id="h0-7-26" class="i">+    int i = 0;
</a>     client *c;
<a href="#h0-7-28" id="h0-7-28" class="i">+
</a>     XDestroyWindowEvent *ev = &amp;e-&gt;xdestroywindow;
 
<a href="#h0-7-31" id="h0-7-31" class="d">-    // Uber (and ugly) hack ;)
</a>     for(c=head;c;c=c-&gt;next)
<a href="#h0-7-33" id="h0-7-33" class="d">-        if(ev-&gt;window == c-&gt;win)
</a><a href="#h0-7-34" id="h0-7-34" class="d">-            i++;
</a><a href="#h0-7-35" id="h0-7-35" class="i">+        if(ev-&gt;window == c-&gt;win) i++;
</a> 
<a href="#h0-7-37" id="h0-7-37" class="d">-    // End of the hack
</a>     if(i == 0)
         return;
 
<a href="#h0-8" id="h0-8" class="h">@@ -231,27 +194,21 @@ void update_current() {
</a>     client *c;
 
     for(c=head;c;c=c-&gt;next)
<a href="#h0-8-3" id="h0-8-3" class="d">-        if(current == c) {
</a><a href="#h0-8-4" id="h0-8-4" class="d">-            XSetWindowBorderWidth(dis,c-&gt;win,1);
</a><a href="#h0-8-5" id="h0-8-5" class="d">-            XSetInputFocus(dis,c-&gt;win,RevertToParent,CurrentTime);
</a><a href="#h0-8-6" id="h0-8-6" class="d">-            XRaiseWindow(dis,c-&gt;win);
</a><a href="#h0-8-7" id="h0-8-7" class="i">+        if (current == c) {
</a><a href="#h0-8-8" id="h0-8-8" class="i">+            XSetWindowBorderWidth(dis, c-&gt;win, 1);
</a><a href="#h0-8-9" id="h0-8-9" class="i">+            XSetInputFocus(dis, c-&gt;win, RevertToParent, CurrentTime);
</a><a href="#h0-8-10" id="h0-8-10" class="i">+            XRaiseWindow(dis, c-&gt;win);
</a>         }
 }
 
<a href="#h0-8-14" id="h0-8-14" class="d">-void die(const char* e) {
</a><a href="#h0-8-15" id="h0-8-15" class="d">-    fprintf(stdout,&quot;catwm: %s\n&quot;,e);
</a><a href="#h0-8-16" id="h0-8-16" class="d">-    exit(1);
</a><a href="#h0-8-17" id="h0-8-17" class="d">-}
</a><a href="#h0-8-18" id="h0-8-18" class="d">-
</a> void grabkeys() {
     int i;
     KeyCode code;
 
<a href="#h0-8-23" id="h0-8-23" class="d">-    // For each shortcuts
</a>     for(i=0;i&lt;TABLENGTH(keys);++i) {
<a href="#h0-8-25" id="h0-8-25" class="d">-        if((code = XKeysymToKeycode(dis,keys[i].keysym))) {
</a><a href="#h0-8-26" id="h0-8-26" class="d">-            XGrabKey(dis,code,keys[i].mod,root,True,GrabModeAsync,GrabModeAsync);
</a><a href="#h0-8-27" id="h0-8-27" class="d">-        }
</a><a href="#h0-8-28" id="h0-8-28" class="i">+        if ((code = XKeysymToKeycode(dis, keys[i].keysym)))
</a><a href="#h0-8-29" id="h0-8-29" class="i">+            XGrabKey(dis, code, keys[i].mod, root,
</a><a href="#h0-8-30" id="h0-8-30" class="i">+                     True, GrabModeAsync, GrabModeAsync);
</a>     }
 }
 
<a href="#h0-9" id="h0-9" class="h">@@ -299,12 +256,14 @@ void kill_client() {
</a> 	if(current != NULL) {
 		//send delete signal to window
 		XEvent ke;
<a href="#h0-9-3" id="h0-9-3" class="d">-		ke.type = ClientMessage;
</a><a href="#h0-9-4" id="h0-9-4" class="d">-		ke.xclient.window = current-&gt;win;
</a><a href="#h0-9-5" id="h0-9-5" class="i">+
</a><a href="#h0-9-6" id="h0-9-6" class="i">+		ke.type                 = ClientMessage;
</a><a href="#h0-9-7" id="h0-9-7" class="i">+		ke.xclient.window       = current-&gt;win;
</a> 		ke.xclient.message_type = XInternAtom(dis, &quot;WM_PROTOCOLS&quot;, True);
<a href="#h0-9-9" id="h0-9-9" class="d">-		ke.xclient.format = 32;
</a><a href="#h0-9-10" id="h0-9-10" class="d">-		ke.xclient.data.l[0] = XInternAtom(dis, &quot;WM_DELETE_WINDOW&quot;, True);
</a><a href="#h0-9-11" id="h0-9-11" class="d">-		ke.xclient.data.l[1] = CurrentTime;
</a><a href="#h0-9-12" id="h0-9-12" class="i">+		ke.xclient.format       = 32;
</a><a href="#h0-9-13" id="h0-9-13" class="i">+		ke.xclient.data.l[0]    = XInternAtom(dis, &quot;WM_DELETE_WINDOW&quot;, True);
</a><a href="#h0-9-14" id="h0-9-14" class="i">+		ke.xclient.data.l[1]    = CurrentTime;
</a><a href="#h0-9-15" id="h0-9-15" class="i">+
</a> 		XSendEvent(dis, current-&gt;win, False, NoEventMask, &amp;ke);
 		send_kill_signal(current-&gt;win);
 	}
<a href="#h0-10" id="h0-10" class="h">@@ -312,9 +271,9 @@ void kill_client() {
</a> 
 void maprequest(XEvent *e) {
     XMapRequestEvent *ev = &amp;e-&gt;xmaprequest;
<a href="#h0-10-3" id="h0-10-3" class="i">+    client *c;
</a> 
     // For fullscreen mplayer (and maybe some other program)
<a href="#h0-10-6" id="h0-10-6" class="d">-    client *c;
</a>     for(c=head;c;c=c-&gt;next)
         if(ev-&gt;window == c-&gt;win) {
             XMapWindow(dis,ev-&gt;window);
<a href="#h0-11" id="h0-11" class="h">@@ -329,8 +288,8 @@ void maprequest(XEvent *e) {
</a> void next_win() {
     client *c;
 
<a href="#h0-11-3" id="h0-11-3" class="d">-    if(current != NULL &amp;&amp; head != NULL) {
</a><a href="#h0-11-4" id="h0-11-4" class="d">-		if(current-&gt;next == NULL)
</a><a href="#h0-11-5" id="h0-11-5" class="i">+    if (current != NULL &amp;&amp; head != NULL) {
</a><a href="#h0-11-6" id="h0-11-6" class="i">+		if (current-&gt;next == NULL)
</a>             c = head;
         else
             c = current-&gt;next;
<a href="#h0-12" id="h0-12" class="h">@@ -343,63 +302,70 @@ void next_win() {
</a> void remove_window(Window w) {
     client *c;
 
<a href="#h0-12-3" id="h0-12-3" class="d">-    // CHANGE THIS UGLY CODE
</a>     for(c=head;c;c=c-&gt;next) {
<a href="#h0-12-5" id="h0-12-5" class="i">+        if(c-&gt;win != w)
</a><a href="#h0-12-6" id="h0-12-6" class="i">+            return;
</a><a href="#h0-12-7" id="h0-12-7" class="i">+
</a><a href="#h0-12-8" id="h0-12-8" class="i">+        if (c-&gt;prev == NULL &amp;&amp; c-&gt;next == NULL) {
</a><a href="#h0-12-9" id="h0-12-9" class="i">+            free(head);
</a><a href="#h0-12-10" id="h0-12-10" class="i">+
</a><a href="#h0-12-11" id="h0-12-11" class="i">+            head    = NULL;
</a><a href="#h0-12-12" id="h0-12-12" class="i">+            current = NULL;
</a> 
<a href="#h0-12-14" id="h0-12-14" class="d">-        if(c-&gt;win == w) {
</a><a href="#h0-12-15" id="h0-12-15" class="d">-            if(c-&gt;prev == NULL &amp;&amp; c-&gt;next == NULL) {
</a><a href="#h0-12-16" id="h0-12-16" class="d">-                free(head);
</a><a href="#h0-12-17" id="h0-12-17" class="d">-                head = NULL;
</a><a href="#h0-12-18" id="h0-12-18" class="d">-                current = NULL;
</a><a href="#h0-12-19" id="h0-12-19" class="d">-                return;
</a><a href="#h0-12-20" id="h0-12-20" class="d">-            }
</a><a href="#h0-12-21" id="h0-12-21" class="d">-
</a><a href="#h0-12-22" id="h0-12-22" class="d">-            if(c-&gt;prev == NULL) {
</a><a href="#h0-12-23" id="h0-12-23" class="d">-                head = c-&gt;next;
</a><a href="#h0-12-24" id="h0-12-24" class="d">-                c-&gt;next-&gt;prev = NULL;
</a><a href="#h0-12-25" id="h0-12-25" class="d">-                current = c-&gt;next;
</a><a href="#h0-12-26" id="h0-12-26" class="d">-            }
</a><a href="#h0-12-27" id="h0-12-27" class="d">-            else if(c-&gt;next == NULL) {
</a><a href="#h0-12-28" id="h0-12-28" class="d">-                c-&gt;prev-&gt;next = NULL;
</a><a href="#h0-12-29" id="h0-12-29" class="d">-                current = c-&gt;prev;
</a><a href="#h0-12-30" id="h0-12-30" class="d">-            }
</a><a href="#h0-12-31" id="h0-12-31" class="d">-            else {
</a><a href="#h0-12-32" id="h0-12-32" class="d">-                c-&gt;prev-&gt;next = c-&gt;next;
</a><a href="#h0-12-33" id="h0-12-33" class="d">-                c-&gt;next-&gt;prev = c-&gt;prev;
</a><a href="#h0-12-34" id="h0-12-34" class="d">-                current = c-&gt;prev;
</a><a href="#h0-12-35" id="h0-12-35" class="d">-            }
</a><a href="#h0-12-36" id="h0-12-36" class="d">-
</a><a href="#h0-12-37" id="h0-12-37" class="d">-            free(c);
</a>             return;
         }
<a href="#h0-12-40" id="h0-12-40" class="i">+
</a><a href="#h0-12-41" id="h0-12-41" class="i">+        if (c-&gt;prev == NULL) {
</a><a href="#h0-12-42" id="h0-12-42" class="i">+            head          = c-&gt;next;
</a><a href="#h0-12-43" id="h0-12-43" class="i">+            c-&gt;next-&gt;prev = NULL;
</a><a href="#h0-12-44" id="h0-12-44" class="i">+            current       = c-&gt;next;
</a><a href="#h0-12-45" id="h0-12-45" class="i">+        }
</a><a href="#h0-12-46" id="h0-12-46" class="i">+
</a><a href="#h0-12-47" id="h0-12-47" class="i">+        else if (c-&gt;next == NULL) {
</a><a href="#h0-12-48" id="h0-12-48" class="i">+            c-&gt;prev-&gt;next = NULL;
</a><a href="#h0-12-49" id="h0-12-49" class="i">+            current       = c-&gt;prev;
</a><a href="#h0-12-50" id="h0-12-50" class="i">+        }
</a><a href="#h0-12-51" id="h0-12-51" class="i">+
</a><a href="#h0-12-52" id="h0-12-52" class="i">+        else {
</a><a href="#h0-12-53" id="h0-12-53" class="i">+            c-&gt;prev-&gt;next = c-&gt;next;
</a><a href="#h0-12-54" id="h0-12-54" class="i">+            c-&gt;next-&gt;prev = c-&gt;prev;
</a><a href="#h0-12-55" id="h0-12-55" class="i">+            current       = c-&gt;prev;
</a><a href="#h0-12-56" id="h0-12-56" class="i">+        }
</a><a href="#h0-12-57" id="h0-12-57" class="i">+
</a><a href="#h0-12-58" id="h0-12-58" class="i">+        free(c);
</a><a href="#h0-12-59" id="h0-12-59" class="i">+        return;
</a>     }
 }
 
 void save_desktop(int i) {
<a href="#h0-12-64" id="h0-12-64" class="d">-    desktops[i].mode = mode;
</a><a href="#h0-12-65" id="h0-12-65" class="d">-    desktops[i].head = head;
</a><a href="#h0-12-66" id="h0-12-66" class="i">+    desktops[i].mode    = mode;
</a><a href="#h0-12-67" id="h0-12-67" class="i">+    desktops[i].head    = head;
</a>     desktops[i].current = current;
 }
 
 void select_desktop(int i) {
<a href="#h0-12-72" id="h0-12-72" class="d">-    head = desktops[i].head;
</a><a href="#h0-12-73" id="h0-12-73" class="d">-    current = desktops[i].current;
</a><a href="#h0-12-74" id="h0-12-74" class="d">-    mode = desktops[i].mode;
</a><a href="#h0-12-75" id="h0-12-75" class="d">-    current_desktop = i;
</a><a href="#h0-12-76" id="h0-12-76" class="i">+    head      = desktops[i].head;
</a><a href="#h0-12-77" id="h0-12-77" class="i">+    current   = desktops[i].current;
</a><a href="#h0-12-78" id="h0-12-78" class="i">+    mode      = desktops[i].mode;
</a><a href="#h0-12-79" id="h0-12-79" class="i">+    curr_desk = i;
</a> }
 
 void send_kill_signal(Window w) {
     XEvent ke;
<a href="#h0-12-84" id="h0-12-84" class="d">-    ke.type = ClientMessage;
</a><a href="#h0-12-85" id="h0-12-85" class="d">-    ke.xclient.window = w;
</a><a href="#h0-12-86" id="h0-12-86" class="i">+
</a><a href="#h0-12-87" id="h0-12-87" class="i">+    ke.type                 = ClientMessage;
</a><a href="#h0-12-88" id="h0-12-88" class="i">+    ke.xclient.window       = w;
</a>     ke.xclient.message_type = XInternAtom(dis, &quot;WM_PROTOCOLS&quot;, True);
<a href="#h0-12-90" id="h0-12-90" class="d">-    ke.xclient.format = 32;
</a><a href="#h0-12-91" id="h0-12-91" class="d">-    ke.xclient.data.l[0] = XInternAtom(dis, &quot;WM_DELETE_WINDOW&quot;, True);
</a><a href="#h0-12-92" id="h0-12-92" class="d">-    ke.xclient.data.l[1] = CurrentTime;
</a><a href="#h0-12-93" id="h0-12-93" class="i">+    ke.xclient.format       = 32;
</a><a href="#h0-12-94" id="h0-12-94" class="i">+    ke.xclient.data.l[0]    = XInternAtom(dis, &quot;WM_DELETE_WINDOW&quot;, True);
</a><a href="#h0-12-95" id="h0-12-95" class="i">+    ke.xclient.data.l[1]    = CurrentTime;
</a><a href="#h0-12-96" id="h0-12-96" class="i">+
</a>     XSendEvent(dis, w, False, NoEventMask, &amp;ke);
 }
 
 void setup() {
<a href="#h0-12-101" id="h0-12-101" class="i">+    int i;
</a><a href="#h0-12-102" id="h0-12-102" class="i">+
</a>     sigchld(0);
 
     screen = DefaultScreen(dis);
<a href="#h0-13" id="h0-13" class="h">@@ -414,35 +380,35 @@ void setup() {
</a>     head      = NULL;
     current   = NULL;
 
<a href="#h0-13-3" id="h0-13-3" class="d">-    int i;
</a>     for(i=0;i&lt;TABLENGTH(desktops);++i) {
<a href="#h0-13-5" id="h0-13-5" class="d">-        desktops[i].mode = mode;
</a><a href="#h0-13-6" id="h0-13-6" class="d">-        desktops[i].head = head;
</a><a href="#h0-13-7" id="h0-13-7" class="i">+        desktops[i].mode    = mode;
</a><a href="#h0-13-8" id="h0-13-8" class="i">+        desktops[i].head    = head;
</a>         desktops[i].current = current;
     }
 
     const Arg arg = {.i = 1};
<a href="#h0-13-13" id="h0-13-13" class="d">-    current_desktop = arg.i;
</a><a href="#h0-13-14" id="h0-13-14" class="i">+    curr_desk = arg.i;
</a>     change_desktop(arg);
 
<a href="#h0-13-17" id="h0-13-17" class="d">-    XSelectInput(dis,root,SubstructureNotifyMask|SubstructureRedirectMask);
</a><a href="#h0-13-18" id="h0-13-18" class="i">+    XSelectInput(dis, root, SubstructureNotifyMask|SubstructureRedirectMask);
</a> }
 
 void sigchld(int unused) {
<a href="#h0-13-22" id="h0-13-22" class="d">-	if(signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h0-13-23" id="h0-13-23" class="d">-		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h0-13-24" id="h0-13-24" class="i">+	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h0-13-25" id="h0-13-25" class="i">+        exit(1);
</a> 
 	while(0 &lt; waitpid(-1, NULL, WNOHANG));
 }
 
 void spawn(const Arg arg) {
<a href="#h0-13-31" id="h0-13-31" class="d">-    if(fork() == 0) {
</a><a href="#h0-13-32" id="h0-13-32" class="d">-        if(fork() == 0) {
</a><a href="#h0-13-33" id="h0-13-33" class="d">-            if(dis) close(ConnectionNumber(dis));
</a><a href="#h0-13-34" id="h0-13-34" class="i">+    if (fork() == 0) {
</a><a href="#h0-13-35" id="h0-13-35" class="i">+        if (fork() == 0) {
</a><a href="#h0-13-36" id="h0-13-36" class="i">+            if (dis) close(ConnectionNumber(dis));
</a> 
             setsid();
             execvp((char*)arg.com[0],(char**)arg.com);
         }
<a href="#h0-13-41" id="h0-13-41" class="i">+
</a>         exit(0);
     }
 }
<a href="#h0-14" id="h0-14" class="h">@@ -466,8 +432,8 @@ void init() {
</a> }
 
 int main(int argc, char **argv) {
<a href="#h0-14-3" id="h0-14-3" class="d">-    if(!(dis = XOpenDisplay(NULL)))
</a><a href="#h0-14-4" id="h0-14-4" class="d">-        die(&quot;Cannot open display!&quot;);
</a><a href="#h0-14-5" id="h0-14-5" class="i">+    if (!(dis = XOpenDisplay(NULL)))
</a><a href="#h0-14-6" id="h0-14-6" class="i">+        exit(1);
</a> 
     setup();
     init();
</pre>
</div>
</body>
</html>
