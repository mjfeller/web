<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Style inquistion was here. - tabbed - tab interface for application supporting Xembed
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="tabbed Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>tabbed</h1><span class="desc">tab interface for application supporting Xembed
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/3f0067b1c775a7f0ade805e10546272f8ce01dd3.html">3f0067b1c775a7f0ade805e10546272f8ce01dd3</a>
<b>parent</b> <a href="../commit/bcf3d90ce7d93bf2a34c2bec3b2fdd2a7c5e0af0.html">bcf3d90ce7d93bf2a34c2bec3b2fdd2a7c5e0af0</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Thu,  8 Nov 2012 21:40:58 +0100

Style inquistion was here.
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">tabbed.c</a></td><td> | </td><td class="num">193</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------------</span></td></tr>
</table></pre><pre>1 file changed, 129 insertions(+), 64 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/tabbed.c.html">tabbed.c</a> b/<a href="../file/tabbed.c.html">tabbed.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -42,7 +42,7 @@
</a> /* Macros */
 #define MAX(a, b)                ((a) &gt; (b) ? (a) : (b))
 #define MIN(a, b)                ((a) &lt; (b) ? (a) : (b))
<a href="#h0-0-3" id="h0-0-3" class="d">-#define LENGTH(x)                (sizeof (x) / sizeof *(x))
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#define LENGTH(x)                (sizeof((x)) / sizeof(*(x)))
</a> #define CLEANMASK(mask)          (mask &amp; ~(numlockmask|LockMask))
 #define TEXTW(x)                 (textnw(x, strlen(x)) + dc.font.height)
 
<a href="#h0-1" id="h0-1" class="h">@@ -201,10 +201,13 @@ cleanup(void) {
</a> 		n = c-&gt;next;
 		unmanage(c);
 	}
<a href="#h0-1-3" id="h0-1-3" class="d">-	if(dc.font.set)
</a><a href="#h0-1-4" id="h0-1-4" class="i">+
</a><a href="#h0-1-5" id="h0-1-5" class="i">+	if(dc.font.set) {
</a> 		XFreeFontSet(dpy, dc.font.set);
<a href="#h0-1-7" id="h0-1-7" class="d">-	else
</a><a href="#h0-1-8" id="h0-1-8" class="i">+	} else {
</a> 		XFreeFont(dpy, dc.font.xfont);
<a href="#h0-1-10" id="h0-1-10" class="i">+	}
</a><a href="#h0-1-11" id="h0-1-11" class="i">+
</a> 	XFreePixmap(dpy, dc.drawable);
 	XFreeGC(dpy, dc.gc);
 	XDestroyWindow(dpy, win);
<a href="#h0-2" id="h0-2" class="h">@@ -217,8 +220,9 @@ clientmessage(const XEvent *e) {
</a> 	const XClientMessageEvent *ev = &amp;e-&gt;xclient;
 
 	if(ev-&gt;message_type == wmatom[WMProtocols]
<a href="#h0-2-3" id="h0-2-3" class="d">-			&amp;&amp; ev-&gt;data.l[0] == wmatom[WMDelete])
</a><a href="#h0-2-4" id="h0-2-4" class="i">+			&amp;&amp; ev-&gt;data.l[0] == wmatom[WMDelete]) {
</a> 		running = False;
<a href="#h0-2-6" id="h0-2-6" class="i">+	}
</a> }
 
 void
<a href="#h0-3" id="h0-3" class="h">@@ -229,7 +233,8 @@ configurenotify(const XEvent *e) {
</a> 		ww = ev-&gt;width;
 		wh = ev-&gt;height;
 		XFreePixmap(dpy, dc.drawable);
<a href="#h0-3-3" id="h0-3-3" class="d">-		dc.drawable = XCreatePixmap(dpy, root, ww, wh, DefaultDepth(dpy, screen));
</a><a href="#h0-3-4" id="h0-3-4" class="i">+		dc.drawable = XCreatePixmap(dpy, root, ww, wh,
</a><a href="#h0-3-5" id="h0-3-5" class="i">+				DefaultDepth(dpy, screen));
</a> 		if(sel)
 			resize(sel, ww, wh - bh);
 		XSync(dpy, False);
<a href="#h0-4" id="h0-4" class="h">@@ -297,10 +302,13 @@ drawbar() {
</a> 		XSync(dpy, False);
 		return;
 	}
<a href="#h0-4-3" id="h0-4-3" class="i">+
</a> 	width = ww;
 	for(c = clients; c; c = c-&gt;next)
 		c-&gt;tabx = -1;
<a href="#h0-4-7" id="h0-4-7" class="i">+
</a> 	for(n = 0, fc = c = getfirsttab(); c; c = c-&gt;next, n++);
<a href="#h0-4-9" id="h0-4-9" class="i">+
</a> 	if(n * tabwidth &gt; width) {
 		dc.w = TEXTW(after);
 		dc.x = width - dc.w;
<a href="#h0-5" id="h0-5" class="h">@@ -308,22 +316,24 @@ drawbar() {
</a> 		width -= dc.w;
 	}
 	dc.x = 0;
<a href="#h0-5-3" id="h0-5-3" class="i">+
</a> 	if(fc != clients) {
 		dc.w = TEXTW(before);
 		drawtext(before, dc.sel);
 		dc.x += dc.w;
 		width -= dc.w;
 	}
<a href="#h0-5-10" id="h0-5-10" class="i">+
</a> 	for(c = fc; c &amp;&amp; dc.x &lt; width; c = c-&gt;next) {
 		dc.w = tabwidth;
 		if(c == sel) {
 			col = dc.sel;
<a href="#h0-5-15" id="h0-5-15" class="d">-			if(n * tabwidth &gt; width)
</a><a href="#h0-5-16" id="h0-5-16" class="i">+			if(n * tabwidth &gt; width) {
</a> 				dc.w += width % tabwidth;
<a href="#h0-5-18" id="h0-5-18" class="d">-			else
</a><a href="#h0-5-19" id="h0-5-19" class="i">+			} else {
</a> 				dc.w = width - (n - 1) * tabwidth;
<a href="#h0-5-21" id="h0-5-21" class="d">-		}
</a><a href="#h0-5-22" id="h0-5-22" class="d">-		else {
</a><a href="#h0-5-23" id="h0-5-23" class="i">+			}
</a><a href="#h0-5-24" id="h0-5-24" class="i">+		} else {
</a> 			col = dc.norm;
 		}
 		drawtext(c-&gt;name, col);
<a href="#h0-6" id="h0-6" class="h">@@ -344,22 +354,30 @@ drawtext(const char *text, unsigned long col[ColLast]) {
</a> 	XFillRectangles(dpy, dc.drawable, dc.gc, &amp;r, 1);
 	if(!text)
 		return;
<a href="#h0-6-3" id="h0-6-3" class="i">+
</a> 	olen = strlen(text);
 	h = dc.font.ascent + dc.font.descent;
 	y = dc.y + (dc.h / 2) - (h / 2) + dc.font.ascent;
 	x = dc.x + (h / 2);
<a href="#h0-6-8" id="h0-6-8" class="i">+
</a> 	/* shorten text if necessary */
<a href="#h0-6-10" id="h0-6-10" class="d">-	for(len = MIN(olen, sizeof buf); len &amp;&amp; textnw(text, len) &gt; dc.w - h; len--);
</a><a href="#h0-6-11" id="h0-6-11" class="i">+	for(len = MIN(olen, sizeof(buf));
</a><a href="#h0-6-12" id="h0-6-12" class="i">+			len &amp;&amp; textnw(text, len) &gt; dc.w - h; len--);
</a> 	if(!len)
 		return;
<a href="#h0-6-15" id="h0-6-15" class="i">+
</a> 	memcpy(buf, text, len);
<a href="#h0-6-17" id="h0-6-17" class="d">-	if(len &lt; olen)
</a><a href="#h0-6-18" id="h0-6-18" class="i">+	if(len &lt; olen) {
</a> 		for(i = len; i &amp;&amp; i &gt; len - 3; buf[--i] = &#39;.&#39;);
<a href="#h0-6-20" id="h0-6-20" class="i">+	}
</a><a href="#h0-6-21" id="h0-6-21" class="i">+
</a> 	XSetForeground(dpy, dc.gc, col[ColFG]);
<a href="#h0-6-23" id="h0-6-23" class="d">-	if(dc.font.set)
</a><a href="#h0-6-24" id="h0-6-24" class="d">-		XmbDrawString(dpy, dc.drawable, dc.font.set, dc.gc, x, y, buf, len);
</a><a href="#h0-6-25" id="h0-6-25" class="d">-	else
</a><a href="#h0-6-26" id="h0-6-26" class="i">+	if(dc.font.set) {
</a><a href="#h0-6-27" id="h0-6-27" class="i">+		XmbDrawString(dpy, dc.drawable, dc.font.set,
</a><a href="#h0-6-28" id="h0-6-28" class="i">+				dc.gc, x, y, buf, len);
</a><a href="#h0-6-29" id="h0-6-29" class="i">+	} else {
</a> 		XDrawString(dpy, dc.drawable, dc.gc, x, y, buf, len);
<a href="#h0-6-31" id="h0-6-31" class="i">+	}
</a> }
 
 void *
<a href="#h0-7" id="h0-7" class="h">@@ -381,26 +399,31 @@ expose(const XEvent *e) {
</a> 
 void
 focus(Client *c) {
<a href="#h0-7-3" id="h0-7-3" class="i">+	char buf[BUFSIZ] = &quot;tabbed-&quot;VERSION&quot; ::&quot;;
</a><a href="#h0-7-4" id="h0-7-4" class="i">+	size_t i, n;
</a><a href="#h0-7-5" id="h0-7-5" class="i">+
</a> 	/* If c, sel and clients are NULL, raise tabbed-win itself */
 	if(!c &amp;&amp; !(c = sel ? sel : clients)) {
<a href="#h0-7-8" id="h0-7-8" class="d">-		char buf[BUFSIZ] = &quot;tabbed-&quot;VERSION&quot; ::&quot;;
</a><a href="#h0-7-9" id="h0-7-9" class="d">-		size_t i, n;
</a><a href="#h0-7-10" id="h0-7-10" class="i">+		for(i = 0, n = strlen(buf); cmd[i] &amp;&amp; n &lt; sizeof(buf); i++)
</a><a href="#h0-7-11" id="h0-7-11" class="i">+			n += snprintf(&amp;buf[n], sizeof(buf) - n, &quot; %s&quot;, cmd[i]);
</a> 
<a href="#h0-7-13" id="h0-7-13" class="d">-		for(i = 0, n = strlen(buf); cmd[i] &amp;&amp; n &lt; sizeof buf; i++)
</a><a href="#h0-7-14" id="h0-7-14" class="d">-			n += snprintf(&amp;buf[n], sizeof buf - n, &quot; %s&quot;, cmd[i]);
</a> 		XStoreName(dpy, win, buf);
 		XRaiseWindow(dpy, win);
<a href="#h0-7-17" id="h0-7-17" class="i">+
</a> 		return;
 	}
<a href="#h0-7-20" id="h0-7-20" class="i">+
</a> 	resize(c, ww, wh - bh);
 	XRaiseWindow(dpy, c-&gt;win);
 	XSetInputFocus(dpy, c-&gt;win, RevertToParent, CurrentTime);
 	sendxembed(c, XEMBED_FOCUS_IN, XEMBED_FOCUS_CURRENT, 0, 0);
 	sendxembed(c, XEMBED_WINDOW_ACTIVATE, 0, 0, 0);
 	XStoreName(dpy, win, c-&gt;name);
<a href="#h0-7-27" id="h0-7-27" class="i">+
</a> 	if(sel != c) {
 		lastsel = sel;
 	}
<a href="#h0-7-31" id="h0-7-31" class="i">+
</a> 	sel = c;
 	drawbar();
 }
<a href="#h0-8" id="h0-8" class="h">@@ -427,9 +450,11 @@ Client *
</a> getclient(Window w) {
 	Client *c;
 
<a href="#h0-8-3" id="h0-8-3" class="d">-	for(c = clients; c; c = c-&gt;next)
</a><a href="#h0-8-4" id="h0-8-4" class="i">+	for(c = clients; c; c = c-&gt;next) {
</a> 		if(c-&gt;win == w)
 			return c;
<a href="#h0-8-7" id="h0-8-7" class="i">+	}
</a><a href="#h0-8-8" id="h0-8-8" class="i">+
</a> 	return NULL;
 }
 
<a href="#h0-9" id="h0-9" class="h">@@ -440,6 +465,7 @@ getcolor(const char *colstr) {
</a> 
 	if(!XAllocNamedColor(dpy, cmap, colstr, &amp;color, &amp;color))
 		die(&quot;tabbed: cannot allocate color &#39;%s&#39;\n&quot;, colstr);
<a href="#h0-9-3" id="h0-9-3" class="i">+
</a> 	return color.pixel;
 }
 
<a href="#h0-10" id="h0-10" class="h">@@ -450,10 +476,13 @@ getfirsttab() {
</a> 
 	if(!sel)
 		return NULL;
<a href="#h0-10-3" id="h0-10-3" class="i">+
</a> 	c = fc = clients;
 	for(n = 0; c; c = c-&gt;next, n++);
<a href="#h0-10-6" id="h0-10-6" class="i">+
</a> 	if(n * tabwidth &gt; ww) {
 		for(seli = 0, c = clients; c &amp;&amp; c != sel; c = c-&gt;next, seli++);
<a href="#h0-10-9" id="h0-10-9" class="i">+
</a> 		for(; seli * tabwidth &gt; ww / 2 &amp;&amp; n * tabwidth &gt; ww;
 				fc = fc-&gt;next, seli--, n--);
 	}
<a href="#h0-11" id="h0-11" class="h">@@ -468,40 +497,45 @@ gettextprop(Window w, Atom atom, char *text, unsigned int size) {
</a> 
 	if(!text || size == 0)
 		return False;
<a href="#h0-11-3" id="h0-11-3" class="i">+
</a> 	text[0] = &#39;\0&#39;;
 	XGetTextProperty(dpy, w, &amp;name, atom);
 	if(!name.nitems)
 		return False;
<a href="#h0-11-8" id="h0-11-8" class="d">-	if(name.encoding == XA_STRING)
</a><a href="#h0-11-9" id="h0-11-9" class="i">+
</a><a href="#h0-11-10" id="h0-11-10" class="i">+	if(name.encoding == XA_STRING) {
</a> 		strncpy(text, (char *)name.value, size - 1);
<a href="#h0-11-12" id="h0-11-12" class="d">-	else {
</a><a href="#h0-11-13" id="h0-11-13" class="d">-		if(XmbTextPropertyToTextList(dpy, &amp;name, &amp;list, &amp;n) &gt;= Success &amp;&amp; n &gt; 0 &amp;&amp; *list) {
</a><a href="#h0-11-14" id="h0-11-14" class="i">+	} else {
</a><a href="#h0-11-15" id="h0-11-15" class="i">+		if(XmbTextPropertyToTextList(dpy, &amp;name, &amp;list, &amp;n) &gt;= Success
</a><a href="#h0-11-16" id="h0-11-16" class="i">+				&amp;&amp; n &gt; 0 &amp;&amp; *list) {
</a> 			strncpy(text, *list, size - 1);
 			XFreeStringList(list);
 		}
 	}
 	text[size - 1] = &#39;\0&#39;;
 	XFree(name.value);
<a href="#h0-11-23" id="h0-11-23" class="i">+
</a> 	return True;
 }
 
 void
 initfont(const char *fontstr) {
<a href="#h0-11-29" id="h0-11-29" class="d">-	char *def, **missing;
</a><a href="#h0-11-30" id="h0-11-30" class="i">+	char *def, **missing, **font_names;
</a> 	int i, n;
<a href="#h0-11-32" id="h0-11-32" class="i">+	XFontStruct **xfonts;
</a> 
 	missing = NULL;
 	if(dc.font.set)
 		XFreeFontSet(dpy, dc.font.set);
<a href="#h0-11-37" id="h0-11-37" class="i">+
</a> 	dc.font.set = XCreateFontSet(dpy, fontstr, &amp;missing, &amp;n, &amp;def);
 	if(missing) {
 		while(n--)
 			fprintf(stderr, &quot;tabbed: missing fontset: %s\n&quot;, missing[n]);
 		XFreeStringList(missing);
 	}
<a href="#h0-11-44" id="h0-11-44" class="i">+
</a> 	if(dc.font.set) {
<a href="#h0-11-46" id="h0-11-46" class="d">-		XFontStruct **xfonts;
</a><a href="#h0-11-47" id="h0-11-47" class="d">-		char **font_names;
</a> 		dc.font.ascent = dc.font.descent = 0;
 		n = XFontsOfFontSet(dc.font.set, &amp;xfonts, &amp;font_names);
 		for(i = 0, dc.font.ascent = 0, dc.font.descent = 0; i &lt; n; i++) {
<a href="#h0-12" id="h0-12" class="h">@@ -509,14 +543,15 @@ initfont(const char *fontstr) {
</a> 			dc.font.descent = MAX(dc.font.descent,(*xfonts)-&gt;descent);
 			xfonts++;
 		}
<a href="#h0-12-3" id="h0-12-3" class="d">-	}
</a><a href="#h0-12-4" id="h0-12-4" class="d">-	else {
</a><a href="#h0-12-5" id="h0-12-5" class="i">+	} else {
</a> 		if(dc.font.xfont)
 			XFreeFont(dpy, dc.font.xfont);
 		dc.font.xfont = NULL;
 		if(!(dc.font.xfont = XLoadQueryFont(dpy, fontstr))
<a href="#h0-12-10" id="h0-12-10" class="d">-		&amp;&amp; !(dc.font.xfont = XLoadQueryFont(dpy, &quot;fixed&quot;)))
</a><a href="#h0-12-11" id="h0-12-11" class="i">+				&amp;&amp; !(dc.font.xfont = XLoadQueryFont(dpy, &quot;fixed&quot;))) {
</a> 			die(&quot;tabbed: cannot load font: &#39;%s&#39;\n&quot;, fontstr);
<a href="#h0-12-13" id="h0-12-13" class="i">+		}
</a><a href="#h0-12-14" id="h0-12-14" class="i">+
</a> 		dc.font.ascent = dc.font.xfont-&gt;ascent;
 		dc.font.descent = dc.font.xfont-&gt;descent;
 	}
<a href="#h0-13" id="h0-13" class="h">@@ -530,11 +565,13 @@ isprotodel(Client *c) {
</a> 	Bool ret = False;
 
 	if(XGetWMProtocols(dpy, c-&gt;win, &amp;protocols, &amp;n)) {
<a href="#h0-13-3" id="h0-13-3" class="d">-		for(i = 0; !ret &amp;&amp; i &lt; n; i++)
</a><a href="#h0-13-4" id="h0-13-4" class="i">+		for(i = 0; !ret &amp;&amp; i &lt; n; i++) {
</a> 			if(protocols[i] == wmatom[WMDelete])
 				ret = True;
<a href="#h0-13-7" id="h0-13-7" class="i">+		}
</a> 		XFree(protocols);
 	}
<a href="#h0-13-10" id="h0-13-10" class="i">+
</a> 	return ret;
 }
 
<a href="#h0-14" id="h0-14" class="h">@@ -545,11 +582,13 @@ keypress(const XEvent *e) {
</a> 	KeySym keysym;
 
 	keysym = XkbKeycodeToKeysym(dpy, (KeyCode)ev-&gt;keycode, 0, 0);
<a href="#h0-14-3" id="h0-14-3" class="d">-	for(i = 0; i &lt; LENGTH(keys); i++)
</a><a href="#h0-14-4" id="h0-14-4" class="i">+	for(i = 0; i &lt; LENGTH(keys); i++) {
</a> 		if(keysym == keys[i].keysym
<a href="#h0-14-6" id="h0-14-6" class="d">-		&amp;&amp; CLEANMASK(keys[i].mod) == CLEANMASK(ev-&gt;state)
</a><a href="#h0-14-7" id="h0-14-7" class="d">-		&amp;&amp; keys[i].func)
</a><a href="#h0-14-8" id="h0-14-8" class="i">+				&amp;&amp; CLEANMASK(keys[i].mod) == CLEANMASK(ev-&gt;state)
</a><a href="#h0-14-9" id="h0-14-9" class="i">+				&amp;&amp; keys[i].func) {
</a> 			keys[i].func(&amp;(keys[i].arg));
<a href="#h0-14-11" id="h0-14-11" class="i">+		}
</a><a href="#h0-14-12" id="h0-14-12" class="i">+	}
</a> }
 
 void
<a href="#h0-15" id="h0-15" class="h">@@ -558,6 +597,7 @@ killclient(const Arg *arg) {
</a> 
 	if(!sel)
 		return;
<a href="#h0-15-3" id="h0-15-3" class="i">+
</a> 	if(isprotodel(sel) &amp;&amp; !sel-&gt;closed) {
 		ev.type = ClientMessage;
 		ev.xclient.window = sel-&gt;win;
<a href="#h0-16" id="h0-16" class="h">@@ -567,9 +607,9 @@ killclient(const Arg *arg) {
</a> 		ev.xclient.data.l[1] = CurrentTime;
 		XSendEvent(dpy, sel-&gt;win, False, NoEventMask, &amp;ev);
 		sel-&gt;closed = True;
<a href="#h0-16-3" id="h0-16-3" class="d">-	}
</a><a href="#h0-16-4" id="h0-16-4" class="d">-	else
</a><a href="#h0-16-5" id="h0-16-5" class="i">+	} else {
</a> 		XKillClient(dpy, sel-&gt;win);
<a href="#h0-16-7" id="h0-16-7" class="i">+	}
</a> }
 
 void
<a href="#h0-17" id="h0-17" class="h">@@ -587,18 +627,22 @@ manage(Window w) {
</a> 		XSelectInput(dpy, w, PropertyChangeMask|StructureNotifyMask|EnterWindowMask);
 		XSync(dpy, False);
 		for(i = 0; i &lt; LENGTH(keys); i++) {
<a href="#h0-17-3" id="h0-17-3" class="d">-			if((code = XKeysymToKeycode(dpy, keys[i].keysym)))
</a><a href="#h0-17-4" id="h0-17-4" class="i">+			if((code = XKeysymToKeycode(dpy, keys[i].keysym))) {
</a> 				for(j = 0; j &lt; LENGTH(modifiers); j++)
 					XGrabKey(dpy, code, keys[i].mod | modifiers[j], w,
 						 True, GrabModeAsync, GrabModeAsync);
<a href="#h0-17-8" id="h0-17-8" class="i">+			}
</a> 		}
<a href="#h0-17-10" id="h0-17-10" class="d">-		c = emallocz(sizeof *c);
</a><a href="#h0-17-11" id="h0-17-11" class="i">+
</a><a href="#h0-17-12" id="h0-17-12" class="i">+		c = emallocz(sizeof(*c));
</a> 		c-&gt;next = clients;
 		c-&gt;win = w;
 		clients = c;
<a href="#h0-17-16" id="h0-17-16" class="i">+
</a> 		updatetitle(c);
 		drawbar();
 		XMapRaised(dpy, w);
<a href="#h0-17-20" id="h0-17-20" class="i">+
</a> 		e.xclient.window = w;
 		e.xclient.type = ClientMessage;
 		e.xclient.message_type = wmatom[XEmbed];
<a href="#h0-18" id="h0-18" class="h">@@ -609,9 +653,11 @@ manage(Window w) {
</a> 		e.xclient.data.l[3] = win;
 		e.xclient.data.l[4] = 0;
 		XSendEvent(dpy, root, False, NoEventMask, &amp;e);
<a href="#h0-18-3" id="h0-18-3" class="i">+
</a> 		XSync(dpy, False);
 		focus(nextfocus ? c : sel);
 		nextfocus = foreground;
<a href="#h0-18-7" id="h0-18-7" class="i">+
</a> 		if(!lastsel)
 			lastsel = c;
 	}
<a href="#h0-19" id="h0-19" class="h">@@ -671,15 +717,15 @@ void
</a> rotate(const Arg *arg) {
 	Client *c;
 
<a href="#h0-19-3" id="h0-19-3" class="d">-	if(arg-&gt;i == 0)
</a><a href="#h0-19-4" id="h0-19-4" class="i">+	if(arg-&gt;i == 0) {
</a> 		focus(lastsel);
<a href="#h0-19-6" id="h0-19-6" class="d">-	else if(arg-&gt;i &gt; 0) {
</a><a href="#h0-19-7" id="h0-19-7" class="d">-		if(sel &amp;&amp; sel-&gt;next)
</a><a href="#h0-19-8" id="h0-19-8" class="i">+	} else if(arg-&gt;i &gt; 0) {
</a><a href="#h0-19-9" id="h0-19-9" class="i">+		if(sel &amp;&amp; sel-&gt;next) {
</a> 			focus(sel-&gt;next);
<a href="#h0-19-11" id="h0-19-11" class="d">-		else
</a><a href="#h0-19-12" id="h0-19-12" class="i">+		} else {
</a> 			focus(clients);
<a href="#h0-19-14" id="h0-19-14" class="d">-	}
</a><a href="#h0-19-15" id="h0-19-15" class="d">-	else {
</a><a href="#h0-19-16" id="h0-19-16" class="i">+		}
</a><a href="#h0-19-17" id="h0-19-17" class="i">+	} else {
</a> 		for(c = clients; c &amp;&amp; c-&gt;next &amp;&amp; c-&gt;next != sel; c = c-&gt;next);
 		if(c)
 			focus(c);
<a href="#h0-20" id="h0-20" class="h">@@ -695,6 +741,7 @@ run(void) {
</a> 	drawbar();
 	if(doinitspawn == True)
 		spawn(NULL);
<a href="#h0-20-3" id="h0-20-3" class="i">+
</a> 	while(running) {
 		XNextEvent(dpy, &amp;ev);
 		if(handler[ev.type])
<a href="#h0-21" id="h0-21" class="h">@@ -722,7 +769,7 @@ void
</a> setcmd(int argc, char *argv[]) {
 	int i;
 
<a href="#h0-21-3" id="h0-21-3" class="d">-	cmd = emallocz((argc+2) * sizeof *cmd);
</a><a href="#h0-21-4" id="h0-21-4" class="i">+	cmd = emallocz((argc+2) * sizeof(*cmd));
</a> 	for(i = 0; i &lt; argc; i++)
 		cmd[i] = argv[i];
 	cmd[argc] = winid;
<a href="#h0-22" id="h0-22" class="h">@@ -756,12 +803,14 @@ setup(void) {
</a> 	dc.norm[ColFG] = getcolor(normfgcolor);
 	dc.sel[ColBG] = getcolor(selbgcolor);
 	dc.sel[ColFG] = getcolor(selfgcolor);
<a href="#h0-22-3" id="h0-22-3" class="d">-	dc.drawable = XCreatePixmap(dpy, root, ww, wh, DefaultDepth(dpy, screen));
</a><a href="#h0-22-4" id="h0-22-4" class="i">+	dc.drawable = XCreatePixmap(dpy, root, ww, wh,
</a><a href="#h0-22-5" id="h0-22-5" class="i">+			DefaultDepth(dpy, screen));
</a> 	dc.gc = XCreateGC(dpy, root, 0, 0);
 	if(!dc.font.set)
 		XSetFont(dpy, dc.gc, dc.font.xfont-&gt;fid);
 
<a href="#h0-22-10" id="h0-22-10" class="d">-	win = XCreateSimpleWindow(dpy, root, wx, wy, ww, wh, 0, dc.norm[ColFG], dc.norm[ColBG]);
</a><a href="#h0-22-11" id="h0-22-11" class="i">+	win = XCreateSimpleWindow(dpy, root, wx, wy, ww, wh, 0,
</a><a href="#h0-22-12" id="h0-22-12" class="i">+			dc.norm[ColFG], dc.norm[ColBG]);
</a> 	XMapRaised(dpy, win);
 	XSelectInput(dpy, win, SubstructureNotifyMask|FocusChangeMask|
 			ButtonPressMask|ExposureMask|KeyPressMask|
<a href="#h0-23" id="h0-23" class="h">@@ -775,7 +824,7 @@ setup(void) {
</a> 
 	XSetWMProtocols(dpy, win, &amp;wmatom[WMDelete], 1);
 
<a href="#h0-23-3" id="h0-23-3" class="d">-	snprintf(winid, sizeof winid, &quot;%lu&quot;, win);
</a><a href="#h0-23-4" id="h0-23-4" class="i">+	snprintf(winid, sizeof(winid), &quot;%lu&quot;, win);
</a> 	nextfocus = foreground;
 	focus(clients);
 }
<a href="#h0-24" id="h0-24" class="h">@@ -784,6 +833,7 @@ void
</a> sigchld(int unused) {
 	if(signal(SIGCHLD, sigchld) == SIG_ERR)
 		die(&quot;tabbed: cannot install SIGCHLD handler&quot;);
<a href="#h0-24-3" id="h0-24-3" class="i">+
</a> 	while(0 &lt; waitpid(-1, NULL, WNOHANG));
 }
 
<a href="#h0-25" id="h0-25" class="h">@@ -792,6 +842,7 @@ spawn(const Arg *arg) {
</a> 	if(fork() == 0) {
 		if(dpy)
 			close(ConnectionNumber(dpy));
<a href="#h0-25-3" id="h0-25-3" class="i">+
</a> 		setsid();
 		if(arg &amp;&amp; arg-&gt;v) {
 			execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
<a href="#h0-26" id="h0-26" class="h">@@ -813,6 +864,7 @@ textnw(const char *text, unsigned int len) {
</a> 		XmbTextExtents(dc.font.set, text, len, NULL, &amp;r);
 		return r.width;
 	}
<a href="#h0-26-3" id="h0-26-3" class="i">+
</a> 	return XTextWidth(dc.font.xfont, text, len);
 }
 
<a href="#h0-27" id="h0-27" class="h">@@ -820,11 +872,11 @@ void
</a> unmanage(Client *c) {
 	Client *pc;
 
<a href="#h0-27-3" id="h0-27-3" class="d">-	if(!clients)
</a><a href="#h0-27-4" id="h0-27-4" class="i">+	if(!clients) {
</a> 		return;
<a href="#h0-27-6" id="h0-27-6" class="d">-	else if(c == clients)
</a><a href="#h0-27-7" id="h0-27-7" class="i">+	} else if(c == clients) {
</a> 		pc = clients = c-&gt;next;
<a href="#h0-27-9" id="h0-27-9" class="d">-	else {
</a><a href="#h0-27-10" id="h0-27-10" class="i">+	} else {
</a> 		for(pc = clients; pc &amp;&amp; pc-&gt;next &amp;&amp; pc-&gt;next != c; pc = pc-&gt;next);
 		pc-&gt;next = c-&gt;next;
 	}
<a href="#h0-28" id="h0-28" class="h">@@ -846,18 +898,21 @@ updatenumlockmask(void) {
</a> 
 	numlockmask = 0;
 	modmap = XGetModifierMapping(dpy);
<a href="#h0-28-3" id="h0-28-3" class="d">-	for(i = 0; i &lt; 8; i++)
</a><a href="#h0-28-4" id="h0-28-4" class="d">-		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++)
</a><a href="#h0-28-5" id="h0-28-5" class="i">+	for(i = 0; i &lt; 8; i++) {
</a><a href="#h0-28-6" id="h0-28-6" class="i">+		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
</a> 			if(modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j]
<a href="#h0-28-8" id="h0-28-8" class="d">-			   == XKeysymToKeycode(dpy, XK_Num_Lock))
</a><a href="#h0-28-9" id="h0-28-9" class="i">+					== XKeysymToKeycode(dpy, XK_Num_Lock)) {
</a> 				numlockmask = (1 &lt;&lt; i);
<a href="#h0-28-11" id="h0-28-11" class="i">+			}
</a><a href="#h0-28-12" id="h0-28-12" class="i">+		}
</a><a href="#h0-28-13" id="h0-28-13" class="i">+	}
</a> 	XFreeModifiermap(modmap);
 }
 
 void
 updatetitle(Client *c) {
<a href="#h0-28-19" id="h0-28-19" class="d">-	if(!gettextprop(c-&gt;win, wmatom[WMName], c-&gt;name, sizeof c-&gt;name))
</a><a href="#h0-28-20" id="h0-28-20" class="d">-		gettextprop(c-&gt;win, XA_WM_NAME, c-&gt;name, sizeof c-&gt;name);
</a><a href="#h0-28-21" id="h0-28-21" class="i">+	if(!gettextprop(c-&gt;win, wmatom[WMName], c-&gt;name, sizeof(c-&gt;name)))
</a><a href="#h0-28-22" id="h0-28-22" class="i">+		gettextprop(c-&gt;win, XA_WM_NAME, c-&gt;name, sizeof(c-&gt;name));
</a> 	if(sel == c)
 		XStoreName(dpy, win, c-&gt;name);
 	drawbar();
<a href="#h0-29" id="h0-29" class="h">@@ -869,15 +924,25 @@ updatetitle(Client *c) {
</a> int
 xerror(Display *dpy, XErrorEvent *ee) {
 	if(ee-&gt;error_code == BadWindow
<a href="#h0-29-3" id="h0-29-3" class="d">-	|| (ee-&gt;request_code == X_SetInputFocus &amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h0-29-4" id="h0-29-4" class="d">-	|| (ee-&gt;request_code == X_PolyText8 &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-5" id="h0-29-5" class="d">-	|| (ee-&gt;request_code == X_PolyFillRectangle &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-6" id="h0-29-6" class="d">-	|| (ee-&gt;request_code == X_PolySegment &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-7" id="h0-29-7" class="d">-	|| (ee-&gt;request_code == X_ConfigureWindow &amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h0-29-8" id="h0-29-8" class="d">-	|| (ee-&gt;request_code == X_GrabButton &amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h0-29-9" id="h0-29-9" class="d">-	|| (ee-&gt;request_code == X_GrabKey &amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h0-29-10" id="h0-29-10" class="d">-	|| (ee-&gt;request_code == X_CopyArea &amp;&amp; ee-&gt;error_code == BadDrawable))
</a><a href="#h0-29-11" id="h0-29-11" class="i">+			|| (ee-&gt;request_code == X_SetInputFocus
</a><a href="#h0-29-12" id="h0-29-12" class="i">+				&amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h0-29-13" id="h0-29-13" class="i">+			|| (ee-&gt;request_code == X_PolyText8
</a><a href="#h0-29-14" id="h0-29-14" class="i">+				&amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-15" id="h0-29-15" class="i">+			|| (ee-&gt;request_code == X_PolyFillRectangle
</a><a href="#h0-29-16" id="h0-29-16" class="i">+				&amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-17" id="h0-29-17" class="i">+			|| (ee-&gt;request_code == X_PolySegment
</a><a href="#h0-29-18" id="h0-29-18" class="i">+				&amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h0-29-19" id="h0-29-19" class="i">+			|| (ee-&gt;request_code == X_ConfigureWindow
</a><a href="#h0-29-20" id="h0-29-20" class="i">+				&amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h0-29-21" id="h0-29-21" class="i">+			|| (ee-&gt;request_code == X_GrabButton
</a><a href="#h0-29-22" id="h0-29-22" class="i">+				&amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h0-29-23" id="h0-29-23" class="i">+			|| (ee-&gt;request_code == X_GrabKey
</a><a href="#h0-29-24" id="h0-29-24" class="i">+				&amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h0-29-25" id="h0-29-25" class="i">+			|| (ee-&gt;request_code == X_CopyArea
</a><a href="#h0-29-26" id="h0-29-26" class="i">+				&amp;&amp; ee-&gt;error_code == BadDrawable)) {
</a> 		return 0;
<a href="#h0-29-28" id="h0-29-28" class="i">+	}
</a><a href="#h0-29-29" id="h0-29-29" class="i">+
</a> 	fprintf(stderr, &quot;tabbed: fatal error: request code=%d, error code=%d\n&quot;,
 			ee-&gt;request_code, ee-&gt;error_code);
 	return xerrorxlib(dpy, ee); /* may call exit */
<a href="#h0-30" id="h0-30" class="h">@@ -886,8 +951,7 @@ xerror(Display *dpy, XErrorEvent *ee) {
</a> char *argv0;
 
 void
<a href="#h0-30-3" id="h0-30-3" class="d">-usage(void)
</a><a href="#h0-30-4" id="h0-30-4" class="d">-{
</a><a href="#h0-30-5" id="h0-30-5" class="i">+usage(void) {
</a> 	die(&quot;usage: %s [-dhsv] [-n name] command...\n&quot;, argv0);
 }
 
<a href="#h0-31" id="h0-31" class="h">@@ -923,6 +987,7 @@ main(int argc, char *argv[]) {
</a> 		fprintf(stderr, &quot;tabbed: no locale support\n&quot;);
 	if(!(dpy = XOpenDisplay(NULL)))
 		die(&quot;tabbed: cannot open display\n&quot;);
<a href="#h0-31-3" id="h0-31-3" class="i">+
</a> 	setup();
 	printf(&quot;0x%lx\n&quot;, win);
 	fflush(NULL);
</pre>
</div>
</body>
</html>
