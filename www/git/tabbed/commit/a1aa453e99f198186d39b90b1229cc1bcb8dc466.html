<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>select or open new tab with Ctrl-T - tabbed - tab interface for application supporting Xembed
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="tabbed Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>tabbed</h1><span class="desc">tab interface for application supporting Xembed
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a1aa453e99f198186d39b90b1229cc1bcb8dc466.html">a1aa453e99f198186d39b90b1229cc1bcb8dc466</a>
<b>parent</b> <a href="../commit/b46a3a278856bb33dc299d11d0be1b01d04df39c.html">b46a3a278856bb33dc299d11d0be1b01d04df39c</a>
<b>Author:</b> Markus Teich &lt;<a href="mailto:markus.teich@stusta.mhn.de">markus.teich@stusta.mhn.de</a>&gt;
<b>Date:</b>   Thu, 28 Nov 2013 18:26:21 +0100

select or open new tab with Ctrl-T

The default config will display all open tabs in dmenu. You can either select
one of them, or if you enter a string, that does not start with „0x“, tabbed
will open a new tab and run the command specified at tabbed-startup but append
the entered string to the command first.

With
tabbed -r 2 surf -e &#39;&#39;
you can hit Ctrl-T and either select an already opened tab or enter an URL,
which will be opened in a new tab with surf.

Signed-off-by: Christoph Lohmann &lt;20h@r-36.net&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">tabbed.c</a></td><td> | </td><td class="num">51</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------</span></td></tr>
</table></pre><pre>2 files changed, 53 insertions(+), 7 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -19,11 +19,20 @@ static const Bool foreground    = True;
</a> static int  newposition   = 0;
 static Bool npisrelative  = False;
 
<a href="#h0-0-3" id="h0-0-3" class="i">+#define SETPROP(p) { \
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	.v = (char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h0-0-5" id="h0-0-5" class="i">+		&quot;prop=\&quot;`xwininfo -children -id $1 | grep &#39;^     0x&#39; | sed -e&#39;s@^ *\\(0x[0-9a-f]*\\) \&quot;\\([^\&quot;]*\\)\&quot;.*@\\1 \\2@&#39; | xargs -0 printf %b | dmenu -l 10`\&quot; &amp;&amp;&quot; \
</a><a href="#h0-0-6" id="h0-0-6" class="i">+		&quot;xprop -id $1 -f $0 8s -set $0 \&quot;$prop\&quot;&quot;, \
</a><a href="#h0-0-7" id="h0-0-7" class="i">+		p, winid, NULL \
</a><a href="#h0-0-8" id="h0-0-8" class="i">+	} \
</a><a href="#h0-0-9" id="h0-0-9" class="i">+}
</a><a href="#h0-0-10" id="h0-0-10" class="i">+
</a> #define MODKEY ControlMask
 static Key keys[] = { \
 	/* modifier                     key        function        argument */
 	{ MODKEY|ShiftMask,             XK_Return, focusonce,      { 0 } },
 	{ MODKEY|ShiftMask,             XK_Return, spawn,          { 0 } },
<a href="#h0-0-16" id="h0-0-16" class="i">+	{ MODKEY,                       XK_t,      spawn,          SETPROP(&quot;_TABBED_SELECT_TAB&quot;) },
</a> 
 	{ MODKEY|ShiftMask,             XK_l,      rotate,         { .i = +1 } },
 	{ MODKEY|ShiftMask,             XK_h,      rotate,         { .i = -1 } },
<b>diff --git a/<a id="h1" href="../file/tabbed.c.html">tabbed.c</a> b/<a href="../file/tabbed.c.html">tabbed.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -48,7 +48,7 @@
</a> 
 enum { ColFG, ColBG, ColLast };                         /* color */
 enum { WMProtocols, WMDelete, WMName, WMState, WMFullscreen,
<a href="#h1-0-3" id="h1-0-3" class="d">-	XEmbed, WMLast };                               /* default atoms */
</a><a href="#h1-0-4" id="h1-0-4" class="i">+	XEmbed, WMSelectTab, WMLast };                      /* default atoms */
</a> 
 typedef union {
 	int i;
<a href="#h1-1" id="h1-1" class="h">@@ -103,6 +103,7 @@ static void focus(int c);
</a> static void focusin(const XEvent *e);
 static void focusonce(const Arg *arg);
 static void fullscreen(const Arg *arg);
<a href="#h1-1-3" id="h1-1-3" class="i">+static char* getatom(int a);
</a> static int getclient(Window w);
 static unsigned long getcolor(const char *colstr);
 static int getfirsttab(void);
<a href="#h1-2" id="h1-2" class="h">@@ -157,6 +158,7 @@ static Window root, win;
</a> static Client **clients = NULL;
 static int nclients = 0, sel = -1, lastsel = -1;
 static int (*xerrorxlib)(Display *, XErrorEvent *);
<a href="#h1-2-3" id="h1-2-3" class="i">+static int cmd_append_pos = 0;
</a> static char winid[64];
 static char **cmd = NULL;
 static char *wmname = &quot;tabbed&quot;;
<a href="#h1-3" id="h1-3" class="h">@@ -428,6 +430,7 @@ focus(int c) {
</a> 
 	/* If c, sel and clients are -1, raise tabbed-win itself */
 	if(nclients == 0) {
<a href="#h1-3-3" id="h1-3-3" class="i">+		cmd[cmd_append_pos] = NULL;
</a> 		for(i = 0, n = strlen(buf); cmd[i] &amp;&amp; n &lt; sizeof(buf); i++)
 			n += snprintf(&amp;buf[n], sizeof(buf) - n, &quot; %s&quot;, cmd[i]);
 
<a href="#h1-4" id="h1-4" class="h">@@ -489,6 +492,26 @@ fullscreen(const Arg *arg) {
</a> 	XSendEvent(dpy, root, False, SubstructureNotifyMask, &amp;e);
 }
 
<a href="#h1-4-3" id="h1-4-3" class="i">+char *
</a><a href="#h1-4-4" id="h1-4-4" class="i">+getatom(int a) {
</a><a href="#h1-4-5" id="h1-4-5" class="i">+	static char buf[BUFSIZ];
</a><a href="#h1-4-6" id="h1-4-6" class="i">+	Atom adummy;
</a><a href="#h1-4-7" id="h1-4-7" class="i">+	int idummy;
</a><a href="#h1-4-8" id="h1-4-8" class="i">+	unsigned long ldummy;
</a><a href="#h1-4-9" id="h1-4-9" class="i">+	unsigned char *p = NULL;
</a><a href="#h1-4-10" id="h1-4-10" class="i">+
</a><a href="#h1-4-11" id="h1-4-11" class="i">+	XGetWindowProperty(dpy, win, wmatom[a], 0L, BUFSIZ, False, XA_STRING,
</a><a href="#h1-4-12" id="h1-4-12" class="i">+			&amp;adummy, &amp;idummy, &amp;ldummy, &amp;ldummy, &amp;p);
</a><a href="#h1-4-13" id="h1-4-13" class="i">+	if(p) {
</a><a href="#h1-4-14" id="h1-4-14" class="i">+		strncpy(buf, (char *)p, LENGTH(buf)-1);
</a><a href="#h1-4-15" id="h1-4-15" class="i">+	} else {
</a><a href="#h1-4-16" id="h1-4-16" class="i">+		buf[0] = &#39;\0&#39;;
</a><a href="#h1-4-17" id="h1-4-17" class="i">+	}
</a><a href="#h1-4-18" id="h1-4-18" class="i">+	XFree(p);
</a><a href="#h1-4-19" id="h1-4-19" class="i">+
</a><a href="#h1-4-20" id="h1-4-20" class="i">+	return buf;
</a><a href="#h1-4-21" id="h1-4-21" class="i">+}
</a><a href="#h1-4-22" id="h1-4-22" class="i">+
</a> int
 getclient(Window w) {
 	int i;
<a href="#h1-5" id="h1-5" class="h">@@ -775,8 +798,20 @@ void
</a> propertynotify(const XEvent *e) {
 	const XPropertyEvent *ev = &amp;e-&gt;xproperty;
 	int c;
<a href="#h1-5-3" id="h1-5-3" class="i">+	char* selection = NULL;
</a><a href="#h1-5-4" id="h1-5-4" class="i">+	Arg arg;
</a> 
<a href="#h1-5-6" id="h1-5-6" class="d">-	if(ev-&gt;state != PropertyDelete &amp;&amp; ev-&gt;atom == XA_WM_NAME
</a><a href="#h1-5-7" id="h1-5-7" class="i">+	if(ev-&gt;state == PropertyNewValue &amp;&amp; ev-&gt;atom == wmatom[WMSelectTab]) {
</a><a href="#h1-5-8" id="h1-5-8" class="i">+		selection = getatom(WMSelectTab);
</a><a href="#h1-5-9" id="h1-5-9" class="i">+		if(!strncmp(selection, &quot;0x&quot;, 2)) {
</a><a href="#h1-5-10" id="h1-5-10" class="i">+			arg.i = getclient(strtoul(selection, NULL, 0));
</a><a href="#h1-5-11" id="h1-5-11" class="i">+			move(&amp;arg);
</a><a href="#h1-5-12" id="h1-5-12" class="i">+		} else {
</a><a href="#h1-5-13" id="h1-5-13" class="i">+			cmd[cmd_append_pos] = selection;
</a><a href="#h1-5-14" id="h1-5-14" class="i">+			arg.v = cmd;
</a><a href="#h1-5-15" id="h1-5-15" class="i">+			spawn(&amp;arg);
</a><a href="#h1-5-16" id="h1-5-16" class="i">+		}
</a><a href="#h1-5-17" id="h1-5-17" class="i">+	} else if(ev-&gt;state != PropertyDelete &amp;&amp; ev-&gt;atom == XA_WM_NAME
</a> 			&amp;&amp; (c = getclient(ev-&gt;window)) &gt; -1) {
 		updatetitle(c);
 	}
<a href="#h1-6" id="h1-6" class="h">@@ -862,13 +897,14 @@ void
</a> setcmd(int argc, char *argv[], int replace) {
 	int i;
 
<a href="#h1-6-3" id="h1-6-3" class="d">-	cmd = emallocz((argc+2) * sizeof(*cmd));
</a><a href="#h1-6-4" id="h1-6-4" class="i">+	cmd = emallocz((argc+3) * sizeof(*cmd));
</a> 	if (argc == 0)
 		return;
 	for(i = 0; i &lt; argc; i++)
 		cmd[i] = argv[i];
 	cmd[(replace &gt; 0)? replace : argc] = winid;
<a href="#h1-6-10" id="h1-6-10" class="d">-	cmd[argc + !(replace &gt; 0)] = NULL;
</a><a href="#h1-6-11" id="h1-6-11" class="i">+	cmd_append_pos = argc + !replace;
</a><a href="#h1-6-12" id="h1-6-12" class="i">+	cmd[cmd_append_pos] = cmd[cmd_append_pos+1] = NULL;
</a> }
 
 void
<a href="#h1-7" id="h1-7" class="h">@@ -892,8 +928,8 @@ setup(void) {
</a> 	wmatom[XEmbed] = XInternAtom(dpy, &quot;_XEMBED&quot;, False);
 	wmatom[WMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
 	wmatom[WMState] = XInternAtom(dpy, &quot;_NET_WM_STATE&quot;, False);
<a href="#h1-7-3" id="h1-7-3" class="d">-	wmatom[WMFullscreen] = XInternAtom(dpy, &quot;_NET_WM_STATE_FULLSCREEN&quot;,
</a><a href="#h1-7-4" id="h1-7-4" class="d">-			False);
</a><a href="#h1-7-5" id="h1-7-5" class="i">+	wmatom[WMFullscreen] = XInternAtom(dpy, &quot;_NET_WM_STATE_FULLSCREEN&quot;, False);
</a><a href="#h1-7-6" id="h1-7-6" class="i">+	wmatom[WMSelectTab] = XInternAtom(dpy, &quot;_TABBED_SELECT_TAB&quot;, False);
</a> 
 	/* init appearance */
 	wx = 0;
<a href="#h1-8" id="h1-8" class="h">@@ -943,7 +979,7 @@ setup(void) {
</a> 			dc.norm[ColFG], dc.norm[ColBG]);
 	XMapRaised(dpy, win);
 	XSelectInput(dpy, win, SubstructureNotifyMask|FocusChangeMask|
<a href="#h1-8-3" id="h1-8-3" class="d">-			ButtonPressMask|ExposureMask|KeyPressMask|
</a><a href="#h1-8-4" id="h1-8-4" class="i">+			ButtonPressMask|ExposureMask|KeyPressMask|PropertyChangeMask|
</a> 			StructureNotifyMask|SubstructureRedirectMask);
 	xerrorxlib = XSetErrorHandler(xerror);
 
<a href="#h1-9" id="h1-9" class="h">@@ -993,6 +1029,7 @@ spawn(const Arg *arg) {
</a> 			fprintf(stderr, &quot;tabbed: execvp %s&quot;,
 					((char **)arg-&gt;v)[0]);
 		} else {
<a href="#h1-9-3" id="h1-9-3" class="i">+			cmd[cmd_append_pos] = NULL;
</a> 			execvp(cmd[0], cmd);
 			fprintf(stderr, &quot;tabbed: execvp %s&quot;, cmd[0]);
 		}
</pre>
</div>
</body>
</html>
