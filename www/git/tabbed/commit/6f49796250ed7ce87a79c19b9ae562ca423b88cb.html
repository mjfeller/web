<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Changing the single-linked list for clients to a malloc()ed array. This makes algorithms more efficient, that depend on the number of clients or shuffeling around. The patch also adds new shortcuts to move tabs in their position. The default color scheme is changed to the one of the maintainer. - tabbed - tab interface for application supporting Xembed
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="tabbed Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>tabbed</h1><span class="desc">tab interface for application supporting Xembed
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/6f49796250ed7ce87a79c19b9ae562ca423b88cb.html">6f49796250ed7ce87a79c19b9ae562ca423b88cb</a>
<b>parent</b> <a href="../commit/719e5a97fe795b165a2265e6bb25a9238d2211d4.html">719e5a97fe795b165a2265e6bb25a9238d2211d4</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Sun, 25 Nov 2012 22:09:55 +0100

Changing the single-linked list for clients to a malloc()ed array. This makes
algorithms more efficient, that depend on the number of clients or shuffeling
around. The patch also adds new shortcuts to move tabs in their position. The
default color scheme is changed to the one of the maintainer.
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.mk</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">tabbed.1</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">tabbed.c</a></td><td> | </td><td class="num">350</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------------------</span></td></tr>
</table></pre><pre>4 files changed, 226 insertions(+), 146 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,11 +1,11 @@
</a> /* See LICENSE file for copyright and license details. */
 
 /* appearance */
<a href="#h0-0-3" id="h0-0-3" class="d">-static const char font[]        = &quot;-*-terminus-medium-r-*-*-16-*-*-*-*-*-*-*&quot;;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+static const char font[]        = &quot;-*-*-medium-*-*-*-14-*-*-*-*-*-*-*&quot;;
</a> static const char normbgcolor[] = &quot;#222222&quot;;
<a href="#h0-0-6" id="h0-0-6" class="d">-static const char normfgcolor[] = &quot;#bbbbbb&quot;;
</a><a href="#h0-0-7" id="h0-0-7" class="d">-static const char selbgcolor[]  = &quot;#005577&quot;;
</a><a href="#h0-0-8" id="h0-0-8" class="d">-static const char selfgcolor[]  = &quot;#eeeeee&quot;;
</a><a href="#h0-0-9" id="h0-0-9" class="i">+static const char normfgcolor[] = &quot;#cccccc&quot;;
</a><a href="#h0-0-10" id="h0-0-10" class="i">+static const char selbgcolor[]  = &quot;#555555&quot;;
</a><a href="#h0-0-11" id="h0-0-11" class="i">+static const char selfgcolor[]  = &quot;#ffffff&quot;;
</a> static const char before[]      = &quot;&lt;&quot;;
 static const char after[]       = &quot;&gt;&quot;;
 static const int  tabwidth      = 200;
<a href="#h0-1" id="h0-1" class="h">@@ -18,6 +18,8 @@ static Key keys[] = { \
</a> 	{ MODKEY|ShiftMask,             XK_Return, spawn,          { 0 } },
 	{ MODKEY|ShiftMask,             XK_l,      rotate,         { .i = +1 } },
 	{ MODKEY|ShiftMask,             XK_h,      rotate,         { .i = -1 } },
<a href="#h0-1-3" id="h0-1-3" class="i">+	{ MODKEY|ShiftMask,             XK_j,      movetab,        { .i = -1 } },
</a><a href="#h0-1-4" id="h0-1-4" class="i">+	{ MODKEY|ShiftMask,             XK_k,      movetab,        { .i = +1 } },
</a> 	{ MODKEY,                       XK_Tab,    rotate,         { .i = 0 } },
 	{ MODKEY,                       XK_1,      move,           { .i = 0 } },
 	{ MODKEY,                       XK_2,      move,           { .i = 1 } },
<a href="#h0-2" id="h0-2" class="h">@@ -31,3 +33,4 @@ static Key keys[] = { \
</a> 	{ MODKEY,                       XK_0,      move,           { .i = 9 } },
 	{ MODKEY,                       XK_q,      killclient,     { 0 } },
 };
<a href="#h0-2-3" id="h0-2-3" class="i">+
</a><b>diff --git a/<a id="h1" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -13,8 +13,8 @@ LIBS = -L/usr/lib -lc -lX11
</a> 
 # flags
 CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot;
<a href="#h1-0-3" id="h1-0-3" class="d">-CFLAGS = -std=c99 -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
</a><a href="#h1-0-4" id="h1-0-4" class="d">-LDFLAGS = -s ${LIBS}
</a><a href="#h1-0-5" id="h1-0-5" class="i">+CFLAGS = -g -std=c99 -pedantic -Wall -O0 ${INCS} ${CPPFLAGS}
</a><a href="#h1-0-6" id="h1-0-6" class="i">+LDFLAGS = -g ${LIBS}
</a> 
 # Solaris
 #CFLAGS = -fast ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -22,3 +22,4 @@ LDFLAGS = -s ${LIBS}
</a> 
 # compiler and linker
 CC = cc
<a href="#h1-1-3" id="h1-1-3" class="i">+
</a><b>diff --git a/<a id="h2" href="../file/tabbed.1.html">tabbed.1</a> b/<a href="../file/tabbed.1.html">tabbed.1</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -54,6 +54,12 @@ previous tab
</a> .B Ctrl\-Shift\-l
 next tab
 .TP
<a href="#h2-0-3" id="h2-0-3" class="i">+.B Ctrl\-Shift\-j
</a><a href="#h2-0-4" id="h2-0-4" class="i">+move selected tab one to the left
</a><a href="#h2-0-5" id="h2-0-5" class="i">+.TP
</a><a href="#h2-0-6" id="h2-0-6" class="i">+.B Ctrl\-Shift\-k
</a><a href="#h2-0-7" id="h2-0-7" class="i">+move selected tab one to the right
</a><a href="#h2-0-8" id="h2-0-8" class="i">+.TP
</a> .B Ctrl\-Tab
 toggle between tabs
 .TP
<b>diff --git a/<a id="h3" href="../file/tabbed.c.html">tabbed.c</a> b/<a href="../file/tabbed.c.html">tabbed.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -78,7 +78,6 @@ typedef struct {
</a> 
 typedef struct Client {
 	char name[256];
<a href="#h3-0-3" id="h3-0-3" class="d">-	struct Client *next;
</a> 	Window win;
 	int tabx;
 	Bool mapped;
<a href="#h3-1" id="h3-1" class="h">@@ -94,37 +93,39 @@ static void configurerequest(const XEvent *e);
</a> static void createnotify(const XEvent *e);
 static void destroynotify(const XEvent *e);
 static void die(const char *errstr, ...);
<a href="#h3-1-3" id="h3-1-3" class="d">-static void drawbar();
</a><a href="#h3-1-4" id="h3-1-4" class="i">+static void drawbar(void);
</a> static void drawtext(const char *text, unsigned long col[ColLast]);
 static void *emallocz(size_t size);
<a href="#h3-1-7" id="h3-1-7" class="i">+static void *erealloc(void *o, size_t size);
</a> static void expose(const XEvent *e);
<a href="#h3-1-9" id="h3-1-9" class="d">-static void focus(Client *c);
</a><a href="#h3-1-10" id="h3-1-10" class="i">+static void focus(int c);
</a> static void focusin(const XEvent *e);
 static void focusonce(const Arg *arg);
<a href="#h3-1-13" id="h3-1-13" class="d">-static Client *getclient(Window w);
</a><a href="#h3-1-14" id="h3-1-14" class="i">+static int getclient(Window w);
</a> static unsigned long getcolor(const char *colstr);
<a href="#h3-1-16" id="h3-1-16" class="d">-static Client *getfirsttab();
</a><a href="#h3-1-17" id="h3-1-17" class="i">+static int getfirsttab(void);
</a> static Bool gettextprop(Window w, Atom atom, char *text, unsigned int size);
 static void initfont(const char *fontstr);
<a href="#h3-1-20" id="h3-1-20" class="d">-static Bool isprotodel(Client *c);
</a><a href="#h3-1-21" id="h3-1-21" class="i">+static Bool isprotodel(int c);
</a> static void keypress(const XEvent *e);
 static void killclient(const Arg *arg);
 static void manage(Window win);
 static void maprequest(const XEvent *e);
 static void move(const Arg *arg);
<a href="#h3-1-27" id="h3-1-27" class="i">+static void movetab(const Arg *arg);
</a> static void propertynotify(const XEvent *e);
<a href="#h3-1-29" id="h3-1-29" class="d">-static void resize(Client *c, int w, int h);
</a><a href="#h3-1-30" id="h3-1-30" class="i">+static void resize(int c, int w, int h);
</a> static void rotate(const Arg *arg);
 static void run(void);
<a href="#h3-1-33" id="h3-1-33" class="d">-static void sendxembed(Client *c, long msg, long detail, long d1, long d2);
</a><a href="#h3-1-34" id="h3-1-34" class="i">+static void sendxembed(int c, long msg, long detail, long d1, long d2);
</a> static void setup(void);
 static void setcmd(int argc, char *argv[], int);
 static void sigchld(int unused);
 static void spawn(const Arg *arg);
 static int textnw(const char *text, unsigned int len);
<a href="#h3-1-40" id="h3-1-40" class="d">-static void unmanage(Client *c);
</a><a href="#h3-1-41" id="h3-1-41" class="i">+static void unmanage(int c);
</a> static void updatenumlockmask(void);
<a href="#h3-1-43" id="h3-1-43" class="d">-static void updatetitle(Client *c);
</a><a href="#h3-1-44" id="h3-1-44" class="i">+static void updatetitle(int c);
</a> static int xerror(Display *dpy, XErrorEvent *ee);
 
 /* variables */
<a href="#h3-2" id="h3-2" class="h">@@ -149,7 +150,8 @@ static Display *dpy;
</a> static DC dc;
 static Atom wmatom[WMLast];
 static Window root, win;
<a href="#h3-2-3" id="h3-2-3" class="d">-static Client *clients = NULL, *sel = NULL, *lastsel = NULL;
</a><a href="#h3-2-4" id="h3-2-4" class="i">+static Client **clients = NULL;
</a><a href="#h3-2-5" id="h3-2-5" class="i">+static int nclients = 0, sel = -1, lastsel = -1;
</a> static int (*xerrorxlib)(Display *, XErrorEvent *);
 static char winid[64];
 static char **cmd = NULL;
<a href="#h3-3" id="h3-3" class="h">@@ -163,20 +165,19 @@ void
</a> buttonpress(const XEvent *e) {
 	const XButtonPressedEvent *ev = &amp;e-&gt;xbutton;
 	int i;
<a href="#h3-3-3" id="h3-3-3" class="d">-	Client *c;
</a> 	Arg arg;
 
<a href="#h3-3-6" id="h3-3-6" class="d">-	c = getfirsttab();
</a><a href="#h3-3-7" id="h3-3-7" class="d">-	if(c != clients &amp;&amp; ev-&gt;x &lt; TEXTW(before))
</a><a href="#h3-3-8" id="h3-3-8" class="i">+	if(getfirsttab() != 0 &amp;&amp; ev-&gt;x &lt; TEXTW(before))
</a> 		return;
<a href="#h3-3-10" id="h3-3-10" class="d">-	for(i = 0; c; c = c-&gt;next, i++) {
</a><a href="#h3-3-11" id="h3-3-11" class="d">-		if(c-&gt;tabx &gt; ev-&gt;x) {
</a><a href="#h3-3-12" id="h3-3-12" class="i">+
</a><a href="#h3-3-13" id="h3-3-13" class="i">+	for(i = 0; i &lt; nclients; i++) {
</a><a href="#h3-3-14" id="h3-3-14" class="i">+		if(clients[i]-&gt;tabx &gt; ev-&gt;x) {
</a> 			switch(ev-&gt;button) {
 			case Button1:
<a href="#h3-3-17" id="h3-3-17" class="d">-				focus(c);
</a><a href="#h3-3-18" id="h3-3-18" class="i">+				focus(i);
</a> 				break;
 			case Button2:
<a href="#h3-3-21" id="h3-3-21" class="d">-				focus(c);
</a><a href="#h3-3-22" id="h3-3-22" class="i">+				focus(i);
</a> 				killclient(NULL);
 				break;
 			case Button4:
<a href="#h3-4" id="h3-4" class="h">@@ -192,15 +193,17 @@ buttonpress(const XEvent *e) {
</a> 
 void
 cleanup(void) {
<a href="#h3-4-3" id="h3-4-3" class="d">-	Client *c, *n;
</a><a href="#h3-4-4" id="h3-4-4" class="i">+	int i;
</a> 
<a href="#h3-4-6" id="h3-4-6" class="d">-	for(c = clients; c; c = n) {
</a><a href="#h3-4-7" id="h3-4-7" class="d">-		focus(c);
</a><a href="#h3-4-8" id="h3-4-8" class="i">+	for(i = 0; i &lt; nclients; i++) {
</a><a href="#h3-4-9" id="h3-4-9" class="i">+		focus(i);
</a> 		killclient(NULL);
<a href="#h3-4-11" id="h3-4-11" class="d">-		XReparentWindow(dpy, c-&gt;win, root, 0, 0);
</a><a href="#h3-4-12" id="h3-4-12" class="d">-		n = c-&gt;next;
</a><a href="#h3-4-13" id="h3-4-13" class="d">-		unmanage(c);
</a><a href="#h3-4-14" id="h3-4-14" class="i">+		killclient(NULL);
</a><a href="#h3-4-15" id="h3-4-15" class="i">+		XReparentWindow(dpy, clients[i]-&gt;win, root, 0, 0);
</a><a href="#h3-4-16" id="h3-4-16" class="i">+		unmanage(i);
</a> 	}
<a href="#h3-4-18" id="h3-4-18" class="i">+	free(clients);
</a><a href="#h3-4-19" id="h3-4-19" class="i">+	clients = NULL;
</a> 
 	if(dc.font.set) {
 		XFreeFontSet(dpy, dc.font.set);
<a href="#h3-5" id="h3-5" class="h">@@ -235,7 +238,7 @@ configurenotify(const XEvent *e) {
</a> 		XFreePixmap(dpy, dc.drawable);
 		dc.drawable = XCreatePixmap(dpy, root, ww, wh,
 				DefaultDepth(dpy, screen));
<a href="#h3-5-3" id="h3-5-3" class="d">-		if(sel)
</a><a href="#h3-5-4" id="h3-5-4" class="i">+		if(sel &gt; -1)
</a> 			resize(sel, ww, wh - bh);
 		XSync(dpy, False);
 	}
<a href="#h3-6" id="h3-6" class="h">@@ -245,9 +248,9 @@ void
</a> configurerequest(const XEvent *e) {
 	const XConfigureRequestEvent *ev = &amp;e-&gt;xconfigurerequest;
 	XWindowChanges wc;
<a href="#h3-6-3" id="h3-6-3" class="d">-	Client *c;
</a><a href="#h3-6-4" id="h3-6-4" class="i">+	int c;
</a> 
<a href="#h3-6-6" id="h3-6-6" class="d">-	if((c = getclient(ev-&gt;window))) {
</a><a href="#h3-6-7" id="h3-6-7" class="i">+	if((c = getclient(ev-&gt;window)) &gt; -1) {
</a> 		wc.x = 0;
 		wc.y = bh;
 		wc.width = ww;
<a href="#h3-7" id="h3-7" class="h">@@ -255,7 +258,7 @@ configurerequest(const XEvent *e) {
</a> 		wc.border_width = 0;
 		wc.sibling = ev-&gt;above;
 		wc.stack_mode = ev-&gt;detail;
<a href="#h3-7-3" id="h3-7-3" class="d">-		XConfigureWindow(dpy, c-&gt;win, ev-&gt;value_mask, &amp;wc);
</a><a href="#h3-7-4" id="h3-7-4" class="i">+		XConfigureWindow(dpy, clients[c]-&gt;win, ev-&gt;value_mask, &amp;wc);
</a> 	}
 }
 
<a href="#h3-8" id="h3-8" class="h">@@ -263,16 +266,16 @@ void
</a> createnotify(const XEvent *e) {
 	const XCreateWindowEvent *ev = &amp;e-&gt;xcreatewindow;
 
<a href="#h3-8-3" id="h3-8-3" class="d">-	if(ev-&gt;window != win &amp;&amp; !getclient(ev-&gt;window))
</a><a href="#h3-8-4" id="h3-8-4" class="i">+	if(ev-&gt;window != win &amp;&amp; getclient(ev-&gt;window) &lt; 0)
</a> 		manage(ev-&gt;window);
 }
 
 void
 destroynotify(const XEvent *e) {
 	const XDestroyWindowEvent *ev = &amp;e-&gt;xdestroywindow;
<a href="#h3-8-11" id="h3-8-11" class="d">-	Client *c;
</a><a href="#h3-8-12" id="h3-8-12" class="i">+	int c;
</a> 
<a href="#h3-8-14" id="h3-8-14" class="d">-	if((c = getclient(ev-&gt;window)))
</a><a href="#h3-8-15" id="h3-8-15" class="i">+	if((c = getclient(ev-&gt;window)) &gt; -1)
</a> 		unmanage(c);
 }
 
<a href="#h3-9" id="h3-9" class="h">@@ -287,29 +290,29 @@ die(const char *errstr, ...) {
</a> }
 
 void
<a href="#h3-9-3" id="h3-9-3" class="d">-drawbar() {
</a><a href="#h3-9-4" id="h3-9-4" class="i">+drawbar(void) {
</a> 	unsigned long *col;
<a href="#h3-9-6" id="h3-9-6" class="d">-	int n, width;
</a><a href="#h3-9-7" id="h3-9-7" class="d">-	Client *c, *fc;
</a><a href="#h3-9-8" id="h3-9-8" class="i">+	int c, fc, width, n = 0;
</a> 	char *name = NULL;
 
<a href="#h3-9-11" id="h3-9-11" class="d">-	if(!clients) {
</a><a href="#h3-9-12" id="h3-9-12" class="i">+	if(nclients == 0) {
</a> 		dc.x = 0;
 		dc.w = ww;
 		XFetchName(dpy, win, &amp;name);
 		drawtext(name ? name : &quot;&quot;, dc.norm);
 		XCopyArea(dpy, dc.drawable, win, dc.gc, 0, 0, ww, bh, 0, 0);
 		XSync(dpy, False);
<a href="#h3-9-19" id="h3-9-19" class="i">+
</a> 		return;
 	}
 
 	width = ww;
<a href="#h3-9-24" id="h3-9-24" class="d">-	for(c = clients; c; c = c-&gt;next)
</a><a href="#h3-9-25" id="h3-9-25" class="d">-		c-&gt;tabx = -1;
</a><a href="#h3-9-26" id="h3-9-26" class="d">-
</a><a href="#h3-9-27" id="h3-9-27" class="d">-	for(n = 0, fc = c = getfirsttab(); c; c = c-&gt;next, n++);
</a><a href="#h3-9-28" id="h3-9-28" class="i">+	clients[nclients-1]-&gt;tabx = -1;
</a><a href="#h3-9-29" id="h3-9-29" class="i">+	fc = getfirsttab();
</a><a href="#h3-9-30" id="h3-9-30" class="i">+	if(fc &gt; -1)
</a><a href="#h3-9-31" id="h3-9-31" class="i">+		n = nclients - fc;
</a> 
<a href="#h3-9-33" id="h3-9-33" class="d">-	if(n * tabwidth &gt; width) {
</a><a href="#h3-9-34" id="h3-9-34" class="i">+	if((n * tabwidth) &gt; width) {
</a> 		dc.w = TEXTW(after);
 		dc.x = width - dc.w;
 		drawtext(after, dc.sel);
<a href="#h3-10" id="h3-10" class="h">@@ -317,18 +320,18 @@ drawbar() {
</a> 	}
 	dc.x = 0;
 
<a href="#h3-10-3" id="h3-10-3" class="d">-	if(fc != clients) {
</a><a href="#h3-10-4" id="h3-10-4" class="i">+	if(fc &gt; 0) {
</a> 		dc.w = TEXTW(before);
 		drawtext(before, dc.sel);
 		dc.x += dc.w;
 		width -= dc.w;
 	}
 
<a href="#h3-10-11" id="h3-10-11" class="d">-	for(c = fc; c &amp;&amp; dc.x &lt; width; c = c-&gt;next) {
</a><a href="#h3-10-12" id="h3-10-12" class="i">+	for(c = (fc &gt; 0)? fc : 0; c &lt; nclients &amp;&amp; dc.x &lt; width; c++) {
</a> 		dc.w = tabwidth;
 		if(c == sel) {
 			col = dc.sel;
<a href="#h3-10-16" id="h3-10-16" class="d">-			if(n * tabwidth &gt; width) {
</a><a href="#h3-10-17" id="h3-10-17" class="i">+			if((n * tabwidth) &gt; width) {
</a> 				dc.w += width % tabwidth;
 			} else {
 				dc.w = width - (n - 1) * tabwidth;
<a href="#h3-11" id="h3-11" class="h">@@ -336,9 +339,9 @@ drawbar() {
</a> 		} else {
 			col = dc.norm;
 		}
<a href="#h3-11-3" id="h3-11-3" class="d">-		drawtext(c-&gt;name, col);
</a><a href="#h3-11-4" id="h3-11-4" class="i">+		drawtext(clients[c]-&gt;name, col);
</a> 		dc.x += dc.w;
<a href="#h3-11-6" id="h3-11-6" class="d">-		c-&gt;tabx = dc.x;
</a><a href="#h3-11-7" id="h3-11-7" class="i">+		clients[c]-&gt;tabx = dc.x;
</a> 	}
 	XCopyArea(dpy, dc.drawable, win, dc.gc, 0, 0, ww, bh, 0, 0);
 	XSync(dpy, False);
<a href="#h3-12" id="h3-12" class="h">@@ -389,6 +392,15 @@ emallocz(size_t size) {
</a> 	return p;
 }
 
<a href="#h3-12-3" id="h3-12-3" class="i">+void *
</a><a href="#h3-12-4" id="h3-12-4" class="i">+erealloc(void *o, size_t size) {
</a><a href="#h3-12-5" id="h3-12-5" class="i">+	void *p;
</a><a href="#h3-12-6" id="h3-12-6" class="i">+
</a><a href="#h3-12-7" id="h3-12-7" class="i">+	if(!(p = realloc(o, size)))
</a><a href="#h3-12-8" id="h3-12-8" class="i">+		die(&quot;tabbed: cannot realloc\n&quot;);
</a><a href="#h3-12-9" id="h3-12-9" class="i">+	return p;
</a><a href="#h3-12-10" id="h3-12-10" class="i">+}
</a><a href="#h3-12-11" id="h3-12-11" class="i">+
</a> void
 expose(const XEvent *e) {
 	const XExposeEvent *ev = &amp;e-&gt;xexpose;
<a href="#h3-13" id="h3-13" class="h">@@ -398,12 +410,12 @@ expose(const XEvent *e) {
</a> }
 
 void
<a href="#h3-13-3" id="h3-13-3" class="d">-focus(Client *c) {
</a><a href="#h3-13-4" id="h3-13-4" class="i">+focus(int c) {
</a> 	char buf[BUFSIZ] = &quot;tabbed-&quot;VERSION&quot; ::&quot;;
 	size_t i, n;
 
<a href="#h3-13-8" id="h3-13-8" class="d">-	/* If c, sel and clients are NULL, raise tabbed-win itself */
</a><a href="#h3-13-9" id="h3-13-9" class="d">-	if(!c &amp;&amp; !(c = sel ? sel : clients)) {
</a><a href="#h3-13-10" id="h3-13-10" class="i">+	/* If c, sel and clients are -1, raise tabbed-win itself */
</a><a href="#h3-13-11" id="h3-13-11" class="i">+	if(nclients == 0) {
</a> 		for(i = 0, n = strlen(buf); cmd[i] &amp;&amp; n &lt; sizeof(buf); i++)
 			n += snprintf(&amp;buf[n], sizeof(buf) - n, &quot; %s&quot;, cmd[i]);
 
<a href="#h3-14" id="h3-14" class="h">@@ -413,16 +425,18 @@ focus(Client *c) {
</a> 		return;
 	}
 
<a href="#h3-14-3" id="h3-14-3" class="i">+	if(c &lt; 0 || c &gt;= nclients)
</a><a href="#h3-14-4" id="h3-14-4" class="i">+		return;
</a><a href="#h3-14-5" id="h3-14-5" class="i">+
</a> 	resize(c, ww, wh - bh);
<a href="#h3-14-7" id="h3-14-7" class="d">-	XRaiseWindow(dpy, c-&gt;win);
</a><a href="#h3-14-8" id="h3-14-8" class="d">-	XSetInputFocus(dpy, c-&gt;win, RevertToParent, CurrentTime);
</a><a href="#h3-14-9" id="h3-14-9" class="i">+	XRaiseWindow(dpy, clients[c]-&gt;win);
</a><a href="#h3-14-10" id="h3-14-10" class="i">+	XSetInputFocus(dpy, clients[c]-&gt;win, RevertToParent, CurrentTime);
</a> 	sendxembed(c, XEMBED_FOCUS_IN, XEMBED_FOCUS_CURRENT, 0, 0);
 	sendxembed(c, XEMBED_WINDOW_ACTIVATE, 0, 0, 0);
<a href="#h3-14-13" id="h3-14-13" class="d">-	XStoreName(dpy, win, c-&gt;name);
</a><a href="#h3-14-14" id="h3-14-14" class="i">+	XStoreName(dpy, win, clients[c]-&gt;name);
</a> 
<a href="#h3-14-16" id="h3-14-16" class="d">-	if(sel != c) {
</a><a href="#h3-14-17" id="h3-14-17" class="i">+	if(sel != c)
</a> 		lastsel = sel;
<a href="#h3-14-19" id="h3-14-19" class="d">-	}
</a> 
 	sel = c;
 	drawbar();
<a href="#h3-15" id="h3-15" class="h">@@ -446,16 +460,16 @@ focusonce(const Arg *arg) {
</a> 	nextfocus = True;
 }
 
<a href="#h3-15-3" id="h3-15-3" class="d">-Client *
</a><a href="#h3-15-4" id="h3-15-4" class="i">+int
</a> getclient(Window w) {
<a href="#h3-15-6" id="h3-15-6" class="d">-	Client *c;
</a><a href="#h3-15-7" id="h3-15-7" class="i">+	int i;
</a> 
<a href="#h3-15-9" id="h3-15-9" class="d">-	for(c = clients; c; c = c-&gt;next) {
</a><a href="#h3-15-10" id="h3-15-10" class="d">-		if(c-&gt;win == w)
</a><a href="#h3-15-11" id="h3-15-11" class="d">-			return c;
</a><a href="#h3-15-12" id="h3-15-12" class="i">+	for(i = 0; i &lt; nclients; i++) {
</a><a href="#h3-15-13" id="h3-15-13" class="i">+		if(clients[i]-&gt;win == w)
</a><a href="#h3-15-14" id="h3-15-14" class="i">+			return i;
</a> 	}
 
<a href="#h3-15-17" id="h3-15-17" class="d">-	return NULL;
</a><a href="#h3-15-18" id="h3-15-18" class="i">+	return -1;
</a> }
 
 unsigned long
<a href="#h3-16" id="h3-16" class="h">@@ -469,23 +483,22 @@ getcolor(const char *colstr) {
</a> 	return color.pixel;
 }
 
<a href="#h3-16-3" id="h3-16-3" class="d">-Client *
</a><a href="#h3-16-4" id="h3-16-4" class="d">-getfirsttab() {
</a><a href="#h3-16-5" id="h3-16-5" class="d">-	unsigned int n, seli;
</a><a href="#h3-16-6" id="h3-16-6" class="d">-	Client *c, *fc;
</a><a href="#h3-16-7" id="h3-16-7" class="d">-
</a><a href="#h3-16-8" id="h3-16-8" class="d">-	if(!sel)
</a><a href="#h3-16-9" id="h3-16-9" class="d">-		return NULL;
</a><a href="#h3-16-10" id="h3-16-10" class="d">-
</a><a href="#h3-16-11" id="h3-16-11" class="d">-	c = fc = clients;
</a><a href="#h3-16-12" id="h3-16-12" class="d">-	for(n = 0; c; c = c-&gt;next, n++);
</a><a href="#h3-16-13" id="h3-16-13" class="d">-
</a><a href="#h3-16-14" id="h3-16-14" class="d">-	if(n * tabwidth &gt; ww) {
</a><a href="#h3-16-15" id="h3-16-15" class="d">-		for(seli = 0, c = clients; c &amp;&amp; c != sel; c = c-&gt;next, seli++);
</a><a href="#h3-16-16" id="h3-16-16" class="d">-
</a><a href="#h3-16-17" id="h3-16-17" class="d">-		for(; seli * tabwidth &gt; ww / 2 &amp;&amp; n * tabwidth &gt; ww;
</a><a href="#h3-16-18" id="h3-16-18" class="d">-				fc = fc-&gt;next, seli--, n--);
</a><a href="#h3-16-19" id="h3-16-19" class="i">+int
</a><a href="#h3-16-20" id="h3-16-20" class="i">+getfirsttab(void) {
</a><a href="#h3-16-21" id="h3-16-21" class="i">+	int c, n, fc;
</a><a href="#h3-16-22" id="h3-16-22" class="i">+
</a><a href="#h3-16-23" id="h3-16-23" class="i">+	if(sel &lt; 0)
</a><a href="#h3-16-24" id="h3-16-24" class="i">+		return -1;
</a><a href="#h3-16-25" id="h3-16-25" class="i">+
</a><a href="#h3-16-26" id="h3-16-26" class="i">+	c = sel;
</a><a href="#h3-16-27" id="h3-16-27" class="i">+	fc = 0;
</a><a href="#h3-16-28" id="h3-16-28" class="i">+	n = nclients;
</a><a href="#h3-16-29" id="h3-16-29" class="i">+	if((n * tabwidth) &gt; ww) {
</a><a href="#h3-16-30" id="h3-16-30" class="i">+		for(; (c * tabwidth) &gt; (ww / 2)
</a><a href="#h3-16-31" id="h3-16-31" class="i">+				&amp;&amp; (n * tabwidth) &gt; ww;
</a><a href="#h3-16-32" id="h3-16-32" class="i">+				c--, n--, fc++);
</a> 	}
<a href="#h3-16-34" id="h3-16-34" class="i">+
</a> 	return fc;
 }
 
<a href="#h3-17" id="h3-17" class="h">@@ -559,12 +572,12 @@ initfont(const char *fontstr) {
</a> }
 
 Bool
<a href="#h3-17-3" id="h3-17-3" class="d">-isprotodel(Client *c) {
</a><a href="#h3-17-4" id="h3-17-4" class="i">+isprotodel(int c) {
</a> 	int i, n;
 	Atom *protocols;
 	Bool ret = False;
 
<a href="#h3-17-9" id="h3-17-9" class="d">-	if(XGetWMProtocols(dpy, c-&gt;win, &amp;protocols, &amp;n)) {
</a><a href="#h3-17-10" id="h3-17-10" class="i">+	if(XGetWMProtocols(dpy, clients[c]-&gt;win, &amp;protocols, &amp;n)) {
</a> 		for(i = 0; !ret &amp;&amp; i &lt; n; i++) {
 			if(protocols[i] == wmatom[WMDelete])
 				ret = True;
<a href="#h3-18" id="h3-18" class="h">@@ -595,20 +608,20 @@ void
</a> killclient(const Arg *arg) {
 	XEvent ev;
 
<a href="#h3-18-3" id="h3-18-3" class="d">-	if(!sel)
</a><a href="#h3-18-4" id="h3-18-4" class="i">+	if(sel &lt; 0)
</a> 		return;
 
<a href="#h3-18-7" id="h3-18-7" class="d">-	if(isprotodel(sel) &amp;&amp; !sel-&gt;closed) {
</a><a href="#h3-18-8" id="h3-18-8" class="i">+	if(isprotodel(sel) &amp;&amp; !clients[sel]-&gt;closed) {
</a> 		ev.type = ClientMessage;
<a href="#h3-18-10" id="h3-18-10" class="d">-		ev.xclient.window = sel-&gt;win;
</a><a href="#h3-18-11" id="h3-18-11" class="i">+		ev.xclient.window = clients[sel]-&gt;win;
</a> 		ev.xclient.message_type = wmatom[WMProtocols];
 		ev.xclient.format = 32;
 		ev.xclient.data.l[0] = wmatom[WMDelete];
 		ev.xclient.data.l[1] = CurrentTime;
<a href="#h3-18-16" id="h3-18-16" class="d">-		XSendEvent(dpy, sel-&gt;win, False, NoEventMask, &amp;ev);
</a><a href="#h3-18-17" id="h3-18-17" class="d">-		sel-&gt;closed = True;
</a><a href="#h3-18-18" id="h3-18-18" class="i">+		XSendEvent(dpy, clients[sel]-&gt;win, False, NoEventMask, &amp;ev);
</a><a href="#h3-18-19" id="h3-18-19" class="i">+		clients[sel]-&gt;closed = True;
</a> 	} else {
<a href="#h3-18-21" id="h3-18-21" class="d">-		XKillClient(dpy, sel-&gt;win);
</a><a href="#h3-18-22" id="h3-18-22" class="i">+		XKillClient(dpy, clients[sel]-&gt;win);
</a> 	}
 }
 
<a href="#h3-19" id="h3-19" class="h">@@ -617,30 +630,41 @@ manage(Window w) {
</a> 	updatenumlockmask();
 	{
 		int i, j;
<a href="#h3-19-3" id="h3-19-3" class="d">-		unsigned int modifiers[] = { 0, LockMask, numlockmask, numlockmask|LockMask };
</a><a href="#h3-19-4" id="h3-19-4" class="i">+		unsigned int modifiers[] = { 0, LockMask, numlockmask,
</a><a href="#h3-19-5" id="h3-19-5" class="i">+			numlockmask|LockMask };
</a> 		KeyCode code;
 		Client *c;
 		XEvent e;
 
 		XWithdrawWindow(dpy, w, 0);
 		XReparentWindow(dpy, w, win, 0, bh);
<a href="#h3-19-12" id="h3-19-12" class="d">-		XSelectInput(dpy, w, PropertyChangeMask|StructureNotifyMask|EnterWindowMask);
</a><a href="#h3-19-13" id="h3-19-13" class="i">+		XSelectInput(dpy, w, PropertyChangeMask
</a><a href="#h3-19-14" id="h3-19-14" class="i">+				|StructureNotifyMask|EnterWindowMask);
</a> 		XSync(dpy, False);
<a href="#h3-19-16" id="h3-19-16" class="i">+
</a> 		for(i = 0; i &lt; LENGTH(keys); i++) {
 			if((code = XKeysymToKeycode(dpy, keys[i].keysym))) {
<a href="#h3-19-19" id="h3-19-19" class="d">-				for(j = 0; j &lt; LENGTH(modifiers); j++)
</a><a href="#h3-19-20" id="h3-19-20" class="d">-					XGrabKey(dpy, code, keys[i].mod | modifiers[j], w,
</a><a href="#h3-19-21" id="h3-19-21" class="d">-						 True, GrabModeAsync, GrabModeAsync);
</a><a href="#h3-19-22" id="h3-19-22" class="i">+				for(j = 0; j &lt; LENGTH(modifiers); j++) {
</a><a href="#h3-19-23" id="h3-19-23" class="i">+					XGrabKey(dpy, code, keys[i].mod
</a><a href="#h3-19-24" id="h3-19-24" class="i">+							| modifiers[j], w,
</a><a href="#h3-19-25" id="h3-19-25" class="i">+						 True, GrabModeAsync,
</a><a href="#h3-19-26" id="h3-19-26" class="i">+						 GrabModeAsync);
</a><a href="#h3-19-27" id="h3-19-27" class="i">+				}
</a> 			}
 		}
 
 		c = emallocz(sizeof(*c));
<a href="#h3-19-32" id="h3-19-32" class="d">-		c-&gt;next = clients;
</a> 		c-&gt;win = w;
<a href="#h3-19-34" id="h3-19-34" class="d">-		clients = c;
</a> 
<a href="#h3-19-36" id="h3-19-36" class="d">-		updatetitle(c);
</a><a href="#h3-19-37" id="h3-19-37" class="d">-		drawbar();
</a><a href="#h3-19-38" id="h3-19-38" class="i">+		nclients++;
</a><a href="#h3-19-39" id="h3-19-39" class="i">+		clients = erealloc(clients, sizeof(Client *) * nclients);
</a><a href="#h3-19-40" id="h3-19-40" class="i">+		if(nclients &gt; 1) {
</a><a href="#h3-19-41" id="h3-19-41" class="i">+			memmove(&amp;clients[1], &amp;clients[0],
</a><a href="#h3-19-42" id="h3-19-42" class="i">+					sizeof(Client *) * (nclients - 1));
</a><a href="#h3-19-43" id="h3-19-43" class="i">+		}
</a><a href="#h3-19-44" id="h3-19-44" class="i">+		clients[0] = c;
</a><a href="#h3-19-45" id="h3-19-45" class="i">+
</a><a href="#h3-19-46" id="h3-19-46" class="i">+		updatetitle(0);
</a> 		XLowerWindow(dpy, w);
 		XMapWindow(dpy, w);
 
<a href="#h3-20" id="h3-20" class="h">@@ -656,11 +680,11 @@ manage(Window w) {
</a> 		XSendEvent(dpy, root, False, NoEventMask, &amp;e);
 
 		XSync(dpy, False);
<a href="#h3-20-3" id="h3-20-3" class="d">-		focus(nextfocus ? c : sel);
</a><a href="#h3-20-4" id="h3-20-4" class="i">+		focus((nextfocus)? 0 : ((sel &lt; 0)? 0 : sel));
</a> 		nextfocus = foreground;
 
<a href="#h3-20-7" id="h3-20-7" class="d">-		if(!lastsel)
</a><a href="#h3-20-8" id="h3-20-8" class="d">-			lastsel = c;
</a><a href="#h3-20-9" id="h3-20-9" class="i">+		if(lastsel &lt; 0)
</a><a href="#h3-20-10" id="h3-20-10" class="i">+			lastsel = 0;
</a> 	}
 }
 
<a href="#h3-21" id="h3-21" class="h">@@ -668,34 +692,52 @@ void
</a> maprequest(const XEvent *e) {
 	const XMapRequestEvent *ev = &amp;e-&gt;xmaprequest;
 
<a href="#h3-21-3" id="h3-21-3" class="d">-	if(!getclient(ev-&gt;window))
</a><a href="#h3-21-4" id="h3-21-4" class="i">+	if(getclient(ev-&gt;window) &gt; -1)
</a> 		manage(ev-&gt;window);
 }
 
 void
 move(const Arg *arg) {
<a href="#h3-21-10" id="h3-21-10" class="d">-	int i;
</a><a href="#h3-21-11" id="h3-21-11" class="d">-	Client *c;
</a><a href="#h3-21-12" id="h3-21-12" class="i">+	if(arg-&gt;i &gt;= 0 &amp;&amp; arg-&gt;i &lt; nclients)
</a><a href="#h3-21-13" id="h3-21-13" class="i">+		focus(arg-&gt;i);
</a><a href="#h3-21-14" id="h3-21-14" class="i">+}
</a> 
<a href="#h3-21-16" id="h3-21-16" class="d">-	for(i = 0, c = clients; c; c = c-&gt;next, i++) {
</a><a href="#h3-21-17" id="h3-21-17" class="d">-		if(arg-&gt;i == i)
</a><a href="#h3-21-18" id="h3-21-18" class="d">-			focus(c);
</a><a href="#h3-21-19" id="h3-21-19" class="d">-	}
</a><a href="#h3-21-20" id="h3-21-20" class="i">+void
</a><a href="#h3-21-21" id="h3-21-21" class="i">+movetab(const Arg *arg) {
</a><a href="#h3-21-22" id="h3-21-22" class="i">+	int c;
</a><a href="#h3-21-23" id="h3-21-23" class="i">+	Client *new;
</a><a href="#h3-21-24" id="h3-21-24" class="i">+
</a><a href="#h3-21-25" id="h3-21-25" class="i">+	if(sel &lt; 0 || (arg-&gt;i == 0))
</a><a href="#h3-21-26" id="h3-21-26" class="i">+		return;
</a><a href="#h3-21-27" id="h3-21-27" class="i">+
</a><a href="#h3-21-28" id="h3-21-28" class="i">+	c = sel + arg-&gt;i;
</a><a href="#h3-21-29" id="h3-21-29" class="i">+	while(c &gt;= nclients)
</a><a href="#h3-21-30" id="h3-21-30" class="i">+		c -= nclients;
</a><a href="#h3-21-31" id="h3-21-31" class="i">+	while(c &lt; 0)
</a><a href="#h3-21-32" id="h3-21-32" class="i">+		c += nclients;
</a><a href="#h3-21-33" id="h3-21-33" class="i">+
</a><a href="#h3-21-34" id="h3-21-34" class="i">+	new = clients[c];
</a><a href="#h3-21-35" id="h3-21-35" class="i">+	clients[c] = clients[sel];
</a><a href="#h3-21-36" id="h3-21-36" class="i">+	clients[sel] = new;
</a><a href="#h3-21-37" id="h3-21-37" class="i">+
</a><a href="#h3-21-38" id="h3-21-38" class="i">+	sel = c;
</a><a href="#h3-21-39" id="h3-21-39" class="i">+
</a><a href="#h3-21-40" id="h3-21-40" class="i">+	drawbar();
</a> }
 
 void
 propertynotify(const XEvent *e) {
 	const XPropertyEvent *ev = &amp;e-&gt;xproperty;
<a href="#h3-21-46" id="h3-21-46" class="d">-	Client *c;
</a><a href="#h3-21-47" id="h3-21-47" class="i">+	int c;
</a> 
 	if(ev-&gt;state != PropertyDelete &amp;&amp; ev-&gt;atom == XA_WM_NAME
<a href="#h3-21-50" id="h3-21-50" class="d">-			&amp;&amp; (c = getclient(ev-&gt;window))) {
</a><a href="#h3-21-51" id="h3-21-51" class="i">+			&amp;&amp; (c = getclient(ev-&gt;window)) &gt; -1) {
</a> 		updatetitle(c);
 	}
 }
 
 void
<a href="#h3-21-57" id="h3-21-57" class="d">-resize(Client *c, int w, int h) {
</a><a href="#h3-21-58" id="h3-21-58" class="i">+resize(int c, int w, int h) {
</a> 	XConfigureEvent ce;
 	XWindowChanges wc;
 
<a href="#h3-22" id="h3-22" class="h">@@ -705,31 +747,35 @@ resize(Client *c, int w, int h) {
</a> 	ce.height = wc.height = h;
 	ce.type = ConfigureNotify;
 	ce.display = dpy;
<a href="#h3-22-3" id="h3-22-3" class="d">-	ce.event = c-&gt;win;
</a><a href="#h3-22-4" id="h3-22-4" class="d">-	ce.window = c-&gt;win;
</a><a href="#h3-22-5" id="h3-22-5" class="i">+	ce.event = clients[c]-&gt;win;
</a><a href="#h3-22-6" id="h3-22-6" class="i">+	ce.window = clients[c]-&gt;win;
</a> 	ce.above = None;
 	ce.override_redirect = False;
 	ce.border_width = 0;
<a href="#h3-22-10" id="h3-22-10" class="d">-	XConfigureWindow(dpy, c-&gt;win, CWWidth|CWHeight, &amp;wc);
</a><a href="#h3-22-11" id="h3-22-11" class="d">-	XSendEvent(dpy, c-&gt;win, False, StructureNotifyMask, (XEvent *)&amp;ce);
</a><a href="#h3-22-12" id="h3-22-12" class="i">+
</a><a href="#h3-22-13" id="h3-22-13" class="i">+	XConfigureWindow(dpy, clients[c]-&gt;win, CWWidth|CWHeight, &amp;wc);
</a><a href="#h3-22-14" id="h3-22-14" class="i">+	XSendEvent(dpy, clients[c]-&gt;win, False, StructureNotifyMask,
</a><a href="#h3-22-15" id="h3-22-15" class="i">+			(XEvent *)&amp;ce);
</a> }
 
 void
 rotate(const Arg *arg) {
<a href="#h3-22-20" id="h3-22-20" class="d">-	Client *c;
</a><a href="#h3-22-21" id="h3-22-21" class="i">+	int nsel = -1;
</a><a href="#h3-22-22" id="h3-22-22" class="i">+
</a><a href="#h3-22-23" id="h3-22-23" class="i">+	if(sel &lt; 0)
</a><a href="#h3-22-24" id="h3-22-24" class="i">+		return;
</a> 
 	if(arg-&gt;i == 0) {
<a href="#h3-22-27" id="h3-22-27" class="d">-		focus(lastsel);
</a><a href="#h3-22-28" id="h3-22-28" class="d">-	} else if(arg-&gt;i &gt; 0) {
</a><a href="#h3-22-29" id="h3-22-29" class="d">-		if(sel &amp;&amp; sel-&gt;next) {
</a><a href="#h3-22-30" id="h3-22-30" class="d">-			focus(sel-&gt;next);
</a><a href="#h3-22-31" id="h3-22-31" class="d">-		} else {
</a><a href="#h3-22-32" id="h3-22-32" class="d">-			focus(clients);
</a><a href="#h3-22-33" id="h3-22-33" class="d">-		}
</a><a href="#h3-22-34" id="h3-22-34" class="d">-	} else {
</a><a href="#h3-22-35" id="h3-22-35" class="d">-		for(c = clients; c &amp;&amp; c-&gt;next &amp;&amp; c-&gt;next != sel; c = c-&gt;next);
</a><a href="#h3-22-36" id="h3-22-36" class="d">-		if(c)
</a><a href="#h3-22-37" id="h3-22-37" class="d">-			focus(c);
</a><a href="#h3-22-38" id="h3-22-38" class="i">+		if(lastsel &gt; -1)
</a><a href="#h3-22-39" id="h3-22-39" class="i">+			focus(lastsel);
</a><a href="#h3-22-40" id="h3-22-40" class="i">+	} else if(sel &gt; -1) {
</a><a href="#h3-22-41" id="h3-22-41" class="i">+		/* Rotating in an arg-&gt;i step around the clients. */
</a><a href="#h3-22-42" id="h3-22-42" class="i">+		nsel = sel + arg-&gt;i;
</a><a href="#h3-22-43" id="h3-22-43" class="i">+		while(nsel &gt;= nclients)
</a><a href="#h3-22-44" id="h3-22-44" class="i">+			nsel -= nclients;
</a><a href="#h3-22-45" id="h3-22-45" class="i">+		while(nsel &lt; 0)
</a><a href="#h3-22-46" id="h3-22-46" class="i">+			nsel += nclients;
</a><a href="#h3-22-47" id="h3-22-47" class="i">+		focus(nsel);
</a> 	}
 }
 
<a href="#h3-23" id="h3-23" class="h">@@ -751,10 +797,10 @@ run(void) {
</a> }
 
 void
<a href="#h3-23-3" id="h3-23-3" class="d">-sendxembed(Client *c, long msg, long detail, long d1, long d2) {
</a><a href="#h3-23-4" id="h3-23-4" class="i">+sendxembed(int c, long msg, long detail, long d1, long d2) {
</a> 	XEvent e = { 0 };
 
<a href="#h3-23-7" id="h3-23-7" class="d">-	e.xclient.window = c-&gt;win;
</a><a href="#h3-23-8" id="h3-23-8" class="i">+	e.xclient.window = clients[c]-&gt;win;
</a> 	e.xclient.type = ClientMessage;
 	e.xclient.message_type = wmatom[XEmbed];
 	e.xclient.format = 32;
<a href="#h3-24" id="h3-24" class="h">@@ -763,7 +809,7 @@ sendxembed(Client *c, long msg, long detail, long d1, long d2) {
</a> 	e.xclient.data.l[2] = detail;
 	e.xclient.data.l[3] = d1;
 	e.xclient.data.l[4] = d2;
<a href="#h3-24-3" id="h3-24-3" class="d">-	XSendEvent(dpy, c-&gt;win, False, NoEventMask, &amp;e);
</a><a href="#h3-24-4" id="h3-24-4" class="i">+	XSendEvent(dpy, clients[c]-&gt;win, False, NoEventMask, &amp;e);
</a> }
 
 void
<a href="#h3-25" id="h3-25" class="h">@@ -827,7 +873,7 @@ setup(void) {
</a> 
 	snprintf(winid, sizeof(winid), &quot;%lu&quot;, win);
 	nextfocus = foreground;
<a href="#h3-25-3" id="h3-25-3" class="d">-	focus(clients);
</a><a href="#h3-25-4" id="h3-25-4" class="i">+	focus(-1);
</a> }
 
 void
<a href="#h3-26" id="h3-26" class="h">@@ -847,7 +893,8 @@ spawn(const Arg *arg) {
</a> 		setsid();
 		if(arg &amp;&amp; arg-&gt;v) {
 			execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
<a href="#h3-26-3" id="h3-26-3" class="d">-			fprintf(stderr, &quot;tabbed: execvp %s&quot;, ((char **)arg-&gt;v)[0]);
</a><a href="#h3-26-4" id="h3-26-4" class="i">+			fprintf(stderr, &quot;tabbed: execvp %s&quot;,
</a><a href="#h3-26-5" id="h3-26-5" class="i">+					((char **)arg-&gt;v)[0]);
</a> 		} else {
 			execvp(cmd[0], cmd);
 			fprintf(stderr, &quot;tabbed: execvp %s&quot;, cmd[0]);
<a href="#h3-27" id="h3-27" class="h">@@ -863,6 +910,7 @@ textnw(const char *text, unsigned int len) {
</a> 
 	if(dc.font.set) {
 		XmbTextExtents(dc.font.set, text, len, NULL, &amp;r);
<a href="#h3-27-3" id="h3-27-3" class="i">+
</a> 		return r.width;
 	}
 
<a href="#h3-28" id="h3-28" class="h">@@ -870,24 +918,42 @@ textnw(const char *text, unsigned int len) {
</a> }
 
 void
<a href="#h3-28-3" id="h3-28-3" class="d">-unmanage(Client *c) {
</a><a href="#h3-28-4" id="h3-28-4" class="d">-	Client *pc;
</a><a href="#h3-28-5" id="h3-28-5" class="i">+unmanage(int c) {
</a><a href="#h3-28-6" id="h3-28-6" class="i">+	int pc;
</a><a href="#h3-28-7" id="h3-28-7" class="i">+
</a><a href="#h3-28-8" id="h3-28-8" class="i">+	if(c &lt; 0 || c &gt;= nclients)
</a><a href="#h3-28-9" id="h3-28-9" class="i">+		return;
</a> 
<a href="#h3-28-11" id="h3-28-11" class="d">-	if(!clients) {
</a><a href="#h3-28-12" id="h3-28-12" class="i">+	if(!nclients) {
</a> 		return;
<a href="#h3-28-14" id="h3-28-14" class="d">-	} else if(c == clients) {
</a><a href="#h3-28-15" id="h3-28-15" class="d">-		pc = clients = c-&gt;next;
</a><a href="#h3-28-16" id="h3-28-16" class="i">+	} else if(c == 0) {
</a><a href="#h3-28-17" id="h3-28-17" class="i">+		/* First client. */
</a><a href="#h3-28-18" id="h3-28-18" class="i">+		pc = 0;
</a><a href="#h3-28-19" id="h3-28-19" class="i">+		nclients--;
</a><a href="#h3-28-20" id="h3-28-20" class="i">+		free(clients[0]);
</a><a href="#h3-28-21" id="h3-28-21" class="i">+		memmove(&amp;clients[0], &amp;clients[1], sizeof(Client *) * nclients);
</a><a href="#h3-28-22" id="h3-28-22" class="i">+	} else if(c == nclients - 1) {
</a><a href="#h3-28-23" id="h3-28-23" class="i">+		/* Last client. */
</a><a href="#h3-28-24" id="h3-28-24" class="i">+		nclients--;
</a><a href="#h3-28-25" id="h3-28-25" class="i">+		pc = nclients - 1;
</a><a href="#h3-28-26" id="h3-28-26" class="i">+		free(clients[c]);
</a><a href="#h3-28-27" id="h3-28-27" class="i">+		clients = erealloc(clients, sizeof(Client *) * nclients);
</a> 	} else {
<a href="#h3-28-29" id="h3-28-29" class="d">-		for(pc = clients; pc &amp;&amp; pc-&gt;next &amp;&amp; pc-&gt;next != c; pc = pc-&gt;next);
</a><a href="#h3-28-30" id="h3-28-30" class="d">-		pc-&gt;next = c-&gt;next;
</a><a href="#h3-28-31" id="h3-28-31" class="i">+		/* Somewhere inbetween. */
</a><a href="#h3-28-32" id="h3-28-32" class="i">+		pc = c + 1;
</a><a href="#h3-28-33" id="h3-28-33" class="i">+		free(clients[c]);
</a><a href="#h3-28-34" id="h3-28-34" class="i">+		memmove(&amp;clients[c], &amp;clients[c+1],
</a><a href="#h3-28-35" id="h3-28-35" class="i">+				sizeof(Client *) * (nclients - (c + 1)));
</a><a href="#h3-28-36" id="h3-28-36" class="i">+		nclients--;
</a> 	}
<a href="#h3-28-38" id="h3-28-38" class="i">+
</a> 	if(c == lastsel)
<a href="#h3-28-40" id="h3-28-40" class="d">-		lastsel = clients;
</a><a href="#h3-28-41" id="h3-28-41" class="i">+		lastsel = 0;
</a> 	if(c == sel) {
 		sel = pc;
 		focus(lastsel);
 	}
<a href="#h3-28-46" id="h3-28-46" class="d">-	free(c);
</a><a href="#h3-28-47" id="h3-28-47" class="i">+
</a> 	drawbar();
 	XSync(dpy, False);
 }
<a href="#h3-29" id="h3-29" class="h">@@ -902,7 +968,8 @@ updatenumlockmask(void) {
</a> 	for(i = 0; i &lt; 8; i++) {
 		for(j = 0; j &lt; modmap-&gt;max_keypermod; j++) {
 			if(modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j]
<a href="#h3-29-3" id="h3-29-3" class="d">-					== XKeysymToKeycode(dpy, XK_Num_Lock)) {
</a><a href="#h3-29-4" id="h3-29-4" class="i">+					== XKeysymToKeycode(dpy,
</a><a href="#h3-29-5" id="h3-29-5" class="i">+						XK_Num_Lock)) {
</a> 				numlockmask = (1 &lt;&lt; i);
 			}
 		}
<a href="#h3-30" id="h3-30" class="h">@@ -911,11 +978,14 @@ updatenumlockmask(void) {
</a> }
 
 void
<a href="#h3-30-3" id="h3-30-3" class="d">-updatetitle(Client *c) {
</a><a href="#h3-30-4" id="h3-30-4" class="d">-	if(!gettextprop(c-&gt;win, wmatom[WMName], c-&gt;name, sizeof(c-&gt;name)))
</a><a href="#h3-30-5" id="h3-30-5" class="d">-		gettextprop(c-&gt;win, XA_WM_NAME, c-&gt;name, sizeof(c-&gt;name));
</a><a href="#h3-30-6" id="h3-30-6" class="i">+updatetitle(int c) {
</a><a href="#h3-30-7" id="h3-30-7" class="i">+	if(!gettextprop(clients[c]-&gt;win, wmatom[WMName],
</a><a href="#h3-30-8" id="h3-30-8" class="i">+				clients[c]-&gt;name, sizeof(clients[c]-&gt;name))) {
</a><a href="#h3-30-9" id="h3-30-9" class="i">+		gettextprop(clients[c]-&gt;win, XA_WM_NAME,
</a><a href="#h3-30-10" id="h3-30-10" class="i">+				clients[c]-&gt;name, sizeof(clients[c]-&gt;name));
</a><a href="#h3-30-11" id="h3-30-11" class="i">+	}
</a> 	if(sel == c)
<a href="#h3-30-13" id="h3-30-13" class="d">-		XStoreName(dpy, win, c-&gt;name);
</a><a href="#h3-30-14" id="h3-30-14" class="i">+		XStoreName(dpy, win, clients[c]-&gt;name);
</a> 	drawbar();
 }
 
</pre>
</div>
</body>
</html>
