<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>added generic client support (thanks Stephen) - tabbed - tab interface for application supporting Xembed
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="tabbed Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>tabbed</h1><span class="desc">tab interface for application supporting Xembed
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/214992a9baa64b6b2733273d507111e70f36477e.html">214992a9baa64b6b2733273d507111e70f36477e</a>
<b>parent</b> <a href="../commit/d1716bda6b8890d268358901d03e1f4748956ba2.html">d1716bda6b8890d268358901d03e1f4748956ba2</a>
<b>Author:</b> Connor Lane Smith &lt;<a href="mailto:cls@lubutu.com">cls@lubutu.com</a>&gt;
<b>Date:</b>   Fri,  6 May 2011 21:40:53 +0100

added generic client support (thanks Stephen)
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">tabbed.c</a></td><td> | </td><td class="num">56</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
</table></pre><pre>2 files changed, 38 insertions(+), 20 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -12,7 +12,7 @@ static const Bool foreground   = False;
</a> static Key keys[] = { \
 	/* modifier                     key        function        argument */
 	{ MODKEY|ShiftMask,             XK_Return, focusonce,      { 0 } },
<a href="#h0-0-3" id="h0-0-3" class="d">-	{ MODKEY|ShiftMask,             XK_Return, spawn,          { .v = (char*[]){ &quot;surf&quot;, &quot;-e&quot;, winid, NULL} } },
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	{ MODKEY|ShiftMask,             XK_Return, spawn,          { 0 } },
</a> 	{ MODKEY|ShiftMask,             XK_l,      rotate,         { .i = +1 } },
 	{ MODKEY|ShiftMask,             XK_h,      rotate,         { .i = -1 } },
 	{ MODKEY,                       XK_Tab,    rotate,         { .i = 0 } },
<b>diff --git a/<a id="h1" href="../file/tabbed.c.html">tabbed.c</a> b/<a href="../file/tabbed.c.html">tabbed.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -39,7 +39,7 @@
</a> /* Macros */
 #define MAX(a, b)                ((a) &gt; (b) ? (a) : (b))
 #define MIN(a, b)                ((a) &lt; (b) ? (a) : (b))
<a href="#h1-0-3" id="h1-0-3" class="d">-#define LENGTH(x)                (sizeof x / sizeof x[0])
</a><a href="#h1-0-4" id="h1-0-4" class="i">+#define LENGTH(x)                (sizeof (x) / sizeof *(x))
</a> #define CLEANMASK(mask)          (mask &amp; ~(numlockmask|LockMask))
 #define TEXTW(x)                 (textnw(x, strlen(x)) + dc.font.height)
 
<a href="#h1-1" id="h1-1" class="h">@@ -116,6 +116,7 @@ static void rotate(const Arg *arg);
</a> static void run(void);
 static void sendxembed(Client *c, long msg, long detail, long d1, long d2);
 static void setup(void);
<a href="#h1-1-3" id="h1-1-3" class="i">+static void setcmd(int argc, char *argv[]);
</a> static void sigchld(int unused);
 static void spawn(const Arg *arg);
 static int textnw(const char *text, unsigned int len);
<a href="#h1-2" id="h1-2" class="h">@@ -150,6 +151,7 @@ static Window root, win;
</a> static Client *clients = NULL, *sel = NULL, *lastsel = NULL;
 static int (*xerrorxlib)(Display *, XErrorEvent *);
 static char winid[64];
<a href="#h1-2-3" id="h1-2-3" class="i">+static char **cmd = NULL;
</a> /* configuration, allows nested code to access above variables */
 #include &quot;config.h&quot;
 
<a href="#h1-3" id="h1-3" class="h">@@ -189,8 +191,8 @@ cleanup(void) {
</a> 	Client *c, *n;
 
 	for(c = clients; c; c = n) {
<a href="#h1-3-3" id="h1-3-3" class="d">-		killclient(NULL);
</a> 		focus(c);
<a href="#h1-3-5" id="h1-3-5" class="i">+		killclient(NULL);
</a> 		XReparentWindow(dpy, c-&gt;win, root, 0, 0);
 		n = c-&gt;next;
 		unmanage(c);
<a href="#h1-4" id="h1-4" class="h">@@ -203,6 +205,7 @@ cleanup(void) {
</a> 	XFreeGC(dpy, dc.gc);
 	XDestroyWindow(dpy, win);
 	XSync(dpy, False);
<a href="#h1-4-3" id="h1-4-3" class="i">+	free(cmd);
</a> }
 
 void
<a href="#h1-5" id="h1-5" class="h">@@ -360,7 +363,7 @@ emallocz(size_t size) {
</a> 	void *p;
 
 	if(!(p = calloc(1, size)))
<a href="#h1-5-3" id="h1-5-3" class="d">-		die(0, &quot;tabbed: cannot malloc&quot;);
</a><a href="#h1-5-4" id="h1-5-4" class="i">+		die(&quot;tabbed: cannot malloc\n&quot;);
</a> 	return p;
 }
 
<a href="#h1-6" id="h1-6" class="h">@@ -423,7 +426,7 @@ getcolor(const char *colstr) {
</a> 	XColor color;
 
 	if(!XAllocNamedColor(dpy, cmap, colstr, &amp;color, &amp;color))
<a href="#h1-6-3" id="h1-6-3" class="d">-		die(&quot;error, cannot allocate color &#39;%s&#39;\n&quot;, colstr);
</a><a href="#h1-6-4" id="h1-6-4" class="i">+		die(&quot;tabbed: cannot allocate color &#39;%s&#39;\n&quot;, colstr);
</a> 	return color.pixel;
 }
 
<a href="#h1-7" id="h1-7" class="h">@@ -502,7 +505,7 @@ initfont(const char *fontstr) {
</a> 		dc.font.xfont = NULL;
 		if(!(dc.font.xfont = XLoadQueryFont(dpy, fontstr))
 		&amp;&amp; !(dc.font.xfont = XLoadQueryFont(dpy, &quot;fixed&quot;)))
<a href="#h1-7-3" id="h1-7-3" class="d">-			die(&quot;error, cannot load font: &#39;%s&#39;\n&quot;, fontstr);
</a><a href="#h1-7-4" id="h1-7-4" class="i">+			die(&quot;tabbed: cannot load font: &#39;%s&#39;\n&quot;, fontstr);
</a> 		dc.font.ascent = dc.font.xfont-&gt;ascent;
 		dc.font.descent = dc.font.xfont-&gt;descent;
 	}
<a href="#h1-8" id="h1-8" class="h">@@ -578,7 +581,7 @@ manage(Window w) {
</a> 					XGrabKey(dpy, code, keys[i].mod | modifiers[j], w,
 						 True, GrabModeAsync, GrabModeAsync);
 		}
<a href="#h1-8-3" id="h1-8-3" class="d">-		c = emallocz(sizeof(Client));
</a><a href="#h1-8-4" id="h1-8-4" class="i">+		c = emallocz(sizeof *c);
</a> 		c-&gt;next = clients;
 		c-&gt;win = w;
 		clients = c;
<a href="#h1-9" id="h1-9" class="h">@@ -703,6 +706,17 @@ sendxembed(Client *c, long msg, long detail, long d1, long d2) {
</a> }
 
 void
<a href="#h1-9-3" id="h1-9-3" class="i">+setcmd(int argc, char *argv[]) {
</a><a href="#h1-9-4" id="h1-9-4" class="i">+	int i;
</a><a href="#h1-9-5" id="h1-9-5" class="i">+
</a><a href="#h1-9-6" id="h1-9-6" class="i">+	cmd = emallocz((argc+2) * sizeof *cmd);
</a><a href="#h1-9-7" id="h1-9-7" class="i">+	for(i = 0; i &lt; argc; i++)
</a><a href="#h1-9-8" id="h1-9-8" class="i">+		cmd[i] = argv[i];
</a><a href="#h1-9-9" id="h1-9-9" class="i">+	cmd[argc] = winid;
</a><a href="#h1-9-10" id="h1-9-10" class="i">+	cmd[argc+1] = NULL;
</a><a href="#h1-9-11" id="h1-9-11" class="i">+}
</a><a href="#h1-9-12" id="h1-9-12" class="i">+
</a><a href="#h1-9-13" id="h1-9-13" class="i">+void
</a> setup(void) {
 	/* clean up any zombies immediately */
 	sigchld(0);
<a href="#h1-10" id="h1-10" class="h">@@ -740,7 +754,7 @@ setup(void) {
</a> 	class_hint.res_class = &quot;Tabbed&quot;;
 	XSetClassHint(dpy, win, &amp;class_hint);
 	XSetWMProtocols(dpy, win, &amp;wmatom[WMDelete], 1);
<a href="#h1-10-3" id="h1-10-3" class="d">-	snprintf(winid, LENGTH(winid), &quot;%u&quot;, (int)win);
</a><a href="#h1-10-4" id="h1-10-4" class="i">+	snprintf(winid, sizeof winid, &quot;%lu&quot;, win);
</a> 	nextfocus = foreground;
 	focus(clients);
 }
<a href="#h1-11" id="h1-11" class="h">@@ -748,7 +762,7 @@ setup(void) {
</a> void
 sigchld(int unused) {
 	if(signal(SIGCHLD, sigchld) == SIG_ERR)
<a href="#h1-11-3" id="h1-11-3" class="d">-		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h1-11-4" id="h1-11-4" class="i">+		die(&quot;tabbed: cannot install SIGCHLD handler&quot;);
</a> 	while(0 &lt; waitpid(-1, NULL, WNOHANG));
 }
 
<a href="#h1-12" id="h1-12" class="h">@@ -758,8 +772,8 @@ spawn(const Arg *arg) {
</a> 		if(dpy)
 			close(ConnectionNumber(dpy));
 		setsid();
<a href="#h1-12-3" id="h1-12-3" class="d">-		execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
</a><a href="#h1-12-4" id="h1-12-4" class="d">-		fprintf(stderr, &quot;tabbed: execvp %s&quot;, ((char **)arg-&gt;v)[0]);
</a><a href="#h1-12-5" id="h1-12-5" class="i">+		execvp(cmd[0], cmd);
</a><a href="#h1-12-6" id="h1-12-6" class="i">+		fprintf(stderr, &quot;tabbed: execvp %s&quot;, cmd[0]);
</a> 		perror(&quot; failed&quot;);
 		exit(0);
 	}
<a href="#h1-13" id="h1-13" class="h">@@ -844,16 +858,20 @@ xerror(Display *dpy, XErrorEvent *ee) {
</a> 
 int
 main(int argc, char *argv[]) {
<a href="#h1-13-3" id="h1-13-3" class="d">-	int detach = 0;
</a><a href="#h1-13-4" id="h1-13-4" class="d">-
</a><a href="#h1-13-5" id="h1-13-5" class="d">-	if(argc == 2 &amp;&amp; !strcmp(&quot;-v&quot;, argv[1]))
</a><a href="#h1-13-6" id="h1-13-6" class="d">-		die(&quot;tabbed-&quot;VERSION&quot;, © 2009-2010 tabbed engineers, see LICENSE for details\n&quot;);
</a><a href="#h1-13-7" id="h1-13-7" class="d">-	else if(argc == 2 &amp;&amp; strcmp(&quot;-d&quot;, argv[1]) == 0)
</a><a href="#h1-13-8" id="h1-13-8" class="d">-		detach = 1;
</a><a href="#h1-13-9" id="h1-13-9" class="d">-	else if(argc != 1)
</a><a href="#h1-13-10" id="h1-13-10" class="d">-		die(&quot;usage: tabbed [-d] [-v]\n&quot;);
</a><a href="#h1-13-11" id="h1-13-11" class="i">+	int i, detach = 0;
</a><a href="#h1-13-12" id="h1-13-12" class="i">+
</a><a href="#h1-13-13" id="h1-13-13" class="i">+	for(i = 1; i &lt; argc &amp;&amp; !cmd; i++) {
</a><a href="#h1-13-14" id="h1-13-14" class="i">+		if(!strcmp(&quot;-v&quot;, argv[i]))
</a><a href="#h1-13-15" id="h1-13-15" class="i">+			die(&quot;tabbed-&quot;VERSION&quot;, © 2009-2011 tabbed engineers, see LICENSE for details\n&quot;);
</a><a href="#h1-13-16" id="h1-13-16" class="i">+		else if(!strcmp(&quot;-d&quot;, argv[i]))
</a><a href="#h1-13-17" id="h1-13-17" class="i">+			detach = 1;
</a><a href="#h1-13-18" id="h1-13-18" class="i">+		else
</a><a href="#h1-13-19" id="h1-13-19" class="i">+			setcmd(argc-i, argv+i);
</a><a href="#h1-13-20" id="h1-13-20" class="i">+	}
</a><a href="#h1-13-21" id="h1-13-21" class="i">+	if(!cmd)
</a><a href="#h1-13-22" id="h1-13-22" class="i">+		die(&quot;usage: tabbed [-d] [-v] command\n&quot;);
</a> 	if(!setlocale(LC_CTYPE, &quot;&quot;) || !XSupportsLocale())
<a href="#h1-13-24" id="h1-13-24" class="d">-		fprintf(stderr, &quot;warning: no locale support\n&quot;);
</a><a href="#h1-13-25" id="h1-13-25" class="i">+		fprintf(stderr, &quot;tabbed: no locale support\n&quot;);
</a> 	if(!(dpy = XOpenDisplay(NULL)))
 		die(&quot;tabbed: cannot open display\n&quot;);
 	setup();
</pre>
</div>
</body>
</html>
