<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Initial Commit. - tabbed - tab interface for application supporting Xembed
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="tabbed Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>tabbed</h1><span class="desc">tab interface for application supporting Xembed
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/efdd0dd584829a9db969511e487010bf2107b503.html">efdd0dd584829a9db969511e487010bf2107b503</a>
<b>Author:</b> Enno Boland (Gottox) &lt;<a href="mailto:gottox@s01.de">gottox@s01.de</a>&gt;
<b>Date:</b>   Fri,  5 Jun 2009 13:22:40 +0200

Initial Commit.
<b>Diffstat:</b>
<table><tr><td class="A">A</td><td><a href="#h0">LICENSE</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h1">Makefile</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">config.mk</a></td><td> | </td><td class="num">30</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">surf.c</a></td><td> | </td><td class="num">234</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>4 files changed, 341 insertions(+), 0 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/LICENSE.html">LICENSE</a> b/<a href="../file/LICENSE.html">LICENSE</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,21 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+MIT/X Consortium License
</a><a href="#h0-0-1" id="h0-0-1" class="i">+
</a><a href="#h0-0-2" id="h0-0-2" class="i">+Â© 2009 Enno Boland &lt;g s01 de&gt;
</a><a href="#h0-0-3" id="h0-0-3" class="i">+
</a><a href="#h0-0-4" id="h0-0-4" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h0-0-5" id="h0-0-5" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h0-0-6" id="h0-0-6" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h0-0-7" id="h0-0-7" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h0-0-8" id="h0-0-8" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h0-0-9" id="h0-0-9" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h0-0-10" id="h0-0-10" class="i">+
</a><a href="#h0-0-11" id="h0-0-11" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h0-0-12" id="h0-0-12" class="i">+all copies or substantial portions of the Software.
</a><a href="#h0-0-13" id="h0-0-13" class="i">+
</a><a href="#h0-0-14" id="h0-0-14" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h0-0-15" id="h0-0-15" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h0-0-16" id="h0-0-16" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h0-0-17" id="h0-0-17" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h0-0-18" id="h0-0-18" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h0-0-19" id="h0-0-19" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h0-0-20" id="h0-0-20" class="i">+DEALINGS IN THE SOFTWARE.
</a><b>diff --git a/<a id="h1" href="../file/Makefile.html">Makefile</a> b/<a href="../file/Makefile.html">Makefile</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,56 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+# surf - simple browser
</a><a href="#h1-0-1" id="h1-0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h1-0-2" id="h1-0-2" class="i">+
</a><a href="#h1-0-3" id="h1-0-3" class="i">+include config.mk
</a><a href="#h1-0-4" id="h1-0-4" class="i">+
</a><a href="#h1-0-5" id="h1-0-5" class="i">+SRC = surf.c
</a><a href="#h1-0-6" id="h1-0-6" class="i">+OBJ = ${SRC:.c=.o}
</a><a href="#h1-0-7" id="h1-0-7" class="i">+
</a><a href="#h1-0-8" id="h1-0-8" class="i">+all: options surf
</a><a href="#h1-0-9" id="h1-0-9" class="i">+
</a><a href="#h1-0-10" id="h1-0-10" class="i">+options:
</a><a href="#h1-0-11" id="h1-0-11" class="i">+	@echo surf build options:
</a><a href="#h1-0-12" id="h1-0-12" class="i">+	@echo &quot;CFLAGS   = ${CFLAGS}&quot;
</a><a href="#h1-0-13" id="h1-0-13" class="i">+	@echo &quot;LDFLAGS  = ${LDFLAGS}&quot;
</a><a href="#h1-0-14" id="h1-0-14" class="i">+	@echo &quot;CC       = ${CC}&quot;
</a><a href="#h1-0-15" id="h1-0-15" class="i">+
</a><a href="#h1-0-16" id="h1-0-16" class="i">+.c.o:
</a><a href="#h1-0-17" id="h1-0-17" class="i">+	@echo CC $&lt;
</a><a href="#h1-0-18" id="h1-0-18" class="i">+	@${CC} -c ${CFLAGS} $&lt;
</a><a href="#h1-0-19" id="h1-0-19" class="i">+
</a><a href="#h1-0-20" id="h1-0-20" class="i">+${OBJ}: config.mk
</a><a href="#h1-0-21" id="h1-0-21" class="i">+
</a><a href="#h1-0-22" id="h1-0-22" class="i">+surf: ${OBJ}
</a><a href="#h1-0-23" id="h1-0-23" class="i">+	@echo CC -o $@
</a><a href="#h1-0-24" id="h1-0-24" class="i">+	@${CC} -o $@ ${OBJ} ${LDFLAGS}
</a><a href="#h1-0-25" id="h1-0-25" class="i">+
</a><a href="#h1-0-26" id="h1-0-26" class="i">+clean:
</a><a href="#h1-0-27" id="h1-0-27" class="i">+	@echo cleaning
</a><a href="#h1-0-28" id="h1-0-28" class="i">+	@rm -f surf ${OBJ} surf-${VERSION}.tar.gz
</a><a href="#h1-0-29" id="h1-0-29" class="i">+
</a><a href="#h1-0-30" id="h1-0-30" class="i">+dist: clean
</a><a href="#h1-0-31" id="h1-0-31" class="i">+	@echo creating dist tarball
</a><a href="#h1-0-32" id="h1-0-32" class="i">+	@mkdir -p surf-${VERSION}
</a><a href="#h1-0-33" id="h1-0-33" class="i">+	@cp -R LICENSE Makefile README config.def.h config.mk \
</a><a href="#h1-0-34" id="h1-0-34" class="i">+		surf.1 ${SRC} surf-${VERSION}
</a><a href="#h1-0-35" id="h1-0-35" class="i">+	@tar -cf surf-${VERSION}.tar surf-${VERSION}
</a><a href="#h1-0-36" id="h1-0-36" class="i">+	@gzip surf-${VERSION}.tar
</a><a href="#h1-0-37" id="h1-0-37" class="i">+	@rm -rf surf-${VERSION}
</a><a href="#h1-0-38" id="h1-0-38" class="i">+
</a><a href="#h1-0-39" id="h1-0-39" class="i">+install: all
</a><a href="#h1-0-40" id="h1-0-40" class="i">+	@echo installing executable file to ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-41" id="h1-0-41" class="i">+	@mkdir -p ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-42" id="h1-0-42" class="i">+	@cp -f surf ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-43" id="h1-0-43" class="i">+	@chmod 755 ${DESTDIR}${PREFIX}/bin/surf
</a><a href="#h1-0-44" id="h1-0-44" class="i">+	@echo installing manual page to ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h1-0-45" id="h1-0-45" class="i">+	@mkdir -p ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h1-0-46" id="h1-0-46" class="i">+	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt; surf.1 &gt; ${DESTDIR}${MANPREFIX}/man1/surf.1
</a><a href="#h1-0-47" id="h1-0-47" class="i">+	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/surf.1
</a><a href="#h1-0-48" id="h1-0-48" class="i">+
</a><a href="#h1-0-49" id="h1-0-49" class="i">+uninstall:
</a><a href="#h1-0-50" id="h1-0-50" class="i">+	@echo removing executable file from ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-51" id="h1-0-51" class="i">+	@rm -f ${DESTDIR}${PREFIX}/bin/surf
</a><a href="#h1-0-52" id="h1-0-52" class="i">+	@echo removing manual page from ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h1-0-53" id="h1-0-53" class="i">+	@rm -f ${DESTDIR}${MANPREFIX}/man1/surf.1
</a><a href="#h1-0-54" id="h1-0-54" class="i">+
</a><a href="#h1-0-55" id="h1-0-55" class="i">+.PHONY: all options clean dist install uninstall
</a><b>diff --git a/<a id="h2" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,30 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+# surf version
</a><a href="#h2-0-1" id="h2-0-1" class="i">+VERSION = 0.0
</a><a href="#h2-0-2" id="h2-0-2" class="i">+
</a><a href="#h2-0-3" id="h2-0-3" class="i">+# Customize below to fit your system
</a><a href="#h2-0-4" id="h2-0-4" class="i">+
</a><a href="#h2-0-5" id="h2-0-5" class="i">+# paths
</a><a href="#h2-0-6" id="h2-0-6" class="i">+PREFIX = /usr/local
</a><a href="#h2-0-7" id="h2-0-7" class="i">+MANPREFIX = ${PREFIX}/share/man
</a><a href="#h2-0-8" id="h2-0-8" class="i">+
</a><a href="#h2-0-9" id="h2-0-9" class="i">+GTKINC=$(shell pkg-config --cflags gtk+-2.0 webkit-1.0)
</a><a href="#h2-0-10" id="h2-0-10" class="i">+GTKLIB=$(shell pkg-config --libs gtk+-2.0 webkit-1.0)
</a><a href="#h2-0-11" id="h2-0-11" class="i">+
</a><a href="#h2-0-12" id="h2-0-12" class="i">+
</a><a href="#h2-0-13" id="h2-0-13" class="i">+# includes and libs
</a><a href="#h2-0-14" id="h2-0-14" class="i">+INCS = -I. -I/usr/include ${GTKINC}
</a><a href="#h2-0-15" id="h2-0-15" class="i">+LIBS = -L/usr/lib -lc ${GTKLIB}
</a><a href="#h2-0-16" id="h2-0-16" class="i">+
</a><a href="#h2-0-17" id="h2-0-17" class="i">+# flags
</a><a href="#h2-0-18" id="h2-0-18" class="i">+CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot; ${XINERAMAFLAGS}
</a><a href="#h2-0-19" id="h2-0-19" class="i">+#CFLAGS = -std=c99 -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
</a><a href="#h2-0-20" id="h2-0-20" class="i">+CFLAGS = -std=c99 -pedantic -Wall -O0 ${INCS} ${CPPFLAGS}
</a><a href="#h2-0-21" id="h2-0-21" class="i">+#LDFLAGS = -s ${LIBS}
</a><a href="#h2-0-22" id="h2-0-22" class="i">+LDFLAGS = ${LIBS}
</a><a href="#h2-0-23" id="h2-0-23" class="i">+
</a><a href="#h2-0-24" id="h2-0-24" class="i">+# Solaris
</a><a href="#h2-0-25" id="h2-0-25" class="i">+#CFLAGS = -fast ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
</a><a href="#h2-0-26" id="h2-0-26" class="i">+#LDFLAGS = ${LIBS}
</a><a href="#h2-0-27" id="h2-0-27" class="i">+
</a><a href="#h2-0-28" id="h2-0-28" class="i">+# compiler and linker
</a><a href="#h2-0-29" id="h2-0-29" class="i">+CC = cc
</a><b>diff --git a/<a id="h3" href="../file/surf.c.html">surf.c</a> b/<a href="../file/surf.c.html">surf.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,234 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+#include &lt;gtk/gtk.h&gt;
</a><a href="#h3-0-1" id="h3-0-1" class="i">+#include &lt;string.h&gt;
</a><a href="#h3-0-2" id="h3-0-2" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h3-0-3" id="h3-0-3" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h3-0-4" id="h3-0-4" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h3-0-5" id="h3-0-5" class="i">+#include &lt;webkit/webkit.h&gt;
</a><a href="#h3-0-6" id="h3-0-6" class="i">+
</a><a href="#h3-0-7" id="h3-0-7" class="i">+#define LENGTH(x) (sizeof x / sizeof x[0])
</a><a href="#h3-0-8" id="h3-0-8" class="i">+/* Plan9-style Argument parsing */
</a><a href="#h3-0-9" id="h3-0-9" class="i">+/* Vars: _c -&gt; count; _b -&gt; break; _a -&gt; argument */
</a><a href="#h3-0-10" id="h3-0-10" class="i">+#define ARG int _c, _b; char *_a; \
</a><a href="#h3-0-11" id="h3-0-11" class="i">+	for(_c = 1; _c &lt; argc &amp;&amp; argv[_c][0] == &#39;-&#39; &amp;&amp; argv[_c][1] &amp;&amp; \
</a><a href="#h3-0-12" id="h3-0-12" class="i">+			(strcmp(argv[_c], &quot;--&quot;) != 0); _c++) \
</a><a href="#h3-0-13" id="h3-0-13" class="i">+		for(_a = &amp;argv[_c][1], _b = 0; !_b &amp;&amp; *_a; _a++ ) \
</a><a href="#h3-0-14" id="h3-0-14" class="i">+			switch(*_a)
</a><a href="#h3-0-15" id="h3-0-15" class="i">+#define ARGVAL()	(!_b &amp;&amp; _a[1] &amp;&amp; (_b = 1) ? &amp;_a[1] : _c + 1 == argc ? \
</a><a href="#h3-0-16" id="h3-0-16" class="i">+		0 : argv[++_c])
</a><a href="#h3-0-17" id="h3-0-17" class="i">+#define ARGCHR()	(*_a)
</a><a href="#h3-0-18" id="h3-0-18" class="i">+#define ARGC()		_c
</a><a href="#h3-0-19" id="h3-0-19" class="i">+
</a><a href="#h3-0-20" id="h3-0-20" class="i">+GtkWidget *win;
</a><a href="#h3-0-21" id="h3-0-21" class="i">+GtkWidget *browser;
</a><a href="#h3-0-22" id="h3-0-22" class="i">+WebKitWebView *view;
</a><a href="#h3-0-23" id="h3-0-23" class="i">+gchar *title;
</a><a href="#h3-0-24" id="h3-0-24" class="i">+gint progress = 100;
</a><a href="#h3-0-25" id="h3-0-25" class="i">+gboolean embed = FALSE;
</a><a href="#h3-0-26" id="h3-0-26" class="i">+
</a><a href="#h3-0-27" id="h3-0-27" class="i">+static void setup(void);
</a><a href="#h3-0-28" id="h3-0-28" class="i">+static void cleanup(void);
</a><a href="#h3-0-29" id="h3-0-29" class="i">+static void updatetitle(void);
</a><a href="#h3-0-30" id="h3-0-30" class="i">+static void windestroy(GtkWidget* w, gpointer d);
</a><a href="#h3-0-31" id="h3-0-31" class="i">+static gboolean keypress(GtkWidget* w, GdkEventKey *ev);
</a><a href="#h3-0-32" id="h3-0-32" class="i">+static void titlechange(WebKitWebView* view, WebKitWebFrame* frame, const gchar* title, gpointer d);
</a><a href="#h3-0-33" id="h3-0-33" class="i">+static void progresschange(WebKitWebView *view, gint p, gpointer d);
</a><a href="#h3-0-34" id="h3-0-34" class="i">+static void loadcommit(WebKitWebView *view, WebKitWebFrame *f, gpointer d);
</a><a href="#h3-0-35" id="h3-0-35" class="i">+static void loadstart(WebKitWebView *view, WebKitWebFrame *f, gpointer d);
</a><a href="#h3-0-36" id="h3-0-36" class="i">+static void loadfinish(WebKitWebView *view, WebKitWebFrame *f, gpointer d);
</a><a href="#h3-0-37" id="h3-0-37" class="i">+static void linkhover(WebKitWebView* page, const gchar* t, const gchar* l, gpointer d);
</a><a href="#h3-0-38" id="h3-0-38" class="i">+static gboolean newwindow(WebKitWebView *view, WebKitWebFrame *f,
</a><a href="#h3-0-39" id="h3-0-39" class="i">+		WebKitNetworkRequest *r, WebKitWebNavigationAction *n,
</a><a href="#h3-0-40" id="h3-0-40" class="i">+		WebKitWebPolicyDecision *p, gpointer d);
</a><a href="#h3-0-41" id="h3-0-41" class="i">+static gboolean download(WebKitWebView *view, GObject *o, gpointer d);
</a><a href="#h3-0-42" id="h3-0-42" class="i">+static void loaduri(gchar *uri);
</a><a href="#h3-0-43" id="h3-0-43" class="i">+static void loadfile(gchar *f);
</a><a href="#h3-0-44" id="h3-0-44" class="i">+static void setupstdin();
</a><a href="#h3-0-45" id="h3-0-45" class="i">+static gboolean readstdin(GIOChannel *c, GIOCondition con);
</a><a href="#h3-0-46" id="h3-0-46" class="i">+
</a><a href="#h3-0-47" id="h3-0-47" class="i">+gboolean
</a><a href="#h3-0-48" id="h3-0-48" class="i">+readstdin(GIOChannel *c, GIOCondition con) {
</a><a href="#h3-0-49" id="h3-0-49" class="i">+	gchar *line, *p;
</a><a href="#h3-0-50" id="h3-0-50" class="i">+	GIOStatus ret;
</a><a href="#h3-0-51" id="h3-0-51" class="i">+
</a><a href="#h3-0-52" id="h3-0-52" class="i">+	ret = g_io_channel_read_line(c, &amp;line, NULL, NULL, NULL);
</a><a href="#h3-0-53" id="h3-0-53" class="i">+	if(ret == G_IO_STATUS_ERROR || ret == G_IO_STATUS_EOF)
</a><a href="#h3-0-54" id="h3-0-54" class="i">+		return FALSE;
</a><a href="#h3-0-55" id="h3-0-55" class="i">+	for(p = line; *p &amp;&amp; *p != &#39;\n&#39;; p++);
</a><a href="#h3-0-56" id="h3-0-56" class="i">+	*p = &#39;\0&#39;;
</a><a href="#h3-0-57" id="h3-0-57" class="i">+	loaduri(line);
</a><a href="#h3-0-58" id="h3-0-58" class="i">+	g_free(line);
</a><a href="#h3-0-59" id="h3-0-59" class="i">+	return TRUE;
</a><a href="#h3-0-60" id="h3-0-60" class="i">+}
</a><a href="#h3-0-61" id="h3-0-61" class="i">+
</a><a href="#h3-0-62" id="h3-0-62" class="i">+void
</a><a href="#h3-0-63" id="h3-0-63" class="i">+setupstdin() {
</a><a href="#h3-0-64" id="h3-0-64" class="i">+	GIOChannel *c = NULL;
</a><a href="#h3-0-65" id="h3-0-65" class="i">+
</a><a href="#h3-0-66" id="h3-0-66" class="i">+	c = g_io_channel_unix_new(STDIN_FILENO);
</a><a href="#h3-0-67" id="h3-0-67" class="i">+	if(c &amp;&amp; !g_io_add_watch(c, G_IO_IN|G_IO_HUP, (GIOFunc) readstdin, NULL))
</a><a href="#h3-0-68" id="h3-0-68" class="i">+			g_error(&quot;Stdin: could not add watch\n&quot;);
</a><a href="#h3-0-69" id="h3-0-69" class="i">+}
</a><a href="#h3-0-70" id="h3-0-70" class="i">+
</a><a href="#h3-0-71" id="h3-0-71" class="i">+void
</a><a href="#h3-0-72" id="h3-0-72" class="i">+loadfile(gchar *f) {
</a><a href="#h3-0-73" id="h3-0-73" class="i">+	GIOChannel *c = NULL;
</a><a href="#h3-0-74" id="h3-0-74" class="i">+	GError *e = NULL;
</a><a href="#h3-0-75" id="h3-0-75" class="i">+	GString *code = g_string_new(&quot;&quot;);
</a><a href="#h3-0-76" id="h3-0-76" class="i">+	gchar *line;
</a><a href="#h3-0-77" id="h3-0-77" class="i">+
</a><a href="#h3-0-78" id="h3-0-78" class="i">+	/* cannot use fileno in c99 - workaround*/
</a><a href="#h3-0-79" id="h3-0-79" class="i">+	if(strcmp(f, &quot;-&quot;) == 0)
</a><a href="#h3-0-80" id="h3-0-80" class="i">+		c = g_io_channel_unix_new(STDIN_FILENO);
</a><a href="#h3-0-81" id="h3-0-81" class="i">+	else
</a><a href="#h3-0-82" id="h3-0-82" class="i">+		c = g_io_channel_new_file(f, &quot;r&quot;, NULL);
</a><a href="#h3-0-83" id="h3-0-83" class="i">+	if (c) {
</a><a href="#h3-0-84" id="h3-0-84" class="i">+		while(g_io_channel_read_line(c, &amp;line, NULL, NULL, &amp;e) == G_IO_STATUS_NORMAL) {
</a><a href="#h3-0-85" id="h3-0-85" class="i">+			g_string_append(code, line);
</a><a href="#h3-0-86" id="h3-0-86" class="i">+			g_free(line);
</a><a href="#h3-0-87" id="h3-0-87" class="i">+		}
</a><a href="#h3-0-88" id="h3-0-88" class="i">+		webkit_web_view_load_html_string(view, code-&gt;str, NULL);
</a><a href="#h3-0-89" id="h3-0-89" class="i">+		g_io_channel_shutdown(c, FALSE, NULL);
</a><a href="#h3-0-90" id="h3-0-90" class="i">+	}
</a><a href="#h3-0-91" id="h3-0-91" class="i">+}
</a><a href="#h3-0-92" id="h3-0-92" class="i">+
</a><a href="#h3-0-93" id="h3-0-93" class="i">+static void loaduri(gchar *uri) {
</a><a href="#h3-0-94" id="h3-0-94" class="i">+	GString* u = g_string_new(uri);
</a><a href="#h3-0-95" id="h3-0-95" class="i">+	if(g_strrstr(u-&gt;str, &quot;://&quot;) == NULL)
</a><a href="#h3-0-96" id="h3-0-96" class="i">+		g_string_prepend(u, &quot;http://&quot;);
</a><a href="#h3-0-97" id="h3-0-97" class="i">+	webkit_web_view_load_uri(view, u-&gt;str);
</a><a href="#h3-0-98" id="h3-0-98" class="i">+	g_string_free(u, TRUE);
</a><a href="#h3-0-99" id="h3-0-99" class="i">+}
</a><a href="#h3-0-100" id="h3-0-100" class="i">+
</a><a href="#h3-0-101" id="h3-0-101" class="i">+gboolean
</a><a href="#h3-0-102" id="h3-0-102" class="i">+download(WebKitWebView *view, GObject *o, gpointer d) {
</a><a href="#h3-0-103" id="h3-0-103" class="i">+	/* TODO */
</a><a href="#h3-0-104" id="h3-0-104" class="i">+	return FALSE;
</a><a href="#h3-0-105" id="h3-0-105" class="i">+}
</a><a href="#h3-0-106" id="h3-0-106" class="i">+
</a><a href="#h3-0-107" id="h3-0-107" class="i">+gboolean
</a><a href="#h3-0-108" id="h3-0-108" class="i">+newwindow(WebKitWebView *view, WebKitWebFrame *f,
</a><a href="#h3-0-109" id="h3-0-109" class="i">+		WebKitNetworkRequest *r, WebKitWebNavigationAction *n,
</a><a href="#h3-0-110" id="h3-0-110" class="i">+		WebKitWebPolicyDecision *p, gpointer d) {
</a><a href="#h3-0-111" id="h3-0-111" class="i">+	/* TODO */
</a><a href="#h3-0-112" id="h3-0-112" class="i">+	return FALSE;
</a><a href="#h3-0-113" id="h3-0-113" class="i">+}
</a><a href="#h3-0-114" id="h3-0-114" class="i">+void
</a><a href="#h3-0-115" id="h3-0-115" class="i">+linkhover(WebKitWebView* page, const gchar* t, const gchar* l, gpointer d) {
</a><a href="#h3-0-116" id="h3-0-116" class="i">+	/* TODO */
</a><a href="#h3-0-117" id="h3-0-117" class="i">+}
</a><a href="#h3-0-118" id="h3-0-118" class="i">+
</a><a href="#h3-0-119" id="h3-0-119" class="i">+void
</a><a href="#h3-0-120" id="h3-0-120" class="i">+loadstart(WebKitWebView *view, WebKitWebFrame *f, gpointer d) {
</a><a href="#h3-0-121" id="h3-0-121" class="i">+	/* ??? TODO */
</a><a href="#h3-0-122" id="h3-0-122" class="i">+}
</a><a href="#h3-0-123" id="h3-0-123" class="i">+
</a><a href="#h3-0-124" id="h3-0-124" class="i">+void
</a><a href="#h3-0-125" id="h3-0-125" class="i">+loadcommit(WebKitWebView *view, WebKitWebFrame *f, gpointer d) {
</a><a href="#h3-0-126" id="h3-0-126" class="i">+	/* ??? TODO */
</a><a href="#h3-0-127" id="h3-0-127" class="i">+}
</a><a href="#h3-0-128" id="h3-0-128" class="i">+
</a><a href="#h3-0-129" id="h3-0-129" class="i">+void
</a><a href="#h3-0-130" id="h3-0-130" class="i">+loadfinish(WebKitWebView *view, WebKitWebFrame *f, gpointer d) {
</a><a href="#h3-0-131" id="h3-0-131" class="i">+	/* ??? TODO */
</a><a href="#h3-0-132" id="h3-0-132" class="i">+}
</a><a href="#h3-0-133" id="h3-0-133" class="i">+
</a><a href="#h3-0-134" id="h3-0-134" class="i">+void
</a><a href="#h3-0-135" id="h3-0-135" class="i">+progresschange(WebKitWebView* view, gint p, gpointer d) {
</a><a href="#h3-0-136" id="h3-0-136" class="i">+	progress = p;
</a><a href="#h3-0-137" id="h3-0-137" class="i">+	updatetitle();
</a><a href="#h3-0-138" id="h3-0-138" class="i">+}
</a><a href="#h3-0-139" id="h3-0-139" class="i">+
</a><a href="#h3-0-140" id="h3-0-140" class="i">+void
</a><a href="#h3-0-141" id="h3-0-141" class="i">+updatetitle() {
</a><a href="#h3-0-142" id="h3-0-142" class="i">+	char t[512];
</a><a href="#h3-0-143" id="h3-0-143" class="i">+	snprintf(t, LENGTH(t), &quot;%s [%i%%]&quot;, title, progress);
</a><a href="#h3-0-144" id="h3-0-144" class="i">+	gtk_window_set_title(GTK_WINDOW(win), t);
</a><a href="#h3-0-145" id="h3-0-145" class="i">+}
</a><a href="#h3-0-146" id="h3-0-146" class="i">+
</a><a href="#h3-0-147" id="h3-0-147" class="i">+void
</a><a href="#h3-0-148" id="h3-0-148" class="i">+titlechange(WebKitWebView *v, WebKitWebFrame *f, const gchar *t, gpointer d) {
</a><a href="#h3-0-149" id="h3-0-149" class="i">+	if(title)
</a><a href="#h3-0-150" id="h3-0-150" class="i">+		g_free(title);
</a><a href="#h3-0-151" id="h3-0-151" class="i">+	title = g_strdup(t);
</a><a href="#h3-0-152" id="h3-0-152" class="i">+	updatetitle();
</a><a href="#h3-0-153" id="h3-0-153" class="i">+}
</a><a href="#h3-0-154" id="h3-0-154" class="i">+
</a><a href="#h3-0-155" id="h3-0-155" class="i">+void
</a><a href="#h3-0-156" id="h3-0-156" class="i">+windestroy(GtkWidget* w, gpointer d) {
</a><a href="#h3-0-157" id="h3-0-157" class="i">+	gtk_main_quit();
</a><a href="#h3-0-158" id="h3-0-158" class="i">+}
</a><a href="#h3-0-159" id="h3-0-159" class="i">+
</a><a href="#h3-0-160" id="h3-0-160" class="i">+gboolean
</a><a href="#h3-0-161" id="h3-0-161" class="i">+keypress(GtkWidget* w, GdkEventKey *ev) {
</a><a href="#h3-0-162" id="h3-0-162" class="i">+	/* TODO */
</a><a href="#h3-0-163" id="h3-0-163" class="i">+	return FALSE;
</a><a href="#h3-0-164" id="h3-0-164" class="i">+}
</a><a href="#h3-0-165" id="h3-0-165" class="i">+
</a><a href="#h3-0-166" id="h3-0-166" class="i">+void setup(void) {
</a><a href="#h3-0-167" id="h3-0-167" class="i">+	win = gtk_window_new(GTK_WINDOW_TOPLEVEL);
</a><a href="#h3-0-168" id="h3-0-168" class="i">+	gtk_window_set_default_size(GTK_WINDOW(win), 800, 600);
</a><a href="#h3-0-169" id="h3-0-169" class="i">+	gtk_widget_set_name(win, &quot;surf window&quot;);
</a><a href="#h3-0-170" id="h3-0-170" class="i">+	browser = gtk_scrolled_window_new(NULL, NULL);
</a><a href="#h3-0-171" id="h3-0-171" class="i">+	g_signal_connect (G_OBJECT(win), &quot;destroy&quot;, G_CALLBACK(windestroy), NULL);
</a><a href="#h3-0-172" id="h3-0-172" class="i">+	g_signal_connect (G_OBJECT(win), &quot;key-press-event&quot;, G_CALLBACK(keypress), NULL);
</a><a href="#h3-0-173" id="h3-0-173" class="i">+
</a><a href="#h3-0-174" id="h3-0-174" class="i">+	gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(browser),
</a><a href="#h3-0-175" id="h3-0-175" class="i">+			GTK_POLICY_NEVER, GTK_POLICY_NEVER);
</a><a href="#h3-0-176" id="h3-0-176" class="i">+	view = WEBKIT_WEB_VIEW(webkit_web_view_new());
</a><a href="#h3-0-177" id="h3-0-177" class="i">+	gtk_container_add(GTK_CONTAINER(browser), GTK_WIDGET(view));
</a><a href="#h3-0-178" id="h3-0-178" class="i">+
</a><a href="#h3-0-179" id="h3-0-179" class="i">+	g_signal_connect(G_OBJECT(view), &quot;title-changed&quot;, G_CALLBACK(titlechange), view);
</a><a href="#h3-0-180" id="h3-0-180" class="i">+	g_signal_connect(G_OBJECT(view), &quot;load-progress-changed&quot;, G_CALLBACK(progresschange), view);
</a><a href="#h3-0-181" id="h3-0-181" class="i">+	g_signal_connect(G_OBJECT(view), &quot;load-committed&quot;, G_CALLBACK(loadcommit), view);
</a><a href="#h3-0-182" id="h3-0-182" class="i">+	g_signal_connect(G_OBJECT(view), &quot;load-started&quot;, G_CALLBACK(loadstart), view);
</a><a href="#h3-0-183" id="h3-0-183" class="i">+	g_signal_connect(G_OBJECT(view), &quot;load-finished&quot;, G_CALLBACK(loadfinish), view);
</a><a href="#h3-0-184" id="h3-0-184" class="i">+	g_signal_connect(G_OBJECT(view), &quot;hovering-over-link&quot;, G_CALLBACK(linkhover), view);
</a><a href="#h3-0-185" id="h3-0-185" class="i">+	g_signal_connect(G_OBJECT(view), &quot;new-window-policy-decision-requested&quot;, G_CALLBACK(newwindow), view);
</a><a href="#h3-0-186" id="h3-0-186" class="i">+	g_signal_connect(G_OBJECT(view), &quot;download-requested&quot;, G_CALLBACK(download), view);
</a><a href="#h3-0-187" id="h3-0-187" class="i">+	/* g_signal_connect(G_OBJECT(view), &quot;create-web-view&quot;, G_CALLBACK(createwebview), view); */
</a><a href="#h3-0-188" id="h3-0-188" class="i">+
</a><a href="#h3-0-189" id="h3-0-189" class="i">+	gtk_container_add(GTK_CONTAINER(win), browser);
</a><a href="#h3-0-190" id="h3-0-190" class="i">+	gtk_widget_grab_focus(GTK_WIDGET(view));
</a><a href="#h3-0-191" id="h3-0-191" class="i">+	gtk_widget_show_all(win);
</a><a href="#h3-0-192" id="h3-0-192" class="i">+}
</a><a href="#h3-0-193" id="h3-0-193" class="i">+
</a><a href="#h3-0-194" id="h3-0-194" class="i">+void cleanup() {
</a><a href="#h3-0-195" id="h3-0-195" class="i">+}
</a><a href="#h3-0-196" id="h3-0-196" class="i">+
</a><a href="#h3-0-197" id="h3-0-197" class="i">+int main(int argc, char *argv[]) {
</a><a href="#h3-0-198" id="h3-0-198" class="i">+	gchar *uri = NULL, *file = NULL;
</a><a href="#h3-0-199" id="h3-0-199" class="i">+
</a><a href="#h3-0-200" id="h3-0-200" class="i">+	ARG {
</a><a href="#h3-0-201" id="h3-0-201" class="i">+	case &#39;e&#39;:
</a><a href="#h3-0-202" id="h3-0-202" class="i">+		embed = TRUE;
</a><a href="#h3-0-203" id="h3-0-203" class="i">+		break;
</a><a href="#h3-0-204" id="h3-0-204" class="i">+	case &#39;u&#39;:
</a><a href="#h3-0-205" id="h3-0-205" class="i">+		if(!(uri = ARGVAL()))
</a><a href="#h3-0-206" id="h3-0-206" class="i">+			goto argerr;
</a><a href="#h3-0-207" id="h3-0-207" class="i">+		break;
</a><a href="#h3-0-208" id="h3-0-208" class="i">+	case &#39;f&#39;:
</a><a href="#h3-0-209" id="h3-0-209" class="i">+		if(!(file = ARGVAL()))
</a><a href="#h3-0-210" id="h3-0-210" class="i">+			goto argerr;
</a><a href="#h3-0-211" id="h3-0-211" class="i">+		break;
</a><a href="#h3-0-212" id="h3-0-212" class="i">+	argerr:
</a><a href="#h3-0-213" id="h3-0-213" class="i">+	default:
</a><a href="#h3-0-214" id="h3-0-214" class="i">+		puts(&quot;surf - simple browser&quot;);
</a><a href="#h3-0-215" id="h3-0-215" class="i">+		printf(&quot;usage: %s [-e] [-u uri] [-f file]&quot;, argv[0]);
</a><a href="#h3-0-216" id="h3-0-216" class="i">+		return EXIT_FAILURE;
</a><a href="#h3-0-217" id="h3-0-217" class="i">+	}
</a><a href="#h3-0-218" id="h3-0-218" class="i">+	if(argc != ARGC())
</a><a href="#h3-0-219" id="h3-0-219" class="i">+		goto argerr;
</a><a href="#h3-0-220" id="h3-0-220" class="i">+	gtk_init(NULL, NULL);
</a><a href="#h3-0-221" id="h3-0-221" class="i">+	if (!g_thread_supported())
</a><a href="#h3-0-222" id="h3-0-222" class="i">+		g_thread_init(NULL);
</a><a href="#h3-0-223" id="h3-0-223" class="i">+	setup();
</a><a href="#h3-0-224" id="h3-0-224" class="i">+	if(uri)
</a><a href="#h3-0-225" id="h3-0-225" class="i">+		loaduri(uri);
</a><a href="#h3-0-226" id="h3-0-226" class="i">+	else if(file)
</a><a href="#h3-0-227" id="h3-0-227" class="i">+		loadfile(file);
</a><a href="#h3-0-228" id="h3-0-228" class="i">+	setupstdin();
</a><a href="#h3-0-229" id="h3-0-229" class="i">+	updatetitle();
</a><a href="#h3-0-230" id="h3-0-230" class="i">+	gtk_main();
</a><a href="#h3-0-231" id="h3-0-231" class="i">+	cleanup();
</a><a href="#h3-0-232" id="h3-0-232" class="i">+	return EXIT_SUCCESS;
</a><a href="#h3-0-233" id="h3-0-233" class="i">+}
</a></pre>
</div>
</body>
</html>
