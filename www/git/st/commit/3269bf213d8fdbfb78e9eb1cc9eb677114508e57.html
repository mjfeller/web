<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>remove confusing SERRNO macro - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/3269bf213d8fdbfb78e9eb1cc9eb677114508e57.html">3269bf213d8fdbfb78e9eb1cc9eb677114508e57</a>
<b>parent</b> <a href="../commit/4ad2fc7f18c8a58d9f88d9a91fb4972849cfd964.html">4ad2fc7f18c8a58d9f88d9a91fb4972849cfd964</a>
<b>Author:</b> Markus Teich &lt;<a href="mailto:markus.teich@stusta.mhn.de">markus.teich@stusta.mhn.de</a>&gt;
<b>Date:</b>   Sun, 20 Apr 2014 13:15:40 +0200

remove confusing SERRNO macro

I found the SERRNO Macro slightly confusing, since you have to look
it up, if you don&#39;t know it already. A web search showed it does
not seem to be any kind of standard. Also there was no reason in
the commit log when it was introduced in 2009. As you can see it
also leads to new patches, which don&#39;t use this macro (probably the
author did not know about it).

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++</span><span class="d">--------</span></td></tr>
</table></pre><pre>1 file changed, 7 insertions(+), 8 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -65,7 +65,6 @@ char *argv0;
</a> #define REDRAW_TIMEOUT (80*1000) /* 80 ms */
 
 /* macros */
<a href="#h0-0-3" id="h0-0-3" class="d">-#define SERRNO strerror(errno)
</a> #define MIN(a, b)  ((a) &lt; (b) ? (a) : (b))
 #define MAX(a, b)  ((a) &lt; (b) ? (b) : (a))
 #define LEN(a)     (sizeof(a) / sizeof(a[0]))
<a href="#h0-1" id="h0-1" class="h">@@ -1181,7 +1180,7 @@ sigchld(int a) {
</a> 	int stat = 0;
 
 	if(waitpid(pid, &amp;stat, 0) &lt; 0)
<a href="#h0-1-3" id="h0-1-3" class="d">-		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, SERRNO);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
</a> 
 	if(WIFEXITED(stat)) {
 		exit(WEXITSTATUS(stat));
<a href="#h0-2" id="h0-2" class="h">@@ -1197,7 +1196,7 @@ ttynew(void) {
</a> 
 	/* seems to work fine on linux, openbsd and freebsd */
 	if(openpty(&amp;m, &amp;s, NULL, NULL, &amp;w) &lt; 0)
<a href="#h0-2-3" id="h0-2-3" class="d">-		die(&quot;openpty failed: %s\n&quot;, SERRNO);
</a><a href="#h0-2-4" id="h0-2-4" class="i">+		die(&quot;openpty failed: %s\n&quot;, strerror(errno));
</a> 
 	switch(pid = fork()) {
 	case -1:
<a href="#h0-3" id="h0-3" class="h">@@ -1209,7 +1208,7 @@ ttynew(void) {
</a> 		dup2(s, STDOUT_FILENO);
 		dup2(s, STDERR_FILENO);
 		if(ioctl(s, TIOCSCTTY, NULL) &lt; 0)
<a href="#h0-3-3" id="h0-3-3" class="d">-			die(&quot;ioctl TIOCSCTTY failed: %s\n&quot;, SERRNO);
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			die(&quot;ioctl TIOCSCTTY failed: %s\n&quot;, strerror(errno));
</a> 		close(s);
 		close(m);
 		execsh();
<a href="#h0-4" id="h0-4" class="h">@@ -1252,7 +1251,7 @@ ttyread(void) {
</a> 
 	/* append read bytes to unprocessed bytes */
 	if((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
<a href="#h0-4-3" id="h0-4-3" class="d">-		die(&quot;Couldn&#39;t read from shell: %s\n&quot;, SERRNO);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+		die(&quot;Couldn&#39;t read from shell: %s\n&quot;, strerror(errno));
</a> 
 	/* process every complete utf8 char */
 	buflen += ret;
<a href="#h0-5" id="h0-5" class="h">@@ -1271,7 +1270,7 @@ ttyread(void) {
</a> void
 ttywrite(const char *s, size_t n) {
 	if(write(cmdfd, s, n) == -1)
<a href="#h0-5-3" id="h0-5-3" class="d">-		die(&quot;write error on tty: %s\n&quot;, SERRNO);
</a><a href="#h0-5-4" id="h0-5-4" class="i">+		die(&quot;write error on tty: %s\n&quot;, strerror(errno));
</a> }
 
 void
<a href="#h0-6" id="h0-6" class="h">@@ -1290,7 +1289,7 @@ ttyresize(void) {
</a> 	w.ws_xpixel = xw.tw;
 	w.ws_ypixel = xw.th;
 	if(ioctl(cmdfd, TIOCSWINSZ, &amp;w) &lt; 0)
<a href="#h0-6-3" id="h0-6-3" class="d">-		fprintf(stderr, &quot;Couldn&#39;t set window size: %s\n&quot;, SERRNO);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+		fprintf(stderr, &quot;Couldn&#39;t set window size: %s\n&quot;, strerror(errno));
</a> }
 
 int
<a href="#h0-7" id="h0-7" class="h">@@ -3750,7 +3749,7 @@ run(void) {
</a> 		if(select(MAX(xfd, cmdfd)+1, &amp;rfd, NULL, NULL, tv) &lt; 0) {
 			if(errno == EINTR)
 				continue;
<a href="#h0-7-3" id="h0-7-3" class="d">-			die(&quot;select failed: %s\n&quot;, SERRNO);
</a><a href="#h0-7-4" id="h0-7-4" class="i">+			die(&quot;select failed: %s\n&quot;, strerror(errno));
</a> 		}
 		if(FD_ISSET(cmdfd, &amp;rfd)) {
 			ttyread();
</pre>
</div>
</body>
</html>
