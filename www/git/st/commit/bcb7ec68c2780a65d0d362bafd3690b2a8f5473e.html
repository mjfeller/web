<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>cosmetic, whitespace, etc. - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/bcb7ec68c2780a65d0d362bafd3690b2a8f5473e.html">bcb7ec68c2780a65d0d362bafd3690b2a8f5473e</a>
<b>parent</b> <a href="../commit/df54ab040509829b4baec1673e4b158038ff983d.html">df54ab040509829b4baec1673e4b158038ff983d</a>
<b>Author:</b> Aur√©lien Aptel &lt;<a href="mailto:aurelien.aptel@gmail.com">aurelien.aptel@gmail.com</a>&gt;
<b>Date:</b>   Sat, 21 Jan 2012 23:43:03 +0100

cosmetic, whitespace, etc.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">79</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------------------</span></td></tr>
</table></pre><pre>1 file changed, 42 insertions(+), 37 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -6,6 +6,7 @@
</a> #include &lt;limits.h&gt;
 #include &lt;locale.h&gt;
 #include &lt;stdarg.h&gt;
<a href="#h0-0-3" id="h0-0-3" class="i">+#include &lt;stdbool.h&gt;
</a> #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
<a href="#h0-1" id="h0-1" class="h">@@ -79,6 +80,10 @@ enum { WIN_VISIBLE=1, WIN_REDRAW=2, WIN_FOCUSED=4 };
</a> #undef B0
 enum { B0=1, B1=2, B2=4, B3=8, B4=16, B5=32, B6=64, B7=128 };
 
<a href="#h0-1-3" id="h0-1-3" class="i">+typedef unsigned char uchar;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+typedef unsigned int uint;
</a><a href="#h0-1-5" id="h0-1-5" class="i">+typedef unsigned long ulong;
</a><a href="#h0-1-6" id="h0-1-6" class="i">+
</a> typedef struct {
 	char c[UTF_SIZ];     /* character code */
 	char mode;  /* attribute flags */
<a href="#h0-2" id="h0-2" class="h">@@ -113,7 +118,7 @@ typedef struct {
</a> 	int col;	/* nb col */
 	Line* line;	/* screen */
 	Line* alt;	/* alternate screen */
<a href="#h0-2-3" id="h0-2-3" class="d">-	char* dirty; /* dirtyness of lines */
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	bool* dirty; /* dirtyness of lines */
</a> 	TCursor c;	/* cursor */
 	int top;	/* top    scroll limit */
 	int bot;	/* bottom scroll limit */
<a href="#h0-3" id="h0-3" class="h">@@ -145,13 +150,13 @@ typedef struct {
</a> 
 typedef struct {
 	KeySym k;
<a href="#h0-3-3" id="h0-3-3" class="d">-	unsigned int mask;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+	uint mask;
</a> 	char s[ESC_BUF_SIZ];
 } Key;
 
 /* Drawing Context */
 typedef struct {
<a href="#h0-3-10" id="h0-3-10" class="d">-	unsigned long col[256];
</a><a href="#h0-3-11" id="h0-3-11" class="i">+	ulong col[256];
</a> 	GC gc;
 	struct {
 		int ascent;
<a href="#h0-4" id="h0-4" class="h">@@ -182,7 +187,7 @@ static void drawregion(int, int, int, int);
</a> static void execsh(void);
 static void sigchld(int);
 static void run(void);
<a href="#h0-4-3" id="h0-4-3" class="d">-static int last_draw_too_old(void);
</a><a href="#h0-4-4" id="h0-4-4" class="i">+static bool last_draw_too_old(void);
</a> 
 static void csidump(void);
 static void csihandle(void);
<a href="#h0-5" id="h0-5" class="h">@@ -229,7 +234,7 @@ static void xresize(int, int);
</a> static void expose(XEvent *);
 static void visibility(XEvent *);
 static void unmap(XEvent *);
<a href="#h0-5-3" id="h0-5-3" class="d">-static char* kmap(KeySym, unsigned int);
</a><a href="#h0-5-4" id="h0-5-4" class="i">+static char* kmap(KeySym, uint);
</a> static void kpress(XEvent *);
 static void cmessage(XEvent *);
 static void resize(XEvent *);
<a href="#h0-6" id="h0-6" class="h">@@ -241,7 +246,7 @@ static void selnotify(XEvent *);
</a> static void selrequest(XEvent *);
 
 static void selinit(void);
<a href="#h0-6-3" id="h0-6-3" class="d">-static inline int selected(int, int);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+static inline bool selected(int, int);
</a> static void selcopy(void);
 static void selpaste();
 static void selscroll(int, int);
<a href="#h0-7" id="h0-7" class="h">@@ -282,31 +287,31 @@ static char *opt_class = NULL;
</a> 
 int
 utf8decode(char *s, long *u) {
<a href="#h0-7-3" id="h0-7-3" class="d">-	unsigned char c;
</a><a href="#h0-7-4" id="h0-7-4" class="i">+	uchar c;
</a> 	int i, n, rtn;
 
 	rtn = 1;
 	c = *s;
<a href="#h0-7-9" id="h0-7-9" class="d">-	if(~c&amp;B7) { /* 0xxxxxxx */
</a><a href="#h0-7-10" id="h0-7-10" class="i">+	if(~c &amp; B7) { /* 0xxxxxxx */
</a> 		*u = c;
 		return rtn;
<a href="#h0-7-13" id="h0-7-13" class="d">-	} else if((c&amp;(B7|B6|B5)) == (B7|B6)) { /* 110xxxxx */
</a><a href="#h0-7-14" id="h0-7-14" class="i">+	} else if((c &amp; (B7|B6|B5)) == (B7|B6)) { /* 110xxxxx */
</a> 		*u = c&amp;(B4|B3|B2|B1|B0);
 		n = 1;
<a href="#h0-7-17" id="h0-7-17" class="d">-	} else if((c&amp;(B7|B6|B5|B4)) == (B7|B6|B5)) { /* 1110xxxx */
</a><a href="#h0-7-18" id="h0-7-18" class="i">+	} else if((c &amp; (B7|B6|B5|B4)) == (B7|B6|B5)) { /* 1110xxxx */
</a> 		*u = c&amp;(B3|B2|B1|B0);
 		n = 2;
<a href="#h0-7-21" id="h0-7-21" class="d">-	} else if((c&amp;(B7|B6|B5|B4|B3)) == (B7|B6|B5|B4)) { /* 11110xxx */
</a><a href="#h0-7-22" id="h0-7-22" class="d">-		*u = c&amp;(B2|B1|B0);
</a><a href="#h0-7-23" id="h0-7-23" class="i">+	} else if((c &amp; (B7|B6|B5|B4|B3)) == (B7|B6|B5|B4)) { /* 11110xxx */
</a><a href="#h0-7-24" id="h0-7-24" class="i">+		*u = c &amp; (B2|B1|B0);
</a> 		n = 3;
 	} else
 		goto invalid;
<a href="#h0-7-28" id="h0-7-28" class="d">-	for(i=n,++s; i&gt;0; --i,++rtn,++s) {
</a><a href="#h0-7-29" id="h0-7-29" class="i">+	for(i = n, ++s; i &gt; 0; --i, ++rtn, ++s) {
</a> 		c = *s;
<a href="#h0-7-31" id="h0-7-31" class="d">-		if((c&amp;(B7|B6)) != B7) /* 10xxxxxx */
</a><a href="#h0-7-32" id="h0-7-32" class="i">+		if((c &amp; (B7|B6)) != B7) /* 10xxxxxx */
</a> 			goto invalid;
 		*u &lt;&lt;= 6;
<a href="#h0-7-35" id="h0-7-35" class="d">-		*u |= c&amp;(B5|B4|B3|B2|B1|B0);
</a><a href="#h0-7-36" id="h0-7-36" class="i">+		*u |= c &amp; (B5|B4|B3|B2|B1|B0);
</a> 	}
 	if((n == 1 &amp;&amp; *u &lt; 0x80) ||
 	   (n == 2 &amp;&amp; *u &lt; 0x800) ||
<a href="#h0-8" id="h0-8" class="h">@@ -321,11 +326,11 @@ invalid:
</a> 
 int
 utf8encode(long *u, char *s) {
<a href="#h0-8-3" id="h0-8-3" class="d">-	unsigned char *sp;
</a><a href="#h0-8-4" id="h0-8-4" class="d">-	unsigned long uc;
</a><a href="#h0-8-5" id="h0-8-5" class="i">+	uchar *sp;
</a><a href="#h0-8-6" id="h0-8-6" class="i">+	ulong uc;
</a> 	int i, n;
 
<a href="#h0-8-9" id="h0-8-9" class="d">-	sp = (unsigned char*) s;
</a><a href="#h0-8-10" id="h0-8-10" class="i">+	sp = (uchar*) s;
</a> 	uc = *u;
 	if(uc &lt; 0x80) {
 		*sp = uc; /* 0xxxxxxx */
<a href="#h0-9" id="h0-9" class="h">@@ -357,11 +362,11 @@ invalid:
</a>    UTF-8 otherwise return 0 */
 int
 isfullutf8(char *s, int b) {
<a href="#h0-9-3" id="h0-9-3" class="d">-	unsigned char *c1, *c2, *c3;
</a><a href="#h0-9-4" id="h0-9-4" class="i">+	uchar *c1, *c2, *c3;
</a> 
<a href="#h0-9-6" id="h0-9-6" class="d">-	c1 = (unsigned char *) s;
</a><a href="#h0-9-7" id="h0-9-7" class="d">-	c2 = (unsigned char *) ++s;
</a><a href="#h0-9-8" id="h0-9-8" class="d">-	c3 = (unsigned char *) ++s;
</a><a href="#h0-9-9" id="h0-9-9" class="i">+	c1 = (uchar *) s;
</a><a href="#h0-9-10" id="h0-9-10" class="i">+	c2 = (uchar *) ++s;
</a><a href="#h0-9-11" id="h0-9-11" class="i">+	c3 = (uchar *) ++s;
</a> 	if(b &lt; 1)
 		return 0;
 	else if((*c1&amp;(B7|B6|B5)) == (B7|B6) &amp;&amp; b == 1)
<a href="#h0-10" id="h0-10" class="h">@@ -381,7 +386,7 @@ isfullutf8(char *s, int b) {
</a> 
 int
 utf8size(char *s) {
<a href="#h0-10-3" id="h0-10-3" class="d">-	unsigned char c = *s;
</a><a href="#h0-10-4" id="h0-10-4" class="i">+	uchar c = *s;
</a> 
 	if(~c&amp;B7)
 		return 1;
<a href="#h0-11" id="h0-11" class="h">@@ -405,7 +410,7 @@ selinit(void) {
</a> 		sel.xtarget = XA_STRING;
 }
 
<a href="#h0-11-3" id="h0-11-3" class="d">-static inline int
</a><a href="#h0-11-4" id="h0-11-4" class="i">+static inline bool
</a> selected(int x, int y) {
 	if(sel.ey == y &amp;&amp; sel.by == y) {
 		int bx = MIN(sel.bx, sel.ex);
<a href="#h0-12" id="h0-12" class="h">@@ -504,9 +509,9 @@ selcopy(void) {
</a> 
 void
 selnotify(XEvent *e) {
<a href="#h0-12-3" id="h0-12-3" class="d">-	unsigned long nitems, ofs, rem;
</a><a href="#h0-12-4" id="h0-12-4" class="i">+	ulong nitems, ofs, rem;
</a> 	int format;
<a href="#h0-12-6" id="h0-12-6" class="d">-	unsigned char *data;
</a><a href="#h0-12-7" id="h0-12-7" class="i">+	uchar *data;
</a> 	Atom type;
 
 	ofs = 0;
<a href="#h0-13" id="h0-13" class="h">@@ -550,12 +555,12 @@ selrequest(XEvent *e) {
</a> 		Atom string = sel.xtarget;
 		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
 				XA_ATOM, 32, PropModeReplace,
<a href="#h0-13-3" id="h0-13-3" class="d">-				(unsigned char *) &amp;string, 1);
</a><a href="#h0-13-4" id="h0-13-4" class="i">+				(uchar *) &amp;string, 1);
</a> 		xev.property = xsre-&gt;property;
 	} else if(xsre-&gt;target == sel.xtarget &amp;&amp; sel.clip != NULL) {
 		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
 				xsre-&gt;target, 8, PropModeReplace,
<a href="#h0-13-9" id="h0-13-9" class="d">-				(unsigned char *) sel.clip, strlen(sel.clip));
</a><a href="#h0-13-10" id="h0-13-10" class="i">+				(uchar *) sel.clip, strlen(sel.clip));
</a> 		xev.property = xsre-&gt;property;
 	}
 
<a href="#h0-14" id="h0-14" class="h">@@ -636,7 +641,7 @@ bmotion(XEvent *e) {
</a> 		if(oldey != sel.ey || oldex != sel.ex) {
 			int starty = MIN(oldey, sel.ey);
 			int endy = MAX(oldey, sel.ey);
<a href="#h0-14-3" id="h0-14-3" class="d">-			for(int i=starty; i&lt;=endy; i++)
</a><a href="#h0-14-4" id="h0-14-4" class="i">+			for(int i = starty; i &lt;= endy; i++)
</a> 				term.dirty[i] = 1;
 			draw();
 		}
<a href="#h0-15" id="h0-15" class="h">@@ -1444,7 +1449,7 @@ tputc(char *c) {
</a> 				break;
 			default:
 				fprintf(stderr, &quot;erresc: unknown sequence ESC 0x%02X &#39;%c&#39;\n&quot;,
<a href="#h0-15-3" id="h0-15-3" class="d">-				    (unsigned char) ascii, isprint(ascii)?ascii:&#39;.&#39;);
</a><a href="#h0-15-4" id="h0-15-4" class="i">+				    (uchar) ascii, isprint(ascii)?ascii:&#39;.&#39;);
</a> 				term.esc = 0;
 			}
 		}
<a href="#h0-16" id="h0-16" class="h">@@ -1582,7 +1587,7 @@ void
</a> xloadcols(void) {
 	int i, r, g, b;
 	XColor color;
<a href="#h0-16-3" id="h0-16-3" class="d">-	unsigned long white = WhitePixel(xw.dpy, xw.scr);
</a><a href="#h0-16-4" id="h0-16-4" class="i">+	ulong white = WhitePixel(xw.dpy, xw.scr);
</a> 
 	for(i = 0; i &lt; LEN(colorname); i++) {
 		if(!XAllocNamedColor(xw.dpy, xw.cmap, colorname[i], &amp;color, &amp;color)) {
<a href="#h0-17" id="h0-17" class="h">@@ -1756,7 +1761,7 @@ xinit(void) {
</a> 
 void
 xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
<a href="#h0-17-3" id="h0-17-3" class="d">-	unsigned long xfg = dc.col[base.fg], xbg = dc.col[base.bg], temp;
</a><a href="#h0-17-4" id="h0-17-4" class="i">+	ulong xfg = dc.col[base.fg], xbg = dc.col[base.bg], temp;
</a> 	int winx = x*xw.cw, winy = y*xw.ch + dc.font.ascent, width = charlen*xw.cw;
 	int i;
 	
<a href="#h0-18" id="h0-18" class="h">@@ -1776,7 +1781,7 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 
 	if(base.mode &amp; ATTR_GFX) {
 		for(i = 0; i &lt; bytelen; i++) {
<a href="#h0-18-3" id="h0-18-3" class="d">-			char c = gfx[(unsigned int)s[i] % 256];
</a><a href="#h0-18-4" id="h0-18-4" class="i">+			char c = gfx[(uint)s[i] % 256];
</a> 			if(c)
 				s[i] = c;
 			else if(s[i] &gt; 0x5f)
<a href="#h0-19" id="h0-19" class="h">@@ -1929,11 +1934,11 @@ focus(XEvent *ev) {
</a> }
 
 char*
<a href="#h0-19-3" id="h0-19-3" class="d">-kmap(KeySym k, unsigned int state) {
</a><a href="#h0-19-4" id="h0-19-4" class="i">+kmap(KeySym k, uint state) {
</a> 	int i;
 	state &amp;= ~Mod2Mask;
 	for(i = 0; i &lt; LEN(key); i++) {
<a href="#h0-19-8" id="h0-19-8" class="d">-		unsigned int mask = key[i].mask;
</a><a href="#h0-19-9" id="h0-19-9" class="i">+		uint mask = key[i].mask;
</a> 		if(key[i].k == k &amp;&amp; ((state &amp; mask) == mask || (mask == XK_NO_MOD &amp;&amp; !state)))
 			return (char*)key[i].s;
 	}
<a href="#h0-20" id="h0-20" class="h">@@ -2024,7 +2029,7 @@ resize(XEvent *e) {
</a> 	xresize(col, row);
 }
 
<a href="#h0-20-3" id="h0-20-3" class="d">-int
</a><a href="#h0-20-4" id="h0-20-4" class="i">+bool
</a> last_draw_too_old(void) {
 	struct timeval now;
 	gettimeofday(&amp;now, NULL);
<a href="#h0-21" id="h0-21" class="h">@@ -2037,7 +2042,7 @@ run(void) {
</a> 	fd_set rfd;
 	int xfd = XConnectionNumber(xw.dpy);
 	struct timeval timeout = {0};
<a href="#h0-21-3" id="h0-21-3" class="d">-	int stuff_to_print = 0;
</a><a href="#h0-21-4" id="h0-21-4" class="i">+	bool stuff_to_print = 0;
</a> 	
 	for(;;) {
 		FD_ZERO(&amp;rfd);
</pre>
</div>
</body>
</html>
