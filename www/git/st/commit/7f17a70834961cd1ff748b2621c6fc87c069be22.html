<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Cleaning up lonely tabs. - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/7f17a70834961cd1ff748b2621c6fc87c069be22.html">7f17a70834961cd1ff748b2621c6fc87c069be22</a>
<b>parent</b> <a href="../commit/588ba51a539d18de5f9497a38ab7875e7b3e1429.html">588ba51a539d18de5f9497a38ab7875e7b3e1429</a>
<b>Author:</b> Christoph Lohmann &lt;<a href="mailto:20h@r-36.net">20h@r-36.net</a>&gt;
<b>Date:</b>   Sun,  2 Sep 2012 19:43:29 +0200

Cleaning up lonely tabs.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">46</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
</table></pre><pre>1 file changed, 23 insertions(+), 23 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -504,7 +504,7 @@ mousereport(XEvent *e) {
</a> 	int state = e-&gt;xbutton.state;
 	char buf[] = { &#39;\033&#39;, &#39;[&#39;, &#39;M&#39;, 0, 32+x+1, 32+y+1 };
 	static int ob, ox, oy;
<a href="#h0-0-3" id="h0-0-3" class="d">-	
</a><a href="#h0-0-4" id="h0-0-4" class="i">+
</a> 	/* from urxvt */
 	if(e-&gt;xbutton.type == MotionNotify) {
 		if(!IS_SET(MODE_MOUSEMOTION) || (x == ox &amp;&amp; y == oy))
<a href="#h0-1" id="h0-1" class="h">@@ -522,11 +522,11 @@ mousereport(XEvent *e) {
</a> 			ox = x, oy = y;
 		}
 	}
<a href="#h0-1-3" id="h0-1-3" class="d">-	
</a><a href="#h0-1-4" id="h0-1-4" class="i">+
</a> 	buf[3] = 32 + button + (state &amp; ShiftMask ? 4 : 0)
 		+ (state &amp; Mod4Mask    ? 8  : 0)
 		+ (state &amp; ControlMask ? 16 : 0);
<a href="#h0-1-8" id="h0-1-8" class="d">-	
</a><a href="#h0-1-9" id="h0-1-9" class="i">+
</a> 	ttywrite(buf, sizeof(buf));
 }
 
<a href="#h0-2" id="h0-2" class="h">@@ -751,7 +751,7 @@ sigchld(int a) {
</a> void
 ttynew(void) {
 	int m, s;
<a href="#h0-2-3" id="h0-2-3" class="d">-	
</a><a href="#h0-2-4" id="h0-2-4" class="i">+
</a> 	/* seems to work fine on linux, openbsd and freebsd */
 	struct winsize w = {term.row, term.col, 0, 0};
 	if(openpty(&amp;m, &amp;s, NULL, NULL, &amp;w) &lt; 0)
<a href="#h0-3" id="h0-3" class="h">@@ -910,11 +910,11 @@ void
</a> tscrolldown(int orig, int n) {
 	int i;
 	Line temp;
<a href="#h0-3-3" id="h0-3-3" class="d">-	
</a><a href="#h0-3-4" id="h0-3-4" class="i">+
</a> 	LIMIT(n, 0, term.bot-orig+1);
 
 	tclearregion(0, term.bot-n+1, term.col-1, term.bot);
<a href="#h0-3-8" id="h0-3-8" class="d">-	
</a><a href="#h0-3-9" id="h0-3-9" class="i">+
</a> 	for(i = term.bot; i &gt;= orig+n; i--) {
 		temp = term.line[i];
 		term.line[i] = term.line[i-n];
<a href="#h0-4" id="h0-4" class="h">@@ -932,9 +932,9 @@ tscrollup(int orig, int n) {
</a> 	int i;
 	Line temp;
 	LIMIT(n, 0, term.bot-orig+1);
<a href="#h0-4-3" id="h0-4-3" class="d">-	
</a><a href="#h0-4-4" id="h0-4-4" class="i">+
</a> 	tclearregion(0, orig, term.col-1, orig+n-1);
<a href="#h0-4-6" id="h0-4-6" class="d">-	
</a><a href="#h0-4-7" id="h0-4-7" class="i">+
</a> 	for(i = orig; i &lt;= term.bot-n; i++) {
 		 temp = term.line[i];
 		 term.line[i] = term.line[i+n];
<a href="#h0-5" id="h0-5" class="h">@@ -951,7 +951,7 @@ void
</a> selscroll(int orig, int n) {
 	if(sel.bx == -1)
 		return;
<a href="#h0-5-3" id="h0-5-3" class="d">-	
</a><a href="#h0-5-4" id="h0-5-4" class="i">+
</a> 	if(BETWEEN(sel.by, orig, term.bot) || BETWEEN(sel.ey, orig, term.bot)) {
 		if((sel.by += n) &gt; term.bot || (sel.ey += n) &lt; term.top) {
 			sel.bx = -1;
<a href="#h0-6" id="h0-6" class="h">@@ -988,7 +988,7 @@ csiparse(void) {
</a> 	csiescseq.narg = 0;
 	if(*p == &#39;?&#39;)
 		csiescseq.priv = 1, p++;
<a href="#h0-6-3" id="h0-6-3" class="d">-	
</a><a href="#h0-6-4" id="h0-6-4" class="i">+
</a> 	while(p &lt; csiescseq.buf+csiescseq.len) {
 		while(isdigit(*p)) {
 			csiescseq.arg[csiescseq.narg] *= 10;
<a href="#h0-7" id="h0-7" class="h">@@ -1047,7 +1047,7 @@ tdeletechar(int n) {
</a> 	int src = term.c.x + n;
 	int dst = term.c.x;
 	int size = term.col - src;
<a href="#h0-7-3" id="h0-7-3" class="d">-	
</a><a href="#h0-7-4" id="h0-7-4" class="i">+
</a> 	term.dirty[term.c.y] = 1;
 
 	if(src &gt;= term.col) {
<a href="#h0-8" id="h0-8" class="h">@@ -1765,7 +1765,7 @@ xloadcols(void) {
</a> 		} else
 			dc.col[i] = color.pixel;
 	}
<a href="#h0-8-3" id="h0-8-3" class="d">-	
</a><a href="#h0-8-4" id="h0-8-4" class="i">+
</a> 	/* load colors [16-255] ; same colors as xterm */
 	for(i = 16, r = 0; r &lt; 6; r++)
 		for(g = 0; g &lt; 6; g++)
<a href="#h0-9" id="h0-9" class="h">@@ -1868,7 +1868,7 @@ xinit(void) {
</a> 	if(!(xw.dpy = XOpenDisplay(NULL)))
 		die(&quot;Can&#39;t open display\n&quot;);
 	xw.scr = XDefaultScreen(xw.dpy);
<a href="#h0-9-3" id="h0-9-3" class="d">-	
</a><a href="#h0-9-4" id="h0-9-4" class="i">+
</a> 	/* font */
 	initfonts(FONT, BOLDFONT);
 
<a href="#h0-10" id="h0-10" class="h">@@ -1910,7 +1910,7 @@ xinit(void) {
</a> 					   XNFocusWindow, xw.win, NULL);
 	/* gc */
 	dc.gc = XCreateGC(xw.dpy, xw.win, 0, NULL);
<a href="#h0-10-3" id="h0-10-3" class="d">-	
</a><a href="#h0-10-4" id="h0-10-4" class="i">+
</a> 	/* white cursor, black outline */
 	cursor = XCreateFontCursor(xw.dpy, XC_xterm);
 	XDefineCursor(xw.dpy, xw.win, cursor);
<a href="#h0-11" id="h0-11" class="h">@@ -1932,7 +1932,7 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 	int winx = BORDER+x*xw.cw, winy = BORDER+y*xw.ch + dc.font.ascent, width = charlen*xw.cw;
 	XFontSet fontset = dc.font.set;
 	int i;
<a href="#h0-11-3" id="h0-11-3" class="d">-	
</a><a href="#h0-11-4" id="h0-11-4" class="i">+
</a> 	/* only switch default fg/bg if term is in RV mode */
 	if(IS_SET(MODE_REVERSE)) {
 		if(fg == DefaultFG)
<a href="#h0-12" id="h0-12" class="h">@@ -1963,7 +1963,7 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 	}
 
 	XmbDrawImageString(xw.dpy, xw.buf, fontset, dc.gc, winx, winy, s, bytelen);
<a href="#h0-12-3" id="h0-12-3" class="d">-	
</a><a href="#h0-12-4" id="h0-12-4" class="i">+
</a> 	if(base.mode &amp; ATTR_UNDERLINE)
 		XDrawLine(xw.dpy, xw.buf, dc.gc, winx, winy+1, winx+width-1, winy+1);
 }
<a href="#h0-13" id="h0-13" class="h">@@ -1982,10 +1982,10 @@ xdrawcursor(void) {
</a> 	static int oldy = 0;
 	int sl;
 	Glyph g = {{&#39; &#39;}, ATTR_NULL, DefaultBG, DefaultCS, 0};
<a href="#h0-13-3" id="h0-13-3" class="d">-	
</a><a href="#h0-13-4" id="h0-13-4" class="i">+
</a> 	LIMIT(oldx, 0, term.col-1);
 	LIMIT(oldy, 0, term.row-1);
<a href="#h0-13-7" id="h0-13-7" class="d">-	
</a><a href="#h0-13-8" id="h0-13-8" class="i">+
</a> 	if(term.line[term.c.y][term.c.x].state &amp; GLYPH_SET)
 		memcpy(g.c, term.line[term.c.y][term.c.x].c, UTF_SIZ);
 
<a href="#h0-14" id="h0-14" class="h">@@ -2132,7 +2132,7 @@ kpress(XEvent *ev) {
</a> 	meta = e-&gt;state &amp; Mod1Mask;
 	shift = e-&gt;state &amp; ShiftMask;
 	len = XmbLookupString(xw.xic, e, buf, sizeof(buf), &amp;ksym, &amp;status);
<a href="#h0-14-3" id="h0-14-3" class="d">-	
</a><a href="#h0-14-4" id="h0-14-4" class="i">+
</a> 	/* 1. custom keys from config.h */
 	if((customkey = kmap(ksym, e-&gt;state)))
 		ttywrite(customkey, strlen(customkey));
<a href="#h0-15" id="h0-15" class="h">@@ -2186,10 +2186,10 @@ cmessage(XEvent *e) {
</a> void
 resize(XEvent *e) {
 	int col, row;
<a href="#h0-15-3" id="h0-15-3" class="d">-	
</a><a href="#h0-15-4" id="h0-15-4" class="i">+
</a> 	if(e-&gt;xconfigure.width == xw.w &amp;&amp; e-&gt;xconfigure.height == xw.h)
 		return;
<a href="#h0-15-7" id="h0-15-7" class="d">-	
</a><a href="#h0-15-8" id="h0-15-8" class="i">+
</a> 	xw.w = e-&gt;xconfigure.width;
 	xw.h = e-&gt;xconfigure.height;
 	col = (xw.w - 2*BORDER) / xw.cw;
<a href="#h0-16" id="h0-16" class="h">@@ -2216,7 +2216,7 @@ run(void) {
</a> 	int xfd = XConnectionNumber(xw.dpy);
 	struct timeval timeout = {0};
 	bool stuff_to_print = 0;
<a href="#h0-16-3" id="h0-16-3" class="d">-	
</a><a href="#h0-16-4" id="h0-16-4" class="i">+
</a> 	for(;;) {
 		FD_ZERO(&amp;rfd);
 		FD_SET(cmdfd, &amp;rfd);
<a href="#h0-17" id="h0-17" class="h">@@ -2251,7 +2251,7 @@ run(void) {
</a> int
 main(int argc, char *argv[]) {
 	int i;
<a href="#h0-17-3" id="h0-17-3" class="d">-	
</a><a href="#h0-17-4" id="h0-17-4" class="i">+
</a> 	for(i = 1; i &lt; argc; i++) {
 		switch(argv[i][0] != &#39;-&#39; || argv[i][2] ? -1 : argv[i][1]) {
 		case &#39;t&#39;:
</pre>
</div>
</body>
</html>
