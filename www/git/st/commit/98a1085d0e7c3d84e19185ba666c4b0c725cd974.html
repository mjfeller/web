<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Removing wrapping newlines from selection - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/98a1085d0e7c3d84e19185ba666c4b0c725cd974.html">98a1085d0e7c3d84e19185ba666c4b0c725cd974</a>
<b>parent</b> <a href="../commit/51466e019a67e9319e6c5a7fa4205842ca860b71.html">51466e019a67e9319e6c5a7fa4205842ca860b71</a>
<b>Author:</b> Ben Hendrickson &lt;<a href="mailto:ben@1m7.com">ben@1m7.com</a>&gt;
<b>Date:</b>   Fri, 22 Aug 2014 09:25:04 -0700

Removing wrapping newlines from selection

When getting selected text, lines that were wrapped because of length
ought not include the wrapping newline in the selection.

This comes up, for example, when copying a bash command that is long
enough to wrap from the console and pasting it back into the console.
The extra newline breaks it.

Similiarly, changes behavior when trimming whitespace from the end of a
physical line to only do so if the line does not wrap. Otherwise we are
trimming whitespace from the middle of a logical line, which may change
its meaning.

Signed-off-by: Roberto E. Vargas Caballero &lt;k0ga@shike2.com&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++</span><span class="d">--</span></td></tr>
</table></pre><pre>1 file changed, 5 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -662,7 +662,10 @@ y2row(int y) {
</a> static int tlinelen(int y) {
 	int i = term.col;
 
<a href="#h0-0-3" id="h0-0-3" class="d">-	while (i &gt; 0 &amp;&amp; term.line[y][i - 1].c[0] == &#39; &#39;)
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	if(term.line[y][i - 1].mode &amp; ATTR_WRAP)
</a><a href="#h0-0-5" id="h0-0-5" class="i">+		return i;
</a><a href="#h0-0-6" id="h0-0-6" class="i">+
</a><a href="#h0-0-7" id="h0-0-7" class="i">+	while(i &gt; 0 &amp;&amp; term.line[y][i - 1].c[0] == &#39; &#39;)
</a> 		--i;
 
 	return i;
<a href="#h0-1" id="h0-1" class="h">@@ -959,7 +962,7 @@ getsel(void) {
</a> 		 * st.
 		 * FIXME: Fix the computer world.
 		 */
<a href="#h0-1-3" id="h0-1-3" class="d">-		if(sel.ne.y &gt; y || lastx &gt;= linelen)
</a><a href="#h0-1-4" id="h0-1-4" class="i">+		if((y &lt; sel.ne.y || lastx &gt;= linelen) &amp;&amp; !(last-&gt;mode &amp; ATTR_WRAP))
</a> 			*ptr++ = &#39;\n&#39;;
 	}
 	*ptr = 0;
</pre>
</div>
</body>
</html>
