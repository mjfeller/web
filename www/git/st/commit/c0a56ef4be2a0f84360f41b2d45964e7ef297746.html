<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Make w3mimgdisplay work with st - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/c0a56ef4be2a0f84360f41b2d45964e7ef297746.html">c0a56ef4be2a0f84360f41b2d45964e7ef297746</a>
<b>parent</b> <a href="../commit/9df9a4723dedf4f5e12c954376c4931a6976b918.html">9df9a4723dedf4f5e12c954376c4931a6976b918</a>
<b>Author:</b> Amadeusz Sławiński &lt;<a href="mailto:amade@asmblr.net">amade@asmblr.net</a>&gt;
<b>Date:</b>   Sat, 11 Jan 2014 12:54:36 +0100

Make w3mimgdisplay work with st

Before this patch draw() calls drawregion which calls xdraws and then
updates whole window in one call thus overdrawing anything drawn by
w3mimgdisplay. After moving XCopyArea to xdraws it only updates the
regions which are being updated by XftDraw* functions. It may do a few
more calls to XCopyArea with this patch.

Signed-off-by: Amadeusz Sławiński &lt;amade@asmblr.net&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">st.c</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
</table></pre><pre>1 file changed, 2 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3301,6 +3301,8 @@ xdraws(char *s, Glyph base, int x, int y, int charlen, int bytelen) {
</a> 		XftDrawRect(xw.draw, fg, winx, winy + font-&gt;ascent + 1,
 				width, 1);
 	}
<a href="#h0-0-3" id="h0-0-3" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, winx, winy, width,
</a><a href="#h0-0-4" id="h0-0-4" class="i">+			font-&gt;ascent + font-&gt;descent, winx, winy);
</a> 
 	/* Reset clip to none. */
 	XftDrawSetClip(xw.draw, 0);
<a href="#h0-1" id="h0-1" class="h">@@ -3399,8 +3401,6 @@ redraw(int timeout) {
</a> void
 draw(void) {
 	drawregion(0, 0, term.col, term.row);
<a href="#h0-1-3" id="h0-1-3" class="d">-	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, xw.w,
</a><a href="#h0-1-4" id="h0-1-4" class="d">-			xw.h, 0, 0);
</a> 	XSetForeground(xw.dpy, dc.gc,
 			dc.col[IS_SET(MODE_REVERSE)?
 				defaultfg : defaultbg].pixel);
</pre>
</div>
</body>
</html>
