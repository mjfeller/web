<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Add support for iso14755 - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/68bae9c7b121e30114f6b0cabe15da3fae46e673.html">68bae9c7b121e30114f6b0cabe15da3fae46e673</a>
<b>parent</b> <a href="../commit/331033f1f6abe259218666e6f6a848f38d884078.html">331033f1f6abe259218666e6f6a848f38d884078</a>
<b>Author:</b> Quentin Rameau &lt;<a href="mailto:quinq@fifth.space">quinq@fifth.space</a>&gt;
<b>Date:</b>   Sat,  8 Oct 2016 16:22:18 +0200

Add support for iso14755

We launch dmenu for getting a codepoint, then convert it and send it to
the terminal.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.def.h</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">st.c</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>2 files changed, 29 insertions(+), 0 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.def.h.html">config.def.h</a> b/<a href="../file/config.def.h.html">config.def.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -172,6 +172,7 @@ static Shortcut shortcuts[] = {
</a> 	{ MODKEY|ShiftMask,     XK_C,           clipcopy,       {.i =  0} },
 	{ MODKEY|ShiftMask,     XK_V,           clippaste,      {.i =  0} },
 	{ MODKEY,               XK_Num_Lock,    numlock,        {.i =  0} },
<a href="#h0-0-3" id="h0-0-3" class="i">+	{ MODKEY,               XK_Control_L,   iso14755,       {.i =  0} },
</a> };
 
 /*
<b>diff --git a/<a id="h1" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -66,6 +66,7 @@ char *argv0;
</a> #define MIN(a, b)		((a) &lt; (b) ? (a) : (b))
 #define MAX(a, b)		((a) &lt; (b) ? (b) : (a))
 #define LEN(a)			(sizeof(a) / sizeof(a)[0])
<a href="#h1-0-3" id="h1-0-3" class="i">+#define NUMMAXLEN(x)		((int)(sizeof(x) * 2.56 + 0.5) + 1)
</a> #define DEFAULT(a, b)		(a) = (a) ? (a) : (b)
 #define BETWEEN(x, a, b)	((a) &lt;= (x) &amp;&amp; (x) &lt;= (b))
 #define DIVCEIL(n, d)		(((n) + ((d) - 1)) / (d))
<a href="#h1-1" id="h1-1" class="h">@@ -87,6 +88,8 @@ char *argv0;
</a> #define TRUEGREEN(x)		(((x) &amp; 0xff00))
 #define TRUEBLUE(x)		(((x) &amp; 0xff) &lt;&lt; 8)
 
<a href="#h1-1-3" id="h1-1-3" class="i">+/* constants */
</a><a href="#h1-1-4" id="h1-1-4" class="i">+#define ISO14755CMD		&quot;dmenu -w %lu -p codepoint: &lt;/dev/null&quot;
</a> 
 enum glyph_attribute {
 	ATTR_NULL       = 0,
<a href="#h1-2" id="h1-2" class="h">@@ -338,6 +341,7 @@ static void xzoomabs(const Arg *);
</a> static void xzoomreset(const Arg *);
 static void printsel(const Arg *);
 static void printscreen(const Arg *) ;
<a href="#h1-2-3" id="h1-2-3" class="i">+static void iso14755(const Arg *);
</a> static void toggleprinter(const Arg *);
 static void sendbreak(const Arg *);
 
<a href="#h1-3" id="h1-3" class="h">@@ -2633,6 +2637,30 @@ tprinter(char *s, size_t len)
</a> }
 
 void
<a href="#h1-3-3" id="h1-3-3" class="i">+iso14755(const Arg *arg)
</a><a href="#h1-3-4" id="h1-3-4" class="i">+{
</a><a href="#h1-3-5" id="h1-3-5" class="i">+	char cmd[sizeof(ISO14755CMD) + NUMMAXLEN(xw.win)];
</a><a href="#h1-3-6" id="h1-3-6" class="i">+	FILE *p;
</a><a href="#h1-3-7" id="h1-3-7" class="i">+	char *us, *e, codepoint[9], uc[UTF_SIZ];
</a><a href="#h1-3-8" id="h1-3-8" class="i">+	unsigned long utf32;
</a><a href="#h1-3-9" id="h1-3-9" class="i">+
</a><a href="#h1-3-10" id="h1-3-10" class="i">+	snprintf(cmd, sizeof(cmd), ISO14755CMD, xw.win);
</a><a href="#h1-3-11" id="h1-3-11" class="i">+	if (!(p = popen(cmd, &quot;r&quot;)))
</a><a href="#h1-3-12" id="h1-3-12" class="i">+		return;
</a><a href="#h1-3-13" id="h1-3-13" class="i">+
</a><a href="#h1-3-14" id="h1-3-14" class="i">+	us = fgets(codepoint, sizeof(codepoint), p);
</a><a href="#h1-3-15" id="h1-3-15" class="i">+	pclose(p);
</a><a href="#h1-3-16" id="h1-3-16" class="i">+
</a><a href="#h1-3-17" id="h1-3-17" class="i">+	if (!us || *us == &#39;\0&#39; || *us == &#39;-&#39; || strlen(us) &gt; 7)
</a><a href="#h1-3-18" id="h1-3-18" class="i">+		return;
</a><a href="#h1-3-19" id="h1-3-19" class="i">+	if ((utf32 = strtoul(us, &amp;e, 16)) == ULONG_MAX ||
</a><a href="#h1-3-20" id="h1-3-20" class="i">+	    (*e != &#39;\n&#39; &amp;&amp; *e != &#39;\0&#39;))
</a><a href="#h1-3-21" id="h1-3-21" class="i">+		return;
</a><a href="#h1-3-22" id="h1-3-22" class="i">+
</a><a href="#h1-3-23" id="h1-3-23" class="i">+	ttysend(uc, utf8encode(utf32, uc));
</a><a href="#h1-3-24" id="h1-3-24" class="i">+}
</a><a href="#h1-3-25" id="h1-3-25" class="i">+
</a><a href="#h1-3-26" id="h1-3-26" class="i">+void
</a> toggleprinter(const Arg *arg)
 {
 	term.mode ^= MODE_PRINT;
</pre>
</div>
</body>
</html>
