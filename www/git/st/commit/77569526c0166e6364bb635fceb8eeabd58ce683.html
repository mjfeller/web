<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Remove CEIL macro - st - simple terminal
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="st Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>st</h1><span class="desc">simple terminal
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/77569526c0166e6364bb635fceb8eeabd58ce683.html">77569526c0166e6364bb635fceb8eeabd58ce683</a>
<b>parent</b> <a href="../commit/19d095717f656d844cd9d696d9c921a0821a5ea7.html">19d095717f656d844cd9d696d9c921a0821a5ea7</a>
<b>Author:</b> Roberto E. Vargas Caballero &lt;<a href="mailto:k0ga@shike2.com">k0ga@shike2.com</a>&gt;
<b>Date:</b>   Thu, 26 Jun 2014 12:37:06 +0200

Remove CEIL macro

This macro was not correct in some cases, and it was used only in
one place, where we did&#39;nt get any benefit in performance of in size,
so the macro is removed and ceilf is used instead of it. The only
function needed from math.h is ceilf, so this patch defines the
prototype of it instead of including math.h.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.mk</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">st.c</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
</table></pre><pre>2 files changed, 4 insertions(+), 4 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -14,7 +14,7 @@ X11LIB = /usr/X11R6/lib
</a> INCS = -I. -I/usr/include -I${X11INC} \
        `pkg-config --cflags fontconfig` \
        `pkg-config --cflags freetype2`
<a href="#h0-0-3" id="h0-0-3" class="d">-LIBS = -L/usr/lib -lc -L${X11LIB} -lX11 -lutil -lXext -lXft \
</a><a href="#h0-0-4" id="h0-0-4" class="i">+LIBS = -L/usr/lib -lc -L${X11LIB} -lm -lX11 -lutil -lXext -lXft \
</a>        `pkg-config --libs fontconfig`  \
        `pkg-config --libs freetype2`
 
<b>diff --git a/<a id="h1" href="../file/st.c.html">st.c</a> b/<a href="../file/st.c.html">st.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -77,7 +77,6 @@ char *argv0;
</a> #define ATTRCMP(a, b) ((a).mode != (b).mode || (a).fg != (b).fg || (a).bg != (b).bg)
 #define IS_SET(flag) ((term.mode &amp; (flag)) != 0)
 #define TIMEDIFF(t1, t2) ((t1.tv_sec-t2.tv_sec)*1000 + (t1.tv_nsec-t2.tv_nsec)/1E6)
<a href="#h1-0-3" id="h1-0-3" class="d">-#define CEIL(x) (((x) != (int) (x)) ? (x) + 1 : (x))
</a> #define MODBIT(x, set, bit) ((set) ? ((x) |= (bit)) : ((x) &amp;= ~(bit)))
 
 #define TRUECOLOR(r,g,b) (1 &lt;&lt; 24 | (r) &lt;&lt; 16 | (g) &lt;&lt; 8 | (b))
<a href="#h1-1" id="h1-1" class="h">@@ -2892,6 +2891,7 @@ xloadfonts(char *fontstr, double fontsize) {
</a> 	FcPattern *pattern;
 	FcResult r_sz, r_psz;
 	double fontval;
<a href="#h1-1-3" id="h1-1-3" class="i">+	float ceilf(float);
</a> 
 	if(fontstr[0] == &#39;-&#39;) {
 		pattern = XftXlfdParse(fontstr, False, False);
<a href="#h1-2" id="h1-2" class="h">@@ -2937,8 +2937,8 @@ xloadfonts(char *fontstr, double fontsize) {
</a> 	}
 
 	/* Setting character width and height. */
<a href="#h1-2-3" id="h1-2-3" class="d">-	xw.cw = CEIL(dc.font.width * cwscale);
</a><a href="#h1-2-4" id="h1-2-4" class="d">-	xw.ch = CEIL(dc.font.height * chscale);
</a><a href="#h1-2-5" id="h1-2-5" class="i">+	xw.cw = ceilf(dc.font.width * cwscale);
</a><a href="#h1-2-6" id="h1-2-6" class="i">+	xw.ch = ceilf(dc.font.height * chscale);
</a> 
 	FcPatternDel(pattern, FC_SLANT);
 	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
</pre>
</div>
</body>
</html>
