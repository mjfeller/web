<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>efficient incremental search - dmenu - dynamic menu
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dmenu Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dmenu</h1><span class="desc">dynamic menu
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/43540746077d4fd8ef963b5939934d32d59c9417.html">43540746077d4fd8ef963b5939934d32d59c9417</a>
<b>parent</b> <a href="../commit/4776d6dc6148498a1eab11dd3a15c03736f15d42.html">4776d6dc6148498a1eab11dd3a15c03736f15d42</a>
<b>Author:</b> Connor Lane Smith &lt;<a href="mailto:cls@lubutu.com">cls@lubutu.com</a>&gt;
<b>Date:</b>   Sun, 15 May 2011 16:05:32 +0100

efficient incremental search
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dmenu.c</a></td><td> | </td><td class="num">37</td><td><span class="i">+++++++++++++++++++</span><span class="d">------------------</span></td></tr>
</table></pre><pre>1 file changed, 19 insertions(+), 18 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dmenu.c.html">dmenu.c</a> b/<a href="../file/dmenu.c.html">dmenu.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -27,9 +27,9 @@ static void calcoffsets(void);
</a> static void drawmenu(void);
 static char *fstrstr(const char *s, const char *sub);
 static void grabkeyboard(void);
<a href="#h0-0-3" id="h0-0-3" class="d">-static void insert(const char *s, ssize_t n);
</a><a href="#h0-0-4" id="h0-0-4" class="i">+static void insert(const char *str, ssize_t n);
</a> static void keypress(XKeyEvent *ev);
<a href="#h0-0-6" id="h0-0-6" class="d">-static void match(void);
</a><a href="#h0-0-7" id="h0-0-7" class="i">+static void match(Bool sub);
</a> static size_t nextrune(int incr);
 static void paste(void);
 static void readstdin(void);
<a href="#h0-1" id="h0-1" class="h">@@ -218,14 +218,14 @@ grabkeyboard(void) {
</a> }
 
 void
<a href="#h0-1-3" id="h0-1-3" class="d">-insert(const char *s, ssize_t n) {
</a><a href="#h0-1-4" id="h0-1-4" class="i">+insert(const char *str, ssize_t n) {
</a> 	if(strlen(text) + n &gt; sizeof text - 1)
 		return;
 	memmove(&amp;text[cursor + n], &amp;text[cursor], sizeof text - cursor - MAX(n, 0));
 	if(n &gt; 0)
<a href="#h0-1-9" id="h0-1-9" class="d">-		memcpy(&amp;text[cursor], s, n);
</a><a href="#h0-1-10" id="h0-1-10" class="i">+		memcpy(&amp;text[cursor], str, n);
</a> 	cursor += n;
<a href="#h0-1-12" id="h0-1-12" class="d">-	match();
</a><a href="#h0-1-13" id="h0-1-13" class="i">+	match(n &gt; 0);
</a> }
 
 void
<a href="#h0-2" id="h0-2" class="h">@@ -269,7 +269,7 @@ keypress(XKeyEvent *ev) {
</a> 			break;
 		case XK_k:  /* delete right */
 			text[cursor] = &#39;\0&#39;;
<a href="#h0-2-3" id="h0-2-3" class="d">-			match();
</a><a href="#h0-2-4" id="h0-2-4" class="i">+			match(False);
</a> 			break;
 		case XK_n:
 			ksym = XK_Down;
<a href="#h0-3" id="h0-3" class="h">@@ -375,30 +375,31 @@ keypress(XKeyEvent *ev) {
</a> 			return;
 		strncpy(text, sel-&gt;text, sizeof text);
 		cursor = strlen(text);
<a href="#h0-3-3" id="h0-3-3" class="d">-		match();
</a><a href="#h0-3-4" id="h0-3-4" class="i">+		match(True);
</a> 		break;
 	}
 	drawmenu();
 }
 
 void
<a href="#h0-3-11" id="h0-3-11" class="d">-match(void) {
</a><a href="#h0-3-12" id="h0-3-12" class="i">+match(Bool sub) {
</a> 	size_t len = strlen(text);
<a href="#h0-3-14" id="h0-3-14" class="d">-	Item *item, *lexact, *lprefix, *lsubstr, *exactend, *prefixend, *substrend;
</a><a href="#h0-3-15" id="h0-3-15" class="i">+	Item *lexact, *lprefix, *lsubstr, *exactend, *prefixend, *substrend;
</a><a href="#h0-3-16" id="h0-3-16" class="i">+	Item *item, *next = NULL;
</a> 
<a href="#h0-3-18" id="h0-3-18" class="d">-	matches = lexact = lprefix = lsubstr = matchend = exactend = prefixend = substrend = NULL;
</a><a href="#h0-3-19" id="h0-3-19" class="d">-	for(item = items; item &amp;&amp; item-&gt;text; item++)
</a><a href="#h0-3-20" id="h0-3-20" class="i">+	lexact = lprefix = lsubstr = exactend = prefixend = substrend = NULL;
</a><a href="#h0-3-21" id="h0-3-21" class="i">+	for(item = sub ? matches : items; item &amp;&amp; item-&gt;text; item = next) {
</a><a href="#h0-3-22" id="h0-3-22" class="i">+		next = sub ? item-&gt;right : item + 1;
</a> 		if(!fstrncmp(text, item-&gt;text, len + 1))
 			appenditem(item, &amp;lexact, &amp;exactend);
 		else if(!fstrncmp(text, item-&gt;text, len))
 			appenditem(item, &amp;lprefix, &amp;prefixend);
 		else if(fstrstr(item-&gt;text, text))
 			appenditem(item, &amp;lsubstr, &amp;substrend);
<a href="#h0-3-29" id="h0-3-29" class="d">-
</a><a href="#h0-3-30" id="h0-3-30" class="d">-	if(lexact) {
</a><a href="#h0-3-31" id="h0-3-31" class="d">-		matches = lexact;
</a><a href="#h0-3-32" id="h0-3-32" class="d">-		matchend = exactend;
</a> 	}
<a href="#h0-3-34" id="h0-3-34" class="i">+	matches = lexact;
</a><a href="#h0-3-35" id="h0-3-35" class="i">+	matchend = exactend;
</a><a href="#h0-3-36" id="h0-3-36" class="i">+
</a> 	if(lprefix) {
 		if(matchend) {
 			matchend-&gt;right = lprefix;
<a href="#h0-4" id="h0-4" class="h">@@ -498,8 +499,8 @@ setup(void) {
</a> 
 	normcol[ColBG] = getcolor(dc, normbgcolor);
 	normcol[ColFG] = getcolor(dc, normfgcolor);
<a href="#h0-4-3" id="h0-4-3" class="d">-	selcol[ColBG] = getcolor(dc, selbgcolor);
</a><a href="#h0-4-4" id="h0-4-4" class="d">-	selcol[ColFG] = getcolor(dc, selfgcolor);
</a><a href="#h0-4-5" id="h0-4-5" class="i">+	selcol[ColBG]  = getcolor(dc, selbgcolor);
</a><a href="#h0-4-6" id="h0-4-6" class="i">+	selcol[ColFG]  = getcolor(dc, selfgcolor);
</a> 
 	utf8 = XInternAtom(dc-&gt;dpy, &quot;UTF8_STRING&quot;, False);
 
<a href="#h0-5" id="h0-5" class="h">@@ -532,7 +533,7 @@ setup(void) {
</a> 	}
 	inputw = MIN(inputw, mw/3);
 	promptw = prompt ? textw(dc, prompt) : 0;
<a href="#h0-5-3" id="h0-5-3" class="d">-	match();
</a><a href="#h0-5-4" id="h0-5-4" class="i">+	match(False);
</a> 
 	/* menu window */
 	wa.override_redirect = True;
</pre>
</div>
</body>
</html>
