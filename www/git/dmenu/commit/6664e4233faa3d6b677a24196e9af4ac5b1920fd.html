<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>merge stest -&gt; default - dmenu - dynamic menu
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dmenu Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dmenu</h1><span class="desc">dynamic menu
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/6664e4233faa3d6b677a24196e9af4ac5b1920fd.html">6664e4233faa3d6b677a24196e9af4ac5b1920fd</a>
<b>parent</b> <a href="../commit/26c78cd95291d980f8978113cd6daa9841553c93.html">26c78cd95291d980f8978113cd6daa9841553c93</a>
<b>Author:</b> Connor Lane Smith &lt;<a href="mailto:cls@lubutu.com">cls@lubutu.com</a>&gt;
<b>Date:</b>   Mon, 19 Dec 2011 16:52:48 +0100

merge stest -&gt; default
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Makefile</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.mk</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">dmenu_run</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">lsx.1</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">lsx.c</a></td><td> | </td><td class="num">43</td><td><span class="i"></span><span class="d">-------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">stest.1</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">stest.c</a></td><td> | </td><td class="num">84</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>7 files changed, 186 insertions(+), 69 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Makefile.html">Makefile</a> b/<a href="../file/Makefile.html">Makefile</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3,10 +3,10 @@
</a> 
 include config.mk
 
<a href="#h0-0-3" id="h0-0-3" class="d">-SRC = dmenu.c draw.c lsx.c
</a><a href="#h0-0-4" id="h0-0-4" class="i">+SRC = dmenu.c draw.c stest.c
</a> OBJ = ${SRC:.c=.o}
 
<a href="#h0-0-7" id="h0-0-7" class="d">-all: options dmenu lsx
</a><a href="#h0-0-8" id="h0-0-8" class="i">+all: options dmenu stest
</a> 
 options:
 	@echo dmenu build options:
<a href="#h0-1" id="h0-1" class="h">@@ -24,18 +24,18 @@ dmenu: dmenu.o draw.o
</a> 	@echo CC -o $@
 	@${CC} -o $@ dmenu.o draw.o ${LDFLAGS}
 
<a href="#h0-1-3" id="h0-1-3" class="d">-lsx: lsx.o
</a><a href="#h0-1-4" id="h0-1-4" class="i">+stest: stest.o
</a> 	@echo CC -o $@
<a href="#h0-1-6" id="h0-1-6" class="d">-	@${CC} -o $@ lsx.o ${LDFLAGS}
</a><a href="#h0-1-7" id="h0-1-7" class="i">+	@${CC} -o $@ stest.o ${LDFLAGS}
</a> 
 clean:
 	@echo cleaning
<a href="#h0-1-11" id="h0-1-11" class="d">-	@rm -f dmenu lsx ${OBJ} dmenu-${VERSION}.tar.gz
</a><a href="#h0-1-12" id="h0-1-12" class="i">+	@rm -f dmenu stest ${OBJ} dmenu-${VERSION}.tar.gz
</a> 
 dist: clean
 	@echo creating dist tarball
 	@mkdir -p dmenu-${VERSION}
<a href="#h0-1-17" id="h0-1-17" class="d">-	@cp LICENSE Makefile README config.mk dmenu.1 draw.h dmenu_run lsx.1 ${SRC} dmenu-${VERSION}
</a><a href="#h0-1-18" id="h0-1-18" class="i">+	@cp LICENSE Makefile README config.mk dmenu.1 draw.h dmenu_run stest.1 ${SRC} dmenu-${VERSION}
</a> 	@tar -cf dmenu-${VERSION}.tar dmenu-${VERSION}
 	@gzip dmenu-${VERSION}.tar
 	@rm -rf dmenu-${VERSION}
<a href="#h0-2" id="h0-2" class="h">@@ -43,24 +43,24 @@ dist: clean
</a> install: all
 	@echo installing executables to ${DESTDIR}${PREFIX}/bin
 	@mkdir -p ${DESTDIR}${PREFIX}/bin
<a href="#h0-2-3" id="h0-2-3" class="d">-	@cp -f dmenu dmenu_run lsx ${DESTDIR}${PREFIX}/bin
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	@cp -f dmenu dmenu_run stest ${DESTDIR}${PREFIX}/bin
</a> 	@chmod 755 ${DESTDIR}${PREFIX}/bin/dmenu
 	@chmod 755 ${DESTDIR}${PREFIX}/bin/dmenu_run
<a href="#h0-2-7" id="h0-2-7" class="d">-	@chmod 755 ${DESTDIR}${PREFIX}/bin/lsx
</a><a href="#h0-2-8" id="h0-2-8" class="i">+	@chmod 755 ${DESTDIR}${PREFIX}/bin/stest
</a> 	@echo installing manual pages to ${DESTDIR}${MANPREFIX}/man1
 	@mkdir -p ${DESTDIR}${MANPREFIX}/man1
 	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt; dmenu.1 &gt; ${DESTDIR}${MANPREFIX}/man1/dmenu.1
<a href="#h0-2-12" id="h0-2-12" class="d">-	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt; lsx.1 &gt; ${DESTDIR}${MANPREFIX}/man1/lsx.1
</a><a href="#h0-2-13" id="h0-2-13" class="i">+	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt; stest.1 &gt; ${DESTDIR}${MANPREFIX}/man1/stest.1
</a> 	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/dmenu.1
<a href="#h0-2-15" id="h0-2-15" class="d">-	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/lsx.1
</a><a href="#h0-2-16" id="h0-2-16" class="i">+	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/stest.1
</a> 
 uninstall:
 	@echo removing executables from ${DESTDIR}${PREFIX}/bin
 	@rm -f ${DESTDIR}${PREFIX}/bin/dmenu
 	@rm -f ${DESTDIR}${PREFIX}/bin/dmenu_run
<a href="#h0-2-22" id="h0-2-22" class="d">-	@rm -f ${DESTDIR}${PREFIX}/bin/lsx
</a><a href="#h0-2-23" id="h0-2-23" class="i">+	@rm -f ${DESTDIR}${PREFIX}/bin/stest
</a> 	@echo removing manual page from ${DESTDIR}${MANPREFIX}/man1
 	@rm -f ${DESTDIR}${MANPREFIX}/man1/dmenu.1
<a href="#h0-2-26" id="h0-2-26" class="d">-	@rm -f ${DESTDIR}${MANPREFIX}/man1/lsx.1
</a><a href="#h0-2-27" id="h0-2-27" class="i">+	@rm -f ${DESTDIR}${MANPREFIX}/man1/stest.1
</a> 
 .PHONY: all options clean dist install uninstall
<b>diff --git a/<a id="h1" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -17,7 +17,7 @@ INCS = -I${X11INC}
</a> LIBS = -L${X11LIB} -lX11 ${XINERAMALIBS}
 
 # flags
<a href="#h1-0-3" id="h1-0-3" class="d">-CPPFLAGS = -D_BSD_SOURCE -DVERSION=\&quot;${VERSION}\&quot; ${XINERAMAFLAGS}
</a><a href="#h1-0-4" id="h1-0-4" class="i">+CPPFLAGS = -D_BSD_SOURCE -D_POSIX_C_SOURCE=2 -DVERSION=\&quot;${VERSION}\&quot; ${XINERAMAFLAGS}
</a> CFLAGS   = -ansi -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
 LDFLAGS  = -s ${LIBS}
 
<b>diff --git a/<a id="h2" href="../file/dmenu_run.html">dmenu_run</a> b/<a href="../file/dmenu_run.html">dmenu_run</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -7,8 +7,8 @@ else
</a> fi
 (
 	IFS=:
<a href="#h2-0-3" id="h2-0-3" class="d">-	if [ &quot;`ls -dt $PATH &quot;$cache&quot; | head -n 1`&quot; != &quot;$cache&quot; ]; then
</a><a href="#h2-0-4" id="h2-0-4" class="d">-		lsx $PATH | sort -u | tee &quot;$cache&quot; | dmenu &quot;$@&quot;
</a><a href="#h2-0-5" id="h2-0-5" class="i">+	if stest -dqr -n &quot;$cache&quot; $PATH; then
</a><a href="#h2-0-6" id="h2-0-6" class="i">+		stest -flx $PATH | sort -u | tee &quot;$cache&quot; | dmenu &quot;$@&quot;
</a> 	else
 		dmenu &quot;$@&quot; &lt; &quot;$cache&quot;
 	fi
<b>diff --git a/<a id="h3" href="../file/lsx.1.html">lsx.1</a> b/<a href="../file/lsx.1.html">lsx.1</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,11 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-.TH LSX 1 dmenu\-VERSION
</a><a href="#h3-0-1" id="h3-0-1" class="d">-.SH NAME
</a><a href="#h3-0-2" id="h3-0-2" class="d">-lsx \- list executables
</a><a href="#h3-0-3" id="h3-0-3" class="d">-.SH SYNOPSIS
</a><a href="#h3-0-4" id="h3-0-4" class="d">-.B lsx
</a><a href="#h3-0-5" id="h3-0-5" class="d">-.RI [ directory ...]
</a><a href="#h3-0-6" id="h3-0-6" class="d">-.SH DESCRIPTION
</a><a href="#h3-0-7" id="h3-0-7" class="d">-.B lsx
</a><a href="#h3-0-8" id="h3-0-8" class="d">-lists the executables in each
</a><a href="#h3-0-9" id="h3-0-9" class="d">-.IR directory .
</a><a href="#h3-0-10" id="h3-0-10" class="d">-If none are given the current working directory is used.
</a><b>diff --git a/<a id="h4" href="../file/lsx.c.html">lsx.c</a> b/<a href="../file/lsx.c.html">lsx.c</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,43 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-/* See LICENSE file for copyright and license details. */
</a><a href="#h4-0-1" id="h4-0-1" class="d">-#include &lt;dirent.h&gt;
</a><a href="#h4-0-2" id="h4-0-2" class="d">-#include &lt;errno.h&gt;
</a><a href="#h4-0-3" id="h4-0-3" class="d">-#include &lt;limits.h&gt;
</a><a href="#h4-0-4" id="h4-0-4" class="d">-#include &lt;stdio.h&gt;
</a><a href="#h4-0-5" id="h4-0-5" class="d">-#include &lt;stdlib.h&gt;
</a><a href="#h4-0-6" id="h4-0-6" class="d">-#include &lt;unistd.h&gt;
</a><a href="#h4-0-7" id="h4-0-7" class="d">-#include &lt;sys/stat.h&gt;
</a><a href="#h4-0-8" id="h4-0-8" class="d">-
</a><a href="#h4-0-9" id="h4-0-9" class="d">-static void lsx(const char *dir);
</a><a href="#h4-0-10" id="h4-0-10" class="d">-
</a><a href="#h4-0-11" id="h4-0-11" class="d">-static int status = EXIT_SUCCESS;
</a><a href="#h4-0-12" id="h4-0-12" class="d">-
</a><a href="#h4-0-13" id="h4-0-13" class="d">-int
</a><a href="#h4-0-14" id="h4-0-14" class="d">-main(int argc, char *argv[]) {
</a><a href="#h4-0-15" id="h4-0-15" class="d">-	int i;
</a><a href="#h4-0-16" id="h4-0-16" class="d">-
</a><a href="#h4-0-17" id="h4-0-17" class="d">-	if(argc &lt; 2)
</a><a href="#h4-0-18" id="h4-0-18" class="d">-		lsx(&quot;.&quot;);
</a><a href="#h4-0-19" id="h4-0-19" class="d">-	else for(i = 1; i &lt; argc; i++)
</a><a href="#h4-0-20" id="h4-0-20" class="d">-		lsx(argv[i]);
</a><a href="#h4-0-21" id="h4-0-21" class="d">-	return status;
</a><a href="#h4-0-22" id="h4-0-22" class="d">-}
</a><a href="#h4-0-23" id="h4-0-23" class="d">-
</a><a href="#h4-0-24" id="h4-0-24" class="d">-void
</a><a href="#h4-0-25" id="h4-0-25" class="d">-lsx(const char *dir) {
</a><a href="#h4-0-26" id="h4-0-26" class="d">-	char buf[PATH_MAX];
</a><a href="#h4-0-27" id="h4-0-27" class="d">-	struct dirent *d;
</a><a href="#h4-0-28" id="h4-0-28" class="d">-	struct stat st;
</a><a href="#h4-0-29" id="h4-0-29" class="d">-	DIR *dp;
</a><a href="#h4-0-30" id="h4-0-30" class="d">-
</a><a href="#h4-0-31" id="h4-0-31" class="d">-	for(dp = opendir(dir); dp &amp;&amp; (d = readdir(dp)); errno = 0)
</a><a href="#h4-0-32" id="h4-0-32" class="d">-		if(snprintf(buf, sizeof buf, &quot;%s/%s&quot;, dir, d-&gt;d_name) &lt; (int)sizeof buf
</a><a href="#h4-0-33" id="h4-0-33" class="d">-		&amp;&amp; access(buf, X_OK) == 0 &amp;&amp; stat(buf, &amp;st) == 0 &amp;&amp; S_ISREG(st.st_mode))
</a><a href="#h4-0-34" id="h4-0-34" class="d">-			puts(d-&gt;d_name);
</a><a href="#h4-0-35" id="h4-0-35" class="d">-
</a><a href="#h4-0-36" id="h4-0-36" class="d">-	if(errno != 0) {
</a><a href="#h4-0-37" id="h4-0-37" class="d">-		status = EXIT_FAILURE;
</a><a href="#h4-0-38" id="h4-0-38" class="d">-		perror(dir);
</a><a href="#h4-0-39" id="h4-0-39" class="d">-	}
</a><a href="#h4-0-40" id="h4-0-40" class="d">-	if(dp)
</a><a href="#h4-0-41" id="h4-0-41" class="d">-		closedir(dp);
</a><a href="#h4-0-42" id="h4-0-42" class="d">-}
</a><b>diff --git a/<a id="h5" href="../file/stest.1.html">stest.1</a> b/<a href="../file/stest.1.html">stest.1</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,87 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+.TH STEST 1 dmenu\-VERSION
</a><a href="#h5-0-1" id="h5-0-1" class="i">+.SH NAME
</a><a href="#h5-0-2" id="h5-0-2" class="i">+stest \- filter a list of files by properties
</a><a href="#h5-0-3" id="h5-0-3" class="i">+.SH SYNOPSIS
</a><a href="#h5-0-4" id="h5-0-4" class="i">+.B stest
</a><a href="#h5-0-5" id="h5-0-5" class="i">+.RB [ -abcdefghlpqrsuwx ]
</a><a href="#h5-0-6" id="h5-0-6" class="i">+.RB [ -n
</a><a href="#h5-0-7" id="h5-0-7" class="i">+.IR file ]
</a><a href="#h5-0-8" id="h5-0-8" class="i">+.RB [ -o
</a><a href="#h5-0-9" id="h5-0-9" class="i">+.IR file ]
</a><a href="#h5-0-10" id="h5-0-10" class="i">+.RI [ file ...]
</a><a href="#h5-0-11" id="h5-0-11" class="i">+.SH DESCRIPTION
</a><a href="#h5-0-12" id="h5-0-12" class="i">+.B stest
</a><a href="#h5-0-13" id="h5-0-13" class="i">+takes a list of files and filters by the files&#39; properties, analogous to
</a><a href="#h5-0-14" id="h5-0-14" class="i">+.IR test (1).
</a><a href="#h5-0-15" id="h5-0-15" class="i">+Files which pass all tests are printed to stdout. If no files are given, stest
</a><a href="#h5-0-16" id="h5-0-16" class="i">+reads files from stdin.
</a><a href="#h5-0-17" id="h5-0-17" class="i">+.SH OPTIONS
</a><a href="#h5-0-18" id="h5-0-18" class="i">+.TP
</a><a href="#h5-0-19" id="h5-0-19" class="i">+.B \-a
</a><a href="#h5-0-20" id="h5-0-20" class="i">+Test hidden files.
</a><a href="#h5-0-21" id="h5-0-21" class="i">+.TP
</a><a href="#h5-0-22" id="h5-0-22" class="i">+.B \-b
</a><a href="#h5-0-23" id="h5-0-23" class="i">+Test that files are block specials.
</a><a href="#h5-0-24" id="h5-0-24" class="i">+.TP
</a><a href="#h5-0-25" id="h5-0-25" class="i">+.B \-c
</a><a href="#h5-0-26" id="h5-0-26" class="i">+Test that files are character specials.
</a><a href="#h5-0-27" id="h5-0-27" class="i">+.TP
</a><a href="#h5-0-28" id="h5-0-28" class="i">+.B \-d
</a><a href="#h5-0-29" id="h5-0-29" class="i">+Test that files are directories.
</a><a href="#h5-0-30" id="h5-0-30" class="i">+.TP
</a><a href="#h5-0-31" id="h5-0-31" class="i">+.B \-e
</a><a href="#h5-0-32" id="h5-0-32" class="i">+Test that files exist.
</a><a href="#h5-0-33" id="h5-0-33" class="i">+.TP
</a><a href="#h5-0-34" id="h5-0-34" class="i">+.B \-f
</a><a href="#h5-0-35" id="h5-0-35" class="i">+Test that files are regular files.
</a><a href="#h5-0-36" id="h5-0-36" class="i">+.TP
</a><a href="#h5-0-37" id="h5-0-37" class="i">+.B \-g
</a><a href="#h5-0-38" id="h5-0-38" class="i">+Test that files have their set-group-ID flag set.
</a><a href="#h5-0-39" id="h5-0-39" class="i">+.TP
</a><a href="#h5-0-40" id="h5-0-40" class="i">+.B \-h
</a><a href="#h5-0-41" id="h5-0-41" class="i">+Test that files are symbolic links.
</a><a href="#h5-0-42" id="h5-0-42" class="i">+.TP
</a><a href="#h5-0-43" id="h5-0-43" class="i">+.B \-l
</a><a href="#h5-0-44" id="h5-0-44" class="i">+Test the contents of a directory given as an argument.
</a><a href="#h5-0-45" id="h5-0-45" class="i">+.TP
</a><a href="#h5-0-46" id="h5-0-46" class="i">+.BI \-n &quot; file&quot;
</a><a href="#h5-0-47" id="h5-0-47" class="i">+Test that files are newer than
</a><a href="#h5-0-48" id="h5-0-48" class="i">+.IR file .
</a><a href="#h5-0-49" id="h5-0-49" class="i">+.TP
</a><a href="#h5-0-50" id="h5-0-50" class="i">+.BI \-o &quot; file&quot;
</a><a href="#h5-0-51" id="h5-0-51" class="i">+Test that files are older than
</a><a href="#h5-0-52" id="h5-0-52" class="i">+.IR file .
</a><a href="#h5-0-53" id="h5-0-53" class="i">+.TP
</a><a href="#h5-0-54" id="h5-0-54" class="i">+.B \-p
</a><a href="#h5-0-55" id="h5-0-55" class="i">+Test that files are named pipes.
</a><a href="#h5-0-56" id="h5-0-56" class="i">+.TP
</a><a href="#h5-0-57" id="h5-0-57" class="i">+.B \-q
</a><a href="#h5-0-58" id="h5-0-58" class="i">+No files are printed, only the exit status is returned.
</a><a href="#h5-0-59" id="h5-0-59" class="i">+.TP
</a><a href="#h5-0-60" id="h5-0-60" class="i">+.B \-r
</a><a href="#h5-0-61" id="h5-0-61" class="i">+Test that files are readable.
</a><a href="#h5-0-62" id="h5-0-62" class="i">+.TP
</a><a href="#h5-0-63" id="h5-0-63" class="i">+.B \-s
</a><a href="#h5-0-64" id="h5-0-64" class="i">+Test that files are not empty.
</a><a href="#h5-0-65" id="h5-0-65" class="i">+.TP
</a><a href="#h5-0-66" id="h5-0-66" class="i">+.B \-u
</a><a href="#h5-0-67" id="h5-0-67" class="i">+Test that files have their set-user-ID flag set.
</a><a href="#h5-0-68" id="h5-0-68" class="i">+.TP
</a><a href="#h5-0-69" id="h5-0-69" class="i">+.B \-w
</a><a href="#h5-0-70" id="h5-0-70" class="i">+Test that files are writable.
</a><a href="#h5-0-71" id="h5-0-71" class="i">+.TP
</a><a href="#h5-0-72" id="h5-0-72" class="i">+.B \-x
</a><a href="#h5-0-73" id="h5-0-73" class="i">+Test that files are executable.
</a><a href="#h5-0-74" id="h5-0-74" class="i">+.SH EXIT STATUS
</a><a href="#h5-0-75" id="h5-0-75" class="i">+.TP
</a><a href="#h5-0-76" id="h5-0-76" class="i">+.B 0
</a><a href="#h5-0-77" id="h5-0-77" class="i">+At least one file passed all tests.
</a><a href="#h5-0-78" id="h5-0-78" class="i">+.TP
</a><a href="#h5-0-79" id="h5-0-79" class="i">+.B 1
</a><a href="#h5-0-80" id="h5-0-80" class="i">+No files passed all tests.
</a><a href="#h5-0-81" id="h5-0-81" class="i">+.TP
</a><a href="#h5-0-82" id="h5-0-82" class="i">+.B 2
</a><a href="#h5-0-83" id="h5-0-83" class="i">+An error occurred.
</a><a href="#h5-0-84" id="h5-0-84" class="i">+.SH SEE ALSO
</a><a href="#h5-0-85" id="h5-0-85" class="i">+.IR dmenu (1),
</a><a href="#h5-0-86" id="h5-0-86" class="i">+.IR test (1)
</a><b>diff --git a/<a id="h6" href="../file/stest.c.html">stest.c</a> b/<a href="../file/stest.c.html">stest.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,84 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h6-0-1" id="h6-0-1" class="i">+#include &lt;dirent.h&gt;
</a><a href="#h6-0-2" id="h6-0-2" class="i">+#include &lt;stdbool.h&gt;
</a><a href="#h6-0-3" id="h6-0-3" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h6-0-5" id="h6-0-5" class="i">+#include &lt;string.h&gt;
</a><a href="#h6-0-6" id="h6-0-6" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h6-0-7" id="h6-0-7" class="i">+#include &lt;sys/stat.h&gt;
</a><a href="#h6-0-8" id="h6-0-8" class="i">+
</a><a href="#h6-0-9" id="h6-0-9" class="i">+#define FLAG(x)  (flag[(x)-&#39;a&#39;])
</a><a href="#h6-0-10" id="h6-0-10" class="i">+
</a><a href="#h6-0-11" id="h6-0-11" class="i">+static void test(const char *, const char *);
</a><a href="#h6-0-12" id="h6-0-12" class="i">+
</a><a href="#h6-0-13" id="h6-0-13" class="i">+static bool match = false;
</a><a href="#h6-0-14" id="h6-0-14" class="i">+static bool flag[26];
</a><a href="#h6-0-15" id="h6-0-15" class="i">+static struct stat old, new;
</a><a href="#h6-0-16" id="h6-0-16" class="i">+
</a><a href="#h6-0-17" id="h6-0-17" class="i">+int
</a><a href="#h6-0-18" id="h6-0-18" class="i">+main(int argc, char *argv[]) {
</a><a href="#h6-0-19" id="h6-0-19" class="i">+	struct dirent *d;
</a><a href="#h6-0-20" id="h6-0-20" class="i">+	char buf[BUFSIZ], *p;
</a><a href="#h6-0-21" id="h6-0-21" class="i">+	DIR *dir;
</a><a href="#h6-0-22" id="h6-0-22" class="i">+	int opt;
</a><a href="#h6-0-23" id="h6-0-23" class="i">+
</a><a href="#h6-0-24" id="h6-0-24" class="i">+	while((opt = getopt(argc, argv, &quot;abcdefghln:o:pqrsuwx&quot;)) != -1)
</a><a href="#h6-0-25" id="h6-0-25" class="i">+		switch(opt) {
</a><a href="#h6-0-26" id="h6-0-26" class="i">+		case &#39;n&#39;: /* newer than file */
</a><a href="#h6-0-27" id="h6-0-27" class="i">+		case &#39;o&#39;: /* older than file */
</a><a href="#h6-0-28" id="h6-0-28" class="i">+			if(!(FLAG(opt) = !stat(optarg, (opt == &#39;n&#39; ? &amp;new : &amp;old))))
</a><a href="#h6-0-29" id="h6-0-29" class="i">+				perror(optarg);
</a><a href="#h6-0-30" id="h6-0-30" class="i">+			break;
</a><a href="#h6-0-31" id="h6-0-31" class="i">+		default:  /* miscellaneous operators */
</a><a href="#h6-0-32" id="h6-0-32" class="i">+			FLAG(opt) = true;
</a><a href="#h6-0-33" id="h6-0-33" class="i">+			break;
</a><a href="#h6-0-34" id="h6-0-34" class="i">+		case &#39;?&#39;: /* error: unknown flag */
</a><a href="#h6-0-35" id="h6-0-35" class="i">+			fprintf(stderr, &quot;usage: %s [-abcdefghlpqrsuwx] [-n file] [-o file] [file...]\n&quot;, argv[0]);
</a><a href="#h6-0-36" id="h6-0-36" class="i">+			exit(2);
</a><a href="#h6-0-37" id="h6-0-37" class="i">+		}
</a><a href="#h6-0-38" id="h6-0-38" class="i">+	if(optind == argc)
</a><a href="#h6-0-39" id="h6-0-39" class="i">+		while(fgets(buf, sizeof buf, stdin)) {
</a><a href="#h6-0-40" id="h6-0-40" class="i">+			if((p = strchr(buf, &#39;\n&#39;)))
</a><a href="#h6-0-41" id="h6-0-41" class="i">+				*p = &#39;\0&#39;;
</a><a href="#h6-0-42" id="h6-0-42" class="i">+			test(buf, buf);
</a><a href="#h6-0-43" id="h6-0-43" class="i">+		}
</a><a href="#h6-0-44" id="h6-0-44" class="i">+	for(; optind &lt; argc; optind++)
</a><a href="#h6-0-45" id="h6-0-45" class="i">+		if(FLAG(&#39;l&#39;) &amp;&amp; (dir = opendir(argv[optind]))) {
</a><a href="#h6-0-46" id="h6-0-46" class="i">+			/* test directory contents */
</a><a href="#h6-0-47" id="h6-0-47" class="i">+			while((d = readdir(dir)))
</a><a href="#h6-0-48" id="h6-0-48" class="i">+				if(snprintf(buf, sizeof buf, &quot;%s/%s&quot;, argv[optind], d-&gt;d_name) &lt; sizeof buf)
</a><a href="#h6-0-49" id="h6-0-49" class="i">+					test(buf, d-&gt;d_name);
</a><a href="#h6-0-50" id="h6-0-50" class="i">+			closedir(dir);
</a><a href="#h6-0-51" id="h6-0-51" class="i">+		}
</a><a href="#h6-0-52" id="h6-0-52" class="i">+		else
</a><a href="#h6-0-53" id="h6-0-53" class="i">+			test(argv[optind], argv[optind]);
</a><a href="#h6-0-54" id="h6-0-54" class="i">+
</a><a href="#h6-0-55" id="h6-0-55" class="i">+	return match ? 0 : 1;
</a><a href="#h6-0-56" id="h6-0-56" class="i">+}
</a><a href="#h6-0-57" id="h6-0-57" class="i">+
</a><a href="#h6-0-58" id="h6-0-58" class="i">+void
</a><a href="#h6-0-59" id="h6-0-59" class="i">+test(const char *path, const char *name) {
</a><a href="#h6-0-60" id="h6-0-60" class="i">+	struct stat st, ln;
</a><a href="#h6-0-61" id="h6-0-61" class="i">+
</a><a href="#h6-0-62" id="h6-0-62" class="i">+	if(!stat(path, &amp;st) &amp;&amp; (FLAG(&#39;a&#39;) || name[0] != &#39;.&#39;)          /* hidden files      */
</a><a href="#h6-0-63" id="h6-0-63" class="i">+	&amp;&amp; (!FLAG(&#39;b&#39;) || S_ISBLK(st.st_mode))                        /* block special     */
</a><a href="#h6-0-64" id="h6-0-64" class="i">+	&amp;&amp; (!FLAG(&#39;c&#39;) || S_ISCHR(st.st_mode))                        /* character special */
</a><a href="#h6-0-65" id="h6-0-65" class="i">+	&amp;&amp; (!FLAG(&#39;d&#39;) || S_ISDIR(st.st_mode))                        /* directory         */
</a><a href="#h6-0-66" id="h6-0-66" class="i">+	&amp;&amp; (!FLAG(&#39;e&#39;) || access(path, F_OK) == 0)                    /* exists            */
</a><a href="#h6-0-67" id="h6-0-67" class="i">+	&amp;&amp; (!FLAG(&#39;f&#39;) || S_ISREG(st.st_mode))                        /* regular file      */
</a><a href="#h6-0-68" id="h6-0-68" class="i">+	&amp;&amp; (!FLAG(&#39;g&#39;) || st.st_mode &amp; S_ISGID)                       /* set-group-id flag */
</a><a href="#h6-0-69" id="h6-0-69" class="i">+	&amp;&amp; (!FLAG(&#39;h&#39;) || (!lstat(path, &amp;ln) &amp;&amp; S_ISLNK(ln.st_mode))) /* symbolic link     */
</a><a href="#h6-0-70" id="h6-0-70" class="i">+	&amp;&amp; (!FLAG(&#39;n&#39;) || st.st_mtime &gt; new.st_mtime)                 /* newer than file   */
</a><a href="#h6-0-71" id="h6-0-71" class="i">+	&amp;&amp; (!FLAG(&#39;o&#39;) || st.st_mtime &lt; old.st_mtime)                 /* older than file   */
</a><a href="#h6-0-72" id="h6-0-72" class="i">+	&amp;&amp; (!FLAG(&#39;p&#39;) || S_ISFIFO(st.st_mode))                       /* named pipe        */
</a><a href="#h6-0-73" id="h6-0-73" class="i">+	&amp;&amp; (!FLAG(&#39;r&#39;) || access(path, R_OK) == 0)                    /* readable          */
</a><a href="#h6-0-74" id="h6-0-74" class="i">+	&amp;&amp; (!FLAG(&#39;s&#39;) || st.st_size &gt; 0)                             /* not empty         */
</a><a href="#h6-0-75" id="h6-0-75" class="i">+	&amp;&amp; (!FLAG(&#39;u&#39;) || st.st_mode &amp; S_ISUID)                       /* set-user-id flag  */
</a><a href="#h6-0-76" id="h6-0-76" class="i">+	&amp;&amp; (!FLAG(&#39;w&#39;) || access(path, W_OK) == 0)                    /* writable          */
</a><a href="#h6-0-77" id="h6-0-77" class="i">+	&amp;&amp; (!FLAG(&#39;x&#39;) || access(path, X_OK) == 0)) {                 /* executable        */
</a><a href="#h6-0-78" id="h6-0-78" class="i">+		if(FLAG(&#39;q&#39;))
</a><a href="#h6-0-79" id="h6-0-79" class="i">+			exit(0);
</a><a href="#h6-0-80" id="h6-0-80" class="i">+		match = true;
</a><a href="#h6-0-81" id="h6-0-81" class="i">+		puts(name);
</a><a href="#h6-0-82" id="h6-0-82" class="i">+	}
</a><a href="#h6-0-83" id="h6-0-83" class="i">+}
</a></pre>
</div>
</body>
</html>
