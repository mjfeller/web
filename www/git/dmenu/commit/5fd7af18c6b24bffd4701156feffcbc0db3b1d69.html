<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>removed useless newlines - dmenu - dynamic menu
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dmenu Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="/logo.png" alt="" width="32" height="32" /></a></td><td><h1>dmenu</h1><span class="desc">dynamic menu
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/5fd7af18c6b24bffd4701156feffcbc0db3b1d69.html">5fd7af18c6b24bffd4701156feffcbc0db3b1d69</a>
<b>parent</b> <a href="../commit/02238725f6b580ea8b6356377e359f933c5ca720.html">02238725f6b580ea8b6356377e359f933c5ca720</a>
<b>Author:</b> Anselm R. Garbe &lt;<a href="mailto:arg@10kloc.org">arg@10kloc.org</a>&gt;
<b>Date:</b>   Fri,  6 Oct 2006 11:52:57 +0200

removed useless newlines
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">dmenu.h</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">draw.c</a></td><td> | </td><td class="num">10</td><td><span class="i">+</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">main.c</a></td><td> | </td><td class="num">27</td><td><span class="i">+++</span><span class="d">------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">util.c</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
</table></pre><pre>4 files changed, 8 insertions(+), 37 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dmenu.h.html">dmenu.h</a> b/<a href="../file/dmenu.h.html">dmenu.h</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,5 +1,4 @@
</a><a href="#h0-0-0" id="h0-0-0" class="d">-/*
</a><a href="#h0-0-1" id="h0-0-1" class="d">- * (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h0-0-2" id="h0-0-2" class="i">+/* (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a>  * See LICENSE file for license details.
  */
 
<b>diff --git a/<a id="h1" href="../file/draw.c.html">draw.c</a> b/<a href="../file/draw.c.html">draw.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,5 +1,4 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-/*
</a><a href="#h1-0-1" id="h1-0-1" class="d">- * (C)opyright MMIV-MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h1-0-2" id="h1-0-2" class="i">+/* (C)opyright MMIV-MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a>  * See LICENSE file for license details.
  */
 #include &quot;dmenu.h&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -32,21 +31,17 @@ drawtext(const char *text, unsigned long col[ColLast]) {
</a> 
 	XSetForeground(dpy, dc.gc, col[ColBG]);
 	XFillRectangles(dpy, dc.drawable, dc.gc, &amp;r, 1);
<a href="#h1-1-3" id="h1-1-3" class="d">-
</a> 	if(!text)
 		return;
<a href="#h1-1-6" id="h1-1-6" class="d">-
</a> 	w = 0;
 	olen = len = strlen(text);
 	if(len &gt;= sizeof(buf))
 		len = sizeof(buf) - 1;
 	memcpy(buf, text, len);
 	buf[len] = 0;
<a href="#h1-1-13" id="h1-1-13" class="d">-
</a> 	h = dc.font.ascent + dc.font.descent;
 	y = dc.y + (dc.h / 2) - (h / 2) + dc.font.ascent;
 	x = dc.x + (h / 2);
<a href="#h1-1-17" id="h1-1-17" class="d">-
</a> 	/* shorten text if necessary */
 	while(len &amp;&amp; (w = textnw(buf, len)) &gt; dc.w - h)
 		buf[--len] = 0;
<a href="#h1-2" id="h1-2" class="h">@@ -58,10 +53,8 @@ drawtext(const char *text, unsigned long col[ColLast]) {
</a> 		if(len &gt; 3)
 			buf[len - 3] = &#39;.&#39;;
 	}
<a href="#h1-2-3" id="h1-2-3" class="d">-
</a> 	if(w &gt; dc.w)
 		return; /* too long */
<a href="#h1-2-6" id="h1-2-6" class="d">-
</a> 	gcv.foreground = col[ColFG];
 	if(dc.font.set) {
 		XChangeGC(dpy, dc.gc, GCForeground, &amp;gcv);
<a href="#h1-3" id="h1-3" class="h">@@ -106,7 +99,6 @@ setfont(const char *fontstr) {
</a> 		XFontSetExtents *font_extents;
 		XFontStruct **xfonts;
 		char **font_names;
<a href="#h1-3-3" id="h1-3-3" class="d">-
</a> 		dc.font.ascent = dc.font.descent = 0;
 		font_extents = XExtentsOfFontSet(dc.font.set);
 		n = XFontsOfFontSet(dc.font.set, &amp;xfonts, &amp;font_names);
<b>diff --git a/<a id="h2" href="../file/main.c.html">main.c</a> b/<a href="../file/main.c.html">main.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,4 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-/*
</a><a href="#h2-0-1" id="h2-0-1" class="d">- * (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h2-0-2" id="h2-0-2" class="i">+/* (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a>  * (C)opyright MMVI Sander van Dijk &lt;a dot h dot vandijk at gmail dot com&gt;
  * See LICENSE file for license details.
  */
<a href="#h2-1" id="h2-1" class="h">@@ -47,7 +46,6 @@ calcoffsets(void) {
</a> 
 	if(!curr)
 		return;
<a href="#h2-1-3" id="h2-1-3" class="d">-
</a> 	w = cmdw + 2 * SPACE;
 	for(next = curr; next; next=next-&gt;right) {
 		tw = textw(next-&gt;text);
<a href="#h2-2" id="h2-2" class="h">@@ -57,7 +55,6 @@ calcoffsets(void) {
</a> 		if(w &gt; mw)
 			break;
 	}
<a href="#h2-2-3" id="h2-2-3" class="d">-
</a> 	w = cmdw + 2 * SPACE;
 	for(prev = curr; prev &amp;&amp; prev-&gt;left; prev=prev-&gt;left) {
 		tw = textw(prev-&gt;left-&gt;text);
<a href="#h2-3" id="h2-3" class="h">@@ -78,18 +75,15 @@ drawmenu(void) {
</a> 	dc.w = mw;
 	dc.h = mh;
 	drawtext(NULL, dc.norm);
<a href="#h2-3-3" id="h2-3-3" class="d">-
</a> 	/* print command */
 	if(cmdw &amp;&amp; item)
 		dc.w = cmdw;
 	drawtext(text[0] ? text : NULL, dc.norm);
 	dc.x += cmdw;
<a href="#h2-3-9" id="h2-3-9" class="d">-
</a> 	if(curr) {
 		dc.w = SPACE;
 		drawtext((curr &amp;&amp; curr-&gt;left) ? &quot;&lt;&quot; : NULL, dc.norm);
 		dc.x += dc.w;
<a href="#h2-3-14" id="h2-3-14" class="d">-
</a> 		/* determine maximum items */
 		for(i = curr; i != next; i=i-&gt;right) {
 			dc.w = textw(i-&gt;text);
<a href="#h2-4" id="h2-4" class="h">@@ -98,7 +92,6 @@ drawmenu(void) {
</a> 			drawtext(i-&gt;text, (sel == i) ? dc.sel : dc.norm);
 			dc.x += dc.w;
 		}
<a href="#h2-4-3" id="h2-4-3" class="d">-
</a> 		dc.x = mw - SPACE;
 		dc.w = SPACE;
 		drawtext(next ? &quot;&gt;&quot; : NULL, dc.norm);
<a href="#h2-5" id="h2-5" class="h">@@ -114,11 +107,9 @@ match(char *pattern) {
</a> 
 	if(!pattern)
 		return;
<a href="#h2-5-3" id="h2-5-3" class="d">-
</a> 	plen = strlen(pattern);
 	item = j = NULL;
 	nitem = 0;
<a href="#h2-5-7" id="h2-5-7" class="d">-
</a> 	for(i = allitems; i; i=i-&gt;next)
 		if(!plen || !strncmp(pattern, i-&gt;text, plen)) {
 			if(!j)
<a href="#h2-6" id="h2-6" class="h">@@ -142,7 +133,6 @@ match(char *pattern) {
</a> 			j = i;
 			nitem++;
 		}
<a href="#h2-6-3" id="h2-6-3" class="d">-
</a> 	curr = prev = next = sel = item;
 	calcoffsets();
 }
<a href="#h2-7" id="h2-7" class="h">@@ -157,12 +147,10 @@ kpress(XKeyEvent * e) {
</a> 	len = strlen(text);
 	buf[0] = 0;
 	num = XLookupString(e, buf, sizeof(buf), &amp;ksym, 0);
<a href="#h2-7-3" id="h2-7-3" class="d">-
</a> 	if(IsFunctionKey(ksym) || IsKeypadKey(ksym)
 			|| IsMiscFunctionKey(ksym) || IsPFKey(ksym)
 			|| IsPrivateKeypadKey(ksym))
 		return;
<a href="#h2-7-8" id="h2-7-8" class="d">-
</a> 	/* first check if a control mask is omitted */
 	if(e-&gt;state &amp; ControlMask) {
 		switch (ksym) {
<a href="#h2-8" id="h2-8" class="h">@@ -261,7 +249,6 @@ readstdin(void) {
</a> 			maxname = p;
 			max = len;
 		}
<a href="#h2-8-3" id="h2-8-3" class="d">-
</a> 		new = emalloc(sizeof(Item));
 		new-&gt;next = new-&gt;left = new-&gt;right = NULL;
 		new-&gt;text = p;
<a href="#h2-9" id="h2-9" class="h">@@ -318,7 +305,6 @@ main(int argc, char *argv[]) {
</a> 		}
 		else
 			eprint(&quot;usage: dmenu [-font &lt;name&gt;] [-{norm,sel}{bg,fg} &lt;color&gt;] [-t &lt;seconds&gt;] [-v]\n&quot;, stdout);
<a href="#h2-9-3" id="h2-9-3" class="d">-
</a> 	dpy = XOpenDisplay(0);
 	if(!dpy)
 		eprint(&quot;dmenu: cannot open display\n&quot;);
<a href="#h2-10" id="h2-10" class="h">@@ -333,44 +319,37 @@ main(int argc, char *argv[]) {
</a> 	while(XGrabKeyboard(dpy, root, True, GrabModeAsync,
 			 GrabModeAsync, CurrentTime) != GrabSuccess)
 		usleep(1000);
<a href="#h2-10-3" id="h2-10-3" class="d">-
</a> 	FD_ZERO(&amp;rd);
 	FD_SET(STDIN_FILENO, &amp;rd);
 	if(select(ConnectionNumber(dpy) + 1, &amp;rd, NULL, NULL, &amp;timeout) &lt; 1)
 		goto UninitializedEnd;
 	maxname = readstdin();
<a href="#h2-10-9" id="h2-10-9" class="d">-
</a> 	/* style */
 	dc.norm[ColBG] = getcolor(normbg);
 	dc.norm[ColFG] = getcolor(normfg);
 	dc.sel[ColBG] = getcolor(selbg);
 	dc.sel[ColFG] = getcolor(selfg);
 	setfont(font);
<a href="#h2-10-16" id="h2-10-16" class="d">-
</a><a href="#h2-10-17" id="h2-10-17" class="i">+	/* menu window */
</a> 	wa.override_redirect = 1;
 	wa.background_pixmap = ParentRelative;
 	wa.event_mask = ExposureMask | ButtonPressMask | KeyPressMask;
<a href="#h2-10-21" id="h2-10-21" class="d">-
</a> 	mx = my = 0;
 	mw = DisplayWidth(dpy, screen);
 	mh = dc.font.height + 2;
<a href="#h2-10-25" id="h2-10-25" class="d">-
</a> 	win = XCreateWindow(dpy, root, mx, my, mw, mh, 0,
 			DefaultDepth(dpy, screen), CopyFromParent,
 			DefaultVisual(dpy, screen),
 			CWOverrideRedirect | CWBackPixmap | CWEventMask, &amp;wa);
 	XDefineCursor(dpy, win, XCreateFontCursor(dpy, XC_xterm));
<a href="#h2-10-31" id="h2-10-31" class="d">-
</a> 	/* pixmap */
 	dc.drawable = XCreatePixmap(dpy, root, mw, mh, DefaultDepth(dpy, screen));
 	dc.gc = XCreateGC(dpy, root, 0, 0);
 	XSetLineAttributes(dpy, dc.gc, 1, LineSolid, CapButt, JoinMiter);
<a href="#h2-10-36" id="h2-10-36" class="d">-
</a> 	if(maxname)
 		cmdw = textw(maxname);
 	if(cmdw &gt; mw / 3)
 		cmdw = mw / 3;
<a href="#h2-10-41" id="h2-10-41" class="d">-
</a> 	text[0] = 0;
 	match(text);
 	XMapRaised(dpy, win);
<a href="#h2-11" id="h2-11" class="h">@@ -392,6 +371,7 @@ main(int argc, char *argv[]) {
</a> 		}
 	}
 
<a href="#h2-11-3" id="h2-11-3" class="i">+	/* cleanup */
</a> 	while(allitems) {
 		itm = allitems-&gt;next;
 		free(allitems-&gt;text);
<a href="#h2-12" id="h2-12" class="h">@@ -408,6 +388,5 @@ main(int argc, char *argv[]) {
</a> UninitializedEnd:
 	XUngrabKeyboard(dpy, CurrentTime);
 	XCloseDisplay(dpy);
<a href="#h2-12-3" id="h2-12-3" class="d">-
</a> 	return ret;
 }
<b>diff --git a/<a id="h3" href="../file/util.c.html">util.c</a> b/<a href="../file/util.c.html">util.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,5 +1,4 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-/*
</a><a href="#h3-0-1" id="h3-0-1" class="d">- * (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h3-0-2" id="h3-0-2" class="i">+/* (C)opyright MMVI Anselm R. Garbe &lt;garbeam at gmail dot com&gt;
</a>  * See LICENSE file for license details.
  */
 #include &quot;dmenu.h&quot;
<a href="#h3-1" id="h3-1" class="h">@@ -22,6 +21,7 @@ badmalloc(unsigned int size) {
</a> void *
 emalloc(unsigned int size) {
 	void *res = malloc(size);
<a href="#h3-1-3" id="h3-1-3" class="i">+
</a> 	if(!res)
 		badmalloc(size);
 	return res;
<a href="#h3-2" id="h3-2" class="h">@@ -40,6 +40,7 @@ eprint(const char *errstr, ...) {
</a> char *
 estrdup(const char *str) {
 	void *res = strdup(str);
<a href="#h3-2-3" id="h3-2-3" class="i">+
</a> 	if(!res)
 		badmalloc(strlen(str));
 	return res;
</pre>
</div>
</body>
</html>
